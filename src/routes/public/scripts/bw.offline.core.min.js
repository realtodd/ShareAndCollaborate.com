"use strict";function cmdOfflineDeviceSynchronization(){displayAlertDialog('The offline request device synchronization feature is incomplete.<br /><br />Coming soon!<br /><br /><span style="font-style:italic;font-size:20pt;line-height:0.1em;">[This feature is going to allow you to synchronize your requests across devices, without logging in.]<\/span>')}function loadXslFiles(){var n=[],t;n=[];n.push(["/views/UnsubmittedBudgetRequest.xsl","UnsubmittedBudgetRequest"]);n.push(["/views/UnsubmittedQuoteRequest.xsl","UnsubmittedQuoteRequest"]);n.push(["/views/UnsubmittedReimbursementRequest.xsl","UnsubmittedReimbursementRequest"]);n.push(["/views/UnsubmittedRecurringExpense.xsl","UnsubmittedRecurringExpense"]);n.push(["/viewsIos8/UnsubmittedBudgetRequest.xsl","UnsubmittedBudgetRequestIos8"]);n.push(["/viewsIos8/UnsubmittedQuoteRequest.xsl","UnsubmittedQuoteRequestIos8"]);n.push(["/viewsIos8/UnsubmittedReimbursementRequest.xsl","UnsubmittedReimbursementRequestIos8"]);n.push(["/viewsIos8/UnsubmittedRecurringExpense.xsl","UnsubmittedRecurringExpenseIos8"]);n.push(["/viewsPrintableHtml/UnsubmittedBudgetRequestPrintableHtml.xsl","UnsubmittedBudgetRequestPrintableHtml"]);n.push(["/viewsPrintableHtml/UnsubmittedQuoteRequestPrintableHtml.xsl","UnsubmittedQuoteRequestPrintableHtml"]);n.push(["/viewsPrintableHtml/UnsubmittedReimbursementRequestPrintableHtml.xsl","UnsubmittedReimbursementRequestPrintableHtml"]);n.push(["/viewsPrintableHtml/UnsubmittedRecurringExpensePrintableHtml.xsl","UnsubmittedRecurringExpensePrintableHtml"]);t=bwIndexedDB.open(indexDBName,dbVersion);t.onblocked=function(n){console.log("In bw.offline.core.js.loadXslFiles().request.onblocked: indexDB BLOCKED1. errorCode: "+n.target.errorCode)};t.onerror=function(n){console.log("In bw.offline.core.js.loadXslFiles().request.onerror: Error opening IndexedDB database1. errorCode: "+n.target.errorCode)};t.onsuccess=function(t){var r=t.target.result,i;for(r.onerror=function(n){console.log("In bw.offline.core.js.loadXslFiles().request.onsuccess.db.onerror: ERRRRRRRRRRRRRRRRRRRR: This may not happen in other browsers and unique to edge, but not confirmed (todd): "+n.message+", "+n.target.errorMessage+", "+n.target.name)},i=0;i<n.length;i++)getXsltAndStoreInDatabase(r,n[i][0],n[i][1])}}function getXsltAndStoreInDatabase(n,t,i){var r=new XMLHttpRequest,u,f;r.onreadystatechange=function(){try{if(r.status==200&&r.readyState==4){u=r.response;console.log('Attempting to put Xsl file "'+t+'" as "'+i+'" into IndexedDB. blob length: '+u.length);var e=""+i,o=n.transaction("objectStoreCachedXsltFiles","readwrite").objectStore("objectStoreCachedXsltFiles").add(u,e).onsuccess=function(){console.log("SUCCESSSSSSSSSSSSSS: Stored "+t+" as "+i)}}}catch(f){console.log("Error in getXsltAndStoreInDatabase.xhr.onreadystatechange(): "+f.message+", "+f.stack)}};f=globalUrlPrefix+globalUrlForWebServices+t;r.open("GET",f,!0);r.responseType="text";r.send()}function recordAudioOffline(){displayAlertDialog('This functionality is incomplete. Select the "Choose file..." button in order to record and upload an audio file on your device.');var n=document.getElementById("divAlertDialog_AdditionalButtons");n.style.visibility="visible"}function takePictureOffline(){displayAlertDialog('This functionality is incomplete. Select the "Choose file..." button in order to take a picture and upload it to your device.');var n=document.getElementById("divAlertDialog_AdditionalButtons");n.style.visibility="visible"}function cmdSaveDraftVersionOfTheOfflineAr(){var n,t;try{n=document.getElementById("OfflineRequestBudgetRequestIdInXslForm").innerHTML;console.log("In bw.offline.core.js.cmdSaveDraftVersionOfTheOfflineAr(). BudgetRequestId: "+n);t=bwIndexedDB.open(indexDBName,dbVersion);t.onblocked=function(n){console.log("In bw.offline.core.js.cmdSaveDraftVersionOfTheOfflineAr(): indexDB BLOCKED1. errorCode: "+n.target.errorCode);displayAlertDialog("In cmdSaveDraftVersionOfTheOfflineAr(): indexDB BLOCKED1. errorCode: "+n.target.errorCode)};t.onerror=function(n){console.log("In bw.offline.core.js.cmdSaveDraftVersionOfTheOfflineAr(). Error creating/accessing IndexedDB database1. errorCode: "+n.target.errorCode);displayAlertDialog("In cmdSaveDraftVersionOfTheOfflineAr(). Error creating/accessing IndexedDB database1. errorCode: "+n.target.errorCode)};t.onsuccess=function(t){var i=t.target.result,r;console.log('In bw.offline.core.js.cmdSaveDraftVersionOfTheOfflineAr(). Successfully opened the database "'+t.target.result.name+'".');i.onerror=function(t){console.log("Error in bw.offline.core.js.cmdSaveDraftVersionOfTheOfflineAr("+n+").request.onsuccess.db.onerror: "+t.target.result.name+", errorCode: "+t.target.errorCode);displayAlertDialog("Error in bw.offline.core.js.cmdSaveDraftVersionOfTheOfflineAr("+n+").request.onsuccess.db.onerror: "+t.target.result.name+", errorCode: "+t.target.errorCode)};r=i.transaction("objectStoreCachedRequests","readwrite").objectStore("objectStoreCachedRequests");r.openCursor().onsuccess=function(t){var i,f,e,o;try{if(i=t.target.result,i){if(i.value.bwBudgetRequestId==n)if(f=createXmlDocument_SaveDraftOfflineAr(n),f=="FAILED")displayAlertDialog("Failed to create XML.");else{e=document.getElementById("strProjectTitleInXslForm").innerHTML;i.value.RequestedCapital=document.getElementById("dblRequestedCapitalInXslForm2").innerHTML.replace("<br>","");console.log("projectTitle: "+e+", cursor.value.RequestedCapital: "+i.value.RequestedCapital);var s=getCreatedTimestamp(),h=getDueDateTimestamp(),r=i.value;r.bwDocumentXml=f;r.ProjectTitle=e;r.RequestedExpense=0;o=i.update(r);o.onsuccess=function(){console.log("In bw.offline.core.js.cmdSaveDraftVersionOfTheOfflineAr(). Successfully updated the budget request.");$("#divOfflineRequestFormDialog").dialog("close");Platform=="IOS8"?renderWelcomePageOffline():populateStartPageItem("divArchiveOffline","Reports","")};o.onerror=function(){console.log("In bw.offline.core.js.cmdSaveDraftVersionOfTheOfflineAr(). Error storing _budgetRequest in the database."+this.error);displayAlertDialog("In cmdSaveDraftVersionOfTheOfflineAr(). Error storing _budgetRequest in the database."+this.error)}}i.continue()}else console.log("In bw.offline.core.js.cmdSaveDraftVersionOfTheOfflineAr("+n+").request.onsuccess.objectStore.openCursor().onsuccess. DONE LOOPING through the cursor.")}catch(u){console.log("Exception in bw.offline.core.js.cmdSaveDraftVersionOfTheOfflineAr("+n+"). #1:"+u.message+", "+u.stack);displayAlertDialog("Exception in cmdSaveDraftVersionOfTheOfflineAr("+n+"). #1:"+u.message+", "+u.stack)}console.log("In bw.offline.core.js.cmdSaveDraftVersionOfTheOfflineAr("+n+"). Stored new request in IndexedDB:2.")}}}catch(i){console.log("Exception in bw.offline.core.js.cmdSaveDraftVersionOfTheOfflineAr("+n+"): "+i.message+", "+i.stack);displayAlertDialog("Exception in cmdSaveDraftVersionOfTheOfflineAr("+n+"): "+i.message+", "+i.stack)}}function cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest(){var n,i;try{console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest().");n=document.getElementById("OfflineRequestBudgetRequestIdInXslForm").innerHTML;console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest(). BudgetRequestId: "+n);console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest().  BEFORE ANYTHING HAPPENS, WE HAVE TO START UPLOADING THE ATTACHMENTS!!!!!!!!!!!!!!!!!!!!!!");try{console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").");i=bwIndexedDB.open(indexDBName,dbVersion);i.onblocked=function(t){console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onblocked. errorCode: "+t.target.errorCode);displayAlertDialog("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onblocked. errorCode: "+t.target.errorCode)};i.onerror=function(t){console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onerror. Error creating/accessing IndexedDB database1. errorCode: "+t.target.errorCode);displayAlertDialog("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onerror. Error creating/accessing IndexedDB database1. errorCode: "+t.target.errorCode)};i.onsuccess=function(t){var i=t.target.result,r;console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+').request.onsuccess. Successfully opened the database "'+t.target.result.name+'".');i.onerror=function(t){console.log("Error in bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.db.onerror: "+t.target.result.name+", errorCode: "+t.target.errorCode);displayAlertDialog("Error in bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.db.onerror: "+t.target.result.name+", errorCode: "+t.target.errorCode)};r=i.transaction("OfflineAttachedFiles").objectStore("OfflineAttachedFiles");r.openCursor().onsuccess=function(t){var r,e,a,v,u,s,h,g,y,p,tt,pt,o,d,f;try{if(r=t.target.result,r){if(r.value.bwBudgetRequestId==n)if(r.value.encodingType=="uInt8Array"){for(console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+"): fileName: "+r.value.fileName+", encodingType: "+r.value.encodingType),e=atob(r.value.fileContents),a=new Uint8Array(e.length),u=0,s=e.length;u<s;++u)a[u]=e.charCodeAt(u);for(v="",u=0,s=e.length;u<s;++u)v+=String.fromCharCode(a[u]);h=[];h={bwWorkflowAppId:workflowAppId,bwBudgetRequestId:n,Filename:r.value.fileName,FileContent:v,Description:r.value.fileDescription};f=globalUrlPrefix+globalUrlForWebServices+"/_files/uploadattachment";console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+"). Preparing to upload using operationUri1: "+f+", fileAndData: "+JSON.stringify(h));$.ajax({url:f,type:"PUT",data:h,headers:{Accept:"application/json; odata=verbose"},success:function(t){console.log("in bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+"). SUCCESSS UPLOADING FILE-v4-! response data: "+JSON.stringify(t))},error:function(t,i,r){console.log("Error in bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+"): data1: "+JSON.stringify(t)+", errorCode: "+i+", errorMessage: "+r);displayAlertDialog("Error in bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+"): data1: "+JSON.stringify(t)+", errorCode: "+i+", errorMessage: "+r)}})}else r.value.encodingType=="blob"?(console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+"): fileName: "+r.value.fileName+", encodingType: "+r.value.encodingType),navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)?console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+"): NO SUPPORT FOR iPhone or iPad YET!!!!!!!!!!"):typeof FileReader=="undefined"?console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+"): UNAVAILABLE OBJECT: FileReader!!!!!!!!!!"):(g=r.value.fileContents,y=new FileReader,y.onload=function(t){for(var u,f,e="",s=t.target.result,o=new Uint8Array(s),i=0;i<o.byteLength;i++)e+=String.fromCharCode(o[i]);u=[];u={bwWorkflowAppId:workflowAppId,bwBudgetRequestId:n,Filename:r.value.fileName,FileContent:e,Description:r.value.fileDescription};f=globalUrlPrefix+globalUrlForWebServices+"/_files/uploadattachment";console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+"). Preparing to upload using operationUri: "+f);$.ajax({url:f,type:"PUT",data:u,headers:{Accept:"application/json; odata=verbose"},success:function(t){console.log("in bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+"). SUCCESSS UPLOADING FILE! response data: "+JSON.stringify(t))},error:function(t,i,r){console.log("Error in bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+"): data: "+JSON.stringify(t)+", errorCode: "+i+", errorMessage: "+r);displayAlertDialog("Error in bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+"): data: "+JSON.stringify(t)+", errorCode: "+i+", errorMessage: "+r)}})},y.readAsArrayBuffer(g))):console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+"): UNKNOWN file encodingType in indexDB. fileName: "+fileName+", encodingType: "+r.value.encodingType);r.continue()}else{console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.objectStore.openCursor().onsuccess. DONE LOOPING through the cursor.");p=!1;try{$("#selectNewRequestFormRequestTypeDropDown option:selected").val()=="recurringexpense"&&(p=!0)}catch(c){}if(p==!0){var nt=document.getElementById("RecurringExpenseId").innerHTML,w="",l=document.getElementById("dtRecurringExpenseReminderDate").value;if(l=="")w="";else{var b=new Date,ht=l.split("/")[2],ct=l.split("/")[0],lt=l.split("/")[1],at=b.getHours(),vt=b.getMinutes(),yt=b.getSeconds();w=ht+"-"+ct+"-"+lt+"T:"+at+":"+vt+":"+yt}if(tt=document.getElementById("cbNewRequestRecurringExpenseSubmitImmediately").checked,validateCapexForm2()){var o=createXmlDocument_InitRecurringExpense(nt),it=document.getElementById("strProjectTitle").value,rt=[],ut=document.getElementById("ddlFunctionalArea").value.split("|")[0],ft=document.getElementById("txtProjectManagerId").value,et=document.getElementById("dblRequestedCapital").value.replace(/[^0-9-.]/g,""),ot=0;rt={submitTheFirstRecurringExpenseImmediately:tt,bwRecurringExpenseId:nt,bwTenantId:tenantId,bwWorkflowAppId:workflowAppId,bwWorkflowId:null,CreatedBy:participantFriendlyName,CreatedById:participantId,CreatedByEmail:participantEmail,ReminderDate:w,bwDocumentXml:o.toString(),ProjectTitle:it.toString(),BudgetAmount:null,RequestedCapital:et,RequestedExpense:ot,FunctionalAreaId:ut,Quote:"false",ManagerId:ft};f=webserviceurl+"/bwbudgetrequests/saveanewrecurringxpense";$.ajax({url:f,type:"POST",timeout:ajaxTimeout,data:rt,headers:{Accept:"application/json; odata=verbose"},success:function(n){displayAlertDialog(n);clearNewBudgetRequestFormFields();populateStartPageItem("divWelcome","Reports","")},error:function(n){console.log("Error creating the budget request in budgetrequests library:1: "+JSON.stringify(n));displayAlertDialog("Error creating the budget request in budgetrequests library:1: "+JSON.stringify(n))}})}}else if(console.log("This is NOT a recurring expense, just a regular budget request!"),pt=n+".xml",validateCapexForm2())if(console.log("In cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest(). Preparing to launch createXmlDocument_InitArFromOfflineRequest("+n+")."),o=createXmlDocument_InitArFromOfflineRequest(n),console.log("In cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest(). Returned from createXmlDocument_InitArFromOfflineRequest(). xmlDocument: "+o),o=="FAILED")displayAlertDialog("Failed to create XML.");else{var it=document.getElementById("strProjectTitleInXslForm").innerHTML,k=[],ut=document.getElementById("ddlFunctionalAreaInXslForm").value.split("|")[0],ft=document.getElementById("txtProjectManagerIdInXslForm").innerHTML,et=document.getElementById("dblRequestedCapitalInXslForm2").innerHTML.replace(/[^0-9-.]/g,""),ot=0,wt=getCreatedTimestamp(),bt=getDueDateTimestamp(),st=!1;$("#selectNewRequestFormRequestTypeDropDown option:selected").val()=="quoterequest"&&(st=!0);d=!1;$("#selectNewRequestFormRequestTypeDropDown option:selected").val()=="expenserequest"&&(d=!0);k={bwBudgetRequestId:n.toString(),bwTenantId:tenantId,bwWorkflowAppId:workflowAppId,bwWorkflowId:null,IsSupplementalRequest:"false",RelatedBudgetRequestId:null,IsRecurringExpense:"false",RelatedRecurringExpenseId:null,CreatedBy:participantEmail,CreatedById:participantId,CreatedByEmail:participantEmail,ProjectTitle:it.toString(),BudgetAmount:null,RequestedCapital:et,RequestedExpense:ot,FunctionalAreaId:ut,ARStatus:"Submitted",BudgetWorkflowStatus:"Admin",Quote:st,bwBudgetRequestPlaceholder1:d,ManagerId:ft,bwDocumentXml:o.toString(),bwWorkflowToken:"0"};f=webserviceurl+"/bwbudgetrequests/initbudgetrequest";console.log("SENDING POST TO INITIALIZE A BUDGET REQUEST!!!! /bwbudgetrequests/initbudgetrequest");$.ajax({url:f,type:"POST",timeout:ajaxTimeout,data:k,headers:{Accept:"application/json; odata=verbose"},success:function(){displayAlertDialog("The budget request has been submitted");console.log("The budget request has been submitted: "+JSON.stringify(k));clearNewBudgetRequestFormFields();$("#divOfflineRequestFormDialog").dialog("close");var t=i.transaction("objectStoreCachedRequests").objectStore("objectStoreCachedRequests");t.openCursor().onsuccess=function(t){var r,e,f;try{r=t.target.result;r?(r.value.bwBudgetRequestId==n&&(e=i.transaction("objectStoreCachedRequests","readwrite"),f=e.objectStore("objectStoreCachedRequests").delete(r.primaryKey),f.onsuccess=function(){console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.objectStoreCachedRequests.openCursor().onsuccess.del.onsuccess. Successfully deleted request from the database.");var t=i.transaction("OfflineAttachedFiles").objectStore("OfflineAttachedFiles");t.openCursor().onsuccess=function(t){var r,e,f;try{r=t.target.result;r?(r.value.bwBudgetRequestId==n&&(e=i.transaction("OfflineAttachedFiles","readwrite"),f=e.objectStore("OfflineAttachedFiles").delete(r.primaryKey),f.onsuccess=function(){console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.objectStoreOfflineAttachedFiles.openCursor().onsuccess.del2.onsuccess. Successfully deleted attachment from the database.")},f.onerror=function(){console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.objectStoreOfflineAttachedFiles.openCursor().onsuccess.del2.onerror. Error deleting attachment from the database: "+this.error);console.error("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.objectStoreOfflineAttachedFiles.openCursor().onsuccess.del2.onerror. Error deleting attachment from the database.",this.error);displayAlertDialog("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.objectStoreOfflineAttachedFiles.openCursor().onsuccess.del2.onerror. Error deleting attachment from the database: "+this.error)}),r.continue()):console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.objectStoreOfflineAttachedFiles.openCursor().onsuccess. DONE LOOPING.")}catch(u){console.log("Exception in bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.objectStoreOfflineAttachedFiles.openCursor().onsuccess: "+u.message+", "+u.stack);displayAlertDialog("Exception in bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.objectStoreOfflineAttachedFiles.openCursor().onsuccess: "+u.message+", "+u.stack)}}},f.onerror=function(){console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.objectStoreCachedRequests.openCursor().onsuccess.del.onerror. Error deleting attachment from the database: "+this.error);console.error("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.objectStoreCachedRequests.openCursor().onsuccess.del.onerror. Error deleting attachment from the database.",this.error);displayAlertDialog("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.objectStoreCachedRequests.openCursor().onsuccess.del.onerror. Error deleting attachment from the database: "+this.error)}),r.continue()):console.log("In bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.objectStoreCachedRequests.openCursor().onsuccess. DONE LOOPING.")}catch(u){console.log("Exception in bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.objectStoreCachedRequests.openCursor().onsuccess: "+u.message+", "+u.stack);displayAlertDialog("Exception in bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.objectStoreCachedRequests.openCursor().onsuccess: "+u.message+", "+u.stack)}}},error:function(n){displayAlertDialog("Error creating the budget request in budgetrequests library. "+JSON.stringify(n));displayAlertDialog("Error creating the budget request in budgetrequests library. "+JSON.stringify(n))}})}else console.log("Unexpected error: Validation failed for some reason. validateCapexForm2 did not return true."),displayAlertDialog("Unexpected error: Validation failed for some reason. validateCapexForm2 did not return true.")}}catch(c){console.log("Exception in bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.objectStore.openCursor().onsuccess: "+c.message+", "+c.stack);displayAlertDialog("Exception in bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+").request.onsuccess.objectStore.openCursor().onsuccess: "+c.message+", "+c.stack)}}}}catch(t){console.log("Exception in bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+"): "+t.message+", "+t.stack);displayAlertDialog("Exception in bw.offline.core.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest("+n+"): "+t.message+", "+t.stack)}}catch(t){console.log("Exception in ios8.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest(): "+t.message+", "+t.stack);displayAlertDialog("Exception in ios8.js.cmdCreateBudgetRequestAndStartWorkflowFromOfflineRequest(): "+t.message+", "+t.stack)}}function PerformUploadOfOfflineAttachments(n){try{console.log("In bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+").");var t=bwIndexedDB.open(indexDBName,dbVersion);t.onblocked=function(t){console.log("In bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+").request.onblocked. errorCode: "+t.target.errorCode)};t.onerror=function(t){console.log("In bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+").request.onerror. Error creating/accessing IndexedDB database1. errorCode: "+t.target.errorCode)};t.onsuccess=function(t){var i=t.target.result,r;console.log("In bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+').request.onsuccess. Successfully opened the database "'+t.target.result.name+'".');i.onerror=function(t){console.log("Error in bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+").request.onsuccess.db.onerror: "+t.target.result.name+", errorCode: "+t.target.errorCode)};r=i.transaction("OfflineAttachedFiles").objectStore("OfflineAttachedFiles");r.openCursor().onsuccess=function(t){var i,u,o,s,r,f,e,h,l,c;try{if(i=t.target.result,i){if(i.value.bwBudgetRequestId==n)if(i.value.encodingType=="uInt8Array"){for(console.log("In bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+"): fileName: "+i.value.fileName+", encodingType: "+i.value.encodingType),u=atob(i.value.fileContents),o=new Uint8Array(u.length),r=0,f=u.length;r<f;++r)o[r]=u.charCodeAt(r);for(s="",r=0,f=u.length;r<f;++r)s+=String.fromCharCode(o[r]);e=[];e={bwWorkflowAppId:workflowAppId,bwBudgetRequestId:n,Filename:i.value.fileName,FileContent:s,Description:i.value.fileDescription};h=globalUrlPrefix+globalUrlForWebServices+"/_files/uploadattachment";console.log("In bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+"). Preparing to upload using operationUri1: "+h+", fileAndData: "+JSON.stringify(e));$.ajax({url:h,type:"PUT",data:e,headers:{Accept:"application/json; odata=verbose"},success:function(t){console.log("in bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+"). SUCCESSS UPLOADING FILE-v4-! response data: "+JSON.stringify(t))},error:function(t,i,r){console.log("Error in bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+"): data1: "+JSON.stringify(t)+", errorCode: "+i+", errorMessage: "+r)}})}else i.value.encodingType=="blob"?(console.log("In bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+"): fileName: "+i.value.fileName+", encodingType: "+i.value.encodingType),navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)?console.log("In bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+"): NO SUPPORT FOR iPhone or iPad YET!!!!!!!!!!"):typeof FileReader=="undefined"?console.log("In bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+"): UNAVAILABLE OBJECT: FileReader!!!!!!!!!!"):(l=i.value.fileContents,c=new FileReader,c.onload=function(t){for(var r,f,e="",s=t.target.result,o=new Uint8Array(s),u=0;u<o.byteLength;u++)e+=String.fromCharCode(o[u]);r=[];r={bwWorkflowAppId:workflowAppId,bwBudgetRequestId:n,Filename:i.value.fileName,FileContent:e,Description:i.value.fileDescription};f=globalUrlPrefix+globalUrlForWebServices+"/_files/uploadattachment";console.log("In bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+"). Preparing to upload using operationUri: "+f+", fileAndData: "+JSON.stringify(r));$.ajax({url:f,type:"PUT",data:r,headers:{Accept:"application/json; odata=verbose"},success:function(t){console.log("in bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+"). SUCCESSS UPLOADING FILE! response data: "+JSON.stringify(t))},error:function(t,i,r){console.log("Error in bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+"): data: "+JSON.stringify(t)+", errorCode: "+i+", errorMessage: "+r)}})},c.readAsArrayBuffer(l))):console.log("In bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+"): UNKNOWN file encodingType in indexDB. fileName: "+fileName+", encodingType: "+i.value.encodingType);i.continue()}else console.log("In bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+").request.onsuccess.objectStore.openCursor().onsuccess. DONE LOOPING through the cursor.")}catch(a){console.log("Exception in bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+").request.onsuccess.objectStore.openCursor().onsuccess: "+a.message+", "+a.stack)}}}}catch(i){console.log("Exception in bw.offline.core.js.PerformUploadOfOfflineAttachments("+n+"): "+i.message+", "+i.stack)}}function ProcessOfflineUpload(n,t,i){var f,r,u;try{console.log("In bw.offline.core.js.ProcessOfflineUpload("+n+", "+i+").");f=document.getElementById(t);r=f.files[0];$("#divConfirmFileUploadOfflineDialog").dialog("close");$("#divFileUploadSpinnerDialog").dialog({modal:!0,resizable:!1,closeOnEscape:!0,width:"970px",dialogClass:"no-close",hide:!1,open:function(){$(".ui-widget-overlay").bind("click",function(){$("#divFileUploadSpinnerDialog").dialog("close")})}});$("#divFileUploadSpinnerDialog").dialog().parents(".ui-dialog").find(".ui-dialog-titlebar").remove();document.getElementById("spanFileUploadSpinnerDialogTitle").innerHTML="Uploading "+r.name+"...";console.log("In bw.offline.core.js.ProcessOfflineUpload("+n+", "+i+"). file.name: "+r.name);u=bwIndexedDB.open(indexDBName,dbVersion);u.onblocked=function(n){console.error(n.target);console.log("In bw.offline.core.js.ProcessOfflineUpload().request.onblocked: "+n.target.error.name||n.target.error||n.target.errorCode);displayAlertDialog("In bw.offline.core.js.ProcessOfflineUpload().request.onblocked: "+n.target.error.name||n.target.error||n.target.errorCode)};u.onerror=function(n){console.error(n.target);console.log("In bw.offline.core.js.ProcessOfflineUpload().request.onerror: "+n.target.error.name||n.target.error||n.target.errorCode);displayAlertDialog("In bw.offline.core.js.ProcessOfflineUpload().request.onerror: "+n.target.error.name||n.target.error||n.target.errorCode)};u.onsuccess=function(u){var s,y,h,c,l,a,e,v,p,o;try{if(console.log("In ProcessOfflineUpload().request.onsuccess. Success accessing IndexedDB database."),s=u.target.result,s.onerror=function(n){console.error(n.target);console.log("In bw.offline.core.js.ProcessOfflineUpload().db.onerror: "+n.target.error.name||n.target.error||n.target.errorCode);displayAlertDialog("In bw.offline.core.js.ProcessOfflineUpload().db.onerror: "+n.target.error.name||n.target.error||n.target.errorCode)},y=r.name,h=document.getElementById("txtConfirmFileUploadOfflineDialogFilename").value.trim()==""?r.name:document.getElementById("txtConfirmFileUploadOfflineDialogFilename").value.trim().split(".")[0]+"."+y.split(".")[1],c=document.getElementById("txtConfirmFileUploadOfflineDialogFileDescription").value.trim(),l="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)}),navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i))console.log("THIS IS THE WORKAROUND FOR THE IOS STORING BLOB IN INDEXDB ISSUE"),a=new FileReader,a.onload=function(u){var v=new Uint8Array(u.target.result),o={encodingType:"uInt8Array",fileContents:v,fileName:h,fileDescription:c,bwBudgetRequestId:i,id:l},a,f;console.log("File size: "+r.size+", dbRecord: "+JSON.stringify(o));try{a=s.transaction("OfflineAttachedFiles","readwrite")}catch(e){console.log("ERROR ACCESSING OfflineAttachedFiles DATABASE11!!!!!!!!!!!!"+e.message+", "+e.stack)}try{f=a.objectStore("OfflineAttachedFiles").add(o)}catch(e){console.log("ERROR ACCESSING OfflineAttachedFiles DATABASE22!!!!!!!!!!!!"+e.message+", "+e.stack)}console.log("In bw.offline.core.js.ProcessOfflineUpload(). Successfully executed var put = transaction.objectStore(OfflineAttachedFiles).add(dbRecord);");f.onsuccess=function(){try{console.log("In bw.offline.core.js.ProcessOfflineUpload(). Successfully stored file in the database.");$("#"+t).replaceWith($("#"+t).clone());populateOfflineAttachments(n)}catch(i){displayAlertDialog("Exception in bw.offline.core.js.ProcessOfflineUpload().put.onsuccess: "+i.message+", "+i.stack)}};f.onerror=function(n){console.error(n.target);console.log("In bw.offline.core.js.ProcessOfflineUpload().put.onerror: "+n.target.error.name||n.target.error||n.target.errorCode);displayAlertDialog("In bw.offline.core.js.ProcessOfflineUpload().put.onerror: "+n.target.error.name||n.target.error||n.target.errorCode)};f.transaction.oncomplete=function(){console.log("In bw.offline.core.js.ProcessOfflineUpload().put.transaction.oncomplete.")};f.transaction.onerror=function(n){console.log("In bw.offline.core.js.ProcessOfflineUpload().put.transaction.onerror: "+n.target.error.name||n.target.error||n.target.errorCode);displayAlertDialog("In bw.offline.core.js.ProcessOfflineUpload().put.transaction.onerror: "+n.target.error.name||n.target.error||n.target.errorCode)}},a.readAsArrayBuffer(r);else{console.log("THIS WORKS FOR BLOB APPROACH. NOT ON IOS.");e="";e+="Todd - I currently think this only works for:<br /><br />";e+="- PNG on Mac (Chrome). Safari needs to be fixed!<br />";e+="- PNG on Windows 10 is Ok (IE and Edge).<br />";e+="- iOS - not working.<br />";e+="- Android - not sure.<br />";e+="- Ubuntu (Firefox) - not sure.<br /><br />";console.log(e);v={encodingType:"blob",fileContents:r,fileName:h,fileDescription:c,bwBudgetRequestId:i,id:l};console.log("File size: "+r.size+", dbRecord: "+JSON.stringify(v));try{p=s.transaction("OfflineAttachedFiles","readwrite")}catch(f){f.message=="NotFoundError"?(console.log("In bw.offline.core.js.ProcessOfflineUpload(). The database has been destroyed by the browser, or did not get created properly in the beginning."),displayAlertDialog("In bw.offline.core.js.ProcessOfflineUpload(). The database has been destroyed by the browser, or did not get created properly in the beginning.")):(console.log("In bw.offline.core.js.ProcessOfflineUpload(). ERROR ACCESSING OfflineAttachedFiles DATABASE33!!!!!!!!!!!!"+f.message+", "+f.stack),displayAlertDialog("In bw.offline.core.js.ProcessOfflineUpload(). ERROR ACCESSING OfflineAttachedFiles DATABASE33!!!!!!!!!!!!"+f.message+", "+f.stack))}try{o=p.objectStore("OfflineAttachedFiles").add(v)}catch(f){console.log("In bw.offline.core.js.ProcessOfflineUpload(). Exception performing add on indexDB: "+f.message+", "+f.stack);displayAlertDialog("In bw.offline.core.js.ProcessOfflineUpload(). Exception performing add on indexDB: "+f.message+", "+f.stack)}console.log("In bw.offline.core.js.ProcessOfflineUpload(). Successfully executed var put = transaction.objectStore(OfflineAttachedFiles).add(dbRecord);");o.onsuccess=function(){console.log("In bw.offline.core.js.ProcessOfflineUpload(). Successfully stored file in the database.");populateOfflineAttachments(n)};o.onerror=function(n){console.error(n.target);console.log("In bw.offline.core.js.ProcessOfflineUpload().put.onerror: "+n.target.error.name||n.target.error||n.target.errorCode);displayAlertDialog("In bw.offline.core.js.ProcessOfflineUpload().put.onerror: "+n.target.error.name||n.target.error||n.target.errorCode)};o.transaction.oncomplete=function(){console.log("In bw.offline.core.js.ProcessOfflineUpload().put.transaction.oncomplete.")};o.transaction.onerror=function(n){console.log("In bw.offline.core.js.ProcessOfflineUpload().put.transaction.onerror: "+n.target.error.name||n.target.error||n.target.errorCode);displayAlertDialog("In bw.offline.core.js.ProcessOfflineUpload().put.transaction.onerror: "+n.target.error.name||n.target.error||n.target.errorCode)}}}catch(f){console.log("Exception in bw.offline.core.js.ProcessOfflineUpload(xxx). indexDBName: "+indexDBName+", dbVersion: "+dbVersion+", error: "+f.message+", "+f.stack);displayAlertDialog("Exception in bw.offline.core.js.ProcessOfflineUpload(xxx). indexDBName: "+indexDBName+", dbVersion: "+dbVersion+", error: "+f.message+", "+f.stack)}}}catch(e){displayAlertDialog("Exception In bw.offline.core.js.ProcessOfflineUpload("+n+", "+i+"): "+e.message+", "+e.stack)}}function removeAttachmentOffline(n,t,i,r){try{console.log("In bw.offline.core.js.removeAttachmentOffline("+n+", "+t+", "+i+", "+r+").");$("#divDeleteAnAttachmentOfflineDialog").dialog({modal:!0,resizable:!1,closeText:"Cancel",closeOnEscape:!0,width:"570px",dialogClass:"no-close",hide:!1,open:function(){$(".ui-widget-overlay").bind("click",function(){$("#divDeleteAnAttachmentOfflineDialog").dialog("close")})}});$("#divDeleteAnAttachmentOfflineDialog").dialog().parents(".ui-dialog").find(".ui-dialog-titlebar").remove();document.getElementById("spanDeleteAnAttachmentOfflineDialogTitle").innerHTML="Delete "+n;$("#divDeleteAnAttachmentOfflineDialogDeleteRequestButton").click(function(){var u=bwIndexedDB.open(indexDBName,dbVersion);u.onblocked=function(n){console.log("In bw.offline.core.js.removeAttachmentOffline(' + filename + ', ' + displayAttachmentsTagName + ', ' + _workflowAppId + ', ' + _budgetRequestId + ').request.onblocked. errorCode: "+n.target.errorCode)};u.onerror=function(n){console.log("In bw.offline.core.js.removeAttachmentOffline(' + filename + ', ' + displayAttachmentsTagName + ', ' + _workflowAppId + ', ' + _budgetRequestId + ').request.onerror. Error creating/accessing IndexedDB database1. errorCode: "+n.target.errorCode)};u.onsuccess=function(u){var f=u.target.result,e;console.log("In bw.offline.core.js.removeAttachmentOffline("+n+", "+t+", "+i+", "+r+').request.onsuccess. Successfully opened the database "'+u.target.result.name+'".');f.onerror=function(u){console.log("Error in bw.offline.core.js.removeAttachmentOffline("+n+", "+t+", "+i+", "+r+").request.onsuccess.db.onerror: "+u.target.result.name+", errorCode: "+u.target.errorCode)};e=f.transaction("OfflineAttachedFiles").objectStore("OfflineAttachedFiles");e.openCursor().onsuccess=function(u){var e,s,o;try{e=u.target.result;e?(e.value.bwBudgetRequestId==r&&e.value.fileName==n&&(s=f.transaction("OfflineAttachedFiles","readwrite"),o=s.objectStore("OfflineAttachedFiles").delete(e.primaryKey),o.onsuccess=function(){console.log("In bw.offline.core.js.removeAttachmentOffline("+n+", "+t+", "+i+", "+r+").request.onsuccess.objectStore.openCursor().onsuccess.del.onsuccess. Successfully deleted attachment from the database. displayAttachmentsTagName: "+t);$("#divDeleteAnAttachmentOfflineDialog").dialog("close");populateOfflineAttachments(t);try{$("#divAttachmentsOfflineDialog").dialog("close")}catch(u){}},o.onerror=function(){console.log("In bw.offline.core.js.removeAttachmentOffline("+n+", "+t+", "+i+", "+r+").request.onsuccess.objectStore.openCursor().onsuccess.del.onerror. Error deleting attachment from the database: "+this.error);console.error("In bw.offline.core.js.removeAttachmentOffline("+n+", "+t+", "+i+", "+r+").request.onsuccess.objectStore.openCursor().onsuccess.del.onerror. Error deleting attachment from the database.",this.error)}),e.continue()):console.log("In bw.offline.core.js.removeAttachmentOffline("+n+", "+t+", "+i+", "+r+").request.onsuccess.objectStore.openCursor().onsuccess. DONE LOOPING.")}catch(h){console.log("Exception in bw.offline.core.js.removeAttachmentOffline("+n+", "+t+", "+i+", "+r+").request.onsuccess.objectStore.openCursor().onsuccess: "+h.message+", "+h.stack)}}}})}catch(u){displayAlertDialog("Error in bw.offline.core.js.removeAttachmentOffline("+n+", "+t+", "+i+", "+r+"): "+u.message)}}function cmdSaveAttachmentMetadataOffline(n,t,i){try{console.log("In cmdSaveAttachmentMetadataOffline("+n+", "+t+", "+i+").");var u=document.getElementById("txtAttachmentsOfflineDialogFilename").value+document.getElementById("spanAttachmentsOfflineDialogFileExtension").innerHTML,f=document.getElementById("txtAttachmentsOfflineDialogFileDescription").value.replace(/["']/g,""),r=bwIndexedDB.open(indexDBName,dbVersion);r.onblocked=function(r){console.log("In bw.offline.core.js.cmdSaveAttachmentMetadataOffline("+n+", "+t+", "+i+").request.onblocked. errorCode: "+r.target.errorCode)};r.onerror=function(r){console.log("In bw.offline.core.js.cmdSaveAttachmentMetadataOffline("+n+", "+t+", "+i+").request.onerror. Error creating/accessing IndexedDB database1. errorCode: "+r.target.errorCode)};r.onsuccess=function(r){var e=r.target.result,o;console.log("In bw.offline.core.js.cmdSaveAttachmentMetadataOffline("+n+", "+t+", "+i+').request.onsuccess. Successfully opened the database "'+r.target.result.name+'".');e.onerror=function(n){console.log("Error in bw.offline.core.js.cmdSaveAttachmentMetadataOffline().request.onsuccess.db.onerror: "+n.target.result.name+", errorCode: "+n.target.errorCode)};o=e.transaction("OfflineAttachedFiles","readwrite").objectStore("OfflineAttachedFiles");o.openCursor().onsuccess=function(r){var e,o,s;try{e=r.target.result;e?(e.value.bwBudgetRequestId==n&&e.value.fileName==t&&(console.log("Preparing to update the attachment metadata. newFilename: "+u+", description: "+f),o=e.value,o.fileName=u,o.fileDescription=f,s=e.update(o),s.onsuccess=function(){console.log("In bw.offline.core.js.cmdSaveAttachmentMetadataOffline("+n+", "+t+", "+i+").request.onsuccess.objectStore.openCursor().onsuccess.update.onsuccess. displayAttachmentsTagName: "+i);populateOfflineAttachments(i);try{$("#divAttachmentsOfflineDialog").dialog("close")}catch(r){}},s.onerror=function(){console.error("In bw.offline.core.js.cmdSaveAttachmentMetadataOffline("+n+", "+t+", "+i+").request.onsuccess.objectStore.openCursor().onsuccess.update.onerror. Error deleting attachment from the database: "+this.error);console.error("In bw.offline.core.js.cmdSaveAttachmentMetadataOffline("+n+", "+t+", "+i+").request.onsuccess.objectStore.openCursor().onsuccess.update.onerror. Error deleting attachment from the database.",this.error)}),e.continue()):console.log("In bw.offline.core.js.cmdSaveAttachmentMetadataOffline("+n+", "+t+", "+i+").request.onsuccess.objectStore.openCursor().onsuccess. DONE LOOPING.")}catch(h){console.log("Exception in bw.offline.core.js.cmdSaveAttachmentMetadataOffline("+n+", "+t+", "+i+").request.onsuccess.objectStore.openCursor().onsuccess: "+h.message+", "+h.stack)}}}}catch(e){displayAlertDialog("Error in ios8.js.cmdSaveAttachmentMetadata("+n+", "+t+", "+i+"): "+e.message+", "+e.stack)}}function createXmlDocument_SaveDraftOfflineAr(n){var t='<?xml version="1.0" encoding="UTF-8"?>',r,ot,st,g,ht,ct,u,f,e,lt,s,at,h,vt,c,yt,l,pt,a,wt,v,bt,dt,ni,ii,ui,fi,ut,ft,w,ei,oi,si,b,hi,k,ci,et,li,d,ai,vi,yi;try{r=!1;t+='<my:myFields  xmlns:pc="http://schemas.microsoft.com/office/infopath/2007/PartnerControls" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:my="http://schemas.microsoft.com/office/infopath/2003/myXSD/2012-09-11T20:22:29"  xmlns:xd="http://schemas.microsoft.com/office/infopath/2003">';t+="<my:BudgetRequestId>"+n+"<\/my:BudgetRequestId>";ot=encodeURIComponent(document.getElementById("strProjectTitleInXslForm").innerHTML.replace("<br>",""));t+="<my:Project_Name>"+ot+"<\/my:Project_Name>";st=encodeURIComponent(document.getElementById("strBriefDescriptionOfProjectInXslForm").innerHTML.replace("<br>",""));t+="<my:Brief_Description_of_Project>"+st+"<\/my:Brief_Description_of_Project>";g=document.getElementById("dblRequestedCapitalInXslForm2").innerHTML.replace("<br>","");t+="<my:Requested_Capital>"+g+"<\/my:Requested_Capital>";console.log("Just added this tag from createXmlDocument_SaveDraftOfflineAr(): <my:Requested_Capital>"+g+"<\/my:Requested_Capital>");ht=document.getElementById("dblRequestedExpenseInXslForm2").innerHTML;ct=parseFloat(ht.replace(/[^0-9-.]/g,""));t+='<my:Requested_Expense xsi:nil="true">'+ct+"<\/my:Requested_Expense>";try{var pi=document.getElementById("txtProjectManagerNameInXslForm").innerHTML,wi=document.getElementById("txtProjectManagerIdInXslForm").innerHTML,bi=document.getElementById("txtProjectManagerEmailInXslForm").innerHTML;t+="<my:Project_Manager_Hidden>";t+="\t<pc:Person>";t+="\t\t<pc:DisplayName>"+pi+"<\/pc:DisplayName>";t+="\t\t<pc:AccountId>"+encodeURIComponent(wi)+"<\/pc:AccountId>";t+="\t\t<pc:AccountType>"+bi+"<\/pc:AccountType>";t+="\t<\/pc:Person>";t+="<\/my:Project_Manager_Hidden>"}catch(i){}u="";navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)?(u=$('input[xd\\:binding = "my:Estimated_Start_Date"]')[0].value,u.indexOf("/")>-1&&(e=u.split("/"),u=e[1]+"-"+e[2]+"-"+e[0]),u.indexOf("undefined")>-1&&(u="")):u=document.getElementById("dtEstimatedStartDatex").value;t+="<my:Estimated_Start_Date>"+u+"<\/my:Estimated_Start_Date>";f="";navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)?(f=$('input[xd\\:binding = "my:Estimated_End_Date"]')[0].value,f.indexOf("/")>-1&&(e=f.split("/"),f=e[1]+"-"+e[2]+"-"+e[0]),f.indexOf("undefined")>-1&&(f="")):f=document.getElementById("dtEstimatedEndDatex").value;t+="<my:Estimated_End_Date>"+f+"<\/my:Estimated_End_Date>";t+='<my:Budget_Amount2 xsi:nil="true">0<\/my:Budget_Amount2>';lt=encodeURIComponent($('span[xd\\:binding = "my:Location"]')[0].innerHTML.replace("<br>",""));t+="<my:Location>"+lt+"<\/my:Location>";t+="<my:Cost_Center><\/my:Cost_Center>";t+="<my:FormStatus>FALSE<\/my:FormStatus>";t+="<my:Budget_Category><\/my:Budget_Category>";t+='<my:field3 xsi:nil="true"><\/my:field3>';t+="<my:AttachmentsFolderName>";t+="<\/my:AttachmentsFolderName>";t+="<my:CapexAttachmentsGroup>";t+="    <my:CapexAttachments>";t+='    \t<my:CapexAttachment xsi:nil="true"><\/my:CapexAttachment>';t+="    <\/my:CapexAttachments>";t+="<\/my:CapexAttachmentsGroup>";t+="<my:Year><\/my:Year>";t+="<my:field4><\/my:field4>";t+="<my:Current_Status><\/my:Current_Status>";t+="<my:Status><\/my:Status>";t+="<my:ddlCostOfEquipmentAndParts><\/my:ddlCostOfEquipmentAndParts>";s="";try{s=r==!0?$('span[xd\\:binding = "my:CostOfEquipmentAndParts"]')[0].innerHTML:$('span[xd\\:binding = "my:CostOfEquipmentAndParts"]')[0].innerHTML}catch(i){s=$('input[xd\\:binding = "my:CostOfEquipmentAndParts"]')[0].value}at=parseFloat(s.replace(/[^0-9-.]/g,""));t+="<my:CostOfEquipmentAndParts>"+at+"<\/my:CostOfEquipmentAndParts>";h="";try{h=r==!0?$('span[xd\\:binding = "my:CostOfInternalLabor"]')[0].innerHTML:$('span[xd\\:binding = "my:CostOfInternalLabor"]')[0].innerHTML}catch(i){h=$('input[xd\\:binding = "my:CostOfInternalLabor"]')[0].value}vt=parseFloat(h.replace(/[^0-9-.]/g,""));t+="<my:CostOfInternalLabor>"+vt+"<\/my:CostOfInternalLabor>";c="";try{c=r==!0?$('span[xd\\:binding = "my:CostOfOutsideServices"]')[0].innerHTML:$('span[xd\\:binding = "my:CostOfOutsideServices"]')[0].innerHTML}catch(i){c=$('input[xd\\:binding = "my:CostOfOutsideServices"]')[0].value}yt=parseFloat(c.replace(/[^0-9-.]/g,""));t+="<my:CostOfOutsideServices>"+yt+"<\/my:CostOfOutsideServices>";t+="<my:ddlCostOfOutsideServices><\/my:ddlCostOfOutsideServices>";l="";try{l=r==!0?$('span[xd\\:binding = "my:OtherExpense"]')[0].innerHTML:$('span[xd\\:binding = "my:OtherExpense"]')[0].innerHTML}catch(i){l=$('input[xd\\:binding = "my:OtherExpense"]')[0].value}pt=parseFloat(l.replace(/[^0-9-.]/g,""));t+="<my:OtherExpense>"+pt+"<\/my:OtherExpense>";a="";try{a=r==!0?$('span[xd\\:binding = "my:OtherCapital"]')[0].innerHTML:$('span[xd\\:binding = "my:OtherCapital"]')[0].innerHTML}catch(i){a=$('input[xd\\:binding = "my:OtherCapital"]')[0].value}wt=parseFloat(a.replace(/[^0-9-.]/g,""));t+="<my:OtherCapital>"+wt+"<\/my:OtherCapital>";t+='<my:CapitalTotal xsi:nil="true"><\/my:CapitalTotal>';t+='<my:ExpenseTotal xsi:nil="true"><\/my:ExpenseTotal>';t+='<my:TotalCosts xsi:nil="true"><\/my:TotalCosts>';v="";try{v=r==!0?$('span[xd\\:binding = "my:SalesTax"]')[0].innerHTML:$('span[xd\\:binding = "my:SalesTax"]')[0].innerHTML}catch(i){v=$('input[xd\\:binding = "my:SalesTax"]')[0].value}bt=parseFloat(v.replace(/[^0-9-.]/g,""));t+="<my:SalesTax>"+bt+"<\/my:SalesTax>";try{var ki=document.getElementById("equipmentAndPartsList").innerHTML,nt="",kt=0;try{for(dt=$.parseHTML(ki);;){var y=dt[kt].innerHTML,p=$.parseHTML(y),o=p[0].innerHTML;o!=""&&(nt+="<my:EquipmentAndParts>"+o+"<\/my:EquipmentAndParts>");kt+=1}}catch(i){}t+="<my:group3>";nt!=""&&(t+=nt);t+="<\/my:group3>"}catch(i){WriteToErrorLog("Error in createXmlDocument_SaveDraftOfflineAr() while parsing my:EquipmentAndParts: "+i.message+", "+i.stack)}try{var di=document.getElementById("internalLaborList").innerHTML,tt="",gt=0;try{for(ni=$.parseHTML(di);;){var y=ni[gt].innerHTML,p=$.parseHTML(y),o=p[0].innerHTML;o!=""&&(tt+="<my:CostOfInteralLabor>"+o+"<\/my:CostOfInteralLabor>");gt+=1}}catch(i){}t+="<my:group6>";tt!=""&&(t+=tt);t+="<\/my:group6>"}catch(i){WriteToErrorLog("Error in createXmlDocument_SaveDraftOfflineAr() while parsing my:CostOfInteralLabor: "+i.message+", "+i.stack)}try{var gi=document.getElementById("laborToInstallList").innerHTML,it="",ti=0;try{for(ii=$.parseHTML(gi);;){var y=ii[ti].innerHTML,p=$.parseHTML(y),o=p[0].innerHTML;o!=""&&(it+="<my:LaborToInstall>"+o+"<\/my:LaborToInstall>");ti+=1}}catch(i){}t+="<my:group4>";it!=""&&(t+=it);t+="<\/my:group4>"}catch(i){WriteToErrorLog("Error in createXmlDocument_SaveDraftOfflineAr() while parsing my:LaborToInstall: "+i.message+", "+i.stack)}try{var nr=document.getElementById("otherCostsList").innerHTML,rt="",ri=0;try{for(ui=$.parseHTML(nr);;){var y=ui[ri].innerHTML,p=$.parseHTML(y),o=p[0].innerHTML;o!=""&&(rt+="<my:OtherCosts>"+o+"<\/my:OtherCosts>");ri+=1}}catch(i){}t+="<my:group14>";rt!=""&&(t+=rt);t+="<\/my:group14>"}catch(i){WriteToErrorLog("Error in createXmlDocument_SaveDraftOfflineAr() while parsing my:OtherCosts: "+i.message+", "+i.stack)}t+="<my:sectionSalesTaxNote><\/my:sectionSalesTaxNote>";t+="<my:MaterialSavings>0<\/my:MaterialSavings>";t+="<my:AnnualLaborSavings>0<\/my:AnnualLaborSavings>";t+="<my:OtherSavings>0<\/my:OtherSavings>";t+="<my:PaybackMonths>0<\/my:PaybackMonths>";t+="<my:TotalAnnualSavings>0<\/my:TotalAnnualSavings>";t+="<my:statusfield><\/my:statusfield>";fi=encodeURIComponent($('span[xd\\:binding = "my:NecessityOfProposedExpenditure"]')[0].innerHTML.replace("<br>",""));t+="<my:NecessityOfProposedExpenditure>"+fi+"<\/my:NecessityOfProposedExpenditure>";ut=!1;document.getElementById("cbDoesThisRequireItResources").checked&&(ut=!0);t+="<my:field29>"+ut+"<\/my:field29>";ft=!1;document.getElementById("cbAreThereAssetDispositions").checked&&(ft=!0);t+="<my:AreThereAssetDispositions>"+ft+"<\/my:AreThereAssetDispositions>";w="";try{w=$('span[xd\\:binding = "my:LifeExpectancyOfProjectInMonths"]')[0].innerHTML}catch(i){w=$('input[xd\\:binding = "my:LifeExpectancyOfProjectInMonths"]')[0].value}ei=parseFloat(w.replace(/[^0-9-.]/g,""));t+="<my:LifeExpectancyOfProjectInMonths>"+ei+"<\/my:LifeExpectancyOfProjectInMonths>";t+="<my:group8>";t+="    <my:SupplementalRequests><\/my:SupplementalRequests>";t+="<\/my:group8>";t+="<my:group12>";t+="    <my:group13><\/my:group13>";t+="<\/my:group12>";t+="<my:ItemId><\/my:ItemId>";t+="<my:Project_Manager><\/my:Project_Manager>";t+='<my:BookValue xsi:nil="true"><\/my:BookValue>';t+="<my:OtherSavingsDetails><\/my:OtherSavingsDetails>";t+="<my:BookValueSection><\/my:BookValueSection>";t+="<my:SalesTaxSection><\/my:SalesTaxSection>";oi="";t+="<my:ARTitle>"+oi+"<\/my:ARTitle>";t+="<my:CreatedBy><\/my:CreatedBy>";t+="<my:CreatedDate><\/my:CreatedDate>";t+="<my:txtSpreadsheetData><\/my:txtSpreadsheetData>";t+="<my:FunctionalAreas>";t+="    <my:FunctionalArea>";t+="    \t<my:Displayname><\/my:Displayname>";t+="    <\/my:FunctionalArea>";t+="<\/my:FunctionalAreas>";t+="<my:CloseOuts>";t+="    <my:CloseOut>";t+='    \t<my:CloseOutUrl my:CloseOutUrlText=""><\/my:CloseOutUrl>';t+="    <\/my:CloseOut>";t+="<\/my:CloseOuts>";t+="<my:SupplementalARs>";t+="    <my:SupplementalAR>";t+='    \t<my:SupplementalARUrl my:SupplementalARUrlText=""><\/my:SupplementalARUrl>';t+="    <\/my:SupplementalAR>";t+="<\/my:SupplementalARs>";t+="<my:coARNumber><\/my:coARNumber>";t+="<my:coLocationOfEquipment><\/my:coLocationOfEquipment>";t+="<my:coDate><\/my:coDate>";t+="<my:coSAPInternalOrderNumber><\/my:coSAPInternalOrderNumber>";t+="<my:coCostCenter><\/my:coCostCenter>";t+="<my:coProjectTitle><\/my:coProjectTitle>";t+="<my:coEstimatedAmountClosed>0<\/my:coEstimatedAmountClosed>";t+='<my:coBudgetAmount xsi:nil="true"><\/my:coBudgetAmount>';t+="<my:coEquipmentReplaced><\/my:coEquipmentReplaced>";t+="<my:coPropertyNumber><\/my:coPropertyNumber>";t+="<my:coOnSiteButOutOfService>0<\/my:coOnSiteButOutOfService>";t+="<my:coInStorage>0<\/my:coInStorage>";t+="<my:coScrapped>0<\/my:coScrapped>";t+="<my:coTransfer>0<\/my:coTransfer>";t+="<my:coExplanation><\/my:coExplanation>";t+="<my:coProjectManager><\/my:coProjectManager>";t+='<my:coPlacedIntoServiceDate xsi:nil="true"><\/my:coPlacedIntoServiceDate>';t+="<my:coEquipmentGroup>";t+="    <my:coAssetRegistrarEquipment>";t+="    \t<my:coNewAssetDescription><\/my:coNewAssetDescription>";t+="    \t<my:coNewPropertyNumber>0<\/my:coNewPropertyNumber>";t+="    \t<my:coCostWithInstallation>0<\/my:coCostWithInstallation>";t+="    \t<my:coEstimatedUsefulLife>0<\/my:coEstimatedUsefulLife>";t+="    \t<my:coCategory><\/my:coCategory>";t+="    <\/my:coAssetRegistrarEquipment>";t+="<\/my:coEquipmentGroup>";t+='<my:coTotalEquipmentCost xsi:nil="true"><\/my:coTotalEquipmentCost>';t+="<my:sarProjectTitle><\/my:sarProjectTitle>";t+="<my:sarCapexCategory><\/my:sarCapexCategory>";t+="<my:sarBriefDescriptionOfProject><\/my:sarBriefDescriptionOfProject>";t+='<my:sarRequestedCapital xsi:nil="true"><\/my:sarRequestedCapital>';t+='<my:sarRequestedExpense xsi:nil="true"><\/my:sarRequestedExpense>';t+='<my:sarEstimatedStartDate xsi:nil="true"><\/my:sarEstimatedStartDate>';t+='<my:sarEstimatedEndDate xsi:nil="true"><\/my:sarEstimatedEndDate>';t+="<my:sarAttachmentsGroup>";t+="    <my:sarAttachments>";t+='    \t<my:sarAttachment xsi:nil="true"><\/my:sarAttachment>';t+="    <\/my:sarAttachments>";t+="<\/my:sarAttachmentsGroup>";si=$('span[xd\\:binding = "my:Title"]')[0].innerHTML;t+="<my:Title>"+si+"<\/my:Title>";t+='<my:ContextHelp my:ContextHelp="Click here to see how to complete the AR"><\/my:ContextHelp>';t+="<my:RejectPmiRequestChangeFrom>";t+="    <pc:Person>";t+="    \t<pc:DisplayName><\/pc:DisplayName>";t+="    \t<pc:AccountId><\/pc:AccountId>";t+="    \t<pc:AccountType><\/pc:AccountType>";t+="    <\/pc:Person>";t+="<\/my:RejectPmiRequestChangeFrom>";t+="<my:ARAttachmentsGroup>";t+="    <my:ARAttachments>";t+='    \t<my:ARAttachment xsi:nil="true"><\/my:ARAttachment>';t+="    <\/my:ARAttachments>";t+="<\/my:ARAttachmentsGroup>";t+="<my:RejectPmiComments><\/my:RejectPmiComments>";t+="<my:GlobalError><\/my:GlobalError>";t+="<my:IsBudgetApprover>true<\/my:IsBudgetApprover>";t+="<my:IsApprover>false<\/my:IsApprover>";t+="<my:IsProjectManager>false<\/my:IsProjectManager>";t+="<my:IsAccounting>false<\/my:IsAccounting>";t+="<my:WorkflowComments><\/my:WorkflowComments>";t+="<my:WorkflowConsolidatedComments><\/my:WorkflowConsolidatedComments>";t+='<my:ReturnToSiteUrl my:ReturnToSiteUrlText="&lt; Back to site...">&lt; Back to site...<\/my:ReturnToSiteUrl>';b="";try{b=r==!0?$('span[xd\\:binding = "my:ExpenseEquipmentAndParts"]')[0].innerHTML:$('span[xd\\:binding = "my:ExpenseEquipmentAndParts"]')[0].innerHTML}catch(i){b=$('input[xd\\:binding = "my:ExpenseEquipmentAndParts"]')[0].value}hi=parseFloat(b.replace(/[^0-9-.]/g,""));t+="<my:ExpenseEquipmentAndParts>"+hi+"<\/my:ExpenseEquipmentAndParts>";k="";try{k=r==!0?$('span[xd\\:binding = "my:ExpenseCostOfOutsideServices"]')[0].innerHTML:$('span[xd\\:binding = "my:ExpenseCostOfOutsideServices"]')[0].innerHTML}catch(i){k=$('input[xd\\:binding = "my:ExpenseCostOfOutsideServices"]')[0].value}ci=parseFloat(k.replace(/[^0-9-.]/g,""));t+="<my:ExpenseCostOfOutsideServices>"+ci+"<\/my:ExpenseCostOfOutsideServices>";t+="<my:WorkflowHistory><\/my:WorkflowHistory>";t+="<my:BusinessJustification_NPV>";t+="<\/my:BusinessJustification_NPV>";t+="<my:BusinessJustification_IRR>";t+="<\/my:BusinessJustification_IRR>";t+="<my:BusinessJustification_DiscCashPaybackPeriod>";t+="<\/my:BusinessJustification_DiscCashPaybackPeriod>";t+="<my:BusinessJustification_Months>";t+="<\/my:BusinessJustification_Months>";t+='<my:BusinessJustificationSpreadsheet xsi:nil="true"><\/my:BusinessJustificationSpreadsheet>';t+="<my:ConsolidatedComments2><\/my:ConsolidatedComments2>";t+="<my:WorkflowHistory2><\/my:WorkflowHistory2>";et=!1;document.getElementById("cbLifeExpectancyCostsAreEstimated").checked&&(et=!0);t+="<my:LifeExpectancyCostsAreEstimated>"+et+"<\/my:LifeExpectancyCostsAreEstimated>";li=encodeURIComponent($('span[xd\\:binding = "my:group15/my:EstimatedCostsExplanation"]')[0].innerHTML.replace("<br>",""));t+="<my:group15>";t+="    <my:EstimatedCostsExplanation>"+li+"<\/my:EstimatedCostsExplanation>";t+="<\/my:group15>";t+="<my:FinalCloseOutTitleAppended><\/my:FinalCloseOutTitleAppended>";t+="<my:PartialCloseOutTitleAppended><\/my:PartialCloseOutTitleAppended>";t+="<my:_FunctionalAreaId><\/my:_FunctionalAreaId>";d="";try{d=r==!0?$('span[xd\\:binding = "my:ExpenseInternalLabor"]')[0].innerHTML:$('span[xd\\:binding = "my:ExpenseInternalLabor"]')[0].innerHTML}catch(i){d=$('input[xd\\:binding = "my:ExpenseInternalLabor"]')[0].value}ai=parseFloat(d.replace(/[^0-9-.]/g,""));t+="<my:ExpenseInternalLabor>"+ai+"<\/my:ExpenseInternalLabor>";vi=encodeURIComponent($('span[xd\\:binding = "my:SavingsNotes"]')[0].innerHTML.replace("<br>",""));t+="<my:SavingsNotes>"+vi+"<\/my:SavingsNotes>";t+="<my:AdditionalInfoComments><\/my:AdditionalInfoComments>";t+="<my:BusinessJustificationSpreadsheetURL><\/my:BusinessJustificationSpreadsheetURL>";t+="<\/my:myFields>"}catch(i){yi=t;t="FAILED";displayAlertDialog("Exception in bw.offline.core.js.createXmlDocument_SaveDraftOfflineAr(): "+i.message+", "+i.stack);WriteToErrorLog("Exception in bw.offline.core.js.createXmlDocument_SaveDraftOfflineAr()","Error creating the AR XML: "+i.name+", "+i.message);WriteToErrorLog("Exception in bw.offline.core.js.createXmlDocument_SaveDraftOfflineAr()",yi)}return t}function cmdPrintForm(){$("#PrintDialog").dialog({modal:!0,resizable:!1,closeOnEscape:!1,width:"760",dialogClass:"no-close",hide:!1});$("#PrintDialog").dialog().parents(".ui-dialog").find(".ui-dialog-titlebar").remove();var n="";n+="Print";document.getElementById("spanPrintDialogTitle").innerHTML=n;n="Currently there is no custom report for this screen. Coming Soon!";document.getElementById("spanPrintDialogContents").innerHTML=n}function PrintRequest(){var n,t,r;$("#PrintDialog").dialog("close");try{try{n=document.getElementById("OfflineRequestBudgetRequestIdInXslForm").innerHTML}catch(i){try{n=document.getElementById("UnsubmittedBudgetRequestId").innerHTML}catch(i){n=document.getElementById("XslFormBudgetRequestId").innerHTML}}t=document.getElementById("divDocumentBody").innerHTML;$("#divOfflineRequestFormDialog").dialog("close");r=displayForm_DisplayCachedArWithPrintableHtml(n);r.then(function(){var n,i,r;console.log("Declaring attachment to the window.onafterprint event. This doesn't seem to work on MacBook Safari, or iOS (Safari and Chrome).");window.onafterprint=function(n){try{console.log("Print Dialog Closed.");document.getElementById("divDocumentBody").innerHTML=t;$("#divOfflineRequestFormDialog").dialog("open")}catch(n){console.log("Exception in window.onafterprint: "+n.message)}};console.log("navigator.userAgent: "+navigator.userAgent);console.log("window.matchMedia: "+window.matchMedia);navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)?(n=function(){console.log("Functionality to run before printing.")},i=function(){console.log("Functionality to run after printing");document.getElementById("divDocumentBody").innerHTML=t;$("#divOfflineRequestFormDialog").dialog("open")},window.matchMedia&&(r=window.matchMedia("print"),r.addListener(function(t){t.matches?n():i()})),window.onbeforeprint=n,window.onafterprint=i):navigator.userAgent.match(/Macintosh/i)&&navigator.userAgent.match(/Safari/i)&&(console.log("Print Dialog Closed4. Safari on Macintosh?"),document.getElementById("divDocumentBody").innerHTML=t,$("#divOfflineRequestFormDialog").dialog("open"));window.print();console.log("window.print() has just been executed. In Safari on MacBook, and Safari & Chrome on iOS, this is a synchronous call.")})}catch(i){console.log("Error in bw.offline.core.js.PrintRequest(): "+i.message+", "+i.stack)}}function displayForm_DisplayCachedArWithPrintableHtml(n){return new Promise(function(t,i){try{var r=bwIndexedDB.open(indexDBName,dbVersion);r.onblocked=function(n){console.log("In bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml(): indexDB BLOCKED1. errorCode: "+n.target.errorCode);displayAlertDialog("In bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml(): indexDB BLOCKED1. errorCode: "+n.target.errorCode);i()};r.onerror=function(n){console.log('In bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml(): Error accessing database "'+n.target.result.name+'". errorCode: '+n.target.errorCode);displayAlertDialog('In bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml(): Error accessing database "'+n.target.result.name+'". errorCode: '+n.target.errorCode);i()};r.onsuccess=function(r){console.log('In bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml(): Success accessing database "'+r.target.result.name+'".');var u=r.target.result;u.onerror=function(n){console.log('Error in bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml(). DATABASE ERROR!!!!!!!!!! :Error accessing database "'+n.target.result.name+'". errorCode: '+n.target.errorCode);displayAlertDialog('Error in bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml(). DATABASE ERROR!!!!!!!!!! :Error accessing database "'+n.target.result.name+'". errorCode: '+n.target.errorCode);i()};u.transaction("objectStoreCachedXsltFiles").objectStore("objectStoreCachedXsltFiles").get("UnsubmittedBudgetRequestPrintableHtml").onsuccess=function(r){var f=r.target.result,e;f?(console.log("In bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml("+n+"). Loaded the Xsl file from the indexDB!"),e=u.transaction("objectStoreCachedRequests").objectStore("objectStoreCachedRequests"),e.openCursor().onsuccess=function(r){var e,o,s;try{if(e=r.target.result,e){if(e.value.bwBudgetRequestId==n){status='<img class="imgRedDot" alt="" src="/images/red-dot.png"> You will be prompted to submit this request the next time you <a href="javascript:displayCustomLogonDialog();">sign in.<\/a>';o=e.value.bwDocumentXml;console.log("Starting: TransformToHtmlTextOffline(xml, xslt)");s=TransformToHtmlTextOffline(o,f);console.log("Ending: TransformToHtmlTextOffline(xml, xslt)");console.log("In bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml("+n+"). Preparing to display in divOfflineRequestFormPageMainPageContent.");document.getElementById("divDocumentBody").innerHTML=s;console.log("Completed display in displayForm_DisplayCachedArWithPrintableHtml divOfflineRequestFormPageMainPageContent.");try{$('span[xd\\:binding = "my:Status"]')[0].innerHTML=status;decodeUriInAllFields();formatRequestedExpense();formatRequestedCapital();formatCurrency2("my:Budget_Amount2");formatCurrency2("my:ExpenseEquipmentAndParts");formatCurrency2("my:CostOfEquipmentAndParts");formatCurrency2("my:ExpenseInternalLabor");formatCurrency2("my:CostOfInternalLabor");formatCurrency2("my:ExpenseCostOfOutsideServices");formatCurrency2("my:CostOfOutsideServices");formatCurrency2("my:OtherExpense");formatCurrency2("my:OtherCapital");formatCurrency2("my:SalesTax");console.log("In bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml(): Populating offline attachments 1!!!!")}catch(u){console.log("Exception in bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml(): Error rendering . "+u.message+u.stack);displayAlertDialog("Exception in bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml(): Error rendering . "+u.message+u.stack);i()}}e.continue()}else console.log("In bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml. DONE LOOPING."),t()}catch(u){console.log("Exception in bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml. xxError: "+u.message+", "+u.stack);displayAlertDialog("Exception in bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml. xxError: "+u.message+", "+u.stack);i()}}):(console.log("In bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml: ERRROR LOADING XSL FILE!!! "+f),displayAlertDialog("In bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml: ERRROR LOADING XSL FILE!!!"),i())}}}catch(u){console.log("Exception in bw.offline.core.js.displayForm_DisplayCachedArWithPrintableHtml("+n+")");i()}})}function TransformToHtmlTextOffline(n,t){var o,s,a,i,f,h,c,e;try{var l=new DOMParser,u=l.parseFromString(n,"application/xml"),v=l.parseFromString(t,"application/xml");if(typeof XSLTProcessor!="undefined")return console.log('In ios8.js.TransformToHtmlTextOffline(): typeof (XSLTProcessor) != "undefined"'),o=new XSLTProcessor,o.importStylesheet(v),s=o.transformToFragment(u,document),typeof GetXmlStringFromXmlDoc!="undefined"?(console.log('In ios8.js.TransformToHtmlTextOffline(): typeof (GetXmlStringFromXmlDoc) != "undefined")'),GetXmlStringFromXmlDoc(s)):(console.log("In ios8.js.TransformToHtmlTextOffline(): chrome friendly"),a=new XMLSerializer,i=a.serializeToString(s),i.indexOf("XML Parsing Error: syntax error")>-1&&(console.log("In ios8.js.TransformToHtmlTextOffline(): sResult: "+i),console.log("In ios8.js.TransformToHtmlTextOffline(): xml: "+n)),i.indexOf("<transformiix:result")>-1&&(i=i.substring(i.indexOf(">")+1,i.lastIndexOf("<"))),i);if(typeof u.transformNode!="undefined")return console.log('In ios8.js.TransformToHtmlTextOffline(): typeof (xmlDoc.transformNode) != "undefined"'),u.transformNode(t);f=null;try{f=new ActiveXObject("Msxml2.XSLTemplate")}catch(r){console.log('In ios8.js.TransformToHtmlTextOffline(): Failed to create new ActiveXObject("Msxml2.XSLTemplate"): '+r.message+", "+r.stack)}try{if(f)return console.log("In ios8.js.TransformToHtmlTextOffline(): activeXOb"),h=f,c=new ActiveXObject("Msxml2.FreeThreadedDOMDocument"),console.log("In ios8.js.TransformToHtmlTextOffline(): Preparing to load xml into Msxml2.FreeThreadedDOMDocument"),c.loadXML(t),console.log("In ios8.js.TransformToHtmlTextOffline(): Successful: xslDoc.loadXML(xsltDoc.xml). xsltDoc: "+t+". xsltDoc.xml: "+t.xml),h.stylesheet=c,console.log("In ios8.js.TransformToHtmlTextOffline(): Successful: xslt.stylesheet = xslDoc;"),e=h.createProcessor(),console.log("In ios8.js.TransformToHtmlTextOffline(): Successful: var xslProc = xslt.createProcessor();"),e.input=u,console.log("In ios8.js.TransformToHtmlTextOffline(): Successful: xslProc.input = xmlDoc;"),e.transform(),console.log("In ios8.js.TransformToHtmlTextOffline(): Successful: xslProc.transform();"),e.output}catch(r){return displayAlertDialog("There was an error parsing XSLT."),console.log("Error in ios8.js.TransformToHtmlTextOffline(): There was an error parsing XSLT: "+r.name+", "+r.message),WriteToErrorLog("Error in ios8.js.TransformToHtmlTextOffline()","There was an error parsing XSLT: "+r.name+", "+r.message),WriteToErrorLog("Error in ios8.js.TransformToHtmlTextOffline()",n),null}}catch(r){console.log("Error in TransformToHtmlTextOffline: "+r.message+", "+r.stack)}}function cmdCreateBudgetRequestAndSaveToMyDevice(){try{var t=bwIndexedDB.open(indexDBName,dbVersion);t.onblocked=function(n){console.log("In ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.request.onblocked() errorCode: "+n.target.errorCode);displayAlertDialog("In ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.request.onblocked() errorCode: "+n.target.errorCode)};t.onerror=function(n){console.log("In ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.request.onerror() errorCode: "+n.target.errorCode);displayAlertDialog("In ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.request.onerror() errorCode: "+n.target.errorCode)};t.onsuccess=function(n){var c,o,s,r,u,f,b,h;console.log('In ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.request.onsuccess() Attempting to access IndexedDB database: "'+n.target.result.name+'".');c=n.target.result;console.log('In ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.request.onsuccess(). Successfully opened the database "'+n.target.result.name+'".');var i=[],l="",a="",v="",e="";try{o=document.getElementById("OfflineRequestBudgetRequestId").innerHTML;s=!1;try{$("#selectOfflineRequestNewRequestFormRequestTypeDropDown option:selected").val()=="recurringexpense"&&(s=!0)}catch(t){console.log("Exception in ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.request.onsuccess() while looking up #selectOfflineRequestNewRequestFormRequestTypeDropDown option:selected).val(): "+t.message);displayAlertDialog("Exception in ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.request.onsuccess() while looking up #selectOfflineRequestNewRequestFormRequestTypeDropDown option:selected).val(): "+t.message)}if(s==!0){var y=document.getElementById("OfflineRequestRecurringExpenseId").innerHTML,k=document.getElementById("dtOfflineRequestRecurringExpenseReminderDate").value,d=document.getElementById("cbOfflineNewRequestRecurringExpenseSubmitImmediately").checked,r=createXmlDocument_InitRecurringExpense(y),u=document.getElementById("strOfflineRequestProjectTitle").value,f=document.getElementById("dblOfflineRequestRequestedCapital").value.replace(/[^0-9-.]/g,""),p=0;i={submitTheFirstRecurringExpenseImmediately:d,bwRecurringExpenseId:y,bwTenantId:l,bwWorkflowAppId:a,bwWorkflowId:null,CreatedBy:"",CreatedById:v,CreatedByEmail:e,ReminderDate:k,bwDocumentXml:r.toString(),ProjectTitle:u.toString(),BudgetAmount:null,RequestedCapital:f,RequestedExpense:p,FunctionalAreaId:null,Quote:"false",ManagerId:null}}else if(r=createXmlDocument_InitOfflineAr(o),r=="FAILED")displayAlertDialog("Failed to create XML.");else{try{u=document.getElementById("strOfflineRequestProjectTitle").value}catch(t){u=document.getElementById("strOfflineRequestProjectTitle").innerHTML}try{f=document.getElementById("dblOfflineRequestRequestedCapital").value.replace(/[^0-9-.]/g,"")}catch(t){f=document.getElementById("dblOfflineRequestRequestedCapital").innerHTML.replace(/[^0-9-.]/g,"")}var p=0,g=getCreatedTimestamp(),nt=getDueDateTimestamp(),w=!1;$("#selectOfflineNewRequestFormRequestTypeDropDown option:selected").val()=="quoterequest"&&(w=!0);i={bwBudgetRequestId:o.toString(),bwTenantId:l,bwWorkflowAppId:a,bwWorkflowId:null,IsSupplementalRequest:"false",RelatedBudgetRequestId:null,IsRecurringExpense:"false",RelatedRecurringExpenseId:null,CreatedBy:e,CreatedById:v,CreatedByEmail:e,bwDocumentXml:r.toString(),ProjectTitle:u.toString(),BudgetAmount:null,RequestedCapital:f,RequestedExpense:p,FunctionalAreaId:null,ARStatus:"Submitted",BudgetWorkflowStatus:"Assign Budget",Quote:w,ManagerId:null,bwWorkflowToken:"0"};console.log("In ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.request.onsuccess(): New request successfully stored in _newRequest variable.");try{b=c.transaction("objectStoreCachedRequests","readwrite")}catch(t){console.log("Exception in ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.request.onsuccess()2:. FAILED TO OPEN A TRANSACTION to the database..."+t.message+", "+t.stack);displayAlertDialog("Exception in ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.request.onsuccess()2:. FAILED TO OPEN A TRANSACTION to the database..."+t.message+", "+t.stack)}h=b.objectStore("objectStoreCachedRequests").put(i);h.onsuccess=function(){console.log("In ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.put.onsuccess(): Successfully stored _newRequest in the database. "+JSON.stringify(i));renderWelcomePageOffline()};h.onerror=function(){console.log("In ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.put.onerror(): Error storing _newRequest in the database. "+this.error);displayAlertDialog("In ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.put.onerror(): Error storing _newRequest in the database. "+this.error)};console.log("In ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.request.onsuccess():. Stored new request in IndexedDB:22.")}}catch(t){console.log("Exception in ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.request.onsuccess()1: "+t.message+", "+t.stack);displayAlertDialog("Exception in ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.request.onsuccess()1: "+t.message+", "+t.stack)}}}catch(n){console.log("Exception in ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.request.onsuccess():3: "+n.message+", "+n.stack);displayAlertDialog("Exception in ios8.js.cmdCreateBudgetRequestAndSaveToMyDevice.request.onsuccess():3: "+n.message+", "+n.stack)}}function createXmlDocument_InitOfflineAr(n){var t='<?xml version="1.0" encoding="UTF-8"?>',e,o,s,h,r,u,i,c;try{t+='<my:myFields  xmlns:pc="http://schemas.microsoft.com/office/infopath/2007/PartnerControls" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:my="http://schemas.microsoft.com/office/infopath/2003/myXSD/2012-09-11T20:22:29"  xmlns:xd="http://schemas.microsoft.com/office/infopath/2003">';t+="<my:BudgetRequestId>"+n+"<\/my:BudgetRequestId>";e=document.getElementById("dblOfflineRequestRequestedCapital").value;o=parseFloat(e.replace(/[^0-9-.]/g,""));t+="<my:Requested_Capital>"+o+"<\/my:Requested_Capital>";t+="<my:Functional_Area_Id><\/my:Functional_Area_Id>";t+="<my:Functional_Area><\/my:Functional_Area>";t+="<my:Quote><\/my:Quote>";s=document.getElementById("strOfflineRequestProjectTitle").value;t+="<my:Project_Name>"+s+"<\/my:Project_Name>";h=document.getElementById("strOfflineRequestBriefDescriptionOfProject").value;t+="<my:Brief_Description_of_Project>"+h+"<\/my:Brief_Description_of_Project>";t+='<my:Requested_Expense xsi:nil="true">0<\/my:Requested_Expense>';document.getElementById("dtOfflineRequestEstimatedStartDate")?r=document.getElementById("dtOfflineRequestEstimatedStartDate").value:(r=document.getElementById("dtEstimatedStartDate").value,i=r.split("-"),r=i[1]+"/"+i[2]+"/"+i[0],r.indexOf("undefined")>-1&&(r=""));t+="<my:Estimated_Start_Date>"+r+"<\/my:Estimated_Start_Date>";document.getElementById("dtOfflineRequestEstimatedEndDate")?u=document.getElementById("dtOfflineRequestEstimatedEndDate").value:(u=document.getElementById("dtEstimatedEndDate").value,i=u.split("-"),u=i[1]+"/"+i[2]+"/"+i[0],u.indexOf("undefined")>-1&&(u=""));t+="<my:Estimated_End_Date>"+u+"<\/my:Estimated_End_Date>";t+='<my:Budget_Amount2 xsi:nil="true"><\/my:Budget_Amount2>';t+="<my:Location><\/my:Location>";t+="<my:Cost_Center><\/my:Cost_Center>";t+="<my:FormStatus>FALSE<\/my:FormStatus>";t+="<my:Budget_Category><\/my:Budget_Category>";t+='<my:field3 xsi:nil="true"><\/my:field3>';t+="<my:AttachmentsFolderName>";t+="<\/my:AttachmentsFolderName>";t+="<my:CapexAttachmentsGroup>";t+="    <my:CapexAttachments>";t+="    <\/my:CapexAttachments>";t+="<\/my:CapexAttachmentsGroup>";t+="<my:Year><\/my:Year>";t+="<my:field4><\/my:field4>";t+="<my:Project_Manager_Hidden>";t+="\t<pc:Person>";t+="\t\t<pc:DisplayName><\/pc:DisplayName>";t+="\t\t<pc:AccountId><\/pc:AccountId>";t+="\t\t<pc:AccountType><\/pc:AccountType>";t+="\t<\/pc:Person>";t+="<\/my:Project_Manager_Hidden>";t+="<\/my:myFields>"}catch(f){c=t;t="FAILED";console.log("Exception in ios8.js.createXmlDocument_InitOfflineAr(): Error creating the AR XML: "+f.name+", "+f.message+", "+f.stack);WriteToErrorLog("Exception in ios8.js.createXmlDocument_InitOfflineAr()","Error creating the AR XML: "+f.name+", "+f.message);WriteToErrorLog("ios8.js.createXmlDocument_InitOfflineAr()",c)}return t}var indexDBName="BudgetNet-ca-Requests-TempV3",bwIndexedDB,IDBTransaction,dbVersion;try{bwIndexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB}catch(e){console.log("Error instantiating indexedDB: "+e.message+", "+e.stack)}IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.OIDBTransaction||window.msIDBTransaction;dbVersion=1;
//# sourceMappingURL=bw.offline.core.min.js.map
