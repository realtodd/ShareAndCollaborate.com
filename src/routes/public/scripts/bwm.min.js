"use strict";function cmdRenderSpendingReport(){var t,i,n,r;for($("#bwmCalculator")[0].innerHTML="",t="",t+='<div id="spendingReport1" style="height:350px;width:750px;"><\/div>',$("#bwmCalculator")[0].innerHTML=t,i="",n=0;n<BWMData[0].length;n++)BWMData[0][n][0]==workflowAppId&&(i=BWMData[0][n][2]);r={bwWorkflowAppId:workflowAppId};$.ajax({url:webserviceurl+"/bwbudgetrequestsforburnratereport",type:"DELETE",contentType:"application/json",data:JSON.stringify(r),success:function(n){for(var u,r,l,b,s=[],h=[],t=0;t<BWMData[0].length;t++)if(BWMData[0][t][0]==workflowAppId)for(u=0;u<BWMData[0][t][4].length;u++){var a=BWMData[0][t][4][u][0],v=BWMData[0][t][4][u][1],c=BWMData[0][t][4][u][4],e=Number(c),f=[];for(f.push(["1/1/2017",c,null]),r=0;r<n.length;r++)if(a==n[r].FunctionalAreaId){var o=new Date(n[r].ARStatusModifiedTimestamp),y=o.getMonth()+1+"/"+o.getDate()+"/"+o.getFullYear(),p=Number(n[r].BudgetAmount),w=n[r].Title;e=e-p;f.push([y,e,w])}f.length>0&&(s.push(f),l={label:v,lineWidth:2,markerOptions:{style:"circle"}},h.push(l))}b=$.jqplot("spendingReport1",s,{title:i+" - Burn Rate",seriesColors:sliceHighlightedColors,seriesDefaults:{showMarker:!0,pointLabels:{show:!0,location:"s",ypadding:3}},series:h,legend:{show:!0,placement:"outsideGrid"},axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,label:"Burn Rate (Actual)",tickOptions:{formatString:"%B %#m"}},yaxis:{tickOptions:{prefix:"$"},pad:1.3}},cursor:{show:!0,zoom:!0,showTooltip:!1}});$("#spendingReport1").bind("jqplotDataClick",function(n,t,i,r){try{var u=r[2];displayArInDialog(null,null,null,u,null)}catch(f){displayAlertDialog("Error in spendingReport1.jqplotDataClick(): "+f.message)}})},error:function(n,t,i){displayAlertDialog("Error in my.js.cmdRenderSpendingReport():"+t+", "+i)}})}function renderFinancialSummary9(n){var r,i,u,t;try{for($("#divWelcomeMessage").empty(),$(".bwCoreComponent").bwCoreComponent("populateTheYearDropdown","ddlYear",n),r=0,i=0;i<BWMData[0].length;i++)BWMData[0][i][3]="",BWMData[0][i][4][11]=[];if($("#bwmCalculator")[0].innerHTML="",BWMData[0].length>0)for(RenderFinancialSummaryForSingleWorkflow=[],RenderFinancialSummaryForSingleWorkflow.length=BWMData[0].length,GetSingleWorkflowDataForFinancialSummary=[],GetSingleWorkflowDataForFinancialSummary.length=BWMData[0].length,u=0,t=0;t<BWMData[0].length;t++)RenderFinancialSummaryForSingleWorkflow[t]=$.Deferred(),RenderFinancialSummaryForSingleWorkflow[t].done(function(){var i,t;if(u+=1,u==BWMData[0].length){for(i=0;i<BWMData[0].length;i++)t=getSingleWorkflowHtmlForFinancialSummary(i,n),t!=""&&t&&(r++,$("#bwmCalculator")[0].innerHTML+=t);r==0&&(t='<span class="spanNoDataToDisplayMessageText">There is no data to display.<\/span>',$("#bwmCalculator")[0].innerHTML+=t);$(".bwChartCalculatorWorkflowInstanceTitle").parent().parent().parent().parent().each(function(n,t){var i=t.id.replace("BWFunctionalAreaDiv",""),r=t.querySelectorAll(".bwFADrillDownLinkCell");Array.prototype.forEach.call(r,function(n){$(n).hover(function(){$(this).css({"background-color":sliceColors[i],color:"white",cursor:"pointer"})},function(){$(this).css({"background-color":"white",color:"#444"})})})});createPieChart()}}).fail(function(){}),renderFinancialSummaryForSingleWorkflow(t,n);else displayAlertDialog("There are no connected workflows. You will be returned to the Configuration screen so that you can connect..."),thereAreNoConnectedWorkflowsSoDisplayTheConfigurationScreenAppropriately()}catch(f){handleExceptionWithAlert("Error in Start.js.renderFinancialSummary()","2:"+f.message)}}function renderFinancialSummaryForSingleWorkflow(n,t){try{GetSingleWorkflowDataForFinancialSummary[n]=$.Deferred();GetSingleWorkflowDataForFinancialSummary[n].done(function(){RenderFinancialSummaryForSingleWorkflow[n].resolve()}).fail(function(){});getSingleWorkflowDataForFinancialSummary9(n,t)}catch(i){handleExceptionWithAlert("Error in Start.js.renderFinancialSummaryForSingleWorkflow()",i.message)}}function getSingleWorkflowDataForFinancialSummary9(n,t){try{var i=BWMData[0][n][0],r=webserviceurl+"/getfunctionalareasbyappid/"+i+"/"+t;$.ajax({url:r,method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(t){if(t.d.results.length>0){var i=webserviceurl+"/bwbudgetrequests/getbyappid/"+workflowAppId;$.ajax({url:i,method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(i){var r,f,e;for(BWMData[0][n][4].length=t.d.results.length,r=0;r<t.d.results.length;r++)f=[],e=[t.d.results[r].bwFunctionalAreaId,t.d.results[r].bwFunctionalAreaTitle,t.d.results[r].bwFunctionalAreaQuote,t.d.results[r].bwFunctionalAreaYear,Number(t.d.results[r].bwFunctionalAreaYearlyBudget),null,null,null,0,0,0,f],BWMData[0][n][4][r]=e;var u=new Date,s=u.getFullYear()+"-"+(u.getMonth()+1)+"-"+u.getDate()+"T"+u.getHours()+":"+u.getMinutes()+":"+u.getSeconds(),o=webserviceurl+"/bwworkflowtasks/getbyappid/"+workflowAppId;$.ajax({url:o,method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(t){for(var h,e,s,u,f,c,o,r=0;r<t.d.results.length;r++)for(h=t.d.results[r].bwRelatedItemId,e=0;e<i.d.results.length;e++)if((i.d.results[e].ARStatus=="Submitted"||i.d.results[e].ARStatus=="Approved"&&(i.d.results[e].BudgetWorkflowStatus=="Procurement: Issue PO#"||i.d.results[e].BudgetWorkflowStatus=="Issue PO#: Additional Info Needed"))&&i.d.results[e].bwBudgetRequestId==h)for(s=0;s<BWMData[0][n][4].length;s++)BWMData[0][n][4][s][0]==i.d.results[e].FunctionalAreaId&&(u=new Array(10),u[0]=i.d.results[e].bwBudgetRequestId,u[1]=t.d.results[r].bwTaskTitle,u[2]=t.d.results[r].Created,u[3]=t.d.results[r].Modified,u[4]=t.d.results[r].bwDueDate,u[5]=t.d.results[r].bwAuthorId,u[6]=t.d.results[r].bwEditorId,u[7]=t.d.results[r].bwAssignedToId,u[8]=t.d.results[r].bwStatus,u[9]=t.d.results[r].bwPercentComplete,BWMData[0][n][4][s][11].push(u));for(f=0;f<i.d.results.length;f++)for(c=i.d.results[f].FunctionalAreaId,o=0;o<BWMData[0][n][4].length;o++)BWMData[0][n][4][o][0]==c&&(i.d.results[f].ARStatus=="Approved"||i.d.results[f].ARStatus=="Active"?BWMData[0][n][4][o][8]=Number(BWMData[0][n][4][o][8])+Number(i.d.results[f].BudgetAmount):i.d.results[f].ARStatus=="Rejected"?BWMData[0][n][4][o][10]=Number(BWMData[0][n][4][o][10])+Number(i.d.results[f].BudgetAmount):i.d.results[f].ARStatus=="Submitted"&&(BWMData[0][n][4][o][9]=Number(BWMData[0][n][4][o][9])+Number(i.d.results[f].BudgetAmount)));GetSingleWorkflowDataForFinancialSummary[n].resolve()},error:function(n,t,i){handleExceptionWithAlert("Error in bwm.js.getSingleWorkflowDataForFinancialSummary9()","1:"+t+", "+i)}})},error:function(n,t,i){handleExceptionWithAlert("Error in bwm.js.getSingleWorkflowDataForFinancialSummary9()","2:"+t+", "+i)}})}else GetSingleWorkflowDataForFinancialSummary[n].resolve()},error:function(n,t,i){t!="-1002"&&handleExceptionWithAlert("Error in bwm.js.getSingleWorkflowDataForFinancialSummary9()","3:"+t+", "+i)}})}catch(u){handleExceptionWithAlert("Error in bwm.js.getSingleWorkflowDataForFinancialSummary9()","4:"+u.message)}}function getSingleWorkflowHtmlForFinancialSummary(n){var c,l,a,r,p,f,v,e,o,t,h,y,u;try{if(BWMData[0][n][4].length==0)return displayAlertDialog("xxxx"),"";var w=BWMData[0][n][2],s=0,i="";for(i+='<table id="tblSummaryPageFunctionalAreaSectionForWorkflow'+n.toString()+'" style="cursor:default;" title="">',i+="<tr>",i+="   <td><\/td>",i+="   <td><\/td>",i+='   <td style="text-align:center;" class="bwTdActivityTableColumnTitle">Yearly Budget<\/td>',i+='   <td style="text-align:center;" class="bwTdActivityTableColumnTitle">Approved<\/td>',i+='   <td style="text-align:center;" class="bwTdActivityTableColumnTitle">Pending<\/td>',i+='   <td style="text-align:center;" class="bwTdActivityTableColumnTitle">Remaining (Pending)<\/td>',i+='   <td style="text-align:center;" class="bwTdActivityTableColumnTitle">Remaining (Actual)<\/td>',i+="<\/tr>",i+='<tr id="functionalAreaRow_'+n.toString()+'_Top_1" style="visibility:hidden;"><td colspan="7"><\/td><\/tr>',i+='<tr id="functionalAreaRow_'+n.toString()+'_Top_2" style="visibility:hidden;"><td colspan="7"><\/td><\/tr>',c="",l="",t=0;t<BWMData[0][n][4].length;t++){for(a=!1,r="",r+='<tr id="functionalAreaRow_'+n.toString()+"_"+t.toString()+'" class="bwFunctionalAreaRow">',p=BWMData[0][n][4][t][0],f=0,v=0;v<BWMData[0][n][4][t][11].length;v++)if(BWMData[0][n][4][t][0]==p)try{BWMData[0][n][4][t][11].length>0&&f++}catch(b){}f>0?(a=!0,r+=f==1?'   <td style="width:15px;" class="bwFADrillDownLinkCell" title="There is 1 overdue task. Click here to view the details..." onclick="expandFunctionalAreaAndRenderAlerts(\''+BWMData[0][n][4][t][1].toString()+"', '"+n+"', 'functionalAreaRow_"+n.toString()+"_"+t.toString()+'\');"><span style="color:red;"><em>PENDING<\/em><\/span><\/td>':'   <td style="width:15px;" class="bwFADrillDownLinkCell" title="There are '+f.toString()+' overdue tasks. Click here to view the details..." onclick="expandFunctionalAreaAndRenderAlerts(\''+BWMData[0][n][4][t][1].toString()+"', '"+n+"', 'functionalAreaRow_"+n.toString()+"_"+t.toString()+'\');"><span style="color:red;"><em>PENDING<\/em><\/span><\/td>'):r+='   <td style="width:15px;"><\/td>';r+='   <td style="text-align:left;" class="bwFADrillDownLinkCell" nowrap onclick="expandFunctionalAreaAndRenderAlerts(\''+BWMData[0][n][4][t][1].toString()+"', '"+n+"', 'functionalAreaRow_"+n.toString()+"_"+t.toString()+"');\"><span>"+BWMData[0][n][4][t][1].toString()+"<\/span><\/td>";r+='   <td class="bwChartCalculatorLightCurrencyTableCell">';r+='       <span xd:binding="my:FAYearlyBudget'+t.toString()+'" class="bwCurrencyTextBox" contenteditable="false" tabindex="0">'+formatCurrencyNoDecimal(BWMData[0][n][4][t][4].toString())+"<\/span>";r+="   <\/td>";r+='    <td class="bwChartCalculatorDarkCurrencyTableCell">';r+='        <span xd:binding="my:FABudgetApproved'+t.toString()+'" class="bwCalculatedNegativeTextbox" contenteditable="false" tabindex="0">'+formatCurrencyReturnEmptyForZeroNoDecimal(BWMData[0][n][4][t][8].toString())+"<\/span>";r+="    <\/td>";r+='    <td class="bwChartCalculatorDarkCurrencyTableCell">';r+='        <span xd:binding="my:FABudgetPendingApproval'+t.toString()+'" class="bwCalculatedNegativeTextbox" contenteditable="false" tabindex="0">'+formatCurrencyReturnEmptyForZeroNoDecimal(BWMData[0][n][4][t][9].toString())+"<\/span>";r+="    <\/td>";r+='    <td class="bwChartCalculatorDarkCurrencyTableCell">';r+='        <span xd:binding="my:FABudgetRemainingPendingApproval'+t.toString()+'" class="bwCalculatedTextbox" contenteditable="false" tabindex="0">'+formatCurrencyReturnEmptyForZeroNoDecimal((Number(BWMData[0][n][4][t][4])-Number(BWMData[0][n][4][t][8])-Number(BWMData[0][n][4][t][9])).toString())+"<\/span>";r+="    <\/td>";r+='    <td class="bwChartCalculatorDarkCurrencyTableCell">';r+='        <span xd:binding="my:FABudgetRemainingApproval'+t.toString()+'" class="bwCalculatedTextbox" contenteditable="false" tabindex="0">'+formatCurrencyReturnEmptyForZeroNoDecimal((Number(BWMData[0][n][4][t][4])-Number(BWMData[0][n][4][t][8])).toString())+"<\/span>";r+="    <\/td>";r+="<\/tr>";a==!0?c+=r:l+=r;isNaN(BWMData[0][n][4][t][4])||(s=s+Number(BWMData[0][n][4][t][4]))}for(i+=c+l,e=0,t=0;t<BWMData[0][n][4].length;t++)isNaN(BWMData[0][n][4][t][8])||(e=e+Number(BWMData[0][n][4][t][8]));for(o=0,t=0;t<BWMData[0][n][4].length;t++)isNaN(BWMData[0][n][4][t][9])||(o=o+Number(BWMData[0][n][4][t][9]));return h=0,h=s-e,y=0,y=h-o,i+="<tr>",i+='<td colspan="7">&nbsp;<\/td>',i+="<\/tr>",i+="<tr>",i+="<td><\/td>",i+='        <td style="text-align:left;" class="bwChartCalculatorTableCellLabel" nowrap>Totals<\/td>',i+='        <td class="bwChartCalculatorLightCurrencyTableCell">',i+='            <span xd:binding="my:TotalYearlyBudget_'+n.toString()+'" class="bwCurrencyTextBox" contenteditable="false" tabindex="0">'+formatCurrencyNoDecimal(s)+"<\/span>",i+="        <\/td>",i+='        <td class="bwCalculatedTextboxTableCell">',i+='            <span xd:binding="my:TotalApprovedExpenses_'+n.toString()+'" class="bwCalculatedNegativeTextbox" contenteditable="false" tabindex="0">'+formatCurrencyNoDecimal(e)+"<\/span",i+="        <\/td>",i+='        <td class="bwCalculatedTextboxTableCell">',i+='            <span xd:binding="my:TotalAssignedButNotApprovedExpenses_'+n.toString()+'" class="bwCalculatedNegativeTextbox" contenteditable="false" tabindex="0">'+formatCurrencyNoDecimal(o)+"<\/span>",i+="        <\/td>",i+='        <td class="bwCalculatedTextboxTableCell">',i+='            <span xd:binding="my:TotalProjectedRemaining_'+n.toString()+'" class="bwCalculatedTextbox" contenteditable="false" tabindex="0">'+formatCurrencyNoDecimal(y)+"<\/span>",i+="        <\/td>",i+='        <td class="bwCalculatedTextboxTableCell">',i+='            <span xd:binding="my:TotalActualRemaining_'+n.toString()+'" class="bwCalculatedTextbox" contenteditable="false" tabindex="0">'+formatCurrencyNoDecimal(h)+"<\/span>",i+="        <\/td>",i+="<\/tr>",i+="<\/table>",u="",u+='<div id="BWFunctionalAreaDiv'+n.toString()+'" style="cursor:pointer;" >',u+='<table id="BWFunctionalArea'+n.toString()+'" style="vertical-align:top;width:100%;">',u+="  <tr>",u+='    <td class="bwChartCalculatorWorkflowInstanceTitle" onclick="collapseOrExpandBwFunctionalAreaDiv(\'tblSummaryPageFunctionalAreaSectionForWorkflow'+n.toString()+"', '"+n.toString()+'\');" colspan="6" style="text-align:left;">',u+='      <span style="white-space:nowrap;" id="BWAppInstance'+n.toString()+'Title">'+w+"<\/span>",u+="    <\/td>",Platform=="IOS8"?u+='    <td style="text-align: left; color: rgb(255, 255, 255); background-color: rgb(0, 83, 145);"><\/td>':(u+='    <td class="divBurnRateButton" onclick="cmdRenderSpendingReport();">',u+='      <span style="float:right;cursor:pointer;white-space:nowrap;">Burn Rate<\/span>',u+="    <\/td>"),u+="  <\/tr>",u+=i,u+="<\/table><br />",u+"<\/div>"}catch(b){}}function renderParticipantSummary(n){var u,i,r,t;try{for(u=0,i=0;i<BWMData[0].length;i++)BWMData[0][i][3]="",BWMData[0][i][4]=[];if(BWMData[0].length>0)for(RenderParticipantSummaryForSingleWorkflow=[],RenderParticipantSummaryForSingleWorkflow.length=BWMData[0].length,GetPendingBudgetRequestsByFunctionalAreaForSingleWorkflow=[],GetPendingBudgetRequestsByFunctionalAreaForSingleWorkflow.length=BWMData[0].length,r=0,t=0;t<BWMData[0].length;t++)RenderParticipantSummaryForSingleWorkflow[t]=$.Deferred(),RenderParticipantSummaryForSingleWorkflow[t].done(function(){var n,t,i,u,o;if(r+=1,r==BWMData[0].length){var f=[],s=0,e=!1;for(n=0;n<BWMData[0].length;n++)BWMData[0][n][4].length>0&&(s++,f.push(n),e=!0);for(t=0;t<BWMData[0].length;t++)i="BWFunctionalAreaDiv"+t.toString(),u=document.getElementById(i),f.indexOf(t)>-1?(u.style.visibility="visible",$("#"+i).show()):(u.style.visibility="hidden",$("#"+i).hide());e==!0?createPieChart():(o='<span class="spanNoDataToDisplayMessageText">There is no data to display.<\/span>',$("#bwmCalculator")[0].innerHTML+=o)}}).fail(function(){}),renderParticipantSummaryForSingleWorkflow(t,n);else displayAlertDialog("There are no connected workflows. You will be returned to the Configuration screen so that you can connect..."),thereAreNoConnectedWorkflowsSoDisplayTheConfigurationScreenAppropriately()}catch(f){handleExceptionWithAlert("Error in bwm.js.renderParticipantSummary()",f.message)}}function renderParticipantSummaryForSingleWorkflow(n,t){try{var i=BWMData[0][n][0],r=BWMData[0][n][2],u=webserviceurl+"/getfunctionalareasbyappid/"+i+"/"+t;$.ajax({url:u,method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(u){var o,s,e,f;if(u.d.results.length>0){for(BWMData[0][n][4].length=u.d.results.length,f=0;f<u.d.results.length;f++)o=[],s=[u.d.results[f].bwFunctionalAreaId,u.d.results[f].bwFunctionalAreaTitle,u.d.results[f].bwFunctionalAreaQuote,Number(u.d.results[f].bwFunctionalAreaYearlyBudget),0,0,0,0,o],BWMData[0][n][4][f]=s;for(GetPendingBudgetRequestsByFunctionalAreaForSingleWorkflow[n]=[],GetPendingBudgetRequestsByFunctionalAreaForSingleWorkflow[n].length=u.d.results.length,e=0,f=0;f<u.d.results.length;f++)GetPendingBudgetRequestsByFunctionalAreaForSingleWorkflow[n][f]=$.Deferred(),GetPendingBudgetRequestsByFunctionalAreaForSingleWorkflow[n][f].done(function(){if(e+=1,e==u.d.results.length){var t=webserviceurl+"/bwworkflowtasks/getbyappid/"+i;$.ajax({url:t,method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(t){var e,h,o,f,s,u;for(i=="6f308d4e-66fd-4e6f-925e-714b3135fef3",e=[],h=[],u=0;u<t.d.results.length;u++)o=t.d.results[u].bwAssignedToId,o&&e.indexOf(o)==-1&&e.push(o);if(f=$.unique(e.sort()).sort(),f.length>0)for(GetSingleParticipantDataAndRender=[],GetSingleParticipantDataAndRender.length=f.length,s=0,u=0;u<f.length;u++)GetSingleParticipantDataAndRender[u]=$.Deferred(),GetSingleParticipantDataAndRender[u].done(function(){s+=1}).fail(function(){}),getSingleParticipantDataAndRender(i,u,f[u],r,n),$(".bwChartCalculatorWorkflowInstanceTitle").each(function(){var n=this.innerText;if(n.trim()==r.trim()){var t=$(this).find("span").attr("id"),i=t.replace("BWAppInstance","").replace("Title",""),u="tblSummaryPageFunctionalAreaSectionForWorkflow"+i;document.getElementById(u).innerHTML=""}});else $(".bwChartCalculatorWorkflowInstanceTitle").each(function(){var n=this.innerText;if(n.trim()==r.trim()){var t=$(this).find("span").attr("id"),i=t.replace("BWAppInstance","").replace("Title",""),u="tblSummaryPageFunctionalAreaSectionForWorkflow"+i;document.getElementById(u).innerHTML='<span class="spanH2"><em>There are no outstanding tasks.<\/em><\/span>'}})},error:function(n,t,i){handleExceptionWithAlert("Error in bwm.js.renderParticipantSummaryForSingleWorkflow()","1:"+t+", "+i)}})}}).fail(function(){displayAlertDialog("renderParticipantSummaryForSingleWorkflow["+n+"].fail")}),getPendingBudgetRequestsByFunctionalAreaForSingleWorkflow(f,n,t,u.d.results[f].bwFunctionalAreaId)}RenderParticipantSummaryForSingleWorkflow[n].resolve()},error:function(n,t,i){handleExceptionWithAlert("Error in bwm.js.renderParticipantSummaryForSingleWorkflow()","2:"+t+", "+i)}})}catch(f){displayAlertDialog("You need to go to the following Budget Workflow App instance, and complete the App Configuration by adding an item to the AppConfiguration list at "+appWebUrl)}}function getPendingBudgetRequestsByFunctionalAreaForSingleWorkflow(n,t,i,r){try{var e=BWMData[0][t][0],u=webserviceurl+"/bwbudgetrequests/getpendingbyfunctionalareaid/"+r+"/"+i;$.ajax({url:u,method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(i){for(var u,o,e,f=0;f<BWMData[0][t][4].length;f++)BWMData[0][t][4][f][0]==r&&(e=f);for(BWMData[0][t][4][e][8]=new Array(i.d.results.length),u=0;u<i.d.results.length;u++)o=[i.d.results[u].bwBudgetRequestId,i.d.results[u].Title,i.d.results[u].ProjectTitle,i.d.results[u].FunctionalAreaId,i.d.results[u].BudgetAmount,i.d.results[u].ARStatus,i.d.results[u].BudgetWorkflowStatus],BWMData[0][t][4][e][8][u]=o;GetPendingBudgetRequestsByFunctionalAreaForSingleWorkflow[t][n].resolve()},error:function(n,t,i){handleExceptionWithAlert("Error in bwm.js.getSingleWorkflowBudgetRequestsForFunctionalAreaData()","1:"+t+", "+i)}})}catch(f){handleExceptionWithAlert("Error in bwm.js.getSingleWorkflowBudgetRequestsForFunctionalAreaData()","2:"+f.message)}}function getSingleParticipantDataAndRender(n,t,i,r,u){console.log("In bwm.js.getSingleParticipantDataAndRender(). globalUniqueUserId: "+i);try{if(i){var f=new Array(1),e=webserviceurl+"/bwparticipants/getuserdetailsbyparticipantid/"+i;$.ajax({url:e,method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(i){var e=new Array(3),o;e[0]=i.d.results[0].bwParticipantId;e[1]=i.d.results[0].bwParticipantFriendlyName;e[2]=i.d.results[0].bwParticipantEmail;f.push(e);o=webserviceurl+"/bwworkflowtasks/getbyappid/"+n;$.ajax({url:o,method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(f){n=="6f308d4e-66fd-4e6f-925e-714b3135fef3";$(".bwChartCalculatorWorkflowInstanceTitle").each(function(){var st=this.innerText,v,b,h,lt,y,ot,ut,o;if(st.trim()==r.trim()){var ht=$(this).find("span").attr("id"),d=ht.replace("BWAppInstance","").replace("Title",""),c=0,l=0,a="";for(v=0;v<f.d.results.length;v++)if(f.d.results[v].bwAssignedToId==e[0]){var ft=!1,p,w,g="",nt="",et="",ct=f.d.results[v].bwRelatedItemId,s;for(b=0;b<BWMData[0].length;b++)BWMData[0][b][0]==n&&(s=b);for(h=0;h<BWMData[0][s][4].length;h++)for(lt=h,y=0;y<BWMData[0][s][4][h][8].length;y++)ot=BWMData[0][s][4][h][8][y][0],ot==ct&&(ft=!0,p=h,w=y,nt=BWMData[0][s][4][h][1],g=BWMData[0][s][4][h][8][y][2],et=BWMData[0][s][4][h][8][y][4]);if(ft==!0){var bt=f.d.results[v].bwTaskTitle,tt=f.d.results[v].Created,at=tt.split("-")[0],vt=tt.split("-")[1],yt=tt.split("-")[2].split("T")[0],it=new Date(Number(at),Number(vt)-1,Number(yt)),rt=new Date,pt=Date.UTC(it.getFullYear(),it.getMonth(),it.getDate()),wt=Date.UTC(rt.getFullYear(),rt.getMonth(),rt.getDate()),k=Math.floor((wt-pt)/864e5);a+="   <tr>";a+='       <td style="width:10px;"><\/td>';a+='       <td style="width:10px;"><\/td>';c++;Number(k)>Number(l)&&(l=k);ut="";ut=k==1?"1 day overdue: ":k.toString()+" days overdue: ";a+='  <td class="tdPendingUserTaskTableSingleTask" style="cursor:pointer;" onMouseOver="this.style.backgroundColor=\'lightgoldenrodyellow\';" onMouseOut="this.style.backgroundColor=\'#d8d8d8\';" onclick="displayArInDialog(\''+n+"', '"+BWMData[0][s][4][p][8][w][0]+"', '"+BWMData[0][s][4][p][8][w][1]+"', '"+encodeHtmlAttribute(BWMData[0][s][4][p][8][w][2])+"', '"+BWMData[0][s][4][p][8][w][1]+'\');" target="_blank" title="Click to view the request...">'+ut;a+=nt==""||g==""?"<em>There is a problem with this AR. Click here to learn more<\/em>":g+" (<em>"+formatCurrency(et)+"<\/em>) - <em>"+nt+"<\/em>";a+="   <\/td>";o+="<\/tr>"}}o="";o+="<table>";o+="   <tr>";o+='       <td style="width:10px;"><\/td>';o+='       <td colspan="2" onclick="collapseOrExpandBwFunctionalAreaDiv(\'pendingUserTaskTable_'+d.toString()+"_"+t.toString()+"', '"+t.toString()+'\');" class="tdPendingUserTaskTable" style="cursor:pointer;border-width:0px;margin:0px;padding:6px 0px 6px 20px;color:#ffffff;background-color:'+sliceHighlightedColors[u]+';">'+i.d.results[0].bwParticipantFriendlyName+"      ";c==0?o+="<em> - There are no outstanding tasks&nbsp;&nbsp;&nbsp;<\/em><\/td>":c==1?o+=l==1?'<em style="color:white;"> - '+c.toString()+" overdue task. It is "+l.toString()+" day overdue.<\/em><\/td>":'<em style="color:white;"> - '+c.toString()+" overdue task. It is "+l.toString()+" days overdue.<\/em><\/td>":c>0&&(o+=l==1?'<em style="color:white;"> - '+c.toString()+" overdue tasks. The oldest task is "+l.toString()+" day overdue.<\/em><\/td>":'<em style="color:white;"> - '+c.toString()+" overdue tasks. The oldest task is "+l.toString()+" days overdue.<\/em><\/td>");o+="   <\/tr>";o+="   <tr>";o+="       <td><\/td>";o+="       <td>";o+='           <table id="pendingUserTaskTable_'+d.toString()+"_"+t+'" >';o+="               <tr>";o+=a;o+="               <\/tr>";o+="           <\/table>";o+="       <\/td>";o+="   <\/tr>";o+="<\/table>";$("#tblSummaryPageFunctionalAreaSectionForWorkflow"+d.toString())[0].innerHTML+=o}});GetSingleParticipantDataAndRender[t].resolve()},error:function(n,t,i){handleExceptionWithAlert("Error in bwm.js.getSingleParticipantDataAndRender()","1:"+t+", "+i)}})},error:function(n,t,i){handleExceptionWithAlert("Error in bwm.js.getSingleParticipantDataAndRender()","2:"+t+", "+i)}})}else console.log("Error in bwm.js.getSingleParticipantDataAndRender(). INVALID PARAMETER VALUE PASSED: globalUniqueUserId: "+i),alert("Error in bwm.js.getSingleParticipantDataAndRender(). INVALID PARAMETER VALUE PASSED: globalUniqueUserId: "+i)}catch(o){handleExceptionWithAlert("Error in bwm.js.getSingleParticipantDataAndRender()","3:"+o.message)}}function createPieChart(){var r,o,f,u,s,h,y,t,n,l,a,v,e,i;try{for(console.log("In bwm.js.createPieChart(). USER HAS NAVIGATED TO THE ACTIVITY PAGE!"),r=[],n=0;n<BWMData[0].length;n++)try{if(o=BWMData[0][n][2],f=0,BWMData[0][n][4].length>0)for(u=0;u<BWMData[0][n][4].length;u++)isNaN(BWMData[0][n][4][u][3])||(f=f+Number(BWMData[0][n][4][u][3]));s=f;h=[o,s];r.push(h)}catch(c){y=""}for(t=[],n=0;n<r.length;n++)l=[r[n][0],r[n][1]],t.push(l);if(a=0,$(t).map(function(){a+=this[1]}),v=$.makeArray($(t).map(function(){return'<div style="text-align:center;">'+this[0].toString()+"<\/br>"+formatCurrency(this[1])+"<\/div>"})),e&&e.destroy(),t.length>0){for(e=jQuery.jqplot("drillDownReport1",[t],{seriesColors:sliceColors,seriesDefaults:{renderer:jQuery.jqplot.PieRenderer,rendererOptions:{showDataLabels:!0,dataLabels:v,sliceMargin:4}},legend:{show:!1},grid:{borderWidth:0,shadow:!1,background:"#ffffff"}}),i=0;i<t.length;i++)$('.bwChartCalculatorWorkflowInstanceTitle:contains("'+t[i][0]+'")').css("color","white"),$('.bwChartCalculatorWorkflowInstanceTitle:contains("'+t[i][0]+'")').css("background-color",sliceColors[i]);$("#drillDownReport1").bind("jqplotDataClick",function(n,t,i,r){var e="",o="",l,s,u,f="",h,c;$(".bwChartCalculatorWorkflowInstanceTitle").each(function(){l=this.innerText;s=$(this).find("span").attr("id");u=s.replace("BWAppInstance","").replace("Title","");this.innerText.trim()==r[0].trim()?(e=$("#BWFunctionalAreaDiv"+u.toString())[0].outerHTML,f="tblSummaryPageFunctionalAreaSectionForWorkflow"+u.toString()):o+=$("#BWFunctionalAreaDiv"+u.toString())[0].outerHTML});$("#bwmCalculator").empty();$("#bwmCalculator").append(e+o);h=$(this);h.attr("title",r[0]);c=document.getElementById(f);c.style.visibility="visible";$("#"+f).show();$(".bwChartCalculatorWorkflowInstanceTitle").parent().parent().parent().parent().each(function(n,t){var i=t.id.replace("BWFunctionalAreaDiv",""),r=t.querySelectorAll(".bwFADrillDownLinkCell");Array.prototype.forEach.call(r,function(n){$(n).hover(function(){$(this).css({"background-color":sliceColors[i],color:"white",cursor:"pointer"})},function(){$(this).css({"background-color":"white",color:"#444"})})})})})}}catch(c){WriteToErrorLog("Error in bwm.js.createPieChart(). This user has navigated to the Activity page, and there is an issue rendering the pie chart...: ",c.message+", "+c.stack)}}function displayConnectedWorkflows(){var n=appweburl+"/_api/web/lists/getbytitle('BudgetWorkflowAppWebs')/items";try{$.ajax({url:n,method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(n){var i,t;if($("#bwConnectedWorkflowAppsDiv").text(""),n.d.results.length>0){for(t="",t+="<table>",t+="   <tr>",t+="       <td>",t+="           <strong>Connected Budget Workflows<\/strong>",t+="       <\/td>",t+="   <\/tr>",t+="   <tr>",t+="       <td>",t+="           <ul>",i=0;i<n.d.results.length;i++)t+="<li>",t+='   <a href="'+n.d.results[i].AppWebURL+'/Pages/DrillDownReport.aspx" target="_blank">'+n.d.results[i].Title+'<\/a>&nbsp;&nbsp;<em><a style="cursor:pointer;" onclick="disconnectFromAWorkflow(\''+n.d.results[i].Title+"',"+n.d.results[i].Id.toString()+');">disconnect<\/a><\/em>',t+="<\/li>";t+="           <\/ul>";t+="       <\/td>";t+="   <\/tr>";t+="<\/table>";t+="<table>";t+="   <tr>";t+="       <td><br /><br /><br /><\/td>";t+="   <\/tr>";t+="   <tr>";t+="       <td>";t+='           The Budget Workflow Manager can be connected to additional Budget Workflows. This is accomplished by going to an existing Budget Workflow, copying the URL from the address bar, and pasting it into the prompt once you click the "Connect" button below. <a style="cursor:pointer;" href="http://budgetworkflow.com/budget-workflow-manager-details" target="_blank">For more details, click here.<\/a>';t+="       <\/td>";t+="   <\/tr>";t+="   <tr>";t+="       <td>";t+="           &nbsp;";t+="       <\/td>";t+="   <\/tr>";t+="   <tr>";t+='       <td style="width:100%;text-align:center;">';t+='           <input id="btnConnectToAWorkflow" type="button" value="Connect" onclick="cmdConnectToAWorkflow();" />';t+="       <\/td>";t+="   <\/tr>";t+="<\/table>";$("#bwConnectedWorkflowAppsDiv").append(t)}else t="",t+="<table>",t+="   <tr>",t+="       <td>",t+='           The Budget Workflow Manager needs to be connected to at least one Budget Workflow. This is accomplished by going to an existing Budget Workflow, copying the URL from the address bar, and pasting it into the prompt once you click the "Connect" button below. <a style="cursor:pointer;" href="http://budgetworkflow.com/budget-workflow-manager-details" target="_blank">For more details, click here.<\/a>',t+="       <\/td>",t+="   <\/tr>",t+="   <tr>",t+="       <td>",t+="           &nbsp;",t+="       <\/td>",t+="   <\/tr>",t+="   <tr>",t+='       <td style="width:100%;text-align:center;">',t+='           <input id="btnConnectToAWorkflow" type="button" value="Connect" onclick="cmdConnectToAWorkflow();" />',t+="       <\/td>",t+="   <\/tr>",t+="<\/table>",$("#bwConnectedWorkflowAppsDiv").append(t)},error:function(n,t,i){displayAlertDialog("Error in Start.js.displayConnectedWorkflows()","1:"+t+", "+i)}})}catch(t){displayAlertDialog("Error in Start.js.displayConnectedWorkflows()","2:"+t.message)}}function cmdConnectToAWorkflow(){try{$("#BudgetWorkflowAppUrl").val("");$("#connectToWorkflowAppDialog").dialog({modal:!0,resizable:!1,closeText:"Cancel",closeOnEscape:!0,title:"Connect to a Budget Workflow...",width:"650px",dialogClass:"no-close",hide:!1,buttons:{Cancel:function(){$(this).dialog("close")},Connect:function(){var n,i,t;$(this).dialog("close");try{window.waitDialog=SP.UI.ModalDialog.showWaitScreenWithNoClose("Testing Connection...","");n=document.getElementById("BudgetWorkflowAppUrl").value;i=n.indexOf("?");i>0&&(n=n.split("?")[0]);n.indexOf("http://")==0||n.indexOf("https://")==0?(i=n.indexOf("/BudgetWorkflow"),t=n.substring(0,i+15),$.ajax({url:appweburl+"/_api/SP.AppContextSite(@target)/web/lists/getbytitle('FunctionalAreas')/items?@target='"+t+"'",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(){window.waitDialog.close();var n=new SP.RequestExecutor(appweburl);n.executeAsync({url:appweburl+"/_api/SP.AppContextSite(@t)/web/lists/getbytitle('AppConfiguration')/items?@t='"+t+"'",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(n){var i,r;window.waitDialog.close();i=JSON.parse(n.body);i.d.results.length==0?enterATitleForTheNewWorkflowAndConnect(t):(r=i.d.results[0].Title,connectToTheNewWorkflow(r,t))},error:function(n,i,r){window.waitDialog.close();i=="-1002"?enterATitleForTheNewWorkflowAndConnect(t):handleExceptionWithAlert("Error in Start.js.cmdConnectToAWorkflow","1:"+i+", "+r)}})},error:function(){window.waitDialog.close();handleExceptionWithAlert("Error in Start.js.cmdConnectToAWorkflow()","2:"+e.message)}})):(window.waitDialog.close(),displayAlertDialog('The URL must be prefixed with "http://" or "https://".'))}catch(e){window.waitDialog.close();handleExceptionWithAlert("Error in Start.js.cmdConnectToAWorkflow()","3:"+e.message)}}}})}catch(e){handleExceptionWithAlert("Error in Start.js.cmdConnectToAWorkflow()","4:"+e.message)}}function enterATitleForTheNewWorkflowAndConnect(n){var t,i,r;try{if(t=prompt("Please enter the Title for the workflow",""),t!=null){i=n;r=t;window.waitDialog=SP.UI.ModalDialog.showWaitScreenWithNoClose("Connecting...","");var u=GetItemTypeForListName("BudgetWorkflowAppWebs"),f={__metadata:{type:u},Title:t,AppWebURL:i},e=appweburl+"/_api/web/lists/getbytitle('BudgetWorkflowAppWebs')/items",o=new SP.RequestExecutor(appweburl);o.executeAsync({url:e,method:"POST",body:JSON.stringify(f),headers:{Accept:"application/json; odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":$("#__REQUESTDIGEST").val()},success:function(){window.waitDialog.close();displayConnectedWorkflows()},error:function(n,t,i){window.waitDialog.close();try{n.responseJSON.error.code.indexOf("Microsoft.SharePoint.SPDuplicateValuesFoundException")>-1?displayAlertDialog("This Budget Workflow is already connected."):handleExceptionWithAlert("Error in Start.js.enterATitleForTheNewWorkflowAndConnect()","1:"+t+", "+i)}catch(r){handleExceptionWithAlert("Error in Start.js.enterATitleForTheNewWorkflowAndConnect()","2:"+t+", "+i)}}})}else window.waitDialog.close(),displayAlertDialog("You didn't enter any information!")}catch(s){handleExceptionWithAlert("Error in Start.js.enterATitleForTheNewWorkflowAndConnect()","3:"+s.message)}}function connectToTheNewWorkflow(n,t){try{window.waitDialog=SP.UI.ModalDialog.showWaitScreenWithNoClose("Connecting...","");var i=GetItemTypeForListName("BudgetWorkflowAppWebs"),r={__metadata:{type:i},Title:n,AppWebURL:t},u=appweburl+"/_api/web/lists/getbytitle('BudgetWorkflowAppWebs')/items",f=new SP.RequestExecutor(appweburl);f.executeAsync({url:u,method:"POST",body:JSON.stringify(r),headers:{Accept:"application/json; odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":$("#__REQUESTDIGEST").val()},success:function(){window.waitDialog.close();displayConnectedWorkflows()},error:function(n,t,i){window.waitDialog.close();n.responseJSON.error.code.indexOf("Microsoft.SharePoint.SPDuplicateValuesFoundException")>-1?displayAlertDialog("This Budget Workflow is already connected."):handleExceptionWithAlert("Error in Start.js.connectToTheNewWorkflow()","1:"+t+", "+i)}})}catch(e){window.waitDialog.close();handleExceptionWithAlert("Error in Start.js.connectToTheNewWorkflow()","2:"+e.message)}}function disconnectFromAWorkflow(n,t){var i,r,u;try{i=confirm("Click OK to disconnect from the "+n+" Budget Workflow...");i&&(r=appweburl+"/_api/web/lists/getbytitle('BudgetWorkflowAppWebs')/items("+t+")",u=new SP.RequestExecutor(appweburl),u.executeAsync({url:r,method:"POST",headers:{Accept:"application/json; odata=verbose","X-RequestDigest":$("#__REQUESTDIGEST").val(),"X-HTTP-Method":"DELETE","IF-MATCH":"*"},success:function(){displayConnectedWorkflows()},error:function(n,t,i){handleExceptionWithAlert("Error in Start.js.disconnectFromAWorkflow()","1:"+t+", "+i)}}))}catch(f){handleExceptionWithAlert("Error in Start.js.disconnectFromAWorkflow()","2:"+f.message)}}
//# sourceMappingURL=bwm.min.js.map
