$.widget("bw.bwAuthentication", {
    options: {
        //
        // 2-21-2022
        //
        //1. OK> my3.js.page_Load() and bwAuthentication._create() calls >> checkIfAuthenticatedAndProcessQuerystringParameters().
        //2. OK> checkIfAuthenticatedAndProcessQuerystringParameters() calls getParticipantDetailsAndAcceptInvitation_BudgetWorkflow().
        //3. The "HOME" button and getParticipantDetailsAndAcceptInvitation_BudgetWorkflow() calls this method: >>> getRemainingParticipantDetailsAndWorkflowAppTitle().
        //4. getRemainingParticipantDetailsAndWorkflowAppTitle(). >> This method calls renderHomePagePersonalizedSection_AndRenderButtons().
        //5. renderHomePagePersonalizedSection_AndRenderButtons() >> This method has all the checks for 'owner', 'configurationmanager' etc. and calls renderAlerts2().
        //6. renderAlerts2 >>> Calls generateHomePageNotificationScreen() and 
        //7. generateHomePageNotificationScreen << This makes all the web service calls, and renders "Saved on My Device" summary.
        //8.    bwExecutiveSummariesCarousel2.js.generateHomePageNotificationScreenHtml


        //
        // Change this every time we PUBLISH.
        //

        // <span style="font-size:20pt;">&#129419;</span> // Butterfly emoji.

        WelcomeToThisVersionOfTheSoftware: 'Welcome to the August 21, 2023 version of this software.', // On youtube at <a href="https://www.youtube.com/@budgetworkflow" target="_blank" style="color:cornflowerblue;">https://www.youtube.com/@budgetworkflow</a>, and on twitter <a href="https://twitter.com/budgetworkflow" target="_blank" style="color:cornflowerblue;">@budgetworkflow</a>.',


        ServiceUnavailableMessage: 'The service is unavailable at this time. For assistance email <a href="mailto:support@budgetworkflow.com">support@budgetworkflow.com</a>, and get updates on twitter <a href="https://twitter.com/budgetworkflow" target="_blank">@budgetworkflow</a>. To try again, refresh your web browser.',

        bwSelectedNotificationSound: null, // 1-26-2023

        poppedOutRequestWindows: null, // This is where we keep track of the popped-out request windows. This is an array of window object references. See method bwRequest.js.displayRequestFormInNewBrowserWindow() for code samples.

        // This value is set in the _create() method.
        developerModeEnabled: null, // 1-26-2022 THIS IS USED to keep the sign-in drop down from displaying on the non-logged-in index.html page. Set it to true to see the Microsoft login functionality.

        largeFileUploadEnabled: null,

        participantId: null,
        participantLogonType: null,
        participantLogonTypeUserId: null,
        participantFriendlyName: null,
        participantEmail: null,
        tenantId: null,
        workflowAppId: null,

        activeStateIPAddress: null, // Used to ensure the user is on a trusted device.

        workflowAppTitle: null,
        workflowAppFiscalYear: null, // 1-23-2022
        workflowAppTheme: 'brushedAluminum_blue', //'brushedAluminum', // 'brushedAluminum_blue', //'brushedAluminum_green', // 'brushedAluminum_green', // This is the default theme. Default leftButton theme, and brushedAluminum theme, when not logged in.
        //developerModeEnabled: null, // 12-20-2021



        externallyFacingUrlForAttachments: null, // 6-29-2022 // bwExternallyFacingUrlForAttachments
        externallyFacingUrlForAttachmentsSourceFolder: null, // 6-29-2022 // bwExternallyFacingUrlForAttachmentsSourceFolder



        operationUriPrefix: null,
        msalInstance: null, // MSAL authentication for Microsoft logins.

        backendAdministrationLogin: null, // This provides authentication for the backend login if set to true.


        // 9-7-2021: WE NEED TO keep track of which WorkflowApps and the users' role in them here. This will be referred to for things like "Which buttons to display in the left menu".
        // This gets populated in selectHomePageWorkflowAppDropDown_change.
        SelectedOrganization: {
            OrganizationId: null, // bwWorkflowAppId
            OrganizationTitle: null, // bwWorkflowAppTitle
            OrganizationRole: null // bwParticipantRole // "owner", "participant", "archiveviewer", "reportviewer", "configurationmanager", "Forest Administrator"
        },

        bwLastSelectedExecutiveSummariesExpandedOrCollapsed: null,

        // This is loaded first time, and is also updated from bwRequestTypeEditor.js when the user turns on/off, adds/edits/deletes, Request types. // 1-2-2022
        bwEnabledRequestTypes: null, // Added 11-29-2021. THIS IS THE ONLY PLACE WE SHOULD BE READING IN ENABLED REQUEST TYPES. THIS IS A GLOBAL VARIABLE AND SHOULD BE REFERENCED EVERYWHERE ELSE!

        //selectedRequestType: null, // 11-29-2021
        //LastSelectedRequestType: null, // 11-29-2021 NOT HOOKED UP YET

        LastSelected_bwRequestTypeId: null, // 3-24-2023


        // This is the form we use when we can't find one using the request type. We store it here so that it is in one place and available to everything. 1-2-2022
        bwFormHtml_Default: '',
        bwFormHtml_offlinerequest_Default: '',

        // This is the workflow we use when we can't find one using the request type. We store it here so that it is in one place and available to everything. 1-2-2022
        bwWorkflowJson_Default: '',

        PINNED_REQUESTS: [],
        UserData_PinnedRequestsArray: [],
        MY_UNSUBMITTED_REQUESTS: [],
        MY_SUBMITTED_REQUESTS: [],
        ACTIVE_REQUESTS: [],
        MY_PENDING_TASKS: [],

        //  1-22-2022
        autoRefreshHomePage: true, // This functionality will eventually not be needed, but for now it makes the application a lot more pleasant to use for the user.
        autoRefreshHomePage_Interval: 15000, // In ms. 15000 = 15 seconds.

        ajaxTimeout: 15000,
        autoSenseDeviceType: false, // Automatic UI based on device type. Alpha version so far.







        AJAX_COMPLETED_FASTFIRSTPASS: false,

        AJAX_COMPLETED_FASTSECONDPASS: false,


        //OpenAccordionDrawers: [],
        //DefaultExecutiveSummaryDrawer: ['PINNED_REQUESTS'] // 9-3-2023. Setting as the default until we get the saving back to the database implemented.
        LastSelected_OpenAccordionDrawers: ['PINNED_REQUESTS'] // 9-3-2023. Setting as the default until we get the saving back to the database implemented.







    },
    _create: function () {
        try {
            console.log('');
            console.log('********************************************************');
            console.log('In bwAuthentication.js._create(). THIS IS THE ONLY PLACE WHERE THE PRE-LOGIN DISPLAY IS SET TO DISPLAY THE MICROSOFT LOGIN ETC. (OR NOT!!)');
            console.log('Note that AJAX ERRORS ARE CAUGHT HERE. THIS IS THE ONLY PLACE THAT AJAX ERRORS ARE CAUGHT. Come here to see how it works...');
            console.log('********************************************************');
            console.log('');
            var thiz = this;

            ////
            ////
            //// THIS IS WHERE WE ARE MANAGING AND OPTIMIZING AJAX REQUESTS.
            ////
            ////
            //$.ajaxPrefilter(function (options, originalOptions, jqXHR) {
            //    // Modify options, control originalOptions, store jqXHR, etc.
            //    console.log('*********** ajaxPrefilter ************');
            //    console.log('In bwAuthentication.js._create.ajaxPrefilter(). url: ' + options.url); 
            //    console.log('*********** ajaxPrefilter ************');


            //    if (thiz.options.AJAX_COMPLETED_FASTFIRSTPASS == true) {

            //        //
            //        // Get the high-priority section on the home page... this is the drawer that is open.
            //        //

            //        //var myPinnedRequests = document.getElementById('divBwExecutiveSummariesCarousel_PinnedRequests').style.display;
            //        //if (myPinnedRequests == 'inline') {
            //        //    //alert('myPinnedRequests ARE VISIBLE: ' + myPinnedRequests);
            //        //}

            //        // // divBwExecutiveSummariesCarousel_MyUnsubmittedRequests


            //        //var myPendingTasks = document.getElementById('divBwExecutiveSummariesCarousel_MyPendingTasks').style.display;
            //        //if (myPendingTasks == 'inline') {
            //        //    //alert('myPendingTasks ARE VISIBLE: ' + myPendingTasks);
            //        //}

            //        //if (thiz.options.LastSelected_OpenAccordionDrawers.length == 0) {


            //        //    var drawers = [];
            //        //    //class='bwAccordionDrawer' bwaccordiondrawertype = "MY_SUBMITTED_REQUESTS"
            //        //    var accordionDrawers = $('.bwExecutiveSummariesCarousel2').find('.bwAccordionDrawer');
            //        //    for (var i = 0; i < accordionDrawers.length; i++) {
            //        //        var bwaccordiondrawertype = accordionDrawers[i].getAttribute('bwaccordiondrawertype');
            //        //        var displayElement = $(accordionDrawers[i]).closest('table').closest('tr');
            //        //        var display = $(displayElement).css('display');
            //        //        if (display != 'none') {
            //        //            var drawer = {
            //        //                //element: accordionDrawers[i],
            //        //                bwaccordiondrawertype: bwaccordiondrawertype,
            //        //                display: display
            //        //            }
            //        //            drawers.push(drawer);
            //        //        }
            //        //    }

            //        //    displayAlertDialog('open drawers: ' + JSON.stringify(drawers));

            //        //}

            //        //var drawers = $('.bwExecutiveSummariesCarousel2').find('[bwaccordiondrawertype]');
            //        //if (drawers.length > 0) {
            //        //    //alert('found ' + drawers.length + ' drawers.');

            //        //    var openDrawers = 0;
            //        //    for (var i = 0; i < drawers.length; i++) {
            //        //        if ($(drawers[i]).attr('display') != 'none') {
            //        //            openDrawers += 1;
            //        //        }
            //        //    }

            //        //    //alert('found ' + openDrawers + ' openDrawers.');

            //        //}


            //    }








            //    //
            //    // Check if web service call to "_bw/getDataForHomePageNotificationScreen_FASTSECONDPASS" has completed successfully. If not, block this ajax call until it is complete.
            //    //
            //    if ((options.url.toLowerCase().indexOf('_files/getlistofattachmentsforbudgetrequest') > -1) && (thiz.options.AJAX_COMPLETED_FASTSECONDPASS != true)) {
            //        try {
            //            console.log('*********** ajaxPrefilter BLOCKED URL ************');
            //            console.log('In bwAuthentication.js._create.ajaxPrefilter(). url: ' + options.url);
            //            console.log('*********** ajaxPrefilter BLOCKED URL ************');

            //            jqXHR.abort(); // Did it work?

            //        } catch (e) {
            //            console.log('Exception in bwAuthentication.js._create.document.ajaxPrefilter(): ' + e.message + ', ' + e.stack);
            //            displayAlertDialog('Exception in bwAuthentication.js._create.document.ajaxPrefilter(): ' + e.message + ', ' + e.stack);
            //        }
            //    }




            //});

            //$(document).on('ajaxSuccess', function (event, xhr, settings) {
            //    console.log('*********** ajaxSuccess ************');
            //    console.log('In bwAuthentication.js._create.ajaxSuccess(). url: ' + settings.url);
            //    console.log('*********** ajaxSuccess ************');

            //    if (settings.url.toLowerCase().indexOf('_bw/bwtasksoutstanding_fastfirstpass') > -1) {
            //        alert('setting AJAX_COMPLETED_FASTFIRSTPASS to true');
            //        // if AJAX_COMPLETED_FASTFIRSTPASS has been completed, set it here:
            //        thiz.options.AJAX_COMPLETED_FASTFIRSTPASS = true;
            //    }

            //});

            //$(document).on('ajaxComplete', function (event, xhr, settings) {
            //    console.log('*********** ajaxComplete ************');
            //    console.log('In bwAuthentication.js._create.ajaxComplete(). url: ' + settings.url);
            //    console.log('*********** ajaxComplete ************');
            //});






            ////$(document).on('ajaxStop', function (event, xhr, settings) {
            ////    console.log('*********** ajaxStop ************');
            ////    console.log('In bwAuthentication.js._create.ajaxStop(). THIS MEANS ALL AJAX REQUESTS HAVE BEEN COMPLETED.');
            ////    alert('In bwAuthentication.js._create.ajaxStop(). THIS MEANS ALL AJAX REQUESTS HAVE BEEN COMPLETED.');
            ////    console.log('*********** ajaxStop ************');
            ////});






            ////
            ////
            //// end: THIS IS WHERE WE ARE MANAGING AND OPTIMIZING AJAX REQUESTS.
            ////
            ////













            //
            // This is where we detect the 401 (UNAUTHORIZED) error, and re-present the sign-in circle dialog for a graceful re-authorization/recovery.
            // Note that the individual ajax code will also raise the error event... it bubbles throughout! Woop! :)
            //
            $(document).on('ajaxError', function (event, jqXHR, settings, thrownError) {
                try {

                    console.log('In bwAuthentication._create.document.ajaxError(). settings: ' + JSON.stringify(settings) + ', thrownError: ' + thrownError + ', jqXHR: ' + JSON.stringify(jqXHR));
                    //alert('In bwAuthentication._create.document.ajaxError(). settings: ' + JSON.stringify(settings) + ', thrownError: ' + thrownError + ', jqXHR: ' + JSON.stringify(jqXHR));

                    if (jqXHR.status == 401) { // HTTP 401 "Unauthorized".

                        var responseText = JSON.parse(jqXHR.responseText);

                        if ((responseText.status == 'UNAUTHORIZED') && (responseText.suppressSignInDialog == true)) {

                            //
                            // This usually happens for a request for an image at URI /_files/, which returned a 401 error. We don't want the sign in dialog popping up for every image that returns 401.
                            //
                            console.log('This usually happens for a request for an image at URI /_files/, which returned a 401 error. We do not want the sign in dialog popping up for every image that returns 401.');

                        } else {

                            console.log('You may have logged in on another device. Please re-authenticate and re-try your action. xcx34324-1');

                            displayAlertDialog('You may have logged in on another device. Please re-authenticate and re-try your action. xcx34324-1. console.logs: ' + JSON.stringify(console.logs)); // 8-29-2023.

                            //var element = event.target;
                            //var x = $(element).getAttribute('onclick');

                            //displayAlertDialog('You may have logged in on another device. Please re-authenticate and re-try your action. xcx34324-1 event.target.onclick: ' + x);

                            thiz.displaySignInDialog(true, 'You may have logged in on another device. Please re-authenticate and re-try your action.<br /><br />', true, true);

                        }

                    } else if (jqXHR.status == 404) { // HTTP 404 "Not found".

                        // We are ignoring these ones for the moment, but should make this better in the future... the reason we are ignoring things is because we try to get thumbnails and org images and participant images which dont always exist. This is expected.
                        // Perhaps should be checking the url to see if it it a _files url or not? Hmmm...

                    } else if (jqXHR.status == 503) { // HTTP 503 "Backend Fetch Failed".






                        //console.log('Error in bwAuthentication.js._create.document.ajaxError(). Backend Fetch Failed (503). settings: ' + JSON.stringify(settings) + ', thrownError: ' + thrownError);
                        //displayAlertDialog('Error in bwAuthentication.js._create.document.ajaxError(). Backend Fetch Failed (503). settings: ' + JSON.stringify(settings) + ', thrownError: ' + thrownError);




                        console.log('In bwAuthentication.js._create.document.ajaxError(). ?Varnish error. Backend fetch failed.');

                        if (document.getElementById('divSignInOrSignUpIndexPageButtons')) {

                            // Display the Service Unavailable message on the home screen.
                            var html = '';

                            html += '<span style="font-size:25pt;font-weight:bold;color:tomato;">';
                            //var serviceUnavailableMessage = thiz.options.ServiceUnavailableMessage; // The "ServiceUnavailableMessage" message is stored in the bwAuthentication.js widget.
                            html += '   <br />' + thiz.options.ServiceUnavailableMessage;
                            html += '   <span style="cursor:pointer;" alt="" title="Varnish error. Backend fetch failed.">Ⓘ</span>';
                            html += '   <br />';
                            html += '</span>';

                            document.getElementById('divSignInOrSignUpIndexPageButtons').innerHTML = html;

                        } else {

                            displayAlertDialog(thiz.options.ServiceUnavailableMessage + ' xcx2296324126');

                        }


                        try {
                            $('.bwCircleDialog').bwCircleDialog('hideCircleDialog');
                        } catch (e) { }







                    } else {

                        console.log('Error in bwAuthentication.js._create.document.ajaxError(). settings: ' + JSON.stringify(settings) + ', thrownError: ' + thrownError);
                        //displayAlertDialog('Error in bwAuthentication.js._create.document.ajaxError(). settings: ' + JSON.stringify(settings) + ', thrownError: ' + thrownError);

                    }

                } catch (e) {
                    console.log('Exception in bwAuthentication.js._create.document.ajaxError(): ' + e.message + ', ' + e.stack);
                    displayAlertDialog('Exception in bwAuthentication.js._create.document.ajaxError(): ' + e.message + ', ' + e.stack);
                }
            });

            this.options.developerModeEnabled = false; // THIS IS THE ONLY PLACE WHERE THE PRE-LOGIN DISPLAY IS SET TO DISPLAY THE MICROSOFT LOGIN ETC.
            //

            var html = '';

            html += '<table class="xdFormLayout" style="BORDER-TOP-STYLE: none; WORD-WRAP: break-word; BORDER-LEFT-STYLE: none; BORDER-COLLAPSE: collapse; TABLE-LAYOUT: fixed; BORDER-BOTTOM-STYLE: none; BORDER-RIGHT-STYLE: none; ">';
            html += '    <colgroup> <col style=""> </colgroup>';
            html += '    <tbody>';
            html += '        <tr class="xdTableContentRow">';
            html += '            <td class="xdTableContentCell" style="display:block;BORDER-TOP: #d8d8d8 1pt solid; BORDER-RIGHT: #d8d8d8 1pt solid; VERTICAL-ALIGN: top; BORDER-BOTTOM: #d8d8d8 1pt solid; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; BORDER-LEFT: #d8d8d8 1pt solid; PADDING-RIGHT: 0px">';
            html += '                <div></div> <!--<span style="color:cornflowerblue;">Your currently selected budgeting network: BudgetWorkflow1</span>--> <table style="width:100%;"> <tbody><tr> <td colspan="4"> <span id="divCreateRequestFormContent_requestOrgClickableBreadcrumb" style="color:purple;font-size:8pt;">[divCreateRequestFormContent_requestOrgClickableBreadcrumb]</span> </td> </tr> <tr> <td width="5"></td> <td>';



            html += '<span>';


            //alert('xcx213121243214234-5 fix the image url here....');

            //html += '<img xcx="xcx12432356888" id="divCreateRequestFormContent_imgRequestOrgImage" style="width:150px;height:150px;" src="https://budgetworkflow.com/_files/6f308d4e-66fd-4e6f-925e-714b3135fef3/orgimages/root/orgimage.png">';
            html += '<img xcx="xcx12432356888" id="divCreateRequestFormContent_imgRequestOrgImage" style="width:150px;height:150px;" src="/images/corporeal.png">';

            html += '</span>';



            html += ' </td> <td style="text-align:right;" colspan="2"> &nbsp;&nbsp;<span class="xdlabel" id="spanRequestForm_Title"> [spanRequestForm_Title] </span> <br> <span id="spanViewWorkflowParticipantsLink" style="text-decoration:underline;cursor:pointer;font-size:10pt;color:gray;" onclick="$(\'.bwRequest\').bwRequest(\'displayNewRequestWorkflowParticipantsDialog\', this);">View Workflow/Participants</span> <br> <span id="spanRequestForm_WorkflowAndRoleDetails">[spanRequestForm_WorkflowAndRoleDetails]</span> <span id="spanRequestForm_Checklists">[spanRequestForm_Checklists] &nbsp; </span> </td> </tr> </tbody></table> <div align="right"> <span class="xdlabel"> <em></em> </span> </div> <div align="right"> <span class="xdlabel"> <em> <font style="FONT-SIZE: 11pt"> <span id="spanRequestForm_Instructions">[spanRequestForm_Instructionsxcx2] &nbsp; </span> </font> </em> </span> </div> <div align="right"> <span class="xdlabel" id="spanRequestForm_Buttons"> [spanRequestForm_Buttons] &nbsp; </span> </div> <div align="right"> <span title="" class="xdlabel" id="spanRequestForm_Error" style="color:tomato;" hidefocus="1"> &nbsp; </span> </div> <div align="center"> <span class="xdlabel"></span> </div><div id="tableLeftTopRequestFormSection" style="display:inline-block;vertical-align:top;">';
            html += '                    <div></div><div></div><div> </div><table class="xdFormLayout xdTableStyleTwoCol" style="display:inline-block;border:1px solid aliceblue;width:665px;">';
            html += '                        <colgroup> <col style="WIDTH: 169px"> <col style=""> </colgroup>';
            html += '                        <tbody valign="top">';
            html += '                           <tr class="xdTableOffsetRow" id="trNewRequestRecurringExpenseSection" style="display:none;"> <td class="xdTableOffsetCellLabel" style="text-align:left; BORDER-TOP: #d8d8d8 1pt; VERTICAL-ALIGN: top; PADDING-BOTTOM: 4px; PADDING-TOP: 4px; PADDING-LEFT: 22px; BORDER-LEFT: #d8d8d8 1pt; PADDING-RIGHT: 5px"> <span class="xdlabel" id="spanNewRequestRecurringExpenseSectionTitle">Recurring expense:</span> </td> <td class="xdTableOffsetCellComponent" style="BORDER-TOP: #d8d8d8 1pt; VERTICAL-ALIGN: top; PADDING-BOTTOM: 4px; PADDING-TOP: 4px; PADDING-LEFT: 5px; PADDING-RIGHT: 22px"> <!--<span id="spanNewRequestRecurringExpenseSecondSection"></span>--> <input disabled="" id="cbNewRequestRecurringExpenseSubmitImmediately" type="checkbox"> <span style="font-size:10pt;color:lightgray;">Submit the first budget request immediately.</span> <br> <!--<span style="font-size:8pt;">This does not create the budget request, it only schedules the reminder for when the budget request should be submitted.</span> <br />--> <span style="font-size:10pt;">Reminder date:</span> <br> <input id="dtRecurringExpenseReminderDate" style="WIDTH: 60%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;TEXT-ALIGN: left;" type="text"> <br> <span style="font-size:8pt;">You and the Manager will receive notifications prior to the reminder date so that you can initiate the next new request. Also, if anyone changes the date you will be notified.</span> <br> </td> </tr>';
            html += '                           <tr class="xdTableOffsetRow xdTableOffsetRow-editor" draggable="true" bwwidgetname="bwDescriptionField" id="draggablerow_1">                            <td class="xdTableOffsetCellLabel" style="text-align:left; VERTICAL-ALIGN: top; PADDING-BOTTOM: 4px; PADDING-TOP: 4px; PADDING-LEFT: 22px; BORDER-LEFT: #d8d8d8 1pt; PADDING-RIGHT: 5px">                                <span class="xdlabel">                                    Description:                                </span>                                                           </td>                            <td class="xdTableOffsetCellComponent" style="white-space:nowrap;text-align:left; VERTICAL-ALIGN: top; PADDING-BOTTOM: 4px; PADDING-TOP: 4px; PADDING-LEFT: 5px; PADDING-RIGHT: 22px;">   <input type="text" contenteditable="false" disabled="" class="bwRequestJson" bwdatarequired="true" bwdatatype="string" bwfieldname="ProjectTitle" id="strProjectTitle" onkeyup="$(\'.bwRequest\').bwRequest(\'editTextbox_OnKeyUp\', this);" style="WIDTH: 100%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;"> <!-- was 2.77em -->                            </td>                        </tr>';
            html += '                           <tr class="xdTableOffsetRow xdTableOffsetRow-editor" draggable="true" bwwidgetname="bwCommentsField" id="draggablerow_2">                            <td class="xdTableOffsetCellLabel" style="text-align:left; VERTICAL-ALIGN: top; PADDING-BOTTOM: 4px; PADDING-TOP: 4px; PADDING-LEFT: 22px; BORDER-LEFT: #d8d8d8 1pt; PADDING-RIGHT: 5px">                                <span class="xdlabel">                                    Comments:                                </span>                                                          </td>                            <td class="xdTableOffsetCellComponent" style="white-space:nowrap;text-align:left; VERTICAL-ALIGN: top; PADDING-BOTTOM: 4px; PADDING-TOP: 4px; PADDING-LEFT: 5px; PADDING-RIGHT: 22px;">                                      <div>                                        <table width="100%">                                          <tbody><tr>                                            <td colspan="2">                                              <span id="ReviewerComments" contenteditable="false" disabled="" class="xdTextBoxRequired" bwdatarequired="true" bwfieldname="ReviewerComments" bwdatatype="String" title="" hidefocus="1" xd:datafmt="&quot;string&quot;,&quot;plainMultiline&quot;" style="WORD-WRAP: break-word; HEIGHT: 90px; WHITE-SPACE: normal; OVERFLOW-X: auto; OVERFLOW-Y: auto; WIDTH: 100%;BACKGROUND-COLOR: white;">                                              </span>                                            </td>                                          </tr>                                        </tbody></table>                                      </div>                            </td>                        </tr>';
            html += '                           <tr class="xdTableOffsetRow xdTableOffsetRow-editor" draggable="true" bwwidgetname="bwRequestedCapitalField" id="draggablerow_3">                            <td class="xdTableOffsetCellLabel" style="text-align:left; VERTICAL-ALIGN: top; PADDING-BOTTOM: 4px; PADDING-TOP: 4px; PADDING-LEFT: 22px; BORDER-LEFT: #d8d8d8 1pt; PADDING-RIGHT: 5px">                                <span class="xdlabel">                                    Requested Capital:                                </span>                                                          </td>                            <td class="xdTableOffsetCellComponent" style="white-space:nowrap;text-align:left; VERTICAL-ALIGN: top; PADDING-BOTTOM: 4px; PADDING-TOP: 4px; PADDING-LEFT: 5px; PADDING-RIGHT: 22px;"><input contenteditable="false" disabled="" class="bwRequestJson" style="WIDTH: 60%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;TEXT-ALIGN: right;" type="text" bwfieldname="RequestedCapital" bwdatatype="Number" bwdatarequired="true">                            </td>                        </tr>';
            html += '                           <tr class="xdTableOffsetRow xdTableOffsetRow-editor" draggable="true" bwwidgetname="bwLocationPicker" id="draggablerow_4">                            <td class="xdTableOffsetCellLabel" style="text-align:left; VERTICAL-ALIGN: top; PADDING-BOTTOM: 4px; PADDING-TOP: 4px; PADDING-LEFT: 22px; BORDER-LEFT: #d8d8d8 1pt; PADDING-RIGHT: 5px">                                <span class="xdlabel">                                    Location:                                </span>                                                           </td>                            <td class="xdTableOffsetCellComponent" style="white-space:normal;text-align:left; VERTICAL-ALIGN: top; PADDING-BOTTOM: 4px; PADDING-TOP: 4px; PADDING-LEFT: 5px; PADDING-RIGHT: 22px;"><input id="txtLocationPickerFilter" class="bwRequestJson" bwdatarequired="true" bwdatatype="String" bwfieldname="bwLocationPicker" contenteditable="false" disabled="" type="text" style="width:450px;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;"><br>                                                           <span id="spanNewRequestFormLocationPickerBreadcrumb" style="cursor:pointer;color:purple;font-size:8pt;">[spanNewRequestFormLocationPickerBreadcrumb]</span>                            </td>                        </tr>';

            html += '                           <tr xcx="231242547" class="xdTableOffsetRow bwAttachments" bwwidgetname="bwAttachments" id="draggablerow_4">                                                    <td class="xdTableOffsetCellLabel" style="text-align:left; VERTICAL-ALIGN: top; PADDING-BOTTOM: 4px; PADDING-TOP: 4px; PADDING-LEFT: 22px; BORDER-LEFT: #d8d8d8 1pt; PADDING-RIGHT: 5px">                                <span class="xdlabel">                                    Attachments:                                </span>                            </td>                            <td class="xdTableOffsetCellComponent2" style="white-space:nowrap;text-align:left; VERTICAL-ALIGN: top; PADDING-LEFT: 5px; PADDING-RIGHT: 22px;">           <p id="newrequestattachments"><span style="font-style:italic;font-size:8pt;">There are no attachmentsxcx2</span></p>                            </td>                                            </tr>';


            html += '                        </tbody>';
            html += '                    </table>';
            html += '                </div>';
            html += '            </td>';
            html += '        </tr>';
            html += '    </tbody>';
            html += '</table>';

            this.options.bwFormHtml_Default = html;

            this.options.bwFormHtml_offlinerequest_Default = html;

            // 2-4-2022
            this.options.bwWorkflowJson_Default = {
                "bwRequestType": "defaultrequesttype", // budgetrequest",
                "bwRequestTypeId": "00000000-0000-0000-0000-00000000",
                "bwWorkflowActive": true,
                "Workflow": {
                    //"Parameters": {
                    //    "ExecThreshold1": {
                    //        "@Value": "200000"
                    //    }
                    //},
                    "Steps": {
                        "Step": [
                            {
                                "@Name": "Create",
                                "@Target": "Admin",
                                "Assign": [
                                    {
                                        "@Role": "CREATE",
                                        "@Form": "CARForm.aspx",
                                        "@DoneForm": "CARComments.aspx",
                                        "@Title": "Create and Submit CAR",
                                        "@MailTemplate": "Assign1.xsl",
                                        "@Subject": "Budget Request - New Work Item ({0})",
                                        "@RoleCategory": "Collaborator",
                                        "Action": {
                                            "@Name": "Submit",
                                            "@State": "Done",
                                            "Tooltip": "Submit completed request to the admin for review"
                                        }
                                    }
                                ],
                                "@EmailTemplate": "<div xcx=\"xcx213423678438-1\" style=\"background-color:#f5f6fa;font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color:black;font-size: 12pt;\"><style>                .brushedAluminum {            /*background-image: \t-webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0)   6%, hsla(0,0%,100%, .1) 7.5%, hsla(0,0%, 100%,0) 9%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,  0%,0) 0%, hsla(0,0%,  0%,0)   4%, hsla(0,0%,  0%,.03) 4.5%, hsla(0,0%,  0%,0) 6%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0) 1.2%, hsla(0,0%,100%,.15) 2.2%, hsla(0,0%,100%,0) 4%),                            -webkit-linear-gradient(-90deg, hsl(0,0%,78%)  0%, hsl(0,0%,90%) 47%, hsl(0,0%,78%) 53%, hsl(0,0%,70%)100%);*/            /* 9-25-2021 THIS IS THE COOL MENU ANIMATION! I think @keyframes below is required as well. !!!!!!! */            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);            background-size: 400% 400%;            -moz-animation: gradient 15s ease infinite;            -o-animation: gradient 15s ease infinite;            -webkit-animation: gradient 15s ease infinite;            animation: gradient 15s ease infinite;        }        @keyframes gradient {            0% {                background-position: 0% 50%;            }            50% {                background-position: 100% 50%;            }            100% {                background-position: 0% 50%;            }        }    </style>    <table style=\"width:800px;margin-left: auto; margin-right: auto;\">        <tbody><tr>            <td> </td>        </tr>        <tr>            <td>                <div style=\"float:left;\">BudgetWorkflow.com</div>                <div style=\"float:right;\">Need help? Contact me at todd@budgetworkflow.com.</div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <div style=\"background-color:white;padding:50px 50px 50px 50px;\">                    <table>                        <tbody><tr>                            <td style=\"font-size:30pt;font-weight:bold;\">Welcome to BudgetWorkflow.com.</td>                        </tr>                        <tr>                            <td style=\"padding:20px;\"></td>                        </tr>                        <tr>                            <td style=\"font-size:14pt;\">Your new Budget Request has been received. %Budget Request Number%: %Budget Request Project Title%</td>                        </tr><tr><td></td></tr>                        <tr>                            <td style=\"font-size:14pt;\">You will receive email notifications as it goes through the approval process. %✈ Budget Request Link%</td>                        </tr><tr><td></td></tr>                        <tr>                            <td style=\"font-size:14pt;\">The next step in the workflow is %Next Task Assignment Text%</td>                        </tr><tr><td></td></tr>                        <tr>                            <td style=\"font-size:14pt;\">If you wish to stop receiving these emails click here to unsubscribe. %☒ Unsubscribe Link%</td>                        </tr>                                               <tr>                            <td style=\"padding:30px;\"></td>                        </tr>                        <tr>                            <td style=\"text-align:center;\" align=\"center\">                                <!--<form action=\"https://budgetworkflow.com/\" method=\"get\" target=\"_blank\">                                    <input type=\"submit\" value=\"Sign In\" class=\"brushedAluminum leftButton\" />                                </form>-->                                                                <div class=\"brushedAluminum leftButton\" style=\"width:195px;height:50px;text-align: center; font-weight: bold;border:1px solid skyblue;color:white;\">                                    <a href=\"https://budgetworkflow.com\">Sign In</a>                                </div>                            </td>                        </tr>                    </tbody></table>                </div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <table>                    <tbody>                  <tr>                        <td></td>                    </tr>                    <tr>                        <td>Copyright © 2012-2021 Todd Hiltz. 61 Crescent Avenue, Kentville, NS B4N 1R1 Canada. All rights reserved.</td>                    </tr>                    <tr>                        <td>Organization: %Organization Name%</td>                    </tr>                </tbody></table>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td></td>        </tr>    </tbody></table></div>",
                                "@EmailInstructionText": "This email gets sent to the creator of the request to acknowledge that it has been received.",
                                "@EmailTemplateForSubject": "Your New Budget Request has been received. %Budget Request Title%: %Budget Request Project Title%"
                            },
                            {
                                "@Name": "Revise",
                                "@Target": "Admin",
                                "Assign": [
                                    {
                                        "@IdField": "CreatedByUserId",
                                        "@Role": "CREATE",
                                        "@Form": "CARForm.aspx",
                                        "@DoneForm": "CARComments.aspx",
                                        "@Title": "Revise CAR",
                                        "@MailTemplate": "Assign1.xsl",
                                        "@Subject": "Budget Request - New Work Item ({0})",
                                        "@RoleCategory": "Collaborator",
                                        "Action": {
                                            "@Name": "Submit",
                                            "@State": "Done",
                                            "Tooltip": "Submit revised request to the admin for review"
                                        }
                                    }
                                ],
                                "@EmailInstructionText": "This email gets sent to the creator of the request when a request has been rejected or set to revise/hold, so that they can revise the request and re-submit.",
                                "@EmailTemplateForSubject": "Revise Task. %Budget Request Title%: \"%Budget Request Name%\"",
                                "@EmailTemplate": "<div xcx=\"xcx213423678438-2\" style=\"background-color:#f5f6fa;font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color:black;font-size: 12pt;\"><style>                .brushedAluminum {            /*background-image: \t-webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0)   6%, hsla(0,0%,100%, .1) 7.5%, hsla(0,0%, 100%,0) 9%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,  0%,0) 0%, hsla(0,0%,  0%,0)   4%, hsla(0,0%,  0%,.03) 4.5%, hsla(0,0%,  0%,0) 6%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0) 1.2%, hsla(0,0%,100%,.15) 2.2%, hsla(0,0%,100%,0) 4%),                            -webkit-linear-gradient(-90deg, hsl(0,0%,78%)  0%, hsl(0,0%,90%) 47%, hsl(0,0%,78%) 53%, hsl(0,0%,70%)100%);*/            /* 9-25-2021 THIS IS THE COOL MENU ANIMATION! I think @keyframes below is required as well. !!!!!!! */            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);            background-size: 400% 400%;            -moz-animation: gradient 15s ease infinite;            -o-animation: gradient 15s ease infinite;            -webkit-animation: gradient 15s ease infinite;            animation: gradient 15s ease infinite;        }        @keyframes gradient {            0% {                background-position: 0% 50%;            }            50% {                background-position: 100% 50%;            }            100% {                background-position: 0% 50%;            }        }    </style>    <table style=\"width:800px;margin-left: auto; margin-right: auto;\">        <tbody><tr>            <td> </td>        </tr>        <tr>            <td>                <div style=\"float:left;\">BudgetWorkflow.com</div>                <div style=\"float:right;\">Need help? Contact me at todd@budgetworkflow.com.</div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <div style=\"background-color:white;padding:50px 50px 50px 50px;\">                    <table>                        <tbody><tr>                            <td style=\"font-size:30pt;font-weight:bold;\">Hello %⚇ Participant Friendly Name%,</td>                        </tr>                        <tr>                            <td style=\"padding:20px;\"></td>                        </tr>                        <tr>                            <td style=\"font-size:14pt;\">%Budget Request Title%: \"%Budget Request Project Title%\", is ready for the ADMIN to revise before it proceeds to the next step of the workflow. %✈ Budget Request Link%</td>                        </tr><tr><td></td></tr>                        <tr>                            <td style=\"font-size:14pt;\">Here are your outstanding tasks:<p>%Task Summary Section%</p><p>%☒ Unsubscribe Link%</p><p>%☯ Disclaimer/Legal Text%</p></td>                        </tr>                                               <tr>                            <td style=\"padding:30px;\"></td>                        </tr>                        <tr>                            <td style=\"text-align:center;\" align=\"center\">                                <!--<form action=\"https://budgetworkflow.com/\" method=\"get\" target=\"_blank\">                                    <input type=\"submit\" value=\"Sign In\" class=\"brushedAluminum leftButton\" />                                </form>-->                                                                <div class=\"brushedAluminum leftButton\" style=\"width:195px;height:50px;text-align: center; font-weight: bold;border:1px solid skyblue;color:white;\">                                    <a href=\"https://budgetworkflow.com\">Sign In</a>                                </div>                            </td>                        </tr>                    </tbody></table>                </div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <table>                    <tbody>                   <tr>                        <td></td>                    </tr>                    <tr>                        <td>Copyright © 2012-2021 Todd Hiltz. 61 Crescent Avenue, Kentville, NS B4N 1R1 Canada. All rights reserved.</td>                    </tr>                    <tr>                        <td><span style=\"font-size:10pt;font-family: 'Courier New';\">Organization: %Organization Name%</span></td>                    </tr>                </tbody></table>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td></td>        </tr>    </tbody></table></div>"
                            },
                            {
                                "@Name": "Admin",
                                "@Target": "Collaboration",
                                "Assign": [
                                    {
                                        "@Title": "",
                                        "@Instructions": "",
                                        "@AllowRequestModifications": true,
                                        "@RoleCategory": "Approver",
                                        "@Role": "ADMIN",
                                        "@RoleName": "ADMIN",
                                        "Action": [
                                            {
                                                "@Name": "Approve",
                                                "@State": "Done",
                                                "Tooltip": "Approve the request and submit comments"
                                            },
                                            {
                                                "@Name": "Revise/Hold",
                                                "@Target": "Revise",
                                                "Invalidate": {
                                                    "@Step": "CLevel"
                                                },
                                                "Tooltip": "Send the CAR back to the original creator"
                                            }
                                        ]
                                    }
                                ],
                                "@EmailTemplate": "<div xcx=\"xcx213423678438-3\" style=\"background-color:#f5f6fa;font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color:black;font-size: 12pt;\"><style>                .brushedAluminum {            /*background-image: \t-webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0)   6%, hsla(0,0%,100%, .1) 7.5%, hsla(0,0%, 100%,0) 9%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,  0%,0) 0%, hsla(0,0%,  0%,0)   4%, hsla(0,0%,  0%,.03) 4.5%, hsla(0,0%,  0%,0) 6%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0) 1.2%, hsla(0,0%,100%,.15) 2.2%, hsla(0,0%,100%,0) 4%),                            -webkit-linear-gradient(-90deg, hsl(0,0%,78%)  0%, hsl(0,0%,90%) 47%, hsl(0,0%,78%) 53%, hsl(0,0%,70%)100%);*/            /* 9-25-2021 THIS IS THE COOL MENU ANIMATION! I think @keyframes below is required as well. !!!!!!! */            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);            background-size: 400% 400%;            -moz-animation: gradient 15s ease infinite;            -o-animation: gradient 15s ease infinite;            -webkit-animation: gradient 15s ease infinite;            animation: gradient 15s ease infinite;        }        @keyframes gradient {            0% {                background-position: 0% 50%;            }            50% {                background-position: 100% 50%;            }            100% {                background-position: 0% 50%;            }        }    </style>    <table style=\"width:800px;margin-left: auto; margin-right: auto;\">        <tbody><tr>            <td> </td>        </tr>        <tr>            <td>                <div style=\"float:left;\">BudgetWorkflow.com</div>                <div style=\"float:right;\">Need help? Contact me at todd@budgetworkflow.com.</div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <div style=\"background-color:white;padding:50px 50px 50px 50px;\">                    <table>                        <tbody><tr>                            <td style=\"font-size:30pt;font-weight:bold;\">Hello %⚇ Participant Friendly Name%,</td>                        </tr>                        <tr>                            <td style=\"padding:20px;\"></td>                        </tr>                        <tr>                            <td style=\"font-size:14pt;\">%Budget Request Title%: \"%Budget Request Project Title%\", is ready for the ADMIN to review before it proceeds to the Collaboration step of the workflow. %✈ Budget Request Link%</td>                        </tr><tr><td></td></tr>                        <tr>                            <td style=\"font-size:14pt;\">Here are your outstanding tasks:<p>%Task Summary Section%</p><p>%☒ Unsubscribe Link%</p><p>%☯ Disclaimer/Legal Text%</p></td>                        </tr>                                               <tr>                            <td style=\"padding:30px;\"></td>                        </tr>                        <tr>                            <td style=\"text-align:center;\" align=\"center\">                                <!--<form action=\"https://budgetworkflow.com/\" method=\"get\" target=\"_blank\">                                    <input type=\"submit\" value=\"Sign In\" class=\"brushedAluminum leftButton\" />                                </form>-->                                                                <div class=\"brushedAluminum leftButton\" style=\"width:195px;height:50px;text-align: center; font-weight: bold;border:1px solid skyblue;color:white;\">                                    <a href=\"https://budgetworkflow.com\">Sign In</a>                                </div>                            </td>                        </tr>                    </tbody></table>                </div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <table>                    <tbody>                    <tr>                        <td></td>                    </tr>                    <tr>                        <td>Copyright © 2012-2021 Todd Hiltz. 61 Crescent Avenue, Kentville, NS B4N 1R1 Canada. All rights reserved.</td>                    </tr>                    <tr>                        <td><span style=\"font-size:10pt;font-family: 'Courier New';\">Organization: %Organization Name%</span></td>                    </tr>                </tbody></table>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td></td>        </tr>    </tbody></table></div>",
                                "@EmailInstructionText": "This email gets sent to the Workflow Administrator so that they can review and approve the request before it begins the rest of the workflow steps.",
                                "@EmailTemplateForSubject": "%Budget Request Title%: \"%Budget Request Project Title%\", is ready for the ADMIN to review."
                            },
                            {
                                "@Name": "Collaboration",
                                "@Target": "VPLevel",
                                "Inform": [],
                                "Assign": [
                                    {
                                        "@Role": "ACCT",
                                        "@RoleName": "Accountant",
                                        "@Form": "CARForm.aspx",
                                        "@DoneForm": "CARComments.aspx",
                                        "@Title": "Add Comments/Approve",
                                        "@MailTemplate": "Assign1.xsl",
                                        "@Subject": "eCAR3 - New Work Item ({0})",
                                        "@RoleCategory": "Approver",
                                        "@Cond": "            ",
                                        "Action": [
                                            {
                                                "@Name": "Approve",
                                                "@State": "Done",
                                                "Tooltip": "Approve the CAR and submit comments",
                                                "@JavaScript": "$('.bwRequest').bwRequest('cmdApproveRequest', this);"
                                            },
                                            {
                                                "@Name": "Cancel",
                                                "@State": "Cancel",
                                                "@RequireComments": "True",
                                                "Tooltip": "Cancel the entire CAR"
                                            },
                                            {
                                                "@Name": "Decline",
                                                "@State": "Cancel",
                                                "@RequireComments": "True",
                                                "Tooltip": "Decline the entire CAR"
                                            },
                                            {
                                                "@Name": "Revise/Hold",
                                                "@Target": "Revise",
                                                "Invalidate": {
                                                    "@Step": "CLevel"
                                                },
                                                "Tooltip": "Send the CAR back to the original creator"
                                            }
                                        ],
                                        "@AllowRequestModifications": true
                                    },
                                    {
                                        "@Role": "MG",
                                        "@Form": "CARComments.aspx",
                                        "@DoneForm": "CARComments.aspx",
                                        "@Title": "Add Comments",
                                        "@Cond": "$ProjectTypes~0f29247e-82bc-4d9b-8ab3-3cfc8fa6964f,820d114c-9277-4b7d-880d-19ab4abebaca,91cd7bbf-e47b-440a-aeb0-1386a581803a&$PillarTypes~adab7e29-0f80-4913-b8ea-5ae559f97184,6e9dfe61-652f-4a03-b67c-948ed1f3410c,70eebd61-e2b0-4d72-a510-a6a9266d084d&$ChecklistsRequired~ebf54d04-d7d1-44f6-9f89-42ecd9f3bd70      ",
                                        "@Timeout": "20160",
                                        "@TimeoutAction": "Submit",
                                        "@MailTemplate": "Assign1.xsl",
                                        "@Subject": "Budget Request - New Work Item ({0})",
                                        "@RoleCategory": "Collaborator",
                                        "Action": {
                                            "@Name": "Submit",
                                            "@State": "Done",
                                            "Tooltip": "Submit your comments to the collaboration area"
                                        },
                                        "@RoleName": "Marketing Generalist",
                                        "@AllowRequestModifications": true
                                    },
                                    {
                                        "@Role": "SR",
                                        "@Form": "CARComments.aspx",
                                        "@DoneForm": "CARComments.aspx",
                                        "@Title": "Add Comments",
                                        "@Timeout": "20160",
                                        "@TimeoutAction": "Submit",
                                        "@MailTemplate": "Assign1.xsl",
                                        "@Subject": "Budget Request - New Work Item ({0})",
                                        "@RoleCategory": "Collaborator",
                                        "Action": {
                                            "@Name": "Submit",
                                            "@State": "Done",
                                            "Tooltip": "Submit your comments to the collaboration area"
                                        },
                                        "@Cond": "    ",
                                        "@RoleName": "Sales Representative"
                                    },
                                    {
                                        "@Role": "CSR",
                                        "@Form": "CARComments.aspx",
                                        "@DoneForm": "CARComments.aspx",
                                        "@Title": "Add Comments",
                                        "@Cond": "    ",
                                        "@Timeout": "20160",
                                        "@TimeoutAction": "Submit",
                                        "@MailTemplate": "Assign1.xsl",
                                        "@Subject": "Budget Request - New Work Item ({0})",
                                        "@RoleCategory": "Collaborator",
                                        "Action": {
                                            "@Name": "Submit",
                                            "@State": "Done",
                                            "Tooltip": "Submit your comments to the collaboration area"
                                        },
                                        "@RoleName": "Customer Support Representative"
                                    },
                                    {
                                        "@Role": "BDM",
                                        "@Form": "CARComments.aspx",
                                        "@DoneForm": "CARComments.aspx",
                                        "@Title": "Add Comments",
                                        "@Cond": "    ",
                                        "@Timeout": "20160",
                                        "@TimeoutAction": "Submit",
                                        "@MailTemplate": "Assign1.xsl",
                                        "@Subject": "Budget Request - New Work Item ({0})",
                                        "@RoleCategory": "Collaborator",
                                        "Action": {
                                            "@Name": "Submit",
                                            "@State": "Done",
                                            "Tooltip": "Submit your comments to the collaboration area"
                                        },
                                        "@RoleName": "Business Development Manager"
                                    }
                                ],
                                "@Timeout": "5",
                                "@TimeoutUnits": "Hours",
                                "@EmailTemplate": "<div xcx=\"xcx213423678438-4\" style=\"background-color:#f5f6fa;font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color:black;font-size: 12pt;\"><style>                .brushedAluminum {            /*background-image: \t-webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0)   6%, hsla(0,0%,100%, .1) 7.5%, hsla(0,0%, 100%,0) 9%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,  0%,0) 0%, hsla(0,0%,  0%,0)   4%, hsla(0,0%,  0%,.03) 4.5%, hsla(0,0%,  0%,0) 6%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0) 1.2%, hsla(0,0%,100%,.15) 2.2%, hsla(0,0%,100%,0) 4%),                            -webkit-linear-gradient(-90deg, hsl(0,0%,78%)  0%, hsl(0,0%,90%) 47%, hsl(0,0%,78%) 53%, hsl(0,0%,70%)100%);*/            /* 9-25-2021 THIS IS THE COOL MENU ANIMATION! I think @keyframes below is required as well. !!!!!!! */            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);            background-size: 400% 400%;            -moz-animation: gradient 15s ease infinite;            -o-animation: gradient 15s ease infinite;            -webkit-animation: gradient 15s ease infinite;            animation: gradient 15s ease infinite;        }        @keyframes gradient {            0% {                background-position: 0% 50%;            }            50% {                background-position: 100% 50%;            }            100% {                background-position: 0% 50%;            }        }    </style>    <table style=\"width:800px;margin-left: auto; margin-right: auto;\">        <tbody><tr>            <td> </td>        </tr>        <tr>            <td>                <div style=\"float:left;\">BudgetWorkflow.com</div>                <div style=\"float:right;\">Need help? Contact me at todd@budgetworkflow.com.</div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <div style=\"background-color:white;padding:50px 50px 50px 50px;\">                    <table>                        <tbody><tr>                            <td style=\"font-size:30pt;font-weight:bold;\">Hello %⚇ Participant Friendly Name%,</td>                        </tr>                        <tr>                            <td style=\"padding:20px;\"></td>                        </tr>                        <tr>                            <td style=\"font-size:14pt;\">%Budget Request Title%: \"%Budget Request Project Title%\", is ready for you to review in the Collaboration step of the workflow. The collaboration step is set to expire in xx minutes/hours/days. %✈ Budget Request Link%</td>                        </tr><tr><td></td></tr>                        <tr>                            <td style=\"font-size:14pt;\">Here are your outstanding tasks:<p>%Task Summary Section%</p><p>%☒ Unsubscribe Link%</p><p>%☯ Disclaimer/Legal Text%</p></td>                        </tr>                                               <tr>                            <td style=\"padding:30px;\"></td>                        </tr>                        <tr>                            <td style=\"text-align:center;\" align=\"center\">                                <!--<form action=\"https://budgetworkflow.com/\" method=\"get\" target=\"_blank\">                                    <input type=\"submit\" value=\"Sign In\" class=\"brushedAluminum leftButton\" />                                </form>-->                                                                <div class=\"brushedAluminum leftButton\" style=\"width:195px;height:50px;text-align: center; font-weight: bold;border:1px solid skyblue;color:white;\">                                    <a href=\"https://budgetworkflow.com\">Sign In</a>                                </div>                            </td>                        </tr>                    </tbody></table>                </div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <table>                    <tbody>                   <tr>                        <td></td>                    </tr>                    <tr>                        <td>Copyright © 2012-2021 Todd Hiltz. 61 Crescent Avenue, Kentville, NS B4N 1R1 Canada. All rights reserved.</td>                    </tr>                    <tr>                        <td><span style=\"font-size:10pt;font-family: 'Courier New';\">Organization: %Organization Name%</span></td>                    </tr>                </tbody></table>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td></td>        </tr>    </tbody></table></div>",
                                "@FriendlyName": "Collaborate and Develop Consensus",
                                "@EmailInstructionText": "This email gets sent to people who are involved in this stage of the workflow when this step begins.",
                                "@EmailTemplateForSubject": "Collaboration Task. %Budget Request Title%: \"%Budget Request Project Title%\""
                            },
                            {
                                "@Name": "VPLevel",
                                "@Target": "ExecLevel",
                                "Assign": [
                                    {
                                        "@Role": "CIO",
                                        "@Form": "CARComments.aspx",
                                        "@DoneForm": "CARComments.aspx",
                                        "@Title": "Add Comments/Approve",
                                        "@Cond": "$ChecklistsRequired~becef88f-f43c-4e82-9ff8-0fd4d16b9555,f830e44a-d29f-4261-80c6-756236355e96  ",
                                        "@TimeoutAction": "Submit",
                                        "@MailTemplate": "Assign1.xsl",
                                        "@Subject": "Budget Request - New Work Item ({0})",
                                        "@RoleCategory": "Approver",
                                        "Action": [
                                            {
                                                "@Name": "Approve",
                                                "@State": "Done",
                                                "Tooltip": "Approve the CAR and submit comments",
                                                "@JavaScript": "$('.bwRequest').bwRequest('cmdApproveRequest');"
                                            },
                                            {
                                                "@Name": "Decline",
                                                "@State": "Cancel",
                                                "@RequireComments": "True",
                                                "Tooltip": "Decline the entire CAR"
                                            },
                                            {
                                                "@Name": "Revise/Hold",
                                                "@Target": "Revise",
                                                "@RequireComments": "True",
                                                "Invalidate": {
                                                    "@Step": "CLevel"
                                                },
                                                "Tooltip": "Send the CAR back to the original creator"
                                            }
                                        ],
                                        "@RoleName": "Chief Information Officer",
                                        "@AllowRequestModifications": true
                                    },
                                    {
                                        "@Role": "AVP",
                                        "@Form": "CARAppComments.aspx",
                                        "@DoneForm": "CARComments.aspx",
                                        "@Title": "Add Comments/Approve",
                                        "@Cond": "$ChecklistsRequired~cebeba6a-e89b-48c8-a8c7-52083fd429a9",
                                        "@MailTemplate": "Assign1.xsl",
                                        "@Subject": "Budget Request - New Work Item ({0})",
                                        "@RoleCategory": "Approver",
                                        "Action": [
                                            {
                                                "@Name": "Approve",
                                                "@State": "Done",
                                                "Tooltip": "Approve the CAR and submit comments",
                                                "@JavaScript": "$('.bwRequest').bwRequest('cmdApproveRequest', this);"
                                            },
                                            {
                                                "@Name": "Decline",
                                                "@State": "Cancel",
                                                "@RequireComments": "True",
                                                "Tooltip": "Decline the entire CAR"
                                            },
                                            {
                                                "@Name": "Revise/Hold",
                                                "@Target": "Revise",
                                                "@RequireComments": "True",
                                                "Invalidate": {
                                                    "@Step": "CLevel"
                                                },
                                                "Tooltip": "Send the CAR back to the original creator"
                                            }
                                        ],
                                        "@RoleName": "Assistant Vice President"
                                    },
                                    {
                                        "@Role": "VP",
                                        "@Form": "CARAppComments.aspx",
                                        "@DoneForm": "CARComments.aspx",
                                        "@Title": "Add Comments/Approve",
                                        "@MailTemplate": "Assign1.xsl",
                                        "@Subject": "Budget Request - New Work Item ({0})",
                                        "@RoleCategory": "Approver",
                                        "Action": [
                                            {
                                                "@Name": "Approve",
                                                "@State": "Done",
                                                "Tooltip": "Approve the CAR and submit comments",
                                                "@JavaScript": "$('.bwRequest').bwRequest('cmdApproveRequest');"
                                            },
                                            {
                                                "@Name": "Decline",
                                                "@State": "Cancel",
                                                "@RequireComments": "True",
                                                "Tooltip": "Decline the entire CAR"
                                            },
                                            {
                                                "@Name": "Revise/Hold",
                                                "@Target": "Revise",
                                                "@RequireComments": "True",
                                                "Invalidate": {
                                                    "@Step": "CLevel"
                                                },
                                                "Tooltip": "Send the CAR back to the original creator"
                                            }
                                        ],
                                        "@Cond": "    ",
                                        "@RoleName": "Vice President"
                                    }
                                ],
                                "@EmailTemplate": "<div xcx=\"xcx213423678438-5\" style=\"background-color:#f5f6fa;font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color:black;font-size: 12pt;\"><style>                .brushedAluminum {            /*background-image: \t-webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0)   6%, hsla(0,0%,100%, .1) 7.5%, hsla(0,0%, 100%,0) 9%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,  0%,0) 0%, hsla(0,0%,  0%,0)   4%, hsla(0,0%,  0%,.03) 4.5%, hsla(0,0%,  0%,0) 6%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0) 1.2%, hsla(0,0%,100%,.15) 2.2%, hsla(0,0%,100%,0) 4%),                            -webkit-linear-gradient(-90deg, hsl(0,0%,78%)  0%, hsl(0,0%,90%) 47%, hsl(0,0%,78%) 53%, hsl(0,0%,70%)100%);*/            /* 9-25-2021 THIS IS THE COOL MENU ANIMATION! I think @keyframes below is required as well. !!!!!!! */            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);            background-size: 400% 400%;            -moz-animation: gradient 15s ease infinite;            -o-animation: gradient 15s ease infinite;            -webkit-animation: gradient 15s ease infinite;            animation: gradient 15s ease infinite;        }        @keyframes gradient {            0% {                background-position: 0% 50%;            }            50% {                background-position: 100% 50%;            }            100% {                background-position: 0% 50%;            }        }    </style>    <table style=\"width:800px;margin-left: auto; margin-right: auto;\">        <tbody><tr>            <td> </td>        </tr>        <tr>            <td>                <div style=\"float:left;\">BudgetWorkflow.com</div>                <div style=\"float:right;\">Need help? Contact me at todd@budgetworkflow.com.</div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <div style=\"background-color:white;padding:50px 50px 50px 50px;\">                    <table>                        <tbody><tr>                            <td style=\"font-size:30pt;font-weight:bold;\">Hello %⚇ Participant Friendly Name%,</td>                        </tr>                        <tr>                            <td style=\"padding:20px;\"></td>                        </tr>                        <tr>                            <td style=\"font-size:14pt;\">%Budget Request Title%: \"%Budget Request Project Title%\", is ready for you to review before it proceeds to the Executive Approvals step of the workflow. %✈ Budget Request Link%</td>                        </tr><tr><td></td></tr>                        <tr>                            <td style=\"font-size:14pt;\">Here are your outstanding tasks:<p>%Task Summary Section%</p><p>%☒ Unsubscribe Link%</p><p>%☯ Disclaimer/Legal Text%</p></td>                        </tr>                                               <tr>                            <td style=\"padding:30px;\"></td>                        </tr>                        <tr>                            <td style=\"text-align:center;\" align=\"center\">                                <!--<form action=\"https://budgetworkflow.com/\" method=\"get\" target=\"_blank\">                                    <input type=\"submit\" value=\"Sign In\" class=\"brushedAluminum leftButton\" />                                </form>-->                                                                <div class=\"brushedAluminum leftButton\" style=\"width:195px;height:50px;text-align: center; font-weight: bold;border:1px solid skyblue;color:white;\">                                    <a href=\"https://budgetworkflow.com\">Sign In</a>                                </div>                            </td>                        </tr>                    </tbody></table>                </div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <table>                    <tbody>                  <tr>                        <td></td>                    </tr>                    <tr>                        <td>Copyright © 2012-2021 Todd Hiltz. 61 Crescent Avenue, Kentville, NS B4N 1R1 Canada. All rights reserved.</td>                    </tr>                    <tr>                        <td><span style=\"font-size:10pt;font-family: 'Courier New';\">Organization: %Organization Name%</span></td>                    </tr>                </tbody></table>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td></td>        </tr>    </tbody></table></div>",
                                "@FriendlyName": "VP Approvals",
                                "@EmailInstructionText": "This email gets sent to people who are involved in this stage of the workflow when this step begins.",
                                "@EmailTemplateForSubject": "VP Approval Task. %Budget Request Title%: \"%Budget Request Project Title%\""
                            },
                            {
                                "@Name": "ExecLevel",
                                "@Target": "CLevel",
                                "Assign": [
                                    {
                                        "@Role": "CMO",
                                        "@Form": "CARAppComments.aspx",
                                        "@DoneForm": "CARComments.aspx",
                                        "@Title": "Add Comments/Approve",
                                        "@MailTemplate": "Assign1.xsl",
                                        "@Subject": "Budget Request - New Work Item ({0})",
                                        "@RoleCategory": "Approver",
                                        "@Cond": "        ",
                                        "Action": [
                                            {
                                                "@Name": "Approve",
                                                "@State": "Done",
                                                "Tooltip": "Approve the CAR and submit comments3",
                                                "@JavaScript": "$('.bwRequest').bwRequest('cmdApproveRequest');"
                                            },
                                            {
                                                "@Name": "Decline",
                                                "@State": "Cancel",
                                                "@RequireComments": "True",
                                                "Tooltip": "Decline the entire CAR"
                                            },
                                            {
                                                "@Name": "Revise/Hold",
                                                "@Target": "Revise",
                                                "@RequireComments": "True",
                                                "Invalidate": {
                                                    "@Step": "CLevel"
                                                },
                                                "Tooltip": "Send the CAR back to the original creator"
                                            }
                                        ],
                                        "@RoleName": "Chief Marketing Officer"
                                    },
                                    {
                                        "@Role": "CTO",
                                        "@Form": "CARForm.aspx",
                                        "@DoneForm": "CARComments.aspx",
                                        "@Cond": "  ",
                                        "@Title": "Set Audit Date",
                                        "@MailTemplate": "Assign1.xsl",
                                        "@Subject": "Budget Request - New Work Item ({0})",
                                        "@RoleCategory": "Collaborator",
                                        "Action": [
                                            {
                                                "@Name": "Approve",
                                                "@State": "Done",
                                                "Tooltip": "\r\n            Approve the request and submit audit date\r\n          "
                                            },
                                            {
                                                "@Name": "Decline",
                                                "@State": "Cancel",
                                                "@RequireComments": "True",
                                                "Tooltip": "\r\n            Cancel the entire request\r\n          "
                                            },
                                            {
                                                "@Name": "Revise/Hold",
                                                "@Target": "Revise",
                                                "@RequireComments": "True",
                                                "Invalidate": [
                                                    {
                                                        "@Step": "Admin"
                                                    },
                                                    {
                                                        "@Step": "VPLevel"
                                                    }
                                                ],
                                                "Tooltip": "\r\n            Send the request back to the original creator\r\n          "
                                            }
                                        ],
                                        "@RoleName": "Chief Technology Officer"
                                    },
                                    {
                                        "@Role": "PRES",
                                        "@Form": "CARAppComments.aspx",
                                        "@DoneForm": "CARComments.aspx",
                                        "@Title": "Add Comments/Approve",
                                        "@MailTemplate": "Assign1.xsl",
                                        "@Subject": "Budget Request - New Work Item ({0})",
                                        "@RoleCategory": "Approver",
                                        "Action": [
                                            {
                                                "@Name": "Approve",
                                                "@State": "Done",
                                                "Tooltip": "Approve the CAR and submit comments",
                                                "@JavaScript": "$('.bwRequest').bwRequest('cmdApproveRequest');"
                                            },
                                            {
                                                "@Name": "Decline",
                                                "@State": "Cancel",
                                                "@RequireComments": "True",
                                                "Tooltip": "Decline the entire CAR"
                                            },
                                            {
                                                "@Name": "Revise/Hold",
                                                "@Target": "Revise",
                                                "@RequireComments": "True",
                                                "Invalidate": {
                                                    "@Step": "CLevel"
                                                },
                                                "Tooltip": "Send the CAR back to the original creator"
                                            }
                                        ],
                                        "@Cond": "    ",
                                        "@RoleName": "President"
                                    }
                                ],
                                "@EmailTemplate": "<div xcx=\"xcx213423678438-6\" style=\"background-color:#f5f6fa;font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color:black;font-size: 12pt;\"><style>                .brushedAluminum {            /*background-image: \t-webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0)   6%, hsla(0,0%,100%, .1) 7.5%, hsla(0,0%, 100%,0) 9%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,  0%,0) 0%, hsla(0,0%,  0%,0)   4%, hsla(0,0%,  0%,.03) 4.5%, hsla(0,0%,  0%,0) 6%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0) 1.2%, hsla(0,0%,100%,.15) 2.2%, hsla(0,0%,100%,0) 4%),                            -webkit-linear-gradient(-90deg, hsl(0,0%,78%)  0%, hsl(0,0%,90%) 47%, hsl(0,0%,78%) 53%, hsl(0,0%,70%)100%);*/            /* 9-25-2021 THIS IS THE COOL MENU ANIMATION! I think @keyframes below is required as well. !!!!!!! */            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);            background-size: 400% 400%;            -moz-animation: gradient 15s ease infinite;            -o-animation: gradient 15s ease infinite;            -webkit-animation: gradient 15s ease infinite;            animation: gradient 15s ease infinite;        }        @keyframes gradient {            0% {                background-position: 0% 50%;            }            50% {                background-position: 100% 50%;            }            100% {                background-position: 0% 50%;            }        }    </style>    <table style=\"width:800px;margin-left: auto; margin-right: auto;\">        <tbody><tr>            <td> </td>        </tr>        <tr>            <td>                <div style=\"float:left;\">BudgetWorkflow.com</div>                <div style=\"float:right;\">Need help? Contact me at todd@budgetworkflow.com.</div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <div style=\"background-color:white;padding:50px 50px 50px 50px;\">                    <table>                        <tbody><tr>                            <td style=\"font-size:30pt;font-weight:bold;\">Hello %⚇ Participant Friendly Name%,</td>                        </tr>                        <tr>                            <td style=\"padding:20px;\"></td>                        </tr>                        <tr>                            <td style=\"font-size:14pt;\">%Budget Request Title%: \"%Budget Request Project Title%\", is ready for you to review in the Executive Approvals step of the workflow. %✈ Budget Request Link%</td>                        </tr><tr><td></td></tr>                        <tr>                            <td style=\"font-size:14pt;\">Here are your outstanding tasks:<p>%Task Summary Section%</p><p>%☒ Unsubscribe Link%</p><p>%☯ Disclaimer/Legal Text%</p></td>                        </tr>                                               <tr>                            <td style=\"padding:30px;\"></td>                        </tr>                        <tr>                            <td style=\"text-align:center;\" align=\"center\">                                <!--<form action=\"https://budgetworkflow.com/\" method=\"get\" target=\"_blank\">                                    <input type=\"submit\" value=\"Sign In\" class=\"brushedAluminum leftButton\" />                                </form>-->                                                                <div class=\"brushedAluminum leftButton\" style=\"width:195px;height:50px;text-align: center; font-weight: bold;border:1px solid skyblue;color:white;\">                                    <a href=\"https://budgetworkflow.com\">Sign In</a>                                </div>                            </td>                        </tr>                    </tbody></table>                </div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <table>                    <tbody>                <tr>                        <td></td>                    </tr>                    <tr>                        <td>Copyright © 2012-2021 Todd Hiltz. 61 Crescent Avenue, Kentville, NS B4N 1R1 Canada. All rights reserved.</td>                    </tr>                    <tr>                        <td><span style=\"font-size:10pt;font-family: 'Courier New';\">Organization: %Organization Name%</span></td>                    </tr>                </tbody></table>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td></td>        </tr>    </tbody></table></div>",
                                "@FriendlyName": "Executive Approvals",
                                "@EmailInstructionText": "This email gets sent to people who are involved in this stage of the workflow when this step begins.",
                                "@EmailTemplateForSubject": "Executive Approval Task. %Budget Request Title%: \"%Budget Request Project Title%\""
                            },
                            {
                                "@Name": "CLevel",
                                "@Target": "Done",
                                "Assign": [
                                    {
                                        "@Role": "COO",
                                        "@Form": "CARAppComments.aspx",
                                        "@DoneForm": "CARComments.aspx",
                                        "@Title": "Add Comments/Approve",
                                        "@Cond": "  ",
                                        "@MailTemplate": "Assign1.xsl",
                                        "@Subject": "Budget Request - New Work Item ({0})",
                                        "@RoleCategory": "Approver",
                                        "Action": [
                                            {
                                                "@Name": "Approve",
                                                "@State": "Done",
                                                "Tooltip": "Approve the CAR and submit comments",
                                                "@JavaScript": "$('.bwRequest').bwRequest('cmdApproveRequest');"
                                            },
                                            {
                                                "@Name": "Cancel",
                                                "@State": "Cancel",
                                                "Tooltip": "Cancel the entire CAR"
                                            },
                                            {
                                                "@Name": "Revise/Hold",
                                                "@Target": "Revise",
                                                "@RequireComments": "True",
                                                "Invalidate": {
                                                    "@Step": "CLevel"
                                                },
                                                "Tooltip": "Send the CAR back to the original creator"
                                            }
                                        ],
                                        "@RoleName": "Chief Operating Officer"
                                    },
                                    {
                                        "@Role": "CFO",
                                        "@Form": "CARAppComments.aspx",
                                        "@DoneForm": "CARComments.aspx",
                                        "@Title": "Add Comments/Approve",
                                        "@Cond": "    ",
                                        "@MailTemplate": "Assign1.xsl",
                                        "@Subject": "Budget Request - New Work Item ({0})",
                                        "@RoleCategory": "Approver",
                                        "Action": [
                                            {
                                                "@Name": "Approve",
                                                "@State": "Done",
                                                "Tooltip": "Approve the CAR and submit comments",
                                                "@JavaScript": "$('.bwRequest').bwRequest('cmdApproveRequest');"
                                            },
                                            {
                                                "@Name": "Cancel",
                                                "@State": "Cancel",
                                                "Tooltip": "Cancel the entire CAR"
                                            },
                                            {
                                                "@Name": "Revise/Hold",
                                                "@Target": "Revise",
                                                "@RequireComments": "True",
                                                "Invalidate": {
                                                    "@Step": "CLevel"
                                                },
                                                "Tooltip": "Send the CAR back to the original creator"
                                            }
                                        ],
                                        "@RoleName": "Chief Financial Officer"
                                    },
                                    {
                                        "@Role": "CEO",
                                        "@Form": "CARAppComments.aspx",
                                        "@DoneForm": "CARComments.aspx",
                                        "@Title": "Add Comments/Approve",
                                        "@Cond": "  ",
                                        "@MailTemplate": "Assign1.xsl",
                                        "@Subject": "Budget Request - New Work Item ({0})",
                                        "@RoleCategory": "Approver",
                                        "Action": [
                                            {
                                                "@Name": "Approve",
                                                "@State": "Done",
                                                "Tooltip": "Approve the CAR and submit comments",
                                                "@JavaScript": "$('.bwRequest').bwRequest('cmdApproveRequest');"
                                            },
                                            {
                                                "@Name": "Cancel",
                                                "@State": "Cancel",
                                                "Tooltip": "Cancel the entire CAR"
                                            },
                                            {
                                                "@Name": "Revise/Hold",
                                                "@Target": "Revise",
                                                "@RequireComments": "True",
                                                "Invalidate": {
                                                    "@Step": "CLevel"
                                                },
                                                "Tooltip": "Send the CAR back to the original creator"
                                            }
                                        ],
                                        "@RoleName": "Chief Executive Officer"
                                    }
                                ],
                                "@EmailTemplate": "<div xcx=\"xcx213423678438-7\" style=\"background-color:#f5f6fa;font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color:black;font-size: 12pt;\"><style>                .brushedAluminum {            /*background-image: \t-webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0)   6%, hsla(0,0%,100%, .1) 7.5%, hsla(0,0%, 100%,0) 9%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,  0%,0) 0%, hsla(0,0%,  0%,0)   4%, hsla(0,0%,  0%,.03) 4.5%, hsla(0,0%,  0%,0) 6%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0) 1.2%, hsla(0,0%,100%,.15) 2.2%, hsla(0,0%,100%,0) 4%),                            -webkit-linear-gradient(-90deg, hsl(0,0%,78%)  0%, hsl(0,0%,90%) 47%, hsl(0,0%,78%) 53%, hsl(0,0%,70%)100%);*/            /* 9-25-2021 THIS IS THE COOL MENU ANIMATION! I think @keyframes below is required as well. !!!!!!! */            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);            background-size: 400% 400%;            -moz-animation: gradient 15s ease infinite;            -o-animation: gradient 15s ease infinite;            -webkit-animation: gradient 15s ease infinite;            animation: gradient 15s ease infinite;        }        @keyframes gradient {            0% {                background-position: 0% 50%;            }            50% {                background-position: 100% 50%;            }            100% {                background-position: 0% 50%;            }        }    </style>    <table style=\"width:800px;margin-left: auto; margin-right: auto;\">        <tbody><tr>            <td> </td>        </tr>        <tr>            <td>                <div style=\"float:left;\">BudgetWorkflow.com</div>                <div style=\"float:right;\">Need help? Contact me at todd@budgetworkflow.com.</div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <div style=\"background-color:white;padding:50px 50px 50px 50px;\">                    <table>                        <tbody><tr>                            <td style=\"font-size:30pt;font-weight:bold;\">Hello %⚇ Participant Friendly Name%,</td>                        </tr>                        <tr>                            <td style=\"padding:20px;\"></td>                        </tr>                        <tr>                            <td style=\"font-size:14pt;\">%Budget Request Title%: \"%Budget Request Project Title%\", is ready for you to review before it will be completely approved. %✈ Budget Request Link%</td>                        </tr><tr><td></td></tr>                        <tr>                            <td style=\"font-size:14pt;\">Here are your outstanding tasks:<p>%Task Summary Section%</p><p>%☒ Unsubscribe Link%</p><p>%☯ Disclaimer/Legal Text%</p></td>                        </tr>                                               <tr>                            <td style=\"padding:30px;\"></td>                        </tr>                        <tr>                            <td style=\"text-align:center;\" align=\"center\">                                <!--<form action=\"https://budgetworkflow.com/\" method=\"get\" target=\"_blank\">                                    <input type=\"submit\" value=\"Sign In\" class=\"brushedAluminum leftButton\" />                                </form>-->                                                                <div class=\"brushedAluminum leftButton\" style=\"width:195px;height:50px;text-align: center; font-weight: bold;border:1px solid skyblue;color:white;\">                                    <a href=\"https://budgetworkflow.com\">Sign In</a>                                </div>                            </td>                        </tr>                    </tbody></table>                </div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <table>                    <tbody>                <tr>                        <td></td>                    </tr>                    <tr>                        <td>Copyright © 2012-2021 Todd Hiltz. 61 Crescent Avenue, Kentville, NS B4N 1R1 Canada. All rights reserved.</td>                    </tr>                    <tr>                        <td><span style=\"font-size:10pt;font-family: 'Courier New';\">Organization: %Organization Name%</span></td>                    </tr>                </tbody></table>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td></td>        </tr>    </tbody></table></div>",
                                "@FriendlyName": "Corporate Approvals",
                                "@EmailInstructionText": "This email gets sent to people who are involved in this stage of the workflow when this step begins.",
                                "@EmailTemplateForSubject": "Corporate Approval Task. %Budget Request Title%: \"%Budget Request Project Title%\""
                            },
                            {
                                "@Name": "Done",
                                "@MasterState": "Approved",
                                "Inform": [
                                    {
                                        "@IdField": "ProjSponsorId",
                                        "@RoleName": "Project Sponsor",
                                        "@MailTemplate": "InformDone1.xsl",
                                        "@Subject": "Budget Request - Project {0} approved",
                                        "@Cond": "  ",
                                        "@Role": "BDM"
                                    }
                                ],
                                "@FriendlyName": "Completed (Done)",
                                "@EmailInstructionText": "This email gets sent to people who are involved in this stage of the workflow when this step begins.",
                                "@EmailTemplateForSubject": "Completed (Done) Task. %Budget Request Title%: \"%Budget Request Project Title%\"",
                                "@EmailTemplate": "<div xcx=\"xcx213423678438-8\" style=\"background-color:#f5f6fa;font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color:black;font-size: 12pt;\"><style>                .brushedAluminum {            /*background-image: \t-webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0)   6%, hsla(0,0%,100%, .1) 7.5%, hsla(0,0%, 100%,0) 9%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,  0%,0) 0%, hsla(0,0%,  0%,0)   4%, hsla(0,0%,  0%,.03) 4.5%, hsla(0,0%,  0%,0) 6%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0) 1.2%, hsla(0,0%,100%,.15) 2.2%, hsla(0,0%,100%,0) 4%),                            -webkit-linear-gradient(-90deg, hsl(0,0%,78%)  0%, hsl(0,0%,90%) 47%, hsl(0,0%,78%) 53%, hsl(0,0%,70%)100%);*/            /* 9-25-2021 THIS IS THE COOL MENU ANIMATION! I think @keyframes below is required as well. !!!!!!! */            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);            background-size: 400% 400%;            -moz-animation: gradient 15s ease infinite;            -o-animation: gradient 15s ease infinite;            -webkit-animation: gradient 15s ease infinite;            animation: gradient 15s ease infinite;        }        @keyframes gradient {            0% {                background-position: 0% 50%;            }            50% {                background-position: 100% 50%;            }            100% {                background-position: 0% 50%;            }        }    </style>    <table style=\"width:800px;margin-left: auto; margin-right: auto;\">        <tbody><tr>            <td> </td>        </tr>        <tr>            <td>                <div style=\"float:left;\">BudgetWorkflow.com</div>                <div style=\"float:right;\">Need help? Contact me at todd@budgetworkflow.com.</div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <div style=\"background-color:white;padding:50px 50px 50px 50px;\">                    <table>                        <tbody><tr>                            <td style=\"font-size:30pt;font-weight:bold;\">Hello %⚇ Participant Friendly Name%,</td>                        </tr>                        <tr>                            <td style=\"padding:20px;\"></td>                        </tr>                        <tr>                            <td style=\"font-size:14pt;\">%Budget Request Title%: \"%Budget Request Project Title%\", has been approved, and is ready to move to the \"Issue Purchase Order Number\" step of the workflow. %✈ Budget Request Link%</td>                        </tr><tr><td></td></tr>                        <tr>                            <td style=\"font-size:14pt;\">Here are your outstanding tasks:<p>%Task Summary Section%</p><p>%☒ Unsubscribe Link%</p><p>%☯ Disclaimer/Legal Text%</p></td>                        </tr>                                               <tr>                            <td style=\"padding:30px;\"></td>                        </tr>                        <tr>                            <td style=\"text-align:center;\" align=\"center\">                                <!--<form action=\"https://budgetworkflow.com/\" method=\"get\" target=\"_blank\">                                    <input type=\"submit\" value=\"Sign In\" class=\"brushedAluminum leftButton\" />                                </form>-->                                                                <div class=\"brushedAluminum leftButton\" style=\"width:195px;height:50px;text-align: center; font-weight: bold;border:1px solid skyblue;color:white;\">                                    <a href=\"https://budgetworkflow.com\">Sign In</a>                                </div>                            </td>                        </tr>                    </tbody></table>                </div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <table>                    <tbody>                 <tr>                        <td></td>                    </tr>                    <tr>                        <td>Copyright © 2012-2021 Todd Hiltz. 61 Crescent Avenue, Kentville, NS B4N 1R1 Canada. All rights reserved.</td>                    </tr>                    <tr>                        <td><span style=\"font-size:10pt;font-family: 'Courier New';\">Organization: %Organization Name%</span></td>                    </tr>                </tbody></table>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td></td>        </tr>    </tbody></table></div>"
                            },
                            {
                                "@Name": "IssueOrderNumber",
                                "@MasterState": "Approved",
                                "Inform": [
                                    {
                                        "@Role": "ACCT",
                                        "@MailTemplate": "InformDone1.xsl",
                                        "@Subject": "Budget Request - Project {0} approved",
                                        "@Cond": "  ",
                                        "@RoleName": "Accountant"
                                    }
                                ],
                                "@EmailTemplate": "<div xcx=\"xcx213423678438-9\" style=\"background-color:#f5f6fa;font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color:black;font-size: 12pt;\"><style>                .brushedAluminum {            /*background-image: \t-webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0)   6%, hsla(0,0%,100%, .1) 7.5%, hsla(0,0%, 100%,0) 9%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,  0%,0) 0%, hsla(0,0%,  0%,0)   4%, hsla(0,0%,  0%,.03) 4.5%, hsla(0,0%,  0%,0) 6%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0) 1.2%, hsla(0,0%,100%,.15) 2.2%, hsla(0,0%,100%,0) 4%),                            -webkit-linear-gradient(-90deg, hsl(0,0%,78%)  0%, hsl(0,0%,90%) 47%, hsl(0,0%,78%) 53%, hsl(0,0%,70%)100%);*/            /* 9-25-2021 THIS IS THE COOL MENU ANIMATION! I think @keyframes below is required as well. !!!!!!! */            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);            background-size: 400% 400%;            -moz-animation: gradient 15s ease infinite;            -o-animation: gradient 15s ease infinite;            -webkit-animation: gradient 15s ease infinite;            animation: gradient 15s ease infinite;        }        @keyframes gradient {            0% {                background-position: 0% 50%;            }            50% {                background-position: 100% 50%;            }            100% {                background-position: 0% 50%;            }        }    </style>    <table style=\"width:800px;margin-left: auto; margin-right: auto;\">        <tbody><tr>            <td> </td>        </tr>        <tr>            <td>                <div style=\"float:left;\">BudgetWorkflow.com</div>                <div style=\"float:right;\">Need help? Contact me at todd@budgetworkflow.com.</div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <div style=\"background-color:white;padding:50px 50px 50px 50px;\">                    <table>                        <tbody><tr>                            <td style=\"font-size:30pt;font-weight:bold;\">Hello %⚇ Participant Friendly Name%,</td>                        </tr>                        <tr>                            <td style=\"padding:20px;\"></td>                        </tr>                        <tr>                            <td style=\"font-size:14pt;\">%Budget Request Title%: \"%Budget Request Project Title%\", is ready for you to assign a Purchase Order Number. %✈ Budget Request Link%</td>                        </tr><tr><td></td></tr>                        <tr>                            <td style=\"font-size:14pt;\">Here are your outstanding tasks:<p>%Task Summary Section%</p><p>%☒ Unsubscribe Link%</p><p>%☯ Disclaimer/Legal Text%</p></td>                        </tr>                                               <tr>                            <td style=\"padding:30px;\"></td>                        </tr>                        <tr>                            <td style=\"text-align:center;\" align=\"center\">                                <!--<form action=\"https://budgetworkflow.com/\" method=\"get\" target=\"_blank\">                                    <input type=\"submit\" value=\"Sign In\" class=\"brushedAluminum leftButton\" />                                </form>-->                                                                <div class=\"brushedAluminum leftButton\" style=\"width:195px;height:50px;text-align: center; font-weight: bold;border:1px solid skyblue;color:white;\">                                    <a href=\"https://budgetworkflow.com\">Sign In</a>                                </div>                            </td>                        </tr>                    </tbody></table>                </div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <table>                    <tbody>                 <tr>                        <td></td>                    </tr>                    <tr>                        <td>Copyright © 2012-2021 Todd Hiltz. 61 Crescent Avenue, Kentville, NS B4N 1R1 Canada. All rights reserved.</td>                    </tr>                    <tr>                        <td><span style=\"font-size:10pt;font-family: 'Courier New';\">Organization: %Organization Name%</span></td>                    </tr>                </tbody></table>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td></td>        </tr>    </tbody></table></div>",
                                "@FriendlyName": "Issue Purchase Order Number",
                                "@EmailInstructionText": "This email gets sent to people who are involved in this stage of the workflow when this step begins.",
                                "@EmailTemplateForSubject": "Issue Purchase Number Task. %Budget Request Title%: \"%Budget Request Project Title%\""
                            }
                        ]
                    },
                    "EmailTemplate_Informed": "",
                    "EmailTemplate_TaskAssigned": "",
                    "EmailTemplate_TaskCancelled": "",
                    "EmailTemplateForSubject_Informed": "Informed subject line\n",
                    "EmailTemplateForSubject_TaskAssigned": "Task assigned to %Role Name% (%Role Abbreviation%). %SUBJECT STEP EMAIL TEXT PLACEHOLDER% on %Budget Request Number%: %Budget Request Title%\n",
                    "EmailTemplateForSubject_TaskCancelled": "Task Canceled:  %Budget Request Number%: %Budget Request Title%\n",
                    "@EmailTemplateForSubject_TaskOverdue": "%⚇ Participant Friendly Name%, you have %# Qty of Budget Requests with Tasks% Budget Requests(s) which are waiting for your input. ",
                    "@EmailTemplate_TaskOverdue": '<div style="background-color:#f5f6fa;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color:black;font-size: 12pt;"><style>                .brushedAluminum {            /*background-image: 	-webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0)   6%, hsla(0,0%,100%, .1) 7.5%, hsla(0,0%, 100%,0) 9%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,  0%,0) 0%, hsla(0,0%,  0%,0)   4%, hsla(0,0%,  0%,.03) 4.5%, hsla(0,0%,  0%,0) 6%),                            -webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0) 1.2%, hsla(0,0%,100%,.15) 2.2%, hsla(0,0%,100%,0) 4%),                            -webkit-linear-gradient(-90deg, hsl(0,0%,78%)  0%, hsl(0,0%,90%) 47%, hsl(0,0%,78%) 53%, hsl(0,0%,70%)100%);*/            /* 9-25-2021 THIS IS THE COOL MENU ANIMATION! I think @keyframes below is required as well. !!!!!!! */            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);            background-size: 400% 400%;            -moz-animation: gradient 15s ease infinite;            -o-animation: gradient 15s ease infinite;            -webkit-animation: gradient 15s ease infinite;            animation: gradient 15s ease infinite;        }        @keyframes gradient {            0% {                background-position: 0% 50%;            }            50% {                background-position: 100% 50%;            }            100% {                background-position: 0% 50%;            }        }    </style>    <table style="width:800px;margin-left: auto; margin-right: auto;">        <tbody><tr>            <td>&nbsp;</td>        </tr>        <tr>            <td>                <div style="float:left;">BudgetWorkflow.com</div>                <div style="float:right;">Need help? Contact me at todd@budgetworkflow.com.</div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <div style="background-color:white;padding:50px 50px 50px 50px;">                    <table>                        <tbody><tr>                            <td style="font-size:30pt;font-weight:bold;">Hello %⚇ Participant Friendly Name%,</td>                        </tr>                        <tr>                            <td style="padding:20px;"></td>                        </tr>                        <tr>                            <td style="font-size:14pt;">You have overdue task(s).<hr>%✈ Budget Request Link%&nbsp;&nbsp;</td></tr></tbody></table><br>%Attachment and Inventory Images%<table><tbody><tr>                        </tr><tr><td></td></tr>                        <tr>                            <td style="font-size:14pt;">Here are your outstanding tasks:<p>%Task Summary Section%</p><p>%☒ Unsubscribe Link%</p><p>%☯ Disclaimer/Legal Text%</p></td>                        </tr>                                               <tr>                            <td style="padding:30px;"></td>                        </tr>                        <tr>                            <td style="text-align:center;" align="center">                                <!--<form action="https://budgetworkflow.com/" method="get" target="_blank">                                    <input type="submit" value="Sign In" class="brushedAluminum leftButton" />                                </form>-->                                                                <div class="brushedAluminum leftButton" style="width:195px;height:50px;text-align: center; font-weight: bold;border:1px solid skyblue;color:white;">                                    <a href="https://budgetworkflow.com">Sign In</a>                                </div>                            </td>                        </tr>                    </tbody></table>                </div>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td>                <table>                    <tbody>                <tr>                        <td></td>                    </tr>                    <tr>                        <td>Copyright © 2012-2021 Todd Hiltz. 61 Crescent Avenue, Kentville, NS B4N 1R1 Canada. All rights reserved.</td>                    </tr>                    <tr>                        <td><span style="font-size:10pt;font-family: \'Courier New\';">Organization: %Organization Name%</span></td>                    </tr>                </tbody></table>            </td>        </tr>        <tr>            <td></td>        </tr>        <tr>            <td></td>        </tr>    </tbody></table></div>'
                }
            };

            this.element.addClass("bwAuthentication");
            var thiz = this; // Need this because of the asynchronous operations below.

            selfDiscoverOperationUri(thiz); // This sets this.options.operationUriPrefix correctly.

            //alert('xcx213124 window.location.href: ' + window.location.href + '. <<<< IS THIS TRUE???');

            var openrequest = this.getUrlParams('openrequest');

            var participantId;

            try {
                // This is in a try-catch because if the link comes from an email client, you get this error: [Blocked a frame with origin "https://shareandcollaborate.com" from accessing a cross-origin frame.]
                if (window.opener) {
                    participantId = window.opener.$('.bwAuthentication').bwAuthentication('option', 'participantId');
                }
            } catch (e) { }

            if (openrequest && participantId) { // Only recognize openrequest here if the user is logged in.

                console.log('');
                console.log('/////////////////////////////////////');
                console.log('In bwAuthentication.js._create(). THIS IS A PLACE WHERE THE POPPED-OUT WINDOW IS HANDLED.');
                console.log('/////////////////////////////////////');
                console.log('');
                //
                // THIS IS WHERE THE NEW REQUEST WINDOW IS HANDLED.
                //
                var requestId1 = this.getUrlParams('request');
                var activeStateIdentifier = this.getUrlParams('ActiveStateIdentifier');

                var tenantId = window.opener.$('.bwAuthentication').bwAuthentication('option', 'tenantId');
                var workflowAppId = window.opener.$('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
                var participantId = window.opener.$('.bwAuthentication').bwAuthentication('option', 'participantId');
                var participantEmail = window.opener.$('.bwAuthentication').bwAuthentication('option', 'participantEmail');
                var participantFriendlyName = window.opener.$('.bwAuthentication').bwAuthentication('option', 'participantFriendlyName');
                var participantLogonType = window.opener.$('.bwAuthentication').bwAuthentication('option', 'participantLogonType');
                var participantLogonTypeUserId = window.opener.$('.bwAuthentication').bwAuthentication('option', 'participantLogonTypeUserId');
                var bwEnabledRequestTypes = window.opener.$('.bwAuthentication').bwAuthentication('option', 'bwEnabledRequestTypes');

                $('.bwAuthentication').bwAuthentication({ tenantId: tenantId, workflowAppId: workflowAppId, participantId: participantId, participantEmail: participantEmail, participantFriendlyName: participantFriendlyName, participantLogonType: participantLogonType, participantLogonTypeUserId: participantLogonTypeUserId, bwEnabledRequestTypes: bwEnabledRequestTypes });

                // Initialize this here so that we can support offline requests (on this device).

                //// Scrape the JSON from the originating request form.
                //var promise = this.scrapeBwRequestJson(bwBudgetRequestId);
                //promise.then(function (bwRequestJson) {
                //    try {
                console.log('In bwAuthentication.js._create(). Instantiating bwRequest widget and calling displayRequestFormInNewBrowserWindow().');
                //alert('In bwAuthentication.js._create(). Instantiating bwRequest widget and calling displayRequestFormInNewBrowserWindow().');

                this.renderDialogDivs().then(function () {
                    try {

                        console.log('********************');
                        console.log('RETURNED FROM bwAuthentication.js.renderDialogDivs(). Preparing to instantiate bwRequest.js.');
                        console.log('********************');

                        var $bwRequest = $('#divBwRequest').bwRequest({});
                        $('.bwRequest').bwRequest('displayRequestFormInNewBrowserWindow', requestId1);

                    } catch (e) {
                        console.log('Exception in In bwAuthentication.js._create(). xcx21313412-2: ' + e.message + ', ' + e.stack);
                        displayAlertDialog('Exception in In bwAuthentication.js._create(). xcx21313412-2: ' + e.message + ', ' + e.stack);
                    }
                }).catch(function (e) {
                    console.log('Exception in In bwAuthentication.js._create(). xcx21313412: ' + JSON.stringify(e));
                    displayAlertDialog('Exception in In bwAuthentication.js._create(). xcx21313412: ' + JSON.stringify(e));
                });

            } else if (this.options.backendAdministrationLogin == true) {

                console.log('In bwAuthentication.js._create(). this.options.backendAdministrationLogin == true');

                // SET THE THEME HERE FOR BACKEND ADMIN!!!!!!!!!!!!!!!!!!!!!!!!!!! 12-15-2022
                console.log('In bwAuthentication.js._create(). SET THE THEME HERE FOR BACKEND ADMIN!!!!!!!!!!!!!!!!!!!!!!!!!!! 12-15-2022');
                this.options.workflowAppTheme = 'brushedAluminum_admin';

                // This try catch is so we can keep admin2.html working while we get the new admin.html page working 100%.
                try {
                    $('#divBwActiveMenu').bwActiveMenu_Admin({ HomePage: true });
                } catch (e) {
                    $('#divBwActiveMenu').bwActiveMenu({ HomePage: true });
                }

                // Commented out the following 12-14-2022
                this.renderDialogDivsForBackendAdministration();

                try {
                    //debugger;
                    if (document.getElementById('spanAzureADConnectionDetails')) {
                        // Bind the click event. This has to happen here because this module will be instantiated after the link is presented on the screen. A race condition I suppose.
                        //
                        $('#spanAzureADConnectionDetails').off('click').click(function (error) {
                            console.log('In bwAuthentication._create.spanAzureADConnectionDetails.click().');
                            if (document.getElementById('spanAzureADConnectionDetails').innerHTML.indexOf('Microsoft') > -1) {
                                thiz.displayAzureADConnectionDetails();
                            } else {
                                thiz.displayBudgetWorkflowTwoFactorAuthenticationDetails();
                            }
                        });
                    }
                } catch (e) { }

                if (participantId) {

                    this.initializeTheLogonForParticipantIdAndDisplayUnsubscribePage(participantId);

                } else {

                    this.checkIfAuthenticatedAndProcessQuerystringParameters();

                }

            } else {

                console.log('In bwAuthentication.js._create(). this.options.backendAdministrationLogin != true');

                $('#divBwActiveMenu').bwActiveMenu({}); // First, we instantiate the widget. The rendering is called from xx and xx. 4-16-2022       // old: HomePage: true }); // First, we display the page.

                this.renderDialogDivs().then(function () {

                    if (thiz.options.participantId) {

                        thiz.initializeTheLogonForParticipantIdAndDisplayUnsubscribePage(thiz.options.participantId);

                    } else {

                        thiz.checkIfAuthenticatedAndProcessQuerystringParameters();

                    }

                }).catch(function (e) {

                    console.log('xcx21234132 ' + JSON.stringify(e));
                    alert('xcx21234132 ' + JSON.stringify(e));

                });

            }









            //// Ping the server to make sure it is running. If not, put a message on the screen.
            ////
            //console.log('In bwAuthentication.js._create(). Ping the server to make sure it is running. If not, put a message on the screen.');

            //var item = {
            //    "Errors": 'No error, just doing a ping test for a response.'
            //};
            //$.ajax({
            //    url: this.options.operationUriPrefix + "_bw/writearchivederrorstoexceptionlog",
            //    type: "POST",
            //    data: item,
            //    timeout: 2000,
            //    headers: {
            //        "Accept": "application/json; odata=verbose"
            //    },
            //    success: function (data) {
            //        try {

            //            console.log('The service responded at ' + thiz.options.operationUriPrefix + ', data: ' + JSON.stringify(data));
            //            //alert('The service responded at ' + thiz.options.operationUriPrefix);

            //            page_Load();

            //        } catch (e) {
            //            //console.log('Exception in checkConnectionAndRemoveBlueBarErrorMessage():2: ' + e.message + ', ' + e.stack);
            //            //displayAlertDialog('Exception in checkConnectionAndRemoveBlueBarErrorMessage():2: ' + e.message + ', ' + e.stack);
            //        }
            //    },
            //    error: function (data) {
            //        // alert('ERROR checkConnectionAndRemoveAlertDialog ERROR:' + JSON.stringify(data));

            //        var html = '';

            //        html += '<span style="font-size:25pt;font-weight:bold;color:tomato;">';
            //        html += '<br />' + thiz.options.ServiceUnavailableMessage + '<br />';
            //        html += '</span>';

            //        //alert(html);

            //        document.getElementById('divSignInOrSignUpIndexPageButtons').innerHTML = html;

            //    }
            //});
            ////
            //// end: Ping the server to make sure it is running. If not, put a message on the screen.
            ////













            console.log('In bwAuthentication._create(). The widget has been initialized.');

        } catch (e) {

            var msg = 'Exception in bwAuthentication._create(): ' + e.message + ', ' + e.stack;
            console.log(msg);
            displayAlertDialog(msg);

            var html = '';
            html += '<span style="font-size:24pt;color:red;">Failed to initialize authentication module.</span>';
            html += '<br />';
            html += '<span style="">Exception in bwAuthentication._create(): ' + e.message + ', ' + e.stack + '</span>';
            thiz.element.html(html);
        }

    },



    _setOption: function (key, value) {
        this.options[key] = value;
        this._update();
    },
    _update: function () {
        try {
            //debugger;
            console.log('In _update(). This does nothing! (yet)');
        } catch (e) {
            console.log('Exception in _update(): ' + e.message + ', ' + e.stack);
        }
    },
    _destroy: function () {
        this.element
            .removeClass("bwAuthentication")
            .text("");
    },
    purchaseTest: function () {
        try {
            console.log('In bwAuthentication.js.purchaseTest().');

            var json = {};
            var operationUri = this.options.operationUriPrefix + "_bw/create_checkout_session";
            $.ajax({
                url: operationUri,
                type: "POST",
                data: json,
                headers: {
                    "Accept": "application/json; odata=verbose"
                },
                success: function (results) {
                    try {

                        if (results.status != 'SUCCESS') {
                            displayAlertDialog('xcx123234234-1 ' + JSON.stringify(results));
                        } else {

                            if (!results.results.url) {
                                displayAlertDialog('Error: Stripe provided no forwarding url. xcx123234234-2 ' + JSON.stringify(results));
                            } else {

                                // Display the Stripe url.
                                window.location = results.results.url;

                            }

                        }

                    } catch (e) {
                        console.log('Exception in bwAuthentication.js.purchaseTest():2: ' + e.message + ', ' + e.stack);
                        displayAlertDialog('Exception in bwAuthentication.js.purchaseTest():2: ' + e.message + ', ' + e.stack);
                    }
                },
                error: function (data, errorCode, errorMessage) {
                    console.log('Error in bwAuthentication.js.purchaseTest(). ' + errorMessage + ', ' + errorCode + ', ' + JSON.stringify(data));
                    displayAlertDialog('Error in bwAuthentication.js.purchaseTest(). ' + errorMessage + ', ' + errorCode + ', ' + JSON.stringify(data));
                }
            });

        } catch (e) {
            console.log('Exception in bwAuthentication.js.purchaseTest(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.purchaseTest(): ' + e.message + ', ' + e.stack);
        }
    },
    purchase_one_month_low_traffic_hosting: function () {
        try {
            console.log('In bwAuthentication.js.purchase_one_month_low_traffic_hosting().');

            var json = {};
            var operationUri = this.options.operationUriPrefix + "_bw/stripe_one_month_low_traffic_hosting";
            $.ajax({
                url: operationUri,
                type: "POST",
                data: json,
                headers: {
                    "Accept": "application/json; odata=verbose"
                },
                success: function (results) {
                    try {

                        if (results.status != 'SUCCESS') {
                            displayAlertDialog('xcx123234234-2 ' + JSON.stringify(results));
                        } else {

                            if (!results.results.url) {
                                displayAlertDialog('Error: Stripe provided no forwarding url. xcx123234234-2 ' + JSON.stringify(results));
                            } else {

                                // Display the Stripe url.
                                window.location = results.results.url;

                            }

                        }

                    } catch (e) {
                        console.log('Exception in bwAuthentication.js.purchase_one_month_low_traffic_hosting():2: ' + e.message + ', ' + e.stack);
                        displayAlertDialog('Exception in bwAuthentication.js.purchase_one_month_low_traffic_hosting():2: ' + e.message + ', ' + e.stack);
                    }
                },
                error: function (data, errorCode, errorMessage) {
                    console.log('Error in bwAuthentication.js.purchase_one_month_low_traffic_hosting(). ' + errorMessage + ', ' + errorCode + ', ' + JSON.stringify(data));
                    displayAlertDialog('Error in bwAuthentication.js.purchase_one_month_low_traffic_hosting(). ' + errorMessage + ', ' + errorCode + ', ' + JSON.stringify(data));
                }
            });

        } catch (e) {
            console.log('Exception in bwAuthentication.js.purchase_one_month_low_traffic_hosting(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.purchase_one_month_low_traffic_hosting(): ' + e.message + ', ' + e.stack);
        }
    },
    purchase_one_year_low_traffic_hosting: function () {
        try {
            console.log('In bwAuthentication.js.purchase_one_year_low_traffic_hosting().');

            var json = {};
            var operationUri = this.options.operationUriPrefix + "_bw/stripe_one_year_low_traffic_hosting";
            $.ajax({
                url: operationUri,
                type: "POST",
                data: json,
                headers: {
                    "Accept": "application/json; odata=verbose"
                },
                success: function (results) {
                    try {

                        if (results.status != 'SUCCESS') {
                            displayAlertDialog('xcx123234234-2 ' + JSON.stringify(results));
                        } else {

                            if (!results.results.url) {
                                displayAlertDialog('Error: Stripe provided no forwarding url. xcx123234234-2 ' + JSON.stringify(results));
                            } else {

                                // Display the Stripe url.
                                window.location = results.results.url;

                            }

                        }

                    } catch (e) {
                        console.log('Exception in bwAuthentication.js.purchase_one_year_low_traffic_hosting():2: ' + e.message + ', ' + e.stack);
                        displayAlertDialog('Exception in bwAuthentication.js.purchase_one_year_low_traffic_hosting():2: ' + e.message + ', ' + e.stack);
                    }
                },
                error: function (data, errorCode, errorMessage) {
                    console.log('Error in bwAuthentication.js.purchase_one_year_low_traffic_hosting(). ' + errorMessage + ', ' + errorCode + ', ' + JSON.stringify(data));
                    displayAlertDialog('Error in bwAuthentication.js.purchase_one_year_low_traffic_hosting(). ' + errorMessage + ', ' + errorCode + ', ' + JSON.stringify(data));
                }
            });

        } catch (e) {
            console.log('Exception in bwAuthentication.js.purchase_one_year_low_traffic_hosting(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.purchase_one_year_low_traffic_hosting(): ' + e.message + ', ' + e.stack);
        }
    },
    purchase_one_hour_support: function () {
        try {
            console.log('In bwAuthentication.js.purchase_one_hour_support().');

            var json = {};
            var operationUri = this.options.operationUriPrefix + "_bw/stripe_one_hour_support";
            $.ajax({
                url: operationUri,
                type: "POST",
                data: json,
                headers: {
                    "Accept": "application/json; odata=verbose"
                },
                success: function (results) {
                    try {

                        if (results.status != 'SUCCESS') {
                            displayAlertDialog('xcx123234234-3 ' + JSON.stringify(results));
                        } else {

                            if (!results.results.url) {
                                displayAlertDialog('Error: Stripe provided no forwarding url. xcx123234234-2 ' + JSON.stringify(results));
                            } else {

                                // Display the Stripe url.
                                window.location = results.results.url;

                            }

                        }

                    } catch (e) {
                        console.log('Exception in bwAuthentication.js.purchase_one_hour_support():2: ' + e.message + ', ' + e.stack);
                        displayAlertDialog('Exception in bwAuthentication.js.purchase_one_hour_support():2: ' + e.message + ', ' + e.stack);
                    }
                },
                error: function (data, errorCode, errorMessage) {
                    console.log('Error in bwAuthentication.js.purchase_one_hour_support(). ' + errorMessage + ', ' + errorCode + ', ' + JSON.stringify(data));
                    displayAlertDialog('Error in bwAuthentication.js.purchase_one_hour_support(). ' + errorMessage + ', ' + errorCode + ', ' + JSON.stringify(data));
                }
            });

        } catch (e) {
            console.log('Exception in bwAuthentication.js.purchase_one_hour_support(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.purchase_one_hour_support(): ' + e.message + ', ' + e.stack);
        }
    },
    purchase_one_hour_flyover: function () {
        try {
            console.log('In bwAuthentication.js.purchase_one_hour_flyover().');

            var json = {};
            var operationUri = this.options.operationUriPrefix + "_bw/stripe_one_hour_flyover";
            $.ajax({
                url: operationUri,
                type: "POST",
                data: json,
                headers: {
                    "Accept": "application/json; odata=verbose"
                },
                success: function (results) {
                    try {

                        if (results.status != 'SUCCESS') {
                            displayAlertDialog('xcx123234234-3 ' + JSON.stringify(results));
                        } else {

                            if (!results.results.url) {
                                displayAlertDialog('Error: Stripe provided no forwarding url. xcx123234234-2 ' + JSON.stringify(results));
                            } else {

                                // Display the Stripe url.
                                window.location = results.results.url;

                            }

                        }

                    } catch (e) {
                        console.log('Exception in bwAuthentication.js.purchase_one_hour_flyover():2: ' + e.message + ', ' + e.stack);
                        displayAlertDialog('Exception in bwAuthentication.js.purchase_one_hour_flyover():2: ' + e.message + ', ' + e.stack);
                    }
                },
                error: function (data, errorCode, errorMessage) {
                    console.log('Error in bwAuthentication.js.purchase_one_hour_flyover(). ' + errorMessage + ', ' + errorCode + ', ' + JSON.stringify(data));
                    displayAlertDialog('Error in bwAuthentication.js.purchase_one_hour_flyover(). ' + errorMessage + ', ' + errorCode + ', ' + JSON.stringify(data));
                }
            });

        } catch (e) {
            console.log('Exception in bwAuthentication.js.purchase_one_hour_flyover(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.purchase_one_hour_flyover(): ' + e.message + ', ' + e.stack);
        }
    },
    purchase_source_code: function () {
        try {
            console.log('In bwAuthentication.js.purchase_source_code().');

            var json = {};
            var operationUri = this.options.operationUriPrefix + "_bw/stripe_source_code";
            $.ajax({
                url: operationUri,
                type: "POST",
                data: json,
                headers: {
                    "Accept": "application/json; odata=verbose"
                },
                success: function (results) {
                    try {

                        if (results.status != 'SUCCESS') {
                            displayAlertDialog('xcx123234234-4 ' + JSON.stringify(results));
                        } else {

                            if (!results.results.url) {
                                displayAlertDialog('Error: Stripe provided no forwarding url. xcx123234234-2 ' + JSON.stringify(results));
                            } else {

                                // Display the Stripe url.
                                window.location = results.results.url;

                            }

                        }

                    } catch (e) {
                        console.log('Exception in bwAuthentication.js.purchase_source_code():2: ' + e.message + ', ' + e.stack);
                        displayAlertDialog('Exception in bwAuthentication.js.purchase_source_code():2: ' + e.message + ', ' + e.stack);
                    }
                },
                error: function (data, errorCode, errorMessage) {
                    console.log('Error in bwAuthentication.js.purchase_source_code(). ' + errorMessage + ', ' + errorCode + ', ' + JSON.stringify(data));
                    displayAlertDialog('Error in bwAuthentication.js.purchase_source_code(). ' + errorMessage + ', ' + errorCode + ', ' + JSON.stringify(data));
                }
            });

        } catch (e) {
            console.log('Exception in bwAuthentication.js.purchase_source_code(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.purchase_source_code(): ' + e.message + ', ' + e.stack);
        }
    },
    deploy_to_hosted_servers: function () {
        try {
            console.log('In bwAuthentication.js.deploy_to_hosted_servers().');

            var json = {};
            var operationUri = this.options.operationUriPrefix + "_bw/stripe_deploy_to_hosted_servers";
            $.ajax({
                url: operationUri,
                type: "POST",
                data: json,
                headers: {
                    "Accept": "application/json; odata=verbose"
                },
                success: function (results) {
                    try {

                        if (results.status != 'SUCCESS') {
                            displayAlertDialog('xcx123234234-4 ' + JSON.stringify(results));
                        } else {

                            if (!results.results.url) {
                                displayAlertDialog('Error: Stripe provided no forwarding url. xcx123234234-2 ' + JSON.stringify(results));
                            } else {

                                // Display the Stripe url.
                                window.location = results.results.url;

                            }

                        }

                    } catch (e) {
                        console.log('Exception in bwAuthentication.js.deploy_to_hosted_servers():2: ' + e.message + ', ' + e.stack);
                        displayAlertDialog('Exception in bwAuthentication.js.deploy_to_hosted_servers():2: ' + e.message + ', ' + e.stack);
                    }
                },
                error: function (data, errorCode, errorMessage) {
                    console.log('Error in bwAuthentication.js.deploy_to_hosted_servers(). ' + errorMessage + ', ' + errorCode + ', ' + JSON.stringify(data));
                    displayAlertDialog('Error in bwAuthentication.js.deploy_to_hosted_servers(). ' + errorMessage + ', ' + errorCode + ', ' + JSON.stringify(data));
                }
            });

        } catch (e) {
            console.log('Exception in bwAuthentication.js.deploy_to_hosted_servers(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.deploy_to_hosted_servers(): ' + e.message + ', ' + e.stack);
        }
    },
    checkIfWeNeedToUpdateTheHomepage: function (bwBudgetRequestId) {
        try {
            console.log('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). bwBudgetRequestId: ' + bwBudgetRequestId);
            //alert('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). bwBudgetRequestId: ' + bwBudgetRequestId);

            var window1 = window; // This is how we make this work for popped-out request dialog windows.
            if (window.opener) {
                window1 = window.opener;
            }

            //
            // Check if the request is being displayed on the home screen. If so, refresh it. 8-20-2022
            // IDEALLY THIS WOULD LOOK FOR THE ELEMENT/REQUEST ON THE SCREEN AND JUST DISPLAYING THAT ELEMENT, AND NOT THE WHOLE SCREEN..... 
            //                                                                  Use the class "executiveSummaryInCarousel", so that we can find it... maybe also attribute bwbudgetrequestid as well.
            //
            var classes = window1.$('#divWelcomeButton').attr('class');
            if (classes.indexOf('_SelectedButton') > -1) {
                // The home page is being displayed.
                window1.scrollTo(0, 0); // Scroll to top on button click. This makes sure things render Ok, and also just seems like a nicer user experience.
                //$('.bwAuthentication').bwAuthentication('renderHomePagePersonalizedSection_AndRenderButtons'); // thiz.renderHomePagePersonalizedSection_AndRenderButtons();

                var executiveSummaries = window1.$('.executiveSummaryInCarousel');
                if (executiveSummaries && executiveSummaries.length && executiveSummaries.length > 0) {
                    for (var i = 0; i < executiveSummaries.length; i++) {

                        var budgetRequestId = window1.$(executiveSummaries[i]).attr('bwbudgetrequestid');

                        if (bwBudgetRequestId == budgetRequestId) {
                            // We found it. Redisplay!
                            //$(executiveSummaries[i]).html('We just changed this request... we need to redisplay it here. bwBudgetRequestId: ' + bwBudgetRequestId);

                            console.log('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). We just changed this request... we need to redisplay it here. bwBudgetRequestId: ' + bwBudgetRequestId);

                            var executiveSummariesIndex = i;

                            var promise = $('.bwRequest').bwRequest('scrapeBwRequestJson', bwBudgetRequestId);
                            promise.then(function (results) {
                                try {
                                    var bwRequestJson = results.bwRequestJson;

                                    var workflowTaskItemId = window1.$(executiveSummaries[executiveSummariesIndex]).attr('bwworkflowtaskitemid');

                                    if (workflowTaskItemId) {

                                        // Task item. Call renderExecutiveSummaryForTask().

                                        // Get the task json.
                                        var taskJson;
                                        var tasks = $('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'taskData');
                                        for (var i = 0; i < tasks.length; i++) {
                                            if (workflowTaskItemId == tasks[i].bwWorkflowTaskItemId) {
                                                // We found the task json.
                                                taskJson = tasks[i];
                                                break;
                                            }
                                        }

                                        taskJson["bwRequestJson"] = JSON.stringify(bwRequestJson); // The scraped, new form data, added to the existing task data.
                                        //
                                        // The following json properties have to bubble up from bwRequestJson, to be duplicated at the top level of the request json. This is done to maximize query speed in Mongo. It is the only duplicated data in the entire system, so don't complain lol!! :)
                                        // OrgId, OrgName, ProjectTitle, RequestedCapital.
                                        //
                                        if (bwRequestJson.bwLocationPicker && bwRequestJson.bwLocationPicker.value && bwRequestJson.bwLocationPicker.value.bwOrgId) {
                                            taskJson["OrgId"] = bwRequestJson.bwLocationPicker.value.bwOrgId;
                                        }

                                        if (bwRequestJson.bwLocationPicker && bwRequestJson.bwLocationPicker.value && bwRequestJson.bwLocationPicker.value.bwOrgName) {
                                            taskJson["OrgName"] = bwRequestJson.bwLocationPicker.value.bwOrgName;
                                        }

                                        if (bwRequestJson.ProjectTitle && bwRequestJson.ProjectTitle.value) {
                                            taskJson["ProjectTitle"] = bwRequestJson.ProjectTitle.value;
                                        }

                                        if (bwRequestJson.bwRequestedCapitalField && bwRequestJson.bwRequestedCapitalField.value) {
                                            taskJson["RequestedCapital"] = bwRequestJson.bwRequestedCapitalField.value;
                                        }

                                        console.log('Calling renderExecutiveSummaryForTask(). xcx11223-1');
                                        var promise = window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('renderExecutiveSummaryForTask', JSON.stringify(taskJson), null);
                                        promise.then(function (results) {
                                            try {

                                                console.log('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). ALL OF THE "TASK" EXECUTIVE SUMMARIES ARE DISPLAYING UP TO DATE INFORMATION.');
                                                //alert('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). ALL OF THE "TASK" EXECUTIVE SUMMARIES ARE DISPLAYING UP TO DATE INFORMATION.');
                                                // Get the request json.
                                                var requestJson;
                                                var requests = $('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'brData').PendingBudgetRequests;
                                                for (var i = 0; i < requests.length; i++) {
                                                    if (bwBudgetRequestId == requests[i].bwBudgetRequestId) {
                                                        // We found the request json.
                                                        requestJson = requests[i];
                                                        break;
                                                    }
                                                }

                                                requestJson["bwRequestJson"] = JSON.stringify(bwRequestJson); // The scraped, new form data, added to the existing task data.
                                                //
                                                // The following json properties have to bubble up from bwRequestJson, to be duplicated at the top level of the request json. This is done to maximize query speed in Mongo. It is the only duplicated data in the entire system, so don't complain lol!! :)
                                                // OrgId, OrgName, ProjectTitle, RequestedCapital.
                                                //
                                                if (bwRequestJson.bwLocationPicker && bwRequestJson.bwLocationPicker.value && bwRequestJson.bwLocationPicker.value.bwOrgId) {
                                                    requestJson["OrgId"] = bwRequestJson.bwLocationPicker.value.bwOrgId;
                                                }

                                                if (bwRequestJson.bwLocationPicker && bwRequestJson.bwLocationPicker.value && bwRequestJson.bwLocationPicker.value.bwOrgName) {
                                                    requestJson["OrgName"] = bwRequestJson.bwLocationPicker.value.bwOrgName;
                                                }

                                                if (bwRequestJson.ProjectTitle && bwRequestJson.ProjectTitle.value) {
                                                    requestJson["ProjectTitle"] = bwRequestJson.ProjectTitle.value;
                                                }

                                                if (bwRequestJson.bwRequestedCapitalField && bwRequestJson.bwRequestedCapitalField.value) {
                                                    requestJson["RequestedCapital"] = bwRequestJson.bwRequestedCapitalField.value;
                                                }

                                                console.log('Calling renderExecutiveSummaryForRequest(). xcx332-1');
                                                var promise = window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('renderExecutiveSummaryForRequest', JSON.stringify(requestJson), null);
                                                promise.then(function (results) {

                                                    console.log('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). ALL OF THE "REQUEST" EXECUTIVE SUMMARIES ARE DISPLAYING UP TO DATE INFORMATION.');
                                                    //alert('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). ALL OF THE "REQUEST" EXECUTIVE SUMMARIES ARE DISPLAYING UP TO DATE INFORMATION.');

                                                }).catch(function (e) {
                                                    console.log('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(): ' + JSON.stringify(e));
                                                    alert('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage():xcx2131244-1: ' + JSON.stringify(e));
                                                });

                                            } catch (e) {

                                                console.log('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage():4: ' + e.message + ', ' + e.stack);
                                                displayAlertDialog('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage():4: ' + e.message + ', ' + e.stack);

                                            }

                                        }).catch(function (e) {
                                            console.log('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(): ' + JSON.stringify(e));
                                            displayAlertDialog('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(): ' + JSON.stringify(e));
                                        });

                                    } else {

                                        // Request item. Call renderExecutiveSummaryForRequest().
                                        console.log('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). This is a Request item. Preparing to call renderExecutiveSummaryForRequest().');

                                        // Get the request json.
                                        var requestJson;
                                        var requests = $('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'brData').PendingBudgetRequests;
                                        for (var i = 0; i < requests.length; i++) {
                                            if (bwBudgetRequestId == requests[i].bwBudgetRequestId) {
                                                // We found the request json.
                                                requestJson = requests[i];
                                                break;
                                            }
                                        }

                                        if (requestJson) {
                                            requestJson["bwRequestJson"] = JSON.stringify(bwRequestJson); // The scraped, new form data, added to the existing task data.
                                            //
                                            // The following json properties have to bubble up from bwRequestJson, to be duplicated at the top level of the request json. This is done to maximize query speed in Mongo. It is the only duplicated data in the entire system, so don't complain lol!! :)
                                            // OrgId, OrgName, ProjectTitle, RequestedCapital.
                                            //
                                            if (bwRequestJson.bwLocationPicker && bwRequestJson.bwLocationPicker.value && bwRequestJson.bwLocationPicker.value.bwOrgId) {
                                                requestJson["OrgId"] = bwRequestJson.bwLocationPicker.value.bwOrgId;
                                            }

                                            if (bwRequestJson.bwLocationPicker && bwRequestJson.bwLocationPicker.value && bwRequestJson.bwLocationPicker.value.bwOrgName) {
                                                requestJson["OrgName"] = bwRequestJson.bwLocationPicker.value.bwOrgName;
                                            }

                                            if (bwRequestJson.ProjectTitle && bwRequestJson.ProjectTitle.value) {
                                                requestJson["ProjectTitle"] = bwRequestJson.ProjectTitle.value;
                                            }

                                            if (bwRequestJson.bwRequestedCapitalField && bwRequestJson.bwRequestedCapitalField.value) {
                                                requestJson["RequestedCapital"] = bwRequestJson.bwRequestedCapitalField.value;
                                            }


                                            console.log('Calling renderExecutiveSummaryForRequest(). xcx332-2');
                                            var promise = window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('renderExecutiveSummaryForRequest', JSON.stringify(requestJson), null);
                                            promise.then(function (results) {
                                                try {
                                                    console.log('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). ALL OF THE "REQUEST" EXECUTIVE SUMMARIES ARE DISPLAYING UP TO DATE INFORMATION.');
                                                    //alert('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). ALL OF THE "REQUEST" EXECUTIVE SUMMARIES ARE DISPLAYING UP TO DATE INFORMATION.');

                                                    // Get the task json.
                                                    debugger;
                                                    var taskJson;
                                                    var tasks = $('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'taskData');
                                                    for (var i = 0; i < tasks.length; i++) {
                                                        if (bwBudgetRequestId == tasks[i].bwRelatedItemId) {
                                                            // We found the task json.
                                                            taskJson = tasks[i];
                                                            break;
                                                        }
                                                    }


                                                    // 4-15-2023 COME BACK HERE SOMETIME
                                                    console.log('This does not always have the task section displaying on the home page..... so that is why we are checking here.... we need to add code to display other method from [renderExecutiveSummaryForTask]??');
                                                    if (taskJson) { // This doesn't always have the task section displaying on the home page..... so that is why we are checking here.... we need to add code to display other method from [renderExecutiveSummaryForTask]

                                                        taskJson["bwRequestJson"] = JSON.stringify(bwRequestJson); // The scraped, new form data, added to the existing task data.
                                                        //
                                                        // The following json properties have to bubble up from bwRequestJson, to be duplicated at the top level of the request json. This is done to maximize query speed in Mongo. It is the only duplicated data in the entire system, so don't complain lol!! :)
                                                        // OrgId, OrgName, ProjectTitle, RequestedCapital.
                                                        //
                                                        if (bwRequestJson.bwLocationPicker && bwRequestJson.bwLocationPicker.value && bwRequestJson.bwLocationPicker.value.bwOrgId) {
                                                            taskJson["OrgId"] = bwRequestJson.bwLocationPicker.value.bwOrgId;
                                                        }

                                                        if (bwRequestJson.bwLocationPicker && bwRequestJson.bwLocationPicker.value && bwRequestJson.bwLocationPicker.value.bwOrgName) {
                                                            taskJson["OrgName"] = bwRequestJson.bwLocationPicker.value.bwOrgName;
                                                        }

                                                        if (bwRequestJson.ProjectTitle && bwRequestJson.ProjectTitle.value) {
                                                            taskJson["ProjectTitle"] = bwRequestJson.ProjectTitle.value;
                                                        }

                                                        if (bwRequestJson.bwRequestedCapitalField && bwRequestJson.bwRequestedCapitalField.value) {
                                                            taskJson["RequestedCapital"] = bwRequestJson.bwRequestedCapitalField.value;
                                                        }

                                                        alert('Calling renderExecutiveSummaryForTask(). xcx11223-2');
                                                        var promise = window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('renderExecutiveSummaryForTask', JSON.stringify(taskJson), null);
                                                        promise.then(function (results) {

                                                            console.log('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). ALL OF THE "TASK" EXECUTIVE SUMMARIES ARE DISPLAYING UP TO DATE INFORMATION.');
                                                            alert('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). ALL OF THE "TASK" EXECUTIVE SUMMARIES ARE DISPLAYING UP TO DATE INFORMATION.');

                                                        }).catch(function (e) {
                                                            console.log('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(): ' + JSON.stringify(e));
                                                            alert('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage():xcx2131244-2: ' + JSON.stringify(e));
                                                        });

                                                    }




                                                } catch (e) {

                                                    console.log('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage():3: ' + e.message + ', ' + e.stack);
                                                    displayAlertDialog('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage():3: ' + e.message + ', ' + e.stack);

                                                }


                                            }).catch(function (e) {
                                                console.log('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(): ' + JSON.stringify(e));
                                                alert('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage():xcx2131244-3: ' + JSON.stringify(e));
                                            });

                                        }

                                    }
                                } catch (e) {

                                    console.log('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage():2: ' + e.message + ', ' + e.stack);
                                    displayAlertDialog('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage():2: ' + e.message + ', ' + e.stack);

                                }
                            });
                            break;

                        }
                    }
                }

            }

        } catch (e) {
            console.log('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(): ' + e.message + ', ' + e.stack);
        }
    },
    checkIfWeNeedToUpdateTheHomepage2_AndExecutiveSummariesCarousel2: function (bwBudgetRequestId, bwBudgetRequest) { // This method expects to get the bwBudgetRequestjson after publish/save. This saves us from having to scrape the form again. (scrapeBwRequestJson())
        try {
            console.log('*********** NOTE THIS **************');
            console.log('*********** NOTE THIS **************');
            console.log('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage2(). bwBudgetRequestId: ' + bwBudgetRequestId);
            console.log('*********** NOTE THIS **************');
            console.log('*********** NOTE THIS **************');
            //alert('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage2(). bwBudgetRequestId: ' + bwBudgetRequestId);

            var window1 = window; // This is how we make this work for popped-out request dialog windows.
            if (window.opener) {
                window1 = window.opener;
            }

            //
            // Check if the request is being displayed on the home screen. If so, refresh it. 8-20-2022
            // IDEALLY THIS WOULD LOOK FOR THE ELEMENT/REQUEST ON THE SCREEN AND JUST DISPLAYING THAT ELEMENT, AND NOT THE WHOLE SCREEN..... 
            //                                                                  Use the class "executiveSummaryInCarousel", so that we can find it... maybe also attribute bwbudgetrequestid as well.
            //
            var classes = window1.$('#divWelcomeButton').attr('class');
            if (classes && classes.indexOf && classes.indexOf('_SelectedButton') > -1) {

                // The home page is being displayed.
                window1.scrollTo(0, 0); // Scroll to top on button click. This makes sure things render Ok, and also just seems like a nicer user experience.

                var executiveSummaries = window1.$('.executiveSummaryInCarousel');
                if (executiveSummaries && executiveSummaries.length && executiveSummaries.length > 0) {

                    console.log('');
                    console.log('This is where we update the data. We only want to do this once, so doing it here before we loop through displaying/updating the executive summaries UI.');
                    console.log('');
                    //
                    // This is where we update the data. We only want to do this once, so doing it here before we loop through displaying/updating the executive summaries UI.
                    //
                    var tasks = window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'taskData');
                    for (var j = 0; j < tasks.length; j++) {
                        if (bwBudgetRequestId == tasks[j].bwRelatedItemId) {

                            var taskJson = tasks[j];

                            //alert('xcx12342355');
                            //taskJson["bwRequestTypeId"] = bwBudgetRequest.bwRequestTypeId;

                            taskJson["bwRequestJson"] = bwBudgetRequest.bwRequestJson;

                            taskJson["OrgId"] = bwBudgetRequest.OrgId;
                            taskJson["OrgName"] = bwBudgetRequest.OrgName;
                            taskJson["ProjectTitle"] = bwBudgetRequest.ProjectTitle;
                            taskJson["RequestedCapital"] = bwBudgetRequest.RequestedCapital;
                            taskJson["RequestedExpense"] = bwBudgetRequest.RequestedExpense;

                            taskJson["ManagerId"] = bwBudgetRequest.ManagerId;
                            taskJson["ManagerEmail"] = bwBudgetRequest.ManagerEmail;
                            taskJson["ManagerFriendlyName"] = bwBudgetRequest.ManagerFriendlyName;

                            taskJson["ModifiedById"] = bwBudgetRequest.ModifiedById;
                            taskJson["ModifiedByEmail"] = bwBudgetRequest.ModifiedByEmail;
                            taskJson["ModifiedByFriendlyName"] = bwBudgetRequest.ModifiedByFriendlyName;
                            taskJson["Modified"] = bwBudgetRequest.Modified;

                            tasks[j] = taskJson; // THIS IS WHERE WE UPDATE THE STORED taskData. This saves us having to refresh the entire bwExecutiveSummariesCarousel2 from the database.

                        }
                    }
                    window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'taskData', tasks); // Update!


                    // Get the request json.
                    var requests = window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'brData').PendingBudgetRequests;
                    if (!(requests && requests.length)) {

                        var msg = 'xcx2145 no PendingBudgetRequests!! ';
                        console.log(msg);
                        displayAlertDialog(msg);

                    } else {
                        for (var j = 0; j < requests.length; j++) {
                            if (bwBudgetRequestId == requests[j].bwBudgetRequestId) {

                                var requestJson = requests[j]; // We found the request json.

                                requestJson["bwRequestJson"] = bwBudgetRequest.bwRequestJson;

                                requestJson["OrgId"] = bwBudgetRequest.OrgId;
                                requestJson["OrgName"] = bwBudgetRequest.OrgName;
                                requestJson["ProjectTitle"] = bwBudgetRequest.ProjectTitle;
                                requestJson["RequestedCapital"] = bwBudgetRequest.RequestedCapital;
                                requestJson["RequestedExpense"] = bwBudgetRequest.RequestedExpense;

                                requestJson["ManagerId"] = bwBudgetRequest.ManagerId;
                                requestJson["ManagerEmail"] = bwBudgetRequest.ManagerEmail;
                                requestJson["ManagerFriendlyName"] = bwBudgetRequest.ManagerFriendlyName;

                                requestJson["ModifiedById"] = bwBudgetRequest.ModifiedById;
                                requestJson["ModifiedByEmail"] = bwBudgetRequest.ModifiedByEmail;
                                requestJson["ModifiedByFriendlyName"] = bwBudgetRequest.ModifiedByFriendlyName;
                                requestJson["Modified"] = bwBudgetRequest.Modified;

                                requests[j] = requestJson; // THIS IS WHERE WE UPDATE THE STORED taskData. This saves us having to refresh the entire bwExecutiveSummariesCarousel2 from the database.

                                break;
                            }
                        }
                    }
                    var json1 = {
                        PendingBudgetRequests: requests
                    }
                    window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'brData', json1); // Update!


                    // myUnsubmittedRequests
                    var requests = window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'myUnsubmittedRequests');
                    if (requests && requests.length) {
                        for (var j = 0; j < requests.length; j++) {
                            if (bwBudgetRequestId == requests[j].bwBudgetRequestId) {

                                var requestJson = requests[j]; // We found the request json.

                                requestJson["bwRequestJson"] = bwBudgetRequest.bwRequestJson;

                                requestJson["OrgId"] = bwBudgetRequest.OrgId;
                                requestJson["OrgName"] = bwBudgetRequest.OrgName;
                                requestJson["ProjectTitle"] = bwBudgetRequest.ProjectTitle;
                                requestJson["RequestedCapital"] = bwBudgetRequest.RequestedCapital;
                                requestJson["RequestedExpense"] = bwBudgetRequest.RequestedExpense;

                                requestJson["ManagerId"] = bwBudgetRequest.ManagerId;
                                requestJson["ManagerEmail"] = bwBudgetRequest.ManagerEmail;
                                requestJson["ManagerFriendlyName"] = bwBudgetRequest.ManagerFriendlyName;

                                requestJson["ModifiedById"] = bwBudgetRequest.ModifiedById;
                                requestJson["ModifiedByEmail"] = bwBudgetRequest.ModifiedByEmail;
                                requestJson["ModifiedByFriendlyName"] = bwBudgetRequest.ModifiedByFriendlyName;
                                requestJson["Modified"] = bwBudgetRequest.Modified;

                                requests[j] = requestJson; // THIS IS WHERE WE UPDATE THE STORED taskData. This saves us having to refresh the entire bwExecutiveSummariesCarousel2 from the database.

                                break;

                            }
                        }
                        window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'myUnsubmittedRequests', requests); // Update!
                    }

                    // myBrData
                    debugger; // .myBrData.MyRequests <<<<<<<<<<<<<<<<<<<<<<
                    var requests = window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'myBrData').MyRequests;
                    for (var j = 0; j < requests.length; j++) {
                        if (bwBudgetRequestId == requests[j].bwBudgetRequestId) {

                            var requestJson = requests[j]; // We found the request json.

                            requestJson["bwRequestJson"] = bwBudgetRequest.bwRequestJson;

                            requestJson["OrgId"] = bwBudgetRequest.OrgId;
                            requestJson["OrgName"] = bwBudgetRequest.OrgName;
                            requestJson["ProjectTitle"] = bwBudgetRequest.ProjectTitle;
                            requestJson["RequestedCapital"] = bwBudgetRequest.RequestedCapital;
                            requestJson["RequestedExpense"] = bwBudgetRequest.RequestedExpense;

                            requestJson["ManagerId"] = bwBudgetRequest.ManagerId;
                            requestJson["ManagerEmail"] = bwBudgetRequest.ManagerEmail;
                            requestJson["ManagerFriendlyName"] = bwBudgetRequest.ManagerFriendlyName;

                            requestJson["ModifiedById"] = bwBudgetRequest.ModifiedById;
                            requestJson["ModifiedByEmail"] = bwBudgetRequest.ModifiedByEmail;
                            requestJson["ModifiedByFriendlyName"] = bwBudgetRequest.ModifiedByFriendlyName;
                            requestJson["Modified"] = bwBudgetRequest.Modified;

                            requests[j] = requestJson; // THIS IS WHERE WE UPDATE THE STORED taskData. This saves us having to refresh the entire bwExecutiveSummariesCarousel2 from the database.

                            break;

                        }
                    }
                    var json1 = {
                        MyRequests: requests
                    }
                    window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'myBrData', json1); // Update!

                    //
                    // end: This is where we update the data. We only want to do this once, so doing it here before we loop through the executive summaries.
                    //




                    //
                    // This is where we update the UI.
                    //
                    for (var i = 0; i < executiveSummaries.length; i++) {

                        var executiveSummariesIndex = i;

                        var budgetRequestId = window1.$(executiveSummaries[executiveSummariesIndex]).attr('bwbudgetrequestid');

                        if (bwBudgetRequestId == budgetRequestId) {

                            console.log('>>>>>> In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage2(). We just changed this request... we need to redisplay it here. budgetRequestId: ' + budgetRequestId);

                            var bwRequestJson = JSON.parse(bwBudgetRequest.bwRequestJson);

                            var workflowTaskItemId = window1.$(executiveSummaries[executiveSummariesIndex]).attr('bwworkflowtaskitemid');

                            if (workflowTaskItemId) {

                                // Task item. Call renderExecutiveSummaryForTask().
                                var taskJson;
                                var tasks = window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'taskData');
                                for (var j = 0; j < tasks.length; j++) {
                                    if (workflowTaskItemId == tasks[j].bwWorkflowTaskItemId) {
                                        taskJson = tasks[j]; // We found the task json.
                                        break;
                                    }
                                }

                                console.log('Calling renderExecutiveSummaryForTask(). xcx11223-3');
                                var promise = window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('renderExecutiveSummaryForTask', JSON.stringify(taskJson), window1.$(executiveSummaries[executiveSummariesIndex]));
                                promise.then(function (results) {

                                    console.log('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage2(). ALL OF THE "TASK" EXECUTIVE SUMMARIES ARE DISPLAYING UP TO DATE INFORMATION.');
                                    //alert('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage2(). ALL OF THE "TASK" EXECUTIVE SUMMARIES ARE DISPLAYING UP TO DATE INFORMATION.');

                                }).catch(function (e) {
                                    console.log('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage2():1: ' + JSON.stringify(e));
                                    displayAlertDialog('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage2():1: ' + JSON.stringify(e));
                                });

                            } else {

                                // Request item. Call renderExecutiveSummaryForRequest().
                                var requestJson;
                                var requestJsonIndex;
                                var requests = window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'brData').PendingBudgetRequests;
                                for (var j = 0; j < requests.length; j++) {
                                    if (bwBudgetRequestId == requests[j].bwBudgetRequestId) {
                                        requestJson = requests[j]; // We found the request json.
                                        requestJsonIndex = j;
                                        break;
                                    }
                                }

                                console.log('Calling renderExecutiveSummaryForRequest(). xcx332-4');
                                var promise = window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('renderExecutiveSummaryForRequest', JSON.stringify(requestJson), window1.$(executiveSummaries[executiveSummariesIndex]));
                                promise.then(function (results) {

                                    console.log('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage2(). ALL OF THE "REQUEST" EXECUTIVE SUMMARIES ARE DISPLAYING UP TO DATE INFORMATION.');
                                    //alert('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage2(). ALL OF THE "REQUEST" EXECUTIVE SUMMARIES ARE DISPLAYING UP TO DATE INFORMATION.');

                                }).catch(function (e) {
                                    console.log('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage2(): ' + JSON.stringify(e));
                                    alert('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage2(): ' + JSON.stringify(e));
                                });

                            }

                        }
                    }
                }

            }

        } catch (e) {
            console.log('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage2():2: ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage2():2: ' + e.message + ', ' + e.stack);
        }
    },
    //checkIfWeNeedToUpdateTheHomepage: function (bwBudgetRequestId) {
    //    try {
    //        console.log('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). bwBudgetRequestId: ' + bwBudgetRequestId);
    //        alert('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). bwBudgetRequestId: ' + bwBudgetRequestId);

    //        var window1 = window; // This is how we make this work for popped-out request dialog windows.
    //        if (window.opener) {
    //            window1 = window.opener;
    //        }

    //        //
    //        // Check if the request is being displayed on the home screen. If so, refresh it. 8-20-2022
    //        // IDEALLY THIS WOULD LOOK FOR THE ELEMENT/REQUEST ON THE SCREEN AND JUST DISPLAYING THAT ELEMENT, AND NOT THE WHOLE SCREEN..... 
    //        //                                                                  Use the class "executiveSummaryInCarousel", so that we can find it... maybe also attribute bwbudgetrequestid as well.
    //        //
    //        var classes = window1.$('#divWelcomeButton').attr('class');
    //        if (classes.indexOf('_SelectedButton') > -1) {
    //            // The home page is being displayed.
    //            window1.scrollTo(0, 0); // Scroll to top on button click. This makes sure things render Ok, and also just seems like a nicer user experience.
    //            //$('.bwAuthentication').bwAuthentication('renderHomePagePersonalizedSection_AndRenderButtons'); // thiz.renderHomePagePersonalizedSection_AndRenderButtons();

    //            var executiveSummaries = window1.$('.executiveSummaryInCarousel');
    //            if (executiveSummaries && executiveSummaries.length && executiveSummaries.length > 0) {
    //                for (var i = 0; i < executiveSummaries.length; i++) {

    //                    var budgetRequestId = window1.$(executiveSummaries[i]).attr('bwbudgetrequestid');

    //                    if (bwBudgetRequestId == budgetRequestId) {
    //                        // We found it. Redisplay!
    //                        //$(executiveSummaries[i]).html('We just changed this request... we need to redisplay it here. bwBudgetRequestId: ' + bwBudgetRequestId);

    //                        alert('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). We just changed this request... we need to redisplay it here. bwBudgetRequestId: ' + bwBudgetRequestId);

    //                        var executiveSummariesIndex = i;

    //                        var promise = $('.bwRequest').bwRequest('scrapeBwRequestJson', bwBudgetRequestId);
    //                        promise.then(function (results) {

    //                            var bwRequestJson = results.bwRequestJson;

    //                            var workflowTaskItemId = window1.$(executiveSummaries[executiveSummariesIndex]).attr('bwworkflowtaskitemid');

    //                            if (workflowTaskItemId) {

    //                                // Task item. Call renderExecutiveSummaryForTask().

    //                                // Get the task json.
    //                                var taskJson;
    //                                var tasks = $('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'taskData');
    //                                for (var i = 0; i < tasks.length; i++) {
    //                                    if (workflowTaskItemId == tasks[i].bwWorkflowTaskItemId) {
    //                                        // We found the task json.
    //                                        taskJson = tasks[i];
    //                                        break;
    //                                    }
    //                                }

    //                                taskJson["bwRequestJson"] = JSON.stringify(bwRequestJson); // The scraped, new form data, added to the existing task data.
    //                                //
    //                                // The following json properties have to bubble up from bwRequestJson, to be duplicated at the top level of the request json. This is done to maximize query speed in Mongo. It is the only duplicated data in the entire system, so don't complain lol!! :)
    //                                // OrgId, OrgName, ProjectTitle, RequestedCapital.
    //                                //
    //                                if (bwRequestJson.bwLocationPicker && bwRequestJson.bwLocationPicker.value && bwRequestJson.bwLocationPicker.value.bwOrgId) {
    //                                    taskJson["OrgId"] = bwRequestJson.bwLocationPicker.value.bwOrgId;
    //                                }

    //                                if (bwRequestJson.bwLocationPicker && bwRequestJson.bwLocationPicker.value && bwRequestJson.bwLocationPicker.value.bwOrgName) {
    //                                    taskJson["OrgName"] = bwRequestJson.bwLocationPicker.value.bwOrgName;
    //                                }

    //                                if (bwRequestJson.ProjectTitle && bwRequestJson.ProjectTitle.value) {
    //                                    taskJson["ProjectTitle"] = bwRequestJson.ProjectTitle.value;
    //                                }

    //                                if (bwRequestJson.bwRequestedCapitalField && bwRequestJson.bwRequestedCapitalField.value) {
    //                                    taskJson["RequestedCapital"] = bwRequestJson.bwRequestedCapitalField.value;
    //                                }

    //                                var promise = window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('renderExecutiveSummaryForTask', JSON.stringify(taskJson), null);
    //                                promise.then(function (results) {

    //                                    console.log('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). ALL OF THE "TASK" EXECUTIVE SUMMARIES ARE DISPLAYING UP TO DATE INFORMATION.');
    //                                    alert('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). ALL OF THE "TASK" EXECUTIVE SUMMARIES ARE DISPLAYING UP TO DATE INFORMATION.');

    //                                }).catch(function (e) {
    //                                    console.log('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(): ' + JSON.stringify(e));
    //                                    displayAlertDialog('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(): ' + JSON.stringify(e));
    //                                });

    //                            } else {

    //                                // Request item. Call renderExecutiveSummaryForRequest().
    //                                alert('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). This is a Request item. Preparing to call renderExecutiveSummaryForRequest().');

    //                                // Get the request json.
    //                                var requestJson;
    //                                var requests = $('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'brData').PendingBudgetRequests;
    //                                for (var i = 0; i < requests.length; i++) {
    //                                    if (bwBudgetRequestId == requests[i].bwBudgetRequestId) {
    //                                        // We found the request json.
    //                                        requestJson = requests[i];
    //                                        break;
    //                                    }
    //                                }

    //                                requestJson["bwRequestJson"] = JSON.stringify(bwRequestJson); // The scraped, new form data, added to the existing task data.
    //                                //
    //                                // The following json properties have to bubble up from bwRequestJson, to be duplicated at the top level of the request json. This is done to maximize query speed in Mongo. It is the only duplicated data in the entire system, so don't complain lol!! :)
    //                                // OrgId, OrgName, ProjectTitle, RequestedCapital.
    //                                //
    //                                if (bwRequestJson.bwLocationPicker && bwRequestJson.bwLocationPicker.value && bwRequestJson.bwLocationPicker.value.bwOrgId) {
    //                                    requestJson["OrgId"] = bwRequestJson.bwLocationPicker.value.bwOrgId;
    //                                }

    //                                if (bwRequestJson.bwLocationPicker && bwRequestJson.bwLocationPicker.value && bwRequestJson.bwLocationPicker.value.bwOrgName) {
    //                                    requestJson["OrgName"] = bwRequestJson.bwLocationPicker.value.bwOrgName;
    //                                }

    //                                if (bwRequestJson.ProjectTitle && bwRequestJson.ProjectTitle.value) {
    //                                    requestJson["ProjectTitle"] = bwRequestJson.ProjectTitle.value;
    //                                }

    //                                if (bwRequestJson.bwRequestedCapitalField && bwRequestJson.bwRequestedCapitalField.value) {
    //                                    requestJson["RequestedCapital"] = bwRequestJson.bwRequestedCapitalField.value;
    //                                }
    //                                alert('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). Calling renderExecutiveSummaryForRequest().');
    //                                var promise = window1.$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('renderExecutiveSummaryForRequest', JSON.stringify(requestJson), null);
    //                                promise.then(function (results) {

    //                                    console.log('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). ALL OF THE "REQUEST" EXECUTIVE SUMMARIES ARE DISPLAYING UP TO DATE INFORMATION.');
    //                                    alert('In bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(). ALL OF THE "REQUEST" EXECUTIVE SUMMARIES ARE DISPLAYING UP TO DATE INFORMATION.');

    //                                }).catch(function (e) {
    //                                    console.log('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(): ' + JSON.stringify(e));
    //                                    alert('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(): ' + JSON.stringify(e));
    //                                });

    //                            }

    //                        });
    //                        break;

    //                    }
    //                }
    //            }

    //        }

    //    } catch (e) {
    //        console.log('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(): ' + e.message + ', ' + e.stack);
    //        displayAlertDialog('Exception in bwAuthentication.js.checkIfWeNeedToUpdateTheHomepage(): ' + e.message + ', ' + e.stack);
    //    }
    //},

    renderTheOrgBreadcrumb2: function (json, orgId) {
        try {
            console.log('In bwAuthentication.js.renderTheOrgBreadcrumb2().');

            var d1, g1, e1, l1;
            var orgName = '';

            console.log('');
            console.log('***************');
            console.log('In bwLocationPiker.js.selectLocation(). Another crazy fix here, come back sometime to revisit. xcx3245347-1');
            console.log('***************');
            console.log('');

            if (json.Global) {
                if (json.Global.Global) {
                    json.Global = json.Global.Global;
                }
            } else {
                console.log('');
                console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');
                console.log('COULD THIS BE A PROBLEM? xcx2349953-1?');
                console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');
                console.log('');
            }

            //debugger; // 1-31-2022 why is the last part of the breadcrumb not have a clickable link/url?




            if (json.Global && (orgId == json.Global.Id)) {
                //orgName = json.Global.Name;
                d1 = 'root';
                g1 = undefined;
                e1 = undefined;
                l1 = undefined;
                //debugger;
            } else {
                //debugger; // 12-24-2021 //json.Global.Divisions may be undefined here...
                if (!(json.Global && json.Global.Divisions)) {

                    console.log('');
                    console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');
                    console.log('COULD THIS BE A PROBLEM? xcx2349953-2?');
                    console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');
                    console.log('');

                } else {
                    for (var d = 0; d < json.Global.Divisions.Items.length; d++) {
                        if (orgId == json.Global.Divisions.Items[d].Id) {
                            //orgName = json.Global.Divisions.Items[d].Name;
                            d1 = d;
                            g1 = undefined;
                            e1 = undefined;
                            l1 = undefined;
                            break;
                        }
                        for (var g = 0; g < json.Global.Divisions.Items[d].Groups.Items.length; g++) {
                            if (orgId == json.Global.Divisions.Items[d].Groups.Items[g].Id) {
                                //orgName = json.Global.Divisions.Items[d].Groups.Items[g].Name;
                                d1 = d;
                                g1 = g;
                                e1 = undefined;
                                l1 = undefined;
                                break;
                            }
                            for (var e = 0; e < json.Global.Divisions.Items[d].Groups.Items[g].LegalEntities.Items.length; e++) {
                                if (orgId == json.Global.Divisions.Items[d].Groups.Items[g].LegalEntities.Items[e].Id) {
                                    //orgName = json.Global.Divisions.Items[d].Groups.Items[g].LegalEntities.Items[e].Name;
                                    d1 = d;
                                    g1 = g;
                                    e1 = e;
                                    l1 = undefined;
                                    break;
                                }
                                for (var l = 0; l < json.Global.Divisions.Items[d].Groups.Items[g].LegalEntities.Items[e].Locations.Items.length; l++) {
                                    if (orgId == json.Global.Divisions.Items[d].Groups.Items[g].LegalEntities.Items[e].Locations.Items[l].Id) {
                                        //orgName = json.Global.Divisions.Items[d].Groups.Items[g].LegalEntities.Items[e].Locations.Items[l].Name;
                                        d1 = d;
                                        g1 = g;
                                        e1 = e;
                                        l1 = l;
                                        break;
                                    }
                                }
                            }
                        }
                    }
                }
            }

            var roles, orgId, orgName, orgPath, orgPathClickable;

            var divisionIndex = d1;
            var groupIndex = g1;
            var entityIndex = e1;
            var locationIndex = l1;

            if ((locationIndex || locationIndex > -1) && locationIndex != 'undefined') {
                //debugger;
                roles = json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].LegalEntities.Items[entityIndex].Locations.Items[locationIndex].Roles;
                orgId = json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].LegalEntities.Items[entityIndex].Locations.Items[locationIndex].Id;
                orgName = json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].LegalEntities.Items[entityIndex].Locations.Items[locationIndex].Name;
                orgPath = json.Global.Name + ' > ' + json.Global.Divisions.Items[divisionIndex].Name + ' > ' + json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].Name + ' > ' + json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].LegalEntities.Items[entityIndex].Name + ' > ' + json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].LegalEntities.Items[entityIndex].Locations.Items[locationIndex].Name;
                orgPathClickable = '<span style="cursor:pointer;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + 'root' + '\');">' + json.Global.Name + '</span>' + ' > ' + '<span style="cursor:pointer;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + divisionIndex + '\');">' + json.Global.Divisions.Items[divisionIndex].Name + '</span>' + ' > ' + '<span style="cursor:pointer;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + divisionIndex + '\', \'' + groupIndex + '\');">' + json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].Name + '</span>' + ' > ' + '<span style="cursor:pointer;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + divisionIndex + '\', \'' + groupIndex + '\', \'' + entityIndex + '\');">' + json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].LegalEntities.Items[entityIndex].Name + '</span>' + ' > ' + '<span style="cursor:pointer;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + divisionIndex + '\', \'' + groupIndex + '\', \'' + entityIndex + '\', \'' + locationIndex + '\');">' + json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].LegalEntities.Items[entityIndex].Locations.Items[locationIndex].Name + '</span>';
            } else if ((entityIndex || entityIndex > -1) && entityIndex != 'undefined') {
                roles = json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].LegalEntities.Items[entityIndex].Roles;
                orgId = json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].LegalEntities.Items[entityIndex].Id;
                orgName = json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].LegalEntities.Items[entityIndex].Name;
                orgPath = json.Global.Name + ' > ' + json.Global.Divisions.Items[divisionIndex].Name + ' > ' + json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].Name + ' > ' + json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].LegalEntities.Items[entityIndex].Name;


                //orgPathClickable = '<span style="cursor:pointer;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + 'root' + '\');">' + json.Global.Name + '</span>' + ' > ' + '<span style="cursor:pointer;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + divisionIndex + '\');">' + json.Global.Divisions.Items[divisionIndex].Name + '</span>' + ' > ' + '<span style="cursor:pointer;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + divisionIndex + '\', \'' + groupIndex + '\');">' + json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].Name + '</span>' + ' > ' + json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].LegalEntities.Items[entityIndex].Name;

                orgPathClickable = '<span style="cursor:pointer;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + 'root' + '\');">' + json.Global.Name + '</span>' + ' > ' + '<span style="cursor:pointer;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + divisionIndex + '\');">' + json.Global.Divisions.Items[divisionIndex].Name + '</span>' + ' > ' + '<span style="cursor:pointer;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + divisionIndex + '\', \'' + groupIndex + '\');">' + json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].Name + '</span>' + ' > ' + '<span style="cursor:pointer;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + divisionIndex + '\', \'' + groupIndex + '\', \'' + entityIndex + '\');">' + json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].LegalEntities.Items[entityIndex].Name + '</span>';




            } else if ((groupIndex || groupIndex > -1) && groupIndex != 'undefined') {
                roles = json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].Roles;
                orgId = json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].Id;
                orgName = json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].Name;
                orgPath = json.Global.Name + ' > ' + json.Global.Divisions.Items[divisionIndex].Name + ' > ' + json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].Name;
                orgPathClickable = '<span style="cursor:pointer;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + 'root' + '\');">' + json.Global.Name + '</span>' + ' > ' + '<span style="cursor:pointer;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + divisionIndex + '\');">' + json.Global.Divisions.Items[divisionIndex].Name + '</span>' + ' > ' + '<span style="cursor:pointer;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + divisionIndex + '\', \'' + groupIndex + '\');">' + json.Global.Divisions.Items[divisionIndex].Groups.Items[groupIndex].Name + '</span>'; // 1-31-2022
            } else if ((divisionIndex || divisionIndex > -1) && divisionIndex != 'undefined') {
                if (divisionIndex == 'root') {
                    //debugger;
                    roles = json.Global.Roles;
                    orgId = json.Global.Id;
                    orgName = json.Global.Name;
                    orgPath = json.Global.Name;
                    //orgPathClickable = json.Global.Name;
                    orgPathClickable = '<span style="cursor:pointer;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + 'root' + '\');">' + json.Global.Name + '</span>';
                } else {
                    roles = json.Global.Divisions.Items[divisionIndex].Roles;
                    orgId = json.Global.Divisions.Items[divisionIndex].Id;
                    orgName = json.Global.Divisions.Items[divisionIndex].Name;
                    orgPath = json.Global.Name + ' > ' + json.Global.Divisions.Items[divisionIndex].Name;
                    orgPathClickable = '<span style="cursor:pointer;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + 'root' + '\');">' + json.Global.Name + '</span>' + ' > ' + json.Global.Divisions.Items[divisionIndex].Name;
                }
            } else {
                //debugger;
                console.log('Error in bwLocationPicker.selectLocation(): Unexpected parameter in displayOrgRoleEditorInACircle():2:.');
            }
            //debugger;

            //document.getElementById(requestDialogId + '_requestOrgClickableBreadcrumb').innerHTML = orgPathClickable;
            //$('#' + requestDialogId).find('#requestOrgClickableBreadcrumb')[0].innerHTML = orgPathClickable;



            //var divisionIndex = d1;
            //var groupIndex = g1;
            //var entityIndex = e1;
            //var locationIndex = l1;

            var result = {
                orgPathClickable: orgPathClickable,
                divisionIndex: divisionIndex,
                groupIndex: groupIndex,
                entityIndex: entityIndex,
                locationIndex: locationIndex
            }

            return result;

        } catch (e) {
            console.log('Exception in bwAuthentication.js.renderTheOrgBreadcrumb2(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.renderTheOrgBreadcrumb2(): ' + e.message + ', ' + e.stack);
        }
    },

    cmdForceUnsubscribe: function (bwParticipantId) {
        console.log('In cmdForceUnsubscribe(). bwParticipantId: ' + bwParticipantId);
        //alert('In cmdForceUnsubscribe(). bwParticipantId: ' + bwParticipantId);

        // This is called when the user doesn't want to log in before unsubscribing.
        //displayAlertDialog('This functionality is incomplete. Coming soon! cmdForceUnsubscribe().');

        // This is called when a user has logged in before unsubscribing.
        //displayAlertDialog('cmdUnsubscribe(). Participant:' + participantId);
        // This needs to call the POST web service, /unsubscribe.

        //var unsubscribeIdentifier = getUrlParams()["unsubscribe"].toString().split('#')[0];

        var json = {
            participantId: bwParticipantId
        };
        var operationUri = this.options.operationUriPrefix + "_bw/unsubscribe";
        $.ajax({
            url: operationUri,
            type: "POST",
            data: json,
            headers: {
                "Accept": "application/json; odata=verbose"
            },
            success: function (data) {
                //console.log
                //displayAlertDialog(data.message);
                //renderWelcomeScreen();

                if (data.message.indexOf('The user has been unsubscribed.') > -1) {

                    $('#divUnsubscribeDialog').dialog('close');
                    displayAlertDialog('You have been unsubscribed.');
                    // Redirect the user.
                    //window.location.href = 'https://budgetworkflow.com';

                } else {
                    displayAlertDialog('There was an error unsubscribing: ' + data.message);
                }

            },
            error: function (data, errorCode, errorMessage) {
                displayAlertDialog('Error in my.js.cmdUnsubscribe():1:' + errorMessage + ' ' + JSON.stringify(data));
                //WriteToErrorLog('Error in InitBudgetRequest.js.cmdCreateBudgetRequest()', 'Error creating the budget request in budgetrequests library: ' + errorCode + ', ' + errorMessage);
            }
        });
    },

    //cmdUnsubscribe: function () {
    //    console.log('In cmdUnsubscribe().');

    //    // This is called when a user has logged in before unsubscribing.
    //    //displayAlertDialog('cmdUnsubscribe(). Participant:' + participantId);
    //    // This needs to call the POST web service, /unsubscribe.
    //    var unsubscribe = [];
    //    unsubscribe = {
    //        participantId: participantId
    //    };
    //    var operationUri = webserviceurl + "/unsubscribe";
    //    $.ajax({
    //        url: operationUri,
    //        type: "POST", timeout: ajaxTimeout,
    //        data: unsubscribe,
    //        headers: {
    //            "Accept": "application/json; odata=verbose"
    //        },
    //        success: function (data) {
    //            displayAlertDialog(data);
    //            //renderWelcomeScreen();
    //        },
    //        error: function (data, errorCode, errorMessage) {
    //            displayAlertDialog('Error in my.js.cmdUnsubscribe():1:' + errorMessage + ' ' + JSON.stringify(data));
    //            //WriteToErrorLog('Error in InitBudgetRequest.js.cmdCreateBudgetRequest()', 'Error creating the budget request in budgetrequests library: ' + errorCode + ', ' + errorMessage);
    //        }
    //    });
    //},
    displayUnsubscribeDialog: function (bwParticipantId) {
        try {
            console.log('In bwAuthentication.js.displayUnsubscribeDialog().');

            var html = '';

            html += '<style>';
            html += '   .bwInvitationRadioButton {';
            html += '       transform: scale(2); ';
            html += '   }';
            html += '   .bwInvitationRadioButton_td {';
            html += '       padding: 5px 5px 5px 5px; ';
            html += '   }';
            html += '</style>';

            //html += '<div style="display:none;" id="ViewInvitationDialog">';
            html += '   <table style="width:100%;">';
            html += '       <tr>';
            html += '           <td style="width:90%;">';
            //html += '                    <span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 30pt;font-weight:bold;"><span style="font-weight:lighter;font-size:45pt;">✉</span> Send the invitation</span>';
            html += '               <span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 30pt;font-weight:bold;"><span style="font-weight:lighter;font-size:45pt;">✉</span> Unsubscribe.</span>';
            html += '           </td>';
            html += '           <td style="width:9%;"></td>';
            html += '           <td style="width:1%;cursor:pointer;vertical-align:top;">';
            html += '               <span class="dialogXButton" style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;font-size: 30pt;font-weight:bold;" onclick="$(\'#divUnsubscribeDialog\').dialog(\'close\');">X</span>';
            html += '           </td>';
            html += '       </tr>';
            html += '   </table>';
            html += '   <input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->';
            //html += '        <span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size:30pt;">';
            //html += '           Invite a participant to your organization by sending them this invitation link.';
            //html += '        </span>';
            html += '   <br />';
            html += '   <span style="font-size:12pt;">';
            html += '       <span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size:20pt;">';
            //html += '           Select their security role below, then copy the link and send it to them.<br />';

            html += '<hr><br />';
            html += '<a href="javascript:$(\'.bwAuthentication\').bwAuthentication(\'cmdForceUnsubscribe\', \'' + bwParticipantId + '\');">Click here to unsubscribe</a><br /><br />';
            html += '<hr>';
            html += '<i>You will receive a confirmation email. We send this out to ensure you have authorized this request.<br /><br />';
            html += 'If you are participating in any workflows, we will also notify the Workflow Administrators so that they know you won\'t be participating.</i>';


            html += '       </span>';

            html += '   </span>';
            html += '   <br /><br />';


            html += '   <br /><br />';
            html += '   <div id="xxxx" class="divSignInButton" style="width:90%;text-align:center;line-height:0.8em;font-weight:bold;cursor:pointer !important;" onclick="$(\'#divUnsubscribeDialog\').dialog(\'close\');">';
            html += '       Close';
            html += '   </div>';
            html += '   <br /><br />';
            //html += '</div>';






            // Include the ability to instantly unsubscribe.?
            //var html = '';
            //html += '<hr>It would be better if you can log in prior to completing your unsubscribe request, but if you prefer to do it now <br />';
            //html += 'then you can <a href="javascript:cmdForceUnsubscribe();">Click here to unsubscribe</a><br /><br />';
            //html += '<hr>';
            //html += '<i>You will receive a confirmation email. We send this out to ensure you have authorized this request.<br /><br />';
            //html += 'We will also send emails to the participants of the workflow so they know you won\'t be participating in the workflows.</i>';
            //html += '';

            document.getElementById('divUnsubscribeDialog_Content').innerHTML = html;

            $('#divUnsubscribeDialog').dialog({
                modal: true,
                resizable: false,
                //closeText: "Cancel",
                closeOnEscape: false, // Hit the ESC key to hide! Yeah!
                //title: 'Alert',
                width: "720",
                dialogClass: "no-close", // No close button in the upper right corner.
                hide: false,//, // This means when hiding just disappear with no effects.
                close: function () {
                    $('#divUnsubscribeDialog').dialog('close');
                },
                open: function (event, ui) {
                    $('.ui-widget-overlay').bind('click', function () {
                        $("#divUnsubscribeDialog").dialog('close');
                    });
                } // This allows the dialog to close when clicked outside of the dialog. Only works for modal dialogs.
            });
            $('#divUnsubscribeDialog').dialog().parents('.ui-dialog').find('.ui-dialog-titlebar').remove();

        } catch (e) {
            console.log('Exception in bwAuthentication.js.displayUnsubscribeDialog(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.displayUnsubscribeDialog(): ' + e.message + ', ' + e.stack);
        }
    },
    displayAcceptInvitationDialog: function (bwInvitationId) {
        try {
            console.log('In bwAuthentication.js.displayAcceptInvitationDialog().');

            // THIS IS WHERE WE SHOULD BE ,..?? 8-12-2020 6-46pm adt
            var operationUri = this.options.operationUriPrefix + "_bw/bwinvitations/" + bwInvitationId;
            $.ajax({
                url: operationUri,
                method: "GET",
                headers: {
                    "Accept": "application/json; odata=verbose"
                },
                success: function (data) {
                    try {
                        var html = '';
                        if (data.d.message == 'FAILED' || data.d.results.length == 0 || data.d.results[0].bwInvitationAcceptedByFriendlyName) {

                            console.log('');
                            console.log('THIS IS NOT A VALID INVITATION. It may have expired or been assigned to someone else: "' + data.d.results[0].bwWorkflowAppTitle + '" [' + data.d.results[0].bwWorkflowAppId + ']');
                            console.log('');
                            html += '<span>';
                            html += '<strong>This is not a valid invitation.</strong> It may have expired or been assigned to someone else.';
                            html += '</span>';
                            html += '<br />';

                        } else {

                            console.log('');
                            console.log('THIS IS A VALID INVITATION: "' + data.d.results[0].bwWorkflowAppTitle + '" [' + data.d.results[0].bwWorkflowAppId + ']');
                            console.log('');
                            html += '<table style="margin:auto;">';
                            html += '   <tr>';
                            html += '       <td style="text-align:center;">';
                            html += '           You have been invited by <strong>' + data.d.results[0].bwInvitationCreatedByFriendlyName + '</strong> to participate in their organization <strong>"' + data.d.results[0].bwWorkflowAppTitle + '"</strong>.';
                            html += '       </td>';
                            html += '   </tr>';
                            html += '   <tr>';
                            html += '       <td style="height:20px;"></td>';
                            html += '   </tr>';
                            html += '   <tr>';
                            html += '       <td style="text-align:center;">';
                            html += '           Sign Up to accept the invitation, or Sign In if you have logged in before.';
                            html += '       </td>';
                            html += '   </tr>';
                            html += '</table>';

                        }

                        var html1 = html;

                        var html = '';

                        html += '<style>';
                        html += '   .bwInvitationRadioButton {';
                        html += '       transform: scale(2); ';
                        html += '   }';
                        html += '   .bwInvitationRadioButton_td {';
                        html += '       padding: 5px 5px 5px 5px; ';
                        html += '   }';
                        html += '</style>';

                        //html += '<div style="display:none;" id="ViewInvitationDialog">';
                        html += '   <table style="width:100%;">';
                        html += '       <tr>';
                        html += '           <td style="width:90%;">';
                        //html += '                    <span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 30pt;font-weight:bold;"><span style="font-weight:lighter;font-size:45pt;">✉</span> Send the invitation</span>';
                        html += '               <span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 30pt;font-weight:bold;"><span style="font-weight:lighter;font-size:45pt;">✉</span> Accept Invitation.</span>';
                        html += '           </td>';
                        html += '           <td style="width:9%;"></td>';
                        html += '           <td style="width:1%;cursor:pointer;vertical-align:top;">';
                        html += '               <span class="dialogXButton" style="font-size:25pt;cursor:pointer;width:100%;font-weight:bold;" onclick="$(\'#divAcceptInvitationDialog\').dialog(\'close\');">X</span>';
                        html += '           </td>';
                        html += '       </tr>';
                        html += '   </table>';
                        html += '   <input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->';
                        //html += '        <span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size:30pt;">';
                        //html += '           Invite a participant to your organization by sending them this invitation link.';
                        //html += '        </span>';
                        html += '   <br />';
                        html += '   <span style="font-size:12pt;">';
                        html += '       <span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size:20pt;">';
                        //html += '           Select their security role below, then copy the link and send it to them.<br />';

                        html += '<hr><br />';

                        html += html1;

                        //html += '<a href="javascript:$(\'.bwAuthentication\').bwAuthentication(\'cmdForceUnsubscribe\', \'' + 'bwParticipantId' + '\');">Click here to unsubscribe</a><br /><br />';
                        html += '<hr>';
                        //html += '<i>You will receive a confirmation email. We send this out to ensure you have authorized this request.<br /><br />';
                        //html += 'If you are participating in any workflows, we will also notify the Workflow Administrators so that they know you won\'t be participating.</i>';


                        html += '       </span>';

                        html += '   </span>';
                        html += '   <br /><br />';













                        html += '<table style="margin:auto;">';
                        html += '   <tr>';
                        html += '       <td>';
                        html += '           <div class="divSignInButton" style="width:300px;text-align: center; line-height: 1.1em; font-weight: bold;z-index:15;border:1px solid skyblue;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'displaySignInDialog\', true);">';
                        html += '           Sign In';
                        html += '           </div>';
                        html += '       </td>';
                        html += '       <td>';



                        //html += '           <div class="divSelectLogonTypeButton bwNoUserSelect" style="width:95%;text-align: center; line-height: 1.1em; font-weight: bold;z-index:15;padding:13px 0 6px 13px;border:1px solid skyblue;">';
                        //html += '               with';
                        //html += '               <select id="selectLogonType" onchange="$(\'.bwAuthentication\').bwAuthentication(\'selectLogonType_OnChange\');" class="selectHomePageWorkflowAppDropDown" style="margin-bottom:15px;cursor:pointer;font-weight:bold;font-family:\'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 1em;">';
                        ////html += '                   <option value="BudgetWorkflow.com">bizalicious.com</option>';
                        //html += '                   <option value="BudgetWorkflow.com">BudgetWorkflow.com</option>';
                        ////html += '                   <option>Microsoft</option>'; // Microsoft login needs work, so is only an option in the drop down when this.options.developerModeEnabled == true.
                        //html += '               </select>';
                        //html += '               &nbsp;&nbsp;';
                        //html += '           </div>';



                        html += '       </td>';
                        html += '   </tr>';
                        html += '   <tr>';
                        html += '       <td></td>';
                        html += '       <td>';
                        // 1-28-2022 // Moved the "Remember Me" checkbox here.
                        html += '<table style="width:100%;">';
                        html += '<tbody>';
                        html += '   <tr>';
                        html += '       <td style="text-align:right;">';


                        //html += '           <span style="cursor:help;color:gray;" title="Auto-logon with local storage. Your logon information gets saved in local storage so that you aren\'t subsequently prompted to logon.">';
                        //html += '               <input onclick="$(\'.bwAuthentication\').bwAuthentication(\'changeRememberMeCheckboxSetting_OnClick\');" id="cbCustomLogonRememberMe" type="checkbox" style="cursor:pointer;zoom: 1.25;transform: scale(1.25);-ms-transform: scale(1.25);-webkit-transform: scale(1.25);-o-transform: scale(1.25);-moz-transform: scale(1.25);transform-origin: 0 0;-ms-transform-origin: 0 0;-webkit-transform-origin: 0 0;-o-transform-origin: 0 0;-moz-transform-origin: 0 0;" checked="">';
                        //html += '               &nbsp;Remember me';
                        //html += '           </span>';



                        html += '       </td>';
                        html += '   </tr>';
                        html += '</tbody>';
                        html += '</table>';
                        html += '           &nbsp;&nbsp;';
                        html += '           <span id="spanAzureADConnectionDetails"></span>';
                        html += '       </td>';
                        html += '   </tr>';
                        html += '   <tr>';
                        html += '       <td colspan="2">';
                        //html += '           <br />';
                        html += '           <div style="height:50px;text-align:center;line-height:1.1em;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;font-size:22pt;">&nbsp;&nbsp;or&nbsp;&nbsp;</div>';
                        html += '       </td>';
                        html += '   </tr>';
                        html += '   <tr>';
                        html += '       <td colspan="2">';
                        html += '           <div class="divSignInButton" style="width:300px; text-align: center; line-height: 1.1em; font-weight: bold;z-index:15;border:1px solid skyblue;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'displayCreateFreeAccountDialog\', true);">';
                        html += '               Sign Up&nbsp;&nbsp;';
                        html += '           </div>';
                        html += '       </td>';
                        html += '   </tr>';
                        html += '</table>';





























                        html += '   <br /><br />';
                        html += '   <div id="xxxx" class="divSignInButton" style="width:90%;text-align:center;line-height:0.8em;font-weight:bold;cursor:pointer !important;" onclick="$(\'#divAcceptInvitationDialog\').dialog(\'close\');">';
                        html += '       Close';
                        html += '   </div>';
                        html += '   <br /><br />';
                        //html += '</div>';



                        //alert('xcx214321432');


                        // Include the ability to instantly unsubscribe.?
                        //var html = '';
                        //html += '<hr>It would be better if you can log in prior to completing your unsubscribe request, but if you prefer to do it now <br />';
                        //html += 'then you can <a href="javascript:cmdForceUnsubscribe();">Click here to unsubscribe</a><br /><br />';
                        //html += '<hr>';
                        //html += '<i>You will receive a confirmation email. We send this out to ensure you have authorized this request.<br /><br />';
                        //html += 'We will also send emails to the participants of the workflow so they know you won\'t be participating in the workflows.</i>';
                        //html += '';

                        document.getElementById('divAcceptInvitationDialog_Content').innerHTML = html;

                        $('#divAcceptInvitationDialog').dialog({
                            modal: true,
                            resizable: false,
                            //closeText: "Cancel",
                            closeOnEscape: false, // Hit the ESC key to hide! Yeah!
                            //title: 'Alert',
                            width: "850",
                            dialogClass: "no-close", // No close button in the upper right corner.
                            hide: false,//, // This means when hiding just disappear with no effects.
                            close: function () {
                                try {

                                    //$('#divAcceptInvitationDialog').dialog('close');
                                    window.location = appweburl; // Since the user chose to close the invitation dialog, we will take them to the home page.



                                } catch (e) {
                                    console.log('Exception in bwAuthentication.js.displayAcceptInvitationDialog():3: ' + e.message + ', ' + e.stack);
                                    displayAlertDialog('Exception in bwAuthentication.js.displayAcceptInvitationDialog():3: ' + e.message + ', ' + e.stack);
                                }
                            },
                            open: function (event, ui) {
                                $('.ui-widget-overlay').bind('click', function () {
                                    $("#divAcceptInvitationDialog").dialog('close');
                                });
                            } // This allows the dialog to close when clicked outside of the dialog. Only works for modal dialogs.
                        });
                        $('#divAcceptInvitationDialog').dialog().parents('.ui-dialog').find('.ui-dialog-titlebar').remove();

                    } catch (e) {
                        console.log('Exception in bwAuthentication.js.displayAcceptInvitationDialog():2: ' + e.message + ', ' + e.stack);
                        displayAlertDialog('Exception in bwAuthentication.js.displayAcceptInvitationDialog():2: ' + e.message + ', ' + e.stack);
                    }

                },
                error: function (data, errorCode, errorMessage) {
                    console.log('Error in bwAuthentication.checkIfAuthenticatedAndProcessQuerystringParameters():xcx3376:' + errorCode + ', ' + errorMessage + ' data:' + data);
                    displayAlertDialog('Error in bwAuthentication.checkIfAuthenticatedAndProcessQuerystringParameters():xcx3376:' + errorCode + ', ' + errorMessage + ' data:' + data);
                }
            });

        } catch (e) {
            console.log('Exception in bwAuthentication.js.displayAcceptInvitationDialog(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.displayAcceptInvitationDialog(): ' + e.message + ', ' + e.stack);
        }
    },
    checkConnectionAndRemoveBlueBarErrorMessage: function () {
        try {
            console.log('In bwAuthentication.js.checkConnectionAndRemoveBlueBarErrorMessage().');

            var item = {
                "Errors": 're-established communication'
            };
            var operationUri = this.options.operationUriPrefix + '_bw/writearchivederrorstoexceptionlog';
            $.ajax({
                url: operationUri,
                type: "POST",
                data: item,
                headers: {
                    "Accept": "application/json; odata=verbose"
                },
                success: function (data) {
                    try {
                        clearInterval(connectionTimerObject); // Turn off the timer.
                        connectionTimerObject = null;
                        //$("#divAlertDialog").dialog('close'); // Close the existing alert dialog.
                        //displayAlertDialog('Reconnected!'); // Display that we are reconnected!

                        //document.getElementById('spanErrorLink').style.display = 'none'; //'none';
                        //document.getElementById('spanErrorLinkNewRequest').style.display = 'none'; //'none';
                        //document.getElementById('spanErrorLinkMyStuff').style.display = 'none'; //'none';
                        //document.getElementById('spanErrorLinkSummary').style.display = 'none'; //'none';
                        //document.getElementById('spanErrorLinkConfiguration').style.display = 'none'; //'none';
                        //document.getElementById('spanErrorLinkHelp').style.display = 'none'; //'none';
                    } catch (e) {

                        clearInterval(connectionTimerObject); // Turn off the timer.
                        connectionTimerObject = null;

                        console.log('Exception in checkConnectionAndRemoveBlueBarErrorMessage():2: ' + e.message + ', ' + e.stack);
                        displayAlertDialog('Exception in checkConnectionAndRemoveBlueBarErrorMessage():2: ' + e.message + ', ' + e.stack);
                    }
                },
                error: function (data) {
                    // alert('ERROR checkConnectionAndRemoveAlertDialog ERROR:' + JSON.stringify(data));

                    clearInterval(connectionTimerObject); // Turn off the timer.
                    connectionTimerObject = null;

                }
            });
        } catch (e) {

            clearInterval(connectionTimerObject); // Turn off the timer.
            connectionTimerObject = null;

            console.log('Exception in checkConnectionAndRemoveBlueBarErrorMessage(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in checkConnectionAndRemoveBlueBarErrorMessage(): ' + e.message + ', ' + e.stack);
        }
    },
    checkIfAuthenticatedAndProcessQuerystringParameters: function () { // Called from bwAuthentication.js._create(). 
        try {
            console.log('In bwAuthentication.checkIfAuthenticatedAndProcessQuerystringParameters().');
            var thiz = this;

            //debugger; // This calls getParticipantDetailsAndAcceptInvitation_BudgetWorkflow() lower down in this code.

            // We need to look at the query string and basically guess if we are logged into microsoft or not.
            //try {
            var client_info = this.getUrlParams('client_info'); //].toString().split('#')[0];
            var session_state = this.getUrlParams('session_state'); //].toString().split('#')[0];
            if (client_info && session_state) {
                if (!this.options.msalInstance) {
                    var msalConfig = {
                        auth: {
                            //clientId: '55d270fb-e669-465a-a792-ab44f4ac23f0', // todds
                            clientId: '8b9b6ff1-84f6-4e0e-881a-4f9387b7e460', // makopros
                            redirectUri: 'https://budgetworkflow.com/index.html',
                            postLogoutRedirectUri: 'https://budgetworkflow.com'
                        },
                        cache: {
                            //cacheLocation: 'localStorage',
                            storeAuthStateInCookie: true
                        }
                    }
                    this.options.msalInstance = new Msal.UserAgentApplication(msalConfig); // this is the only place this should happen..?
                }
            }
            //} catch (e) { }

            if (this.options.msalInstance) {

                participantLogonType = 'microsoft';
                // >>>>>>>>>>>>>>>>>>> IS THIS IN THE WRONG PLACE?????????????????????????????????????????????????????? should only be called once. 8-13-2020 2-38pm adt.
                this.getParticipantDetailsAndAcceptInvitation_Microsoft();

            } else {

                //
                // Check if logged in using BudgetWorkflow.com.
                //
                var passwordreset = this.getUrlParams('passwordreset');
                var signup = this.getUrlParams('signup');
                var signin = this.getUrlParams('signin');

                if (passwordreset) {

                    console.log('PASSWORD RESET xcx435689');

                    thiz.displayPasswordResetConfirmationDialog();

                } else if (signup) {

                    console.log('SIGNUP xcx435689-2');

                    thiz.displayCreateFreeAccountDialog(true);

                } else if (signin) {

                    console.log('SIGNIN xcx435689-3');

                    thiz.displaySignInDialog(true);

                } else {

                    var payment = this.getUrlParams('payment');
                    if (payment) {

                        alert('xcx123124123 PAYMENT: ' + payment);

                    } else {

                        //
                        // User is trying to unsubscribe. 12-17-2021
                        //

                        var unsubscribe = this.getUrlParams('unsubscribe');
                        if (unsubscribe) {
                            //alert('FULL STOP! THIS USER IS TRYING TO UNSUBSCRIBE');

                            this.displayUnsubscribeDialog(unsubscribe); // 4-4-2022 // unsubscribe is the bwParticipantId.

                        } else {

                            var activeStateIdentifier = this.getUrlParams('ActiveStateIdentifier');
                            var forestAdministratorLoginToTenant_ActiveStateIdentifier = this.getUrlParams('ForestAdministratorLoginToTenant_ActiveStateIdentifier');
                            var bwInvitationId = this.getUrlParams('invitation');

                            if (activeStateIdentifier || forestAdministratorLoginToTenant_ActiveStateIdentifier) { // This means we are logged in already. xcx1

                                this.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow();

                            } else if (bwInvitationId) {

                                //
                                // Move to this.displayAcceptInvitationDialog(bwInvitationId); // 3-14-2023. Copy this.displayUnsubscribeDialog(unsubscribe);
                                //
                                this.displayAcceptInvitationDialog(bwInvitationId)

                            } else {

                                if (thiz.options.backendAdministrationLogin == true) {
                                    // Do nothing, because the backend uses bwActiveMenu_Admin.js.
                                } else {
                                    console.log('In bwAuthentication.js.checkIfAuthenticatedAndProcessQuerystringParameters(). Calling RenderContentForButton() to set the Home button as selected.');
                                    $('.bwActiveMenu').bwActiveMenu('RenderContentForButton', 'HOME_UNAUTHENTICATED_BUTTON', 'HOME_UNAUTHENTICATED');
                                }

                            }
                        }

                    }

                }
            }
        } catch (e) {

            var msg = 'Exception in bwAuthentication.js.checkIfAuthenticatedAndProcessQuerystringParameters(): ' + e.message + ', ' + e.stack;
            console.log(msg);
            displayAlertDialog(msg);

            var html = '';
            html += '<span style="font-size:24pt;color:red;">Exception in checkIfAuthenticatedAndProcessQuerystringParameters().</span>';
            html += '<br />';
            html += '<span style="">Exception in bwAuthentication.checkIfAuthenticatedAndProcessQuerystringParameters(): ' + e.message + ', ' + e.stack + '</span>';
            thiz.element.html(html);
        }
    },






    addAUserToThisOrganization: function () {
        try {
            console.log('In bwAuthentication.js.addAUserToThisOrganization().'); // Related to this function: addUserToOrganizationAndSendEmail().
            //alert('In bwAuthentication.js.addAUserToThisOrganization().'); // Related to this function: addUserToOrganizationAndSendEmail().
            var thiz = this;

            var workflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
            var workflowAppTitle = $('.bwAuthentication').bwAuthentication('option', 'workflowAppTitle');
            var participantId = $('.bwAuthentication').bwAuthentication('option', 'participantId');
            var participantEmail = $('.bwAuthentication').bwAuthentication('option', 'participantEmail');
            var participantFriendlyName = $('.bwAuthentication').bwAuthentication('option', 'participantFriendlyName');

            if (!this.options.participantId) {

                displayAlertDialog('Unexpected authentication error xcx124235.');
                //console.log('In addAUserToThisOrganization(). User is not logged in, so displaying the logon.');
                //initializeTheLogon(); // The user needs to be logged in before they add anyone.

            } else {

                // Note: We are using cryptographic salted password hashing in order to prevent storing the passwords.
                var bwParticipantFriendlyName_newuser = document.getElementById('txtAddANewPersonDialogFriendlyName').value;
                var bwParticipantEmail_newuser = document.getElementById('txtAddANewPersonDialogEmail').value;

                var bwParticipantRole_newuser = $('#selectAddANewPersonDialogRole').val(); //document.getElementById('selectAddANewPersonDialogRole').value;

                var customLogonPassword = document.getElementById('txtAddANewPersonDialogPassword').value;
                if (bwParticipantFriendlyName_newuser.trim() == '') {
                    this.displayAlertDialog('Please enter a Name before continuing the registration process.');
                    document.getElementById('txtAddANewPersonDialogFriendlyName').focus();
                } else if (bwParticipantEmail_newuser.trim() == '') {
                    this.displayAlertDialog('Please enter an Email Address before continuing the registration process.');
                    document.getElementById('txtAddANewPersonDialogEmail').focus();
                } else if (customLogonPassword.trim() == '') {
                    this.displayAlertDialog('Please enter an Password before continuing the registration process.');
                } else if (customLogonPassword.trim().length < 4 || customLogonPassword.trim().length > 15) {
                    this.displayAlertDialog('Please enter an Password that is 4-15 characters in length.');
                    document.getElementById('txtAddANewPersonDialogPassword').focus();
                } else {

                    var activeStateIdentifier = $('.bwAuthentication:first').bwAuthentication('getActiveStateIdentifier');

                    var data = { // new 9-10-2022
                        bwParticipantId_LoggedIn: participantId,
                        bwActiveStateIdentifier: activeStateIdentifier,
                        bwWorkflowAppId_LoggedIn: workflowAppId,

                        bwWorkflowAppId: workflowAppId,
                        bwWorkflowAppTitle: workflowAppTitle,

                        bwParticipantLogonType: 'custom', // This is all we are supporting at the moment.

                        bwParticipantFriendlyName: bwParticipantFriendlyName_newuser,
                        bwParticipantEmail: bwParticipantEmail_newuser,
                        bwParticipantRole: bwParticipantRole_newuser,

                        customLogonPassword: customLogonPassword,

                        CreatedById: participantId,
                        CreatedByFriendlyName: participantFriendlyName,
                        CreatedByEmail: participantEmail //,

                        //bwInvitationId: bwInvitationId
                    };
                    console.log('In addAUserToThisOrganization(). data: ' + JSON.stringify(data));
                    //alert('In addAUserToThisOrganization(). data: ' + JSON.stringify(data));
                    var operationUri = this.options.operationUriPrefix + "_bw/addausertoanorganization";
                    $.ajax({
                        url: operationUri,
                        type: "POST",
                        data: data,
                        headers: {
                            "Accept": "application/json; odata=verbose"
                        },
                        success: function (data) {
                            //debugger;
                            if (data.message == 'This email address is already in use') { // This email address is already in use
                                displayAlertDialog('This email address is already registered with us. Please enter a different one, or login using the existing credentials.');
                                document.getElementById('txtAddANewPersonDialogEmail').focus();
                            } else if (data.message == 'SUCCESS') {

                                // Cookie!
                                //setCookie('customlogonusername', newUserEmailAddress, 30);
                                //setCookie('customlogonpassword', newUserPassword, 30);

                                //participantId = data.participant.bwParticipantId;
                                //participantFriendlyName = data.participant.bwParticipantFriendlyName;
                                //participantEmail = data.participant.bwParticipantEmail;
                                //tenantId = data.participant.bwTenantId;
                                //workflowAppId = data.participant.bwLastSelectedWorkflowAppId;
                                //workflowAppTitle = data.participant.bwWorkflowAppTitle;
                                //participantLogonType = 'custom';
                                //participantLogonTypeUserId = participantId;

                                //emailNotificationFrequency = data.participant.bwEmailNotificationFrequency;
                                //emailNotificationTypes = data.participant.bwEmailNotificationTypes;

                                //if (data.participant.bwTipsDisplayOn == 'true') tipsDisplayOn = true;
                                //else tipsDisplayOn = false;

                                //if (data.participant.bwInvitationsOnHomePageDisplayOn == 'true') displayInvitationsOnHomePageDisplayOn = true;
                                //else displayInvitationsOnHomePageDisplayOn = false;

                                displayAlertDialog('The person has been added successfully. You will have to notify them.'); //, and they have been notified.');
                                //$('#divAddANewPersonDialog').dialog('close'); // Close the sign in dialog.
                                //$('#divAddANewPersonDialog').dialog('close'); // Close the create your account dialog.

                                //$('.bwCircleDialog').bwCircleDialog('hideAndDestroyCircleDialog');
                                //renderConfigurationParticipants(); // redraw the screen.

                                $('.bwCircleDialog:first').bwCircleDialog('hideCircleDialog');

                                $('.bwParticipantsEditor:first').bwParticipantsEditor('loadAndRenderParticipantsEditor', true);


                            } else if (data.status == 'USER_ALREADY_BELONGS_TO_THIS_ORGANIZATION') {

                                displayAlertDialog('A user with this email address already belongs to this organization.');

                            } else {
                                displayAlertDialog('xcx1243124 ' + JSON.stringify(data));
                            }
                        },
                        error: function (data, errorCode, errorMessage) {
                            console.log('Error in bwAuthentication.js.addAUserToThisOrganization().registeranewuser: ' + errorMessage);
                            displayAlertDialog('Error in bwAuthentication.js.addAUserToThisOrganization().registeranewuser: ' + errorMessage);
                        }
                    });
                }
            }
        } catch (e) {
            console.log('Exception in bwAuthentication.js.addAUserToThisOrganization(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.addAUserToThisOrganization(): ' + e.message + ', ' + e.stack);
        }
    },




    getSelectedOrganization: function () {
        try {
            return this.options.SelectedOrganization;
        } catch (e) {
            this.displayAlertDialog('There was an error getting the selected organization. Error: ' + e.message + ', ' + e.stack);
        }
    },
    getLastSelectedExecutiveSummariesExpandedOrCollapsed: function () {
        try {
            return this.options.bwLastSelectedExecutiveSummariesExpandedOrCollapsed;
        } catch (e) {
            this.displayAlertDialog('There was an error getting bwLastSelectedExecutiveSummariesExpandedOrCollapsed. Error: ' + e.message + ', ' + e.stack);
        }
    },
    setTheTheme: function () {
        try {
            console.log('In bwAuthentication.js.setTheTheme(): ' + this.options.workflowAppTheme);
            console.log('In bwAuthentication.js.setTheTheme(): ' + this.options.workflowAppTheme);

            if (!this.options.workflowAppTheme) {
                console.log('In setTheTheme(). NO THEME WAS SAVED SO LEAVING THE DEFAULT, .brushedAluminum.');
            } else {
                console.log('In setTheTheme(). THEME: ' + this.options.workflowAppTheme);

                var currentClassName;
                if ($('.brushedAluminum') && $('.brushedAluminum').length && $('.brushedAluminum').length > 2) { // There should always be more than 1.
                    var x = $('.brushedAluminum').length;
                    currentClassName = 'brushedAluminum';
                } else if ($('.brushedAluminum_blue') && $('.brushedAluminum_blue').length && $('.brushedAluminum_blue').length > 2) { // There should always be more than 1.
                    var x = $('.brushedAluminum_blue').length;
                    currentClassName = 'brushedAluminum_blue';
                } else if ($('.brushedAluminum_purple') && $('.brushedAluminum_purple').length && $('.brushedAluminum_purple').length > 2) { // There should always be more than 1.
                    var x = $('.brushedAluminum_purple').length;
                    currentClassName = 'brushedAluminum_purple';
                } else if ($('.brushedAluminum_green') && $('.brushedAluminum_green').length && $('.brushedAluminum_green').length > 2) { // There should always be more than 1.
                    var x = $('.brushedAluminum_green').length;
                    currentClassName = 'brushedAluminum_green';
                } else if ($('.brushedAluminum_yellow') && $('.brushedAluminum_yellow').length && $('.brushedAluminum_yellow').length > 2) { // There should always be more than 1.
                    var x = $('.brushedAluminum_yellow').length;
                    currentClassName = 'brushedAluminum_yellow';
                } else if ($('.brushedAluminum_skyblue') && $('.brushedAluminum_skyblue').length && $('.brushedAluminum_skyblue').length > 2) { // There should always be more than 1.
                    var x = $('.brushedAluminum_skyblue').length;
                    currentClassName = 'brushedAluminum_skyblue';
                } else {
                    alert('In bwAuthentication.js.setTheTheme(). xcx1231241 Error: Unexpected value.');
                }

                if (currentClassName == this.options.workflowAppTheme) {
                    // Do nothing.
                } else {
                    // Iterate through all of the elements, leaving the ones on the configuration > settings page alone.
                    var elements = $('.' + currentClassName);
                    for (var i = 0; i < elements.length; i++) {
                        var isThisAColorBox = $(elements[i]).hasClass('colorBox');
                        var weDontWantToAnimateThisElement = $(elements[i]).hasClass('noanimation');
                        if (isThisAColorBox == true) {
                            // Do nothing.
                        } else {
                            if (weDontWantToAnimateThisElement == true) {
                                var nonAnimatedClass = this.options.workflowAppTheme + '_noanimation';
                                $(elements[i]).addClass(nonAnimatedClass).removeClass(currentClassName);
                            } else {
                                $(elements[i]).addClass(this.options.workflowAppTheme).removeClass(currentClassName);
                            }
                        }
                    }

                    // Step 2: Do the top bar.
                    var elements2 = $('.' + currentClassName + '_noanimation');
                    var tmpOldClass = currentClassName + '_noanimation';
                    var tmpNewClass = this.options.workflowAppTheme + '_noanimation';
                    for (var i = 0; i < elements2.length; i++) {
                        $(elements2[i]).addClass(tmpNewClass).removeClass(tmpOldClass);
                    }
                }

                //debugger;
                //console.log('In setTheTheme(). Calling adjustLeftSideMenu(). The menu should fit all of the buttons.')
                //adjustLeftSideMenu();

            }

        } catch (e) {
            console.log('Exception in setTheTheme(): ' + e.message + ', ' + e.stack);
            alert('Exception in setTheTheme(): ' + e.message + ', ' + e.stack);
        }
    },
    securityTrimTheLeftMenuButtons: function () {
        try {
            //debugger;

            // First we will set the theme.
            this.setTheTheme();
            //$('.bwActiveMenu:first').bwActiveMenu('setTheTheme');




            var selectedOrganization = $('.bwAuthentication').bwAuthentication('getSelectedOrganization');

            if (selectedOrganization.OrganizationRole == 'owner') {
                // Make sure the relevent configuration items are displayed. 
                $('#divWelcomeButton').addClass('leftButton');
                $('#divNewRequestButton').addClass('leftButton');
                $('#divArchiveButton').addClass('leftButton');
                $('#divVisualizationsButton').addClass('leftButton');
                $('#divConfigurationButton').addClass('leftButton');


            } else if (selectedOrganization.OrganizationRole == 'customer') {

                $('#divNewRequestButton').removeClass('leftButton'); // customers cannot do this
                $('#divArchiveButton').removeClass('leftButton'); // customers cannot do this
                $('#divVisualizationsButton').removeClass('leftButton'); // customers cannot do this
                $('#divConfigurationButton').removeClass('leftButton'); // customers cannot do this

            } else if (selectedOrganization.OrganizationRole == 'participant') {
                // Hide the relevant stuff.
                $('#divWelcomeButton').addClass('leftButton');
                $('#divNewRequestButton').addClass('leftButton');
                $('#divArchiveButton').removeClass('leftButton');
                $('#divVisualizationsButton').removeClass('leftButton');
                //$('#divConfigurationButton').removeClass('leftButton');


            } else if (selectedOrganization.OrganizationRole == 'archiveviewer') {
                // Hide the relevant stuff in the configuration section.
                $('#divWelcomeButton').addClass('leftButton');
                $('#divNewRequestButton').addClass('leftButton');
                $('#divArchiveButton').addClass('leftButton');
                $('#divVisualizationsButton').removeClass('leftButton');
                //$('#divConfigurationButton').removeClass('leftButton');


            } else if (selectedOrganization.OrganizationRole == 'reportviewer') {
                // Hide the relevant stuff in the configuration section.
                $('#divWelcomeButton').addClass('leftButton');
                $('#divNewRequestButton').addClass('leftButton');
                $('#divArchiveButton').addClass('leftButton');
                $('#divVisualizationsButton').addClass('leftButton');
                //$('#divConfigurationButton').removeClass('leftButton');

            } else if (selectedOrganization.OrganizationRole == 'configurationmanager') {
                // Hide the relevant stuff in the configuration section.
                $('#divWelcomeButton').addClass('leftButton');
                $('#divNewRequestButton').addClass('leftButton');
                $('#divArchiveButton').addClass('leftButton');
                $('#divVisualizationsButton').addClass('leftButton');
                $('#divConfigurationButton').addClass('leftButton');


            } else {

                //$('#divWelcomeButton').removeClass('leftButton');
                $('#divNewRequestButton').removeClass('leftButton'); // customers cannot do this
                $('#divArchiveButton').removeClass('leftButton'); // customers cannot do this
                $('#divVisualizationsButton').removeClass('leftButton'); // customers cannot do this
                $('#divConfigurationButton').removeClass('leftButton');

            }

            // Then we will set the theme.
            //this.setTheTheme();


        } catch (e) {
            console.log('Exception in securityTrimTheLeftMenuButtons: ' + e.message + ', ' + e.stack);
        }
    },
    securityTrimTheLeftMenuButtons_ConfigurationSection: function () {
        try {
            var selectedOrganization = this.options.SelectedOrganization;

            var buttons = $('#tableMainMenu3').find('.leftButton');

            if (selectedOrganization.OrganizationRole == 'owner') {

                // Do nothing, we always want to display all buttons.

            } else if (selectedOrganization.OrganizationRole == 'participant') {

                $(buttons).each(function (index, value) {
                    if (($(buttons[index]).text().trim() == 'PERSONAL/BEHAVIOR') || ($(buttons[index]).text().trim() == 'ORGANIZATION')) {
                        // Do nothing, we always want to display this button.
                    } else {
                        $(buttons[index]).removeClass('leftButton');
                    }
                });

            } else if (selectedOrganization.OrganizationRole == 'archiveviewer') {

                $(buttons).each(function (index, value) {
                    if (($(buttons[index]).text().trim() == 'PERSONAL/BEHAVIOR') || ($(buttons[index]).text().trim() == 'ORGANIZATION') || ($(buttons[index]).text().trim() == 'PARTICIPANTS')) {
                        // Do nothing, we always want to display these buttons.
                    } else {
                        $(buttons[index]).removeClass('leftButton');
                    }
                });

            } else if (selectedOrganization.OrganizationRole == 'reportviewer') {

                $(buttons).each(function (index, value) {
                    if (($(buttons[index]).text().trim() == 'PERSONAL/BEHAVIOR') || ($(buttons[index]).text().trim() == 'ORGANIZATION') || ($(buttons[index]).text().trim() == 'PARTICIPANTS')) {
                        // Do nothing, we always want to display these buttons.
                    } else {
                        $(buttons[index]).removeClass('leftButton');
                    }
                });

            } else if (selectedOrganization.OrganizationRole == 'configurationmanager') {

                // Do nothing, we always want to display all buttons.

            } else {

                console.log('Error: Unexpected value for user security role in bwAuthentication.js.securityTrimTheLeftMenuButtons_ConfigurationSection(), for bwAuthentication.js.selectedOrganization.OrganizationRole: ' + selectedOrganization.OrganizationRole);

                //$(buttons).each(function (index, value) {
                //    if ($(buttons[index]).text().trim() == 'PERSONAL/BEHAVIOR') {
                //        // Do nothing, we always want to display this button.
                //    } else {
                //        $(buttons[index]).removeClass('leftButton');
                //    }
                //});

            }

        } catch (e) {
            console.log('Exception in securityTrimTheLeftMenuButtons_ConfigurationSection: ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in securityTrimTheLeftMenuButtons_ConfigurationSection: ' + e.message + ', ' + e.stack);
        }
    },
    selectHomePageWorkflowAppDropDown_change: function () {
        try {
            console.log('In selectHomePageWorkflowAppDropDown_change().');
            var thiz = this;

            var participantId = this.options.participantId;
            var workflowAppId = this.options.workflowAppId;

            var selectedValue = $('#selectHomePageWorkflowAppDropDown option:selected').val();
            var selectedWorkflowAppId = selectedValue.split('|')[0];
            var selectedWorkflowAppRole = selectedValue.split('|')[1];
            var selectedWorkflowAppTitle = $('#selectHomePageWorkflowAppDropDown option:selected').text();

            if (this.options.workflowAppId != selectedWorkflowAppId) {

                //
                // First, we have to check if there are any .budgetrequestform being displayed. These have to be closed first.
                //
                var budgetRequestForms = $('.budgetrequestform');
                if (budgetRequestForms && budgetRequestForms.length && (budgetRequestForms.length > 0)) {

                    //
                    // Put the select element back to it's original value.
                    //
                    var setTheSelectElementBackToItsOriginalValue = false;
                    var options = $('#selectHomePageWorkflowAppDropDown option');
                    for (var i = 0; i < options.length; i++) {
                        var option_bwWorkflowAppId = $(options[i]).val();
                        if (option_bwWorkflowAppId.indexOf(this.options.SelectedOrganization.OrganizationId) > -1) {
                            //$(options[i]).attr('selected', 'selected');
                            document.getElementById('selectHomePageWorkflowAppDropDown').selectedIndex = i;
                            setTheSelectElementBackToItsOriginalValue = true;
                            break;
                        }
                    }

                    if (setTheSelectElementBackToItsOriginalValue == false) {
                        var msg = 'Error in bwAuthentication.js.selectHomePageWorkflowAppDropDown_change(). Failed to set the select drop-down back to it\'s original value.';
                        console.log(msg);
                        displayAlertDialog(msg);
                    }

                    displayAlertDialog('Please close displayed requests before you switch to another organization.');

                } else {

                    this.options.SelectedOrganization = { // 9-7-2021 STARTING TO RENAME THESE VARS A BIT BETTER FOR FINAL RELEASE.
                        OrganizationId: selectedWorkflowAppId,
                        OrganizationTitle: selectedWorkflowAppTitle,
                        OrganizationRole: selectedWorkflowAppRole
                    };

                    //
                    // Update the database with the new selected Workflow App, then regenerate the interface.
                    //

                    var activeStateIdentifier = this.getActiveStateIdentifier(); // $('.bwAuthentication:first').bwAuthentication('getActiveStateIdentifier');

                    var data = {
                        bwParticipantId_LoggedIn: participantId,
                        bwActiveStateIdentifier: activeStateIdentifier,
                        bwWorkflowAppId_LoggedIn: workflowAppId,

                        bwParticipantId: participantId,
                        selectedWorkflowAppId: selectedWorkflowAppId
                    };
                    var operationUri = webserviceurl + "/bwparticipant/updateuserconfigurationselectedworkflowapp";
                    $.ajax({
                        url: operationUri,
                        type: "POST",
                        data: data,
                        headers: {
                            "Accept": "application/json; odata=verbose"
                        },
                        success: function (data) {

                            if (data.message != 'SUCCESS') {

                                displayAlertDialog(data.message);

                            } else {

                                console.log('data xcx123498865: ' + JSON.stringify(data));

                                thiz.options.workflowAppId = selectedWorkflowAppId;
                                //debugger;
                                //$('#divRequest').bwRequest('option', 'workflowAppId', thiz.options.workflowAppId);
                                thiz.options.workflowAppTitle = selectedWorkflowAppTitle;



                                // 1-24-2022
                                debugger;
                                thiz.options.workflowAppFiscalYear = data.d.results[0].workflowAppFiscalYear;







                                thiz.options.workflowAppTheme = data.d.results[0].bwWorkflowAppTheme;


                                //alert('xcx32453255');

                                thiz.options.externallyFacingUrlForAttachments = data.d.results[0].bwExternallyFacingUrlForAttachments; // 6-29-2022
                                thiz.options.externallyFacingUrlForAttachmentsSourceFolder = data.d.results[0].bwExternallyFacingUrlForAttachmentsSourceFolder; // 6-29-2022

                                //alert('xcx32453255: externallyFacingUrlForAttachmentsSourceFolder: ' + json.STRINGIFY(data.d.results[0]));


                                newBudgetRequestManagerTitle = data.d.results[0].bwNewBudgetRequestManagerTitle;
                                if (data.d.results[0].bwRequireStartEndDates == 'true') requireStartEndDates = true;
                                else requireStartEndDates = false;
                                if (data.d.results[0].bwRequireRequestDetails == 'true') requireRequestDetails = true;
                                else requireRequestDetails = false;
                                if (data.d.results[0].bwRequireRequestDetails == 'true') requireRequestDetails = true;
                                else requireRequestDetails = false;
                                if (data.d.results[0].bwEnableNewRequestAttachments == 'true') enableNewRequestAttachments = true;
                                else enableNewRequestAttachments = false;
                                if (data.d.results[0].bwEnableNewRequestBarcodeAttachments == 'true') enableNewRequestBarcodeAttachments = true;
                                else enableNewRequestBarcodeAttachments = false;

                                if (data.d.results[0].bwQuotingEnabled == 'true') quotingEnabled = true;
                                else quotingEnabled = false;

                                if (data.d.results[0].bwExpenseRequestsEnabled == 'true') reimbursementRequestsEnabled = true;
                                else reimbursementRequestsEnabled = false;

                                if (data.d.results[0].bwCloseoutsEnabled == 'true') closeoutsEnabled = true;
                                else closeoutsEnabled = false;

                                if (data.d.results[0].bwRecurringExpensesEnabled == 'true') recurringExpensesEnabled = true;
                                else recurringExpensesEnabled = false;

                                if (data.d.results[0].bwSupplementalsEnabled == 'true') supplementalsEnabled = true;
                                else supplementalsEnabled = false;

                                console.log('xcx444556 data.d.results[0].bwEmailEnabled: ' + data.d.results[0].bwEmailEnabled);
                                if (data.d.results[0].bwEmailEnabled == 'true') emailEnabled = true;
                                else emailEnabled = false;

                                if (data.d.results[0].bwStrictAuditingEnabled == 'true') strictAuditingEnabled = true;
                                else strictAuditingEnabled = false;

                                if (data.d.results[0].bwDeveloperModeEnabled == 'true') bwDeveloperModeEnabled = true;
                                else bwDeveloperModeEnabled = false;

                                //quotingEnabled = data.d.results[0].bwQuotingEnabled;

                                //requireStartEndDates = data.d.results[0].bwRequireStartEndDates;
                                //requireRequestDetails = data.d.results[0].bwRequireRequestDetails;
                                //enableNewRequestAttachments = data.d.results[0].bwEnableNewRequestAttachments;
                                //quotingEnabled = data.d.results[0].bwQuotingEnabled; 


                                //renderHomePagePersonalizedSection();

                                //debugger;
                                // TODD: I DONT THINK THIS IS REGENERATING THE FA SECTION PRPERLY.
                                generateConfigurationLeftSideMenu();
                                //populateStartPageItem('divConfiguration', 'Reports', '');
                                renderConfigurationPersonalBehavior()
                                // Set the selected value for the drop down on the home page, selectHomePageWorkflowAppDropDown.
                                $('#selectHomePageWorkflowAppDropDown option[value="' + selectedWorkflowAppId + '"]').attr('selected', 'selected');

                                //debugger;
                                console.log('Calling renderHomePagePersonalizedSection_AndRenderButtons().xcx111223-2');
                                thiz.renderHomePagePersonalizedSection_AndRenderButtons();

                                window.scrollTo(0, 0); // Scroll to top.  when changing the organization selection, scroll the window to the left, just like we do scroll to top sometimes. this will make it better in safari on ipod. 12-16-2021
                                $('.bwActiveMenu').bwActiveMenu('adjustLeftSideMenu'); // This makes sure our new stretchy-left-menu redraws Ok.

                            }
                        },
                        error: function (data, errorCode, errorMessage) {
                            console.log('Error in my.js.selectHomePageWorkflowAppDropDown_change(): ' + errorCode + ' ' + errorMessage);
                            displayAlertDialog('Error in my.js.selectHomePageWorkflowAppDropDown_change(): ' + errorCode + ' ' + errorMessage);
                        }
                    });
                }
            }
        } catch (e) {
            console.log('Exception in bwAuthentication.js.selectHomePageWorkflowAppDropDown_change(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.selectHomePageWorkflowAppDropDown_change(): ' + e.message + ', ' + e.stack);
        }
    },

    //logonWith_Microsoft: function () {
    //    try {
    //        console.log('In logonWith_Microsoft().');
    //        var thiz = this;
    //        //debugger;
    //        //
    //        // Documentation for MSAL.js v.1
    //        // https://github.com/AzureAD/microsoft-authentication-library-for-js/tree/dev/lib/msal-core
    //        //
    //        // CODING DOCS: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL.js-1.0.0-api-release
    //        //
    //        // Azure settings:
    //        // Display name: beta.budgetworkflow.com
    //        // Application (client) ID: 55d270fb-e669-465a-a792-ab44f4ac23f0
    //        // Directory (tenant) ID: 0477f091-c206-45cd-ad68-a1b256fac8b8
    //        // Object ID: 06e0bee6-c9d5-487d-8035-b1a907d1faf9
    //        //debugger;
    //        // Configuration object constructed
    //        //const msalConfig = {
    //        //    auth: {
    //        //        clientId: '55d270fb-e669-465a-a792-ab44f4ac23f0',
    //        //        redirectUri: 'https://budgetworkflow.com/my.html?ActiveStateIdentifier=MS', //'https://budgetworkflow.com/my.html', //'https://budgetworkflow.com/',
    //        //    },
    //        //    cache: {
    //        //        cacheLocation: 'localStorage',
    //        //        storeAuthStateInCookie: true
    //        //    }
    //        //}

    //        if (!this.options.msalInstance) {

    //            var msalConfig = {
    //                auth: {
    //                    //clientId: '55d270fb-e669-465a-a792-ab44f4ac23f0', // todds
    //                    clientId: '8b9b6ff1-84f6-4e0e-881a-4f9387b7e460', // makopros
    //                    redirectUri: 'https://budgetworkflow.com/index.html',
    //                    postLogoutRedirectUri: 'https://budgetworkflow.com'
    //                },
    //                cache: {
    //                    //cacheLocation: 'localStorage',
    //                    storeAuthStateInCookie: true
    //                }
    //            }

    //            this.options.msalInstance = new Msal.UserAgentApplication(msalConfig);

    //        }

    //        let loginRequest = {
    //            scopes: ['user.read'], //, 'user.write'],
    //            prompt: 'select_account',
    //        }

    //        let accessTokenRequest = {
    //            scopes: ['user.read'] //, 'user.write']
    //        }

    //        this.options.msalInstance.handleRedirectCallback(function (error, response) {

    //        });

    //        this.options.msalInstance.loginRedirect(loginRequest);

    //    } catch (e) {
    //        this.displayAlertDialog('There was a problem logging you in. Please try again. Error: ' + e.message + ', ' + e.stack);
    //    }
    //},
    logonWith_BudgetWorkflow: function (forceIgnoreInvitation, reauthorize) {
        // The user is trying to logon. 
        // The reauthorize parameter is used when we don't want to change the display that the user is looking at.... we don't want them to lose anything. 12-7-2022
        try {
            console.log('In bwAuthentication.logonWith_BudgetWorkflow().');
            var thiz = this;

            var dialogDescriptionText = '';
            if (document.getElementById('spanCustomLogonDialogInvitationDescriptionText')) {
                dialogDescriptionText = document.getElementById('spanCustomLogonDialogInvitationDescriptionText').innerHTML;
            } else {
                dialogDescriptionText = document.getElementById('spanCustomSignUpDialogInvitationDescriptionText').innerHTML;
            }

            var userEmailAddress = document.getElementById('txtCustomLogonEmail').value;
            var userPassword = document.getElementById('txtCustomLogonPassword').value;
            if (userEmailAddress.trim() == '') {
                this.displayAlertDialog('Please enter an Email Address before continuing the logon process.');
            } else if (userPassword.trim() == '') {
                this.displayAlertDialog('Please enter an Password before continuing the logon process.');
            } else {

                // Ok, lets see if the password is correct.

                ShowActivitySpinner('Attempting login...');

                data = {
                    userEmailAddress: userEmailAddress,
                    userPassword: userPassword
                };

                var operationUri = thiz.options.operationUriPrefix + '_bw/bwworkflow/usercustomlogon';
                $.ajax({
                    url: operationUri,
                    type: "POST",
                    data: data,
                    timeout: 15000,
                    headers: {
                        "Accept": "application/json; odata=verbose"
                    },
                    success: function (data) {
                        try {
                            HideActivitySpinner();
                            //debugger;
                            //displayAlertDialog(data);

                            if (data.message != 'The password is correct') {
                                if (data.message == 'USER_DOES_NOT_EXIST') { // xcx122134-1
                                    // Since the user doesn't exist, display the "Create new user" dialog.
                                    //debugger;
                                    //thiz.setCookie('customlogonusername', userEmailAddress, 30);
                                    //thiz.setCookie('customlogonpassword', userPassword, 30);
                                    //$('.bwCircleDialog').bwCircleDialog('displayCustomSignInWithInvitationDialog', true, 'toddtest');
                                    //document.getElementById('spanCustomSignUpDialogInvitationDescriptionText').innerHTML = 'toddtest22';
                                    displayAlertDialog(data.message);
                                } else {
                                    if (data.message) {
                                        displayAlertDialog(data.message);
                                    } else {
                                        displayAlertDialog(data);
                                    }
                                }
                            } else {

                                // localstorage!
                                if (localStorage) {
                                    localStorage['customlogonusername'] = userEmailAddress;
                                    localStorage['customlogonpassword'] = userPassword;
                                }

                                var bwActiveStateIdentifier = data.bwActiveStateIdentifier;

                                var location;

                                if (thiz.options.backendAdministrationLogin == true) {

                                    //
                                    // Only budgetworkflow@gmail.com is allowed in here!
                                    //
                                    //if (userEmailAddress.toLowerCase() == 'budgetworkflow@gmail.com') {
                                    //if (userEmailAddress.toLowerCase() == 'todd@budgetworkflow.com') { // 2-3-2022

                                    if (window.location.href.indexOf('livestatus.html') > -1) {
                                        location = appweburl + '/livestatus.html?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                                        window.location = location;
                                    } else if (window.location.href.indexOf('admin.html') > -1) {
                                        location = appweburl + '/admin.html?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                                        window.location = location;
                                    } else if (window.location.href.indexOf('admin2.html') > -1) {
                                        location = appweburl + '/admin2.html?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                                        window.location = location;
                                    } else {
                                        alert('Unrecognized URL. Unable to complete authentication.');
                                    }

                                    //} else {
                                    //    displayAlertDialog('You do not have permission to access this location.');
                                    //}



                                } else {

                                    //debugger;

                                    if (data.TwoFactorAuthenticationWithSms && data.TwoFactorAuthenticationWithSms == 'NOT_ENABLED') {

                                        var bwInvitationId = thiz.getUrlParams('invitation');
                                        if (bwInvitationId && (forceIgnoreInvitation != true)) {

                                            //alert('xcx88653-1 DEV:Check code.');
                                            data3 = {
                                                newUserFriendlyName: data.participantFriendlyName,
                                                newUserEmailAddress: data.participantEmail,
                                                newUserPassword: null,
                                                appweburl: appweburl,
                                                bwInvitationId: bwInvitationId
                                            };
                                            var operationUri = webserviceurl + "/registeranewuseroranewuserwithaninvitation";

                                            //debugger; // This is where it works, but not for a completely new user, as it does not add the new user to the invited bwWorkflowApp <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

                                            $.ajax({
                                                url: operationUri,
                                                type: "POST",
                                                data: data3,
                                                headers: {
                                                    "Accept": "application/json; odata=verbose"
                                                },
                                                success: function (data2) {
                                                    try {

                                                        if (data2.message == 'This email address is already in use') {

                                                            displayAlertDialog('This email address is already registered with us. Please enter a different one, or login using the existing credentials.xcx1-1');
                                                            //document.getElementById('txtCustomLogonEmail').focus();

                                                        } else if (data2.message && (data2.message.indexOf('This participant already belongs to this organization') > -1)) {

                                                            console.log('');
                                                            console.log('In bwAuthentication.js.xx.registeranewuseroranewuserwithaninvitation(). This participant already belongs to this organization. This can happen if the user tried an invitation, but then chose to just add themselves as new and the invitation querystring was stillthere...??  data3: ' + JSON.stringify(data3) + ', data2: ' + JSON.stringify(data2));
                                                            console.log('');

                                                            if (localStorage) {
                                                                localStorage['customlogonusername'] = userEmailAddress;
                                                                localStorage['customlogonpassword'] = userPassword;
                                                            }

                                                            window.location = appweburl; // This removes the querystring parameter for the invitation and just logs thme in.

                                                        } else if (data2.status == 'SUCCESS') {

                                                            if (localStorage) {
                                                                localStorage['customlogonusername'] = userEmailAddress;
                                                                localStorage['customlogonpassword'] = userPassword;
                                                            }

                                                            //$('.bwCircleDialog').bwCircleDialog('displaySignInDialog', true, 'Your login was created successfully. You will receive an introductory email in the next few minutes. Click the "Sign In" button to begin using your budget request system.<br />', true);
                                                            $('.bwAuthentication').bwAuthentication('displaySignInDialog', true, 'Your login was created successfully. You will receive an introductory email in the next few minutes. Click the "Sign In" button to begin using your budget request system.<br />', true);

                                                        } else {

                                                            displayAlertDialog(data2.message);

                                                        }

                                                    } catch (e) {
                                                        console.log('Exception in bwAuthentication.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow(): ' + e.message + ', ' + e.stack);
                                                        displayAlertDialog('Exception in bwAuthentication.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow(): data2: ' + JSON.stringify(data2) + ', ' + e.message + ', ' + e.stack);
                                                    }
                                                },
                                                error: function (data, errorCode, errorMessage) {
                                                    console.log('Error in getParticipantDetailsAndAcceptInvitation_BudgetWorkflow().registeranewuser:1:xcx2-1: ' + errorMessage);
                                                    displayAlertDialog('Error in getParticipantDetailsAndAcceptInvitation_BudgetWorkflow().registeranewuser:1:xcx2-1: ' + errorMessage);
                                                }
                                            });

                                        } else {

                                            //
                                            // We are here because it wasn't an invitation. 
                                            //
                                            if (reauthorize && reauthorize == true) {

                                                // We get here when it is a normal login, and perhaps the user logged in on another machine, invalidating our ActiveStateIdentifier.
                                                // Therefore, we don't want to change their screen, as we don't want them to lose anything. We want this to be graceful.
                                                // One idea is to switch to localStorage for the ActiveStateIdentifier.... Call this ActiveStateIdentifier handoff?
                                                console.log('In bwAuthentication.js.xx(). Re-authorized. ActiveStateIdentifier handoff to localStorage.');

                                                localStorage.setItem('bwActiveStateIdentifier', bwActiveStateIdentifier); // Now that this is set, we have to also pass this to the backend to use it properly. 
                                                $('.bwCircleDialog:first').bwCircleDialog('hideCircleDialog');

                                            } else {

                                                location = appweburl + '?ActiveStateIdentifier=' + bwActiveStateIdentifier;

                                                var requestId1 = thiz.getUrlParams('request');
                                                if (requestId1) {
                                                    location += '&request=' + requestId1;
                                                }
                                                //alert('In bwAuthentication.js.xx(). setting window.location!! xcx343245342-2');
                                                window.location = location;

                                            }

                                        }

                                    } else {

                                        //
                                        // Two Factor Authentication.
                                        //

                                        if (data.TwoFactorAuthenticationWithSms && data.TwoFactorAuthenticationWithSms == 'SUCCEEDED_SENDING_SMS') {
                                            // Display the circle dialog for this, and send a code via SMS. 9-2-2021
                                            //alert('data.bwTwoFactorAuthenticationSmsNumber: ' + data.bwTwoFactorAuthenticationSmsNumber);
                                            $('.bwCircleDialog').bwCircleDialog('displaySignInWithSMSCodeDialog', true, null, data.bwTwoFactorAuthenticationSmsNumber);


                                        } else if (data.TwoFactorAuthenticationWithSms && data.TwoFactorAuthenticationWithSms == 'FAILED_SENDING_SMS') {

                                            alert('SMS/text messaging failed: ' + data.SmsFailureMessage + '. Turning off "Two factor authentication using SMS/Text Messaging" until the issue is resolved. Please click the "Sign In" button again in order to login.');
                                            // 12-25-2021
                                            debugger; // <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
                                            var bwParticipantId = data.bwParticipantId;
                                            thiz.configurationBehaviorTwoFactorAuthenticationWithSmsTextMessagingSlider_Onchange(false, bwParticipantId);

                                        } else {
                                            // Unexpected response.
                                            alert('SMS/text messaging failed. Unexpected response: ' + data.TwoFactorAuthenticationWithSms);
                                        }

                                        // SUCCEEDED_SENDING_SMS
                                        // FAILED_SENDING_SMS // data.SmsFailureMessage



                                        //debugger;
                                        //alert('data: ' + JSON.stringify(data));

                                        ////alert('xx');
                                        //console.log('Display login using SMS code.');
                                        //var bwTwoFactorAuthenticationEnabled = true; // CHANGE: GET THIS FROM THE DATABASE







                                    }






                                }
                                //}
                                //console.log('xcx4Setting window.location: ' +location);
                                //debugger;


                            }
                        } catch (e) {
                            HideActivitySpinner();
                            console.log('Exception in logonWith_BudgetWorkflow():2: ' + e.message + ', ' + e.stack);
                            displayAlertDialog('Exception in logonWith_BudgetWorkflow():2: ' + e.message + ', ' + e.stack);
                        }
                    },
                    error: function (data, errorCode, errorMessage) {
                        HideActivitySpinner();
                        console.log('Error in bwAuthentication.logonWith_BudgetWorkflow() calling ' + operationUri + ': ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));

                        if ((data.statusText == 'timeout') || (data.statusText == 'error')) {

                            displayAlertDialog(thiz.options.ServiceUnavailableMessage);
                            $('.bwCircleDialog').bwCircleDialog('hideCircleDialog');

                        } else {
                            displayAlertDialog('Error in bwAuthentication.logonWith_BudgetWorkflow() calling ' + operationUri + ': ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                        }


                        // "readyState":0,"responseText":"","status":0,"statusText":"error"
                        // Todd 10-14-17: This first if statement may not be necessary, but I can't replicate the issue so I am leaving it here.
                        //if (data.readyState == 0 && data.status == 0 && data.statusText == 'error') {
                        //    displayAlertDialog('Our back end web server is not responding. Please try again in a few minutes.');
                        //} else 
                        //if (JSON.stringify(data).toUpperCase().indexOf('ERROR 503 SERVICE UNAVAILABLE') > -1) {
                        //    displayAlertDialog('Our back end web server is not responding. Please try again in a few minutes.');
                        //    WriteToErrorLog('LOGIN FAILURE1!!!!!!!!!!! Error in index.js.logonWith_BudgetWorkflow().usercustomlogon: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                        //} else {
                        //    displayAlertDialog('Error in usercustomlogon. Incorrect .js file version: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                        //    WriteToErrorLog('Error in usercustomlogon. Incorrect .js file version: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                        //}

                        if (errorCode === "timeout") {
                            //alert("got timeout");
                            displayAlertDialog('Our back end server/database is not responding. Please try again in a few minutes.');
                            WriteToErrorLog('LOGIN FAILURE1!!!!!!!!!!! Error in bwAuthentication.logonWith_BudgetWorkflow(): ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));

                        } else if (JSON.stringify(data).toUpperCase().indexOf('403') > -1) {
                            // 403 Forbidden.
                            displayAlertDialog('The back end database cannot be contacted (403). Please try again in a few minutes. <a target="_blank" href="http://status.budgetworkflow.com">http://status.budgetworkflow.com</a>');
                            WriteToErrorLog('LOGIN FAILURE1!!!!!!!!!!! Error in bwAuthentication.logonWith_BudgetWorkflow(): Web services cannot be contacted. Please try again in a few minutes. 403 error The request could not be satisfied.: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                        } else if (JSON.stringify(data).toUpperCase().indexOf('503') > -1) {
                            // 503 Service unavailable.
                            displayAlertDialog('Web services status is 503 Service Unavailable. Please try again in a few minutes. <a target="_blank" href="http://status.budgetworkflow.com">http://status.budgetworkflow.com</a>');
                            WriteToErrorLog('LOGIN FAILURE1!!!!!!!!!!! Error in bwAuthentication.logonWith_BudgetWorkflow(): Web services cannot be contacted. Please try again in a few minutes. 403 error The request could not be satisfied.: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                        } else {
                            displayAlertDialog('Error in bwAuthentication.logonWith_BudgetWorkflow() calling ' + operationUri + ': ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                            WriteToErrorLog('Error in bwAuthentication.logonWith_BudgetWorkflow() calling ' + operationUri + ': ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                        }
                    }
                });
            }
            //}
        } catch (e) {
            console.log('Exception in logonWith_BudgetWorkflow(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in logonWith_BudgetWorkflow(): ' + e.message + ', ' + e.stack);
        }
    },

    displayAttachmentInDialog: function (fileUrl, filename, description, bwBudgetRequestId) {
        try {
            console.log('In bwAuthentication.js.displayAttachmentInDialog().');
            console.log('ADD THE ZOOM SLIDER TO THIS DIALOG!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!');
            console.log('*********************************************************************');
            console.log('In bwAuthentication.js.displayAttachmentInDialog("' + fileUrl + '", "' + filename + '", "' + description + '", "' + bwBudgetRequestId + '").');
            console.log('*********************************************************************');
            console.log('');

            var thiz = this;

            window.scrollTo(0, 0); // Scroll to top on button click. This makes sure things render Ok, and also just seems like a nicer user experience.
            $('.bwActiveMenu').bwActiveMenu('adjustLeftSideMenu'); // This makes sure our new stretchy-left-menu redraws Ok.

            fileUrl = decodeURI(fileUrl); // Since the url gets passed in some click events, it may have gotten encoded. Particularly, the ampersand is a problem with this, as we need ActiveStateIdentifier to get passed properly.

            $('#divAttachmentsDialog1Contents').empty(); // We have to empty the contents of the dialog before it is displayed.
            $("#AttachmentsDialog1").dialog({
                modal: false,
                resizable: true,
                closeOnEscape: false, // Hit the ESC key to hide! Yeah!
                width: "720px",
                dialogClass: "no-close", // No close button in the upper right corner.
                hide: false,//, // This means when hiding just disappear with no effects.
                position: {
                    my: "middle top+12",
                    at: "middle top",
                    of: window
                },
                close: function () {
                    $('#divAttachmentsDialog1Contents').html(''); // Theoretically, clearing this will stop a .mp4 from playing...... ????? 3-19-2022. CONFIRMED! It works with Safari on MacBook! Woop!
                    $(this).dialog('destroy');
                },
                open: function () {
                    try {
                        //debugger; // 1-8-2022
                        var requestDialogId = 'AttachmentsDialog1';

                        $('#' + requestDialogId).css('overflow', 'hidden'); // This keeps the scroll bars from showing up on the form dialog!!!!!!!! 7-13-2020

                        var element = document.getElementById(requestDialogId).parentNode; // This is the best way to get a handle on the jquery dialog.
                        var requestDialogParentId = requestDialogId + '_Parent'; // We need to have an id value so we can refer to this. It doesn't have one unless we add it here.
                        element.id = requestDialogParentId; // We need to have an id value so we can refer to this. It doesn't have one unless we add it here.

                        // This creates the custom header/draggable bar on the dialog!!! 4-2-2020. // ☈ ☇ https://www.toptal.com/designers/htmlarrows/symbols/thunderstorm/
                        var html = '';

                        // added dbkl click here 12-28-2022
                        html += '<table xcx="xcx325432753" style="width:100%;" onclick="$(\'.bwRequest\').bwRequest(\'pinRequestDialog\');" ondblclick="$(\'.bwRequest\').bwRequest(\'zoomAndCenter\', \'' + requestDialogId + '\');" >'; // This click event is like "pin". Once the user clicks the header of the request dialog, it no longer is modal and persists on the screen until they choose to close it.
                        html += '   <tr>';
                        html += '       <td style="width:95%;">';
                        //html += '           <div id="slider_' + budgetRequestId + '" style="width:20%;cursor:pointer;"></div>';
                        html += '           <div id="slider_' + requestDialogId + '" style="width:20%;cursor:pointer;"></div>';
                        html += '       </td>';



                        html += '       <td style="vertical-align:middle;width:5%;padding:0;border:0;margin:0;">';


                        // 2-11-2022
                        //html += '           <div title="pin" class="pinButton" style="display:inline-block;font-size:18pt;cursor:pointer !important;" onclick="$(\'.bwRequest\').bwRequest(\'pinAttachmentsDialog\');"><img src="/images/pin2.jpeg" style="width:50px;height:50px;cursor:pointer !important;" onclick="$(\'.bwRequest\').bwRequest(\'pinAttachmentsDialog\');" /></div>';


                        html += '       </td>';

                        html += '       <td style="vertical-align:middle;width:5%;padding:0;border:0;margin:0;">';






                        html += '           <div title="print" class="printButton" xcx="xcx1232153667" style="display:inline-block;font-size:18pt;cursor:pointer !important;" onclick="$(\'.bwPrintButton\').bwPrintButton(\'PrintIndividualAttachment\', \'' + 'divAttachmentsDialog1Contents' + '\');"><img src="/images/iosprinter_blue.png" style="width:50px;height:50px;cursor:pointer !important;"  /></div>';





                        html += '       </td>';
                        html += '       <td>&nbsp;&nbsp;</td>';
                        html += '       <td>';


                        // changed 11-11-2022
                        //html += '           <span xcx="In bwAuthentication.js.displayAttachmentInDialog.AttachmentsDialog1.dialog.open()" class="dialogXButton" style="font-size:25pt;cursor:pointer;width:100%;font-weight:bold;" onclick="$(\'.bwPageScrollingHandler\').bwPageScrollingHandler(\'CloseDialogAndPreventNextWindowScrollEvent\', \'' + requestDialogId.replace('_Parent', '') + '\');">X</span>';
                        html += '           <span xcx="In bwAuthentication.js.displayAttachmentInDialog.AttachmentsDialog1.dialog.open()" class="dialogXButton" style="font-size:25pt;cursor:pointer;width:100%;font-weight:bold;" onclick="$(\'#' + requestDialogId + '\').dialog(\'close\');">X</span>';



                        html += '       </td>';
                        html += '   </tr>';
                        html += '</table>';
                        document.getElementById(requestDialogId).parentNode.querySelector(".ui-dialog-titlebar").innerHTML = html;

                        $("#slider_" + requestDialogId).slider({
                            min: 50,
                            max: 500, // changed 11-21-2022 // 200,
                            value: 100, // It starts off full size.
                            slide: function (event, ui) {
                                //thiz.setZoom(ui.value, requestDialogId);
                                $('.bwRequest').bwRequest('setZoom', ui.value, requestDialogId);
                            }//,
                            //change: function (event, ui) {
                            //    thiz.setZoom(ui.value, requestDialogId);
                            //}
                        });
                        try {
                            $('.bwRequest').bwRequest('setZoom', '100', requestDialogId);
                        } catch (e) { } // This is here because the backend doesn't use the bwRequest.js widget.
                    } catch (e) {
                        console.log('Exception in bwAttachments.js.AttachmentsDialog1.dialog.open(): ' + e.message + ', ' + e.stack);
                        displayAlertDialog('Exception in bwAttachments.js.AttachmentsDialog1.dialog.open(): ' + e.message + ', ' + e.stack);
                    }
                }
            });
            //$("#AttachmentsDialog1").dialog().parents(".ui-dialog").find(".ui-dialog-titlebar").remove();




            // We need to add these files extensions below!
            // .MP3 (audio), .MP4 (audio), .M4A (audio), .M4V (video), .M4R ("tones"), 




            var html = '';
            //debugger;
            // We need to present these by using file extension. This displays all images. .jpg, .png, .xx << Todd: need work here.
            if (fileUrl.toUpperCase().indexOf('.XLSX') > -1 || fileUrl.toUpperCase().indexOf('.XLS') > -1) {

                // Excel attachments.
                $('#spanAttachmentsDialog1Title').html('<span style="font-size:30pt;font-weight:bold;color:lightgray;" xcx="xcx23214-1">Attachment Item</span> Select the link below to view the EXCEL document...');
                html += '<a href="' + fileUrl + '" target="_blank"><img xcx="xcx2314256" src="images/excelicon.png" style="width:100px;height:46px;cursor:pointer;" /></a>';
                html += '<a href="' + fileUrl + '" target="_blank">Click here to view in EXCEL</a>';
                //html += '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                //html += '<a href="javascript:displayExcelDocumentInBrowser(\'' + fileUrl + '\');" target="_blank">Click here to view in browser</a>';

            } else if (fileUrl.toUpperCase().indexOf('.JFIF') > -1 || fileUrl.toUpperCase().indexOf('.PNG') > -1 || fileUrl.toUpperCase().indexOf('.JPG') > -1 || fileUrl.toUpperCase().indexOf('.JPEG') > -1 || fileUrl.toUpperCase().indexOf('.BMP') > -1 || fileUrl.toUpperCase().indexOf('.GIF') > -1 || fileUrl.toUpperCase().indexOf('.TIFF') > -1 || fileUrl.toUpperCase().indexOf('.SVG') > -1 || fileUrl.toUpperCase().indexOf('.WEBP') > -1) {
                // Images.


                $('#spanAttachmentsDialog1Title').html('<span style="font-size:30pt;font-weight:bold;color:lightgray;" xcx="xcx23214-2">Attachment Item</span>');


                html += '<img xcx="xcx3243674" src="' + fileUrl + '" style="width:700px;display:block;margin-left:auto;margin-right:auto;cursor:pointer;" />';


            } else if (fileUrl.toUpperCase().indexOf('.PDF') > -1 || fileUrl.toUpperCase().indexOf('.RTF') > -1 || fileUrl.toUpperCase().indexOf('.DOC') > -1 || fileUrl.toUpperCase().indexOf('.DOCX') > -1 || fileUrl.toUpperCase().indexOf('.TXT') > -1 || fileUrl.toUpperCase().indexOf('.ODT') > -1 || fileUrl.toUpperCase().indexOf('.ODS') > -1 || fileUrl.toUpperCase().indexOf('.ODP') > -1) {
                // Documents.
                $('#spanAttachmentsDialog1Title').html('<span style="font-size:30pt;font-weight:bold;color:lightgray;" xcx="xcx23214-3">Attachment Item</span> Select the link below to view the document...');
                html += '<a href="' + fileUrl + '" target="_blank">Click here to view the document</a>';
            } else if (fileUrl.toUpperCase().indexOf('.MP3') > -1 || fileUrl.toUpperCase().indexOf('.M4A') > -1 || fileUrl.toUpperCase().indexOf('.M4R') > -1) {
                // Audio.
                $('#spanAttachmentsDialog1Title').html('<span style="font-size:30pt;font-weight:bold;color:lightgray;" xcx="xcx23214-4">Attachment Item</span> Select the link below to listen...');
                if (iOSApp == 'YES') {
                    html += '<a href="' + fileUrl + '">Click here to listen</a>';
                } else {
                    html += '<div style="text-align:center;"><audio src="' + fileUrl + '" controls="controls">Click here to listen</audio></div>';
                }



                html += '<br />';
                html += '<a style="float:right;" href="' + fileUrl + '" download>Click here to download...</a>'; // This is the first a element with a download attribute... more to follow... 4-14-2022.






            } else if (fileUrl.toUpperCase().indexOf('.M4V') > -1 || fileUrl.toUpperCase().indexOf('.AVI') > -1 || fileUrl.toUpperCase().indexOf('.MOV') > -1 || fileUrl.toUpperCase().indexOf('.MP4') > -1) {
                //// Video.
                //$('#spanAttachmentsDialog1Title').html('Select the link below to view...');
                //if (iOSApp == 'YES') {
                //    html += '<a href="' + fileUrl + '">Click here to view</a>';
                //} else {
                //    html += '<audio src="' + fileUrl + '" controls="controls">Click here to view</audio>';
                //}


                // Video.
                $('#spanAttachmentsDialog1Title').html('<span style="font-size:30pt;font-weight:bold;color:lightgray;" xcx="xcx23214-5">Attachment Item</span>');
                if (iOSApp == 'YES') {
                    html += '<a href="' + fileUrl + '">Click here to view</a>';
                } else {


                    var obj = document.createElement("video");
                    //alert('Video test of video/mp4: ' + obj.canPlayType("video/mp4")); // "maybe"
                    //alert('Video test of video/webm: ' + obj.canPlayType("video/webm")); // "maybe"



                    //html += '<div style="text-align:center;"><video xcx="xcx3345-1" controls="controls" width="650" ><source src="' + fileUrl + '" type="video/mp4"></video></div>'; // This sets the size of the video control\element.
                    //html += '<div style="text-align:center;"><video xcx="xcx3345-1" controls="controls" width="650" ><source src="' + fileUrl + '" type="video/webm; codecs=\'vp8, vorbis\'"></video></div>'; // This sets the size of the video control\element.
                    html += '<div style="text-align:center;"><video xcx="xcx3345-1" controls="controls" width="650" ><source src="' + fileUrl + '" type="video/mp4"></video></div>'; // This sets the size of the video control\element.
                }
            } else {

                // 4-13-2023

                //$('#spanAttachmentsDialog1Title').html('<span style="font-size:30pt;font-weight:bold;color:lightgray;" xcx="xcx23214-6">Attachment Item</span> This attachment has an unknown file extension...');
                //html += '<a href="' + fileUrl + '" target="_blank">Click here to try to open this file</a>';

                //alert('xcx1231241 fileUrl: ' + fileUrl);

                $('#spanAttachmentsDialog1Title').html('<span style="font-size:30pt;font-weight:bold;color:lightgray;" xcx="xcx23214-6">Attachment Item</span> This attachment has an unknown file extension...');
                html += '<a xcx="xcx21432356-3" href="' + fileUrl + '" target="_blank">Click here to try to open this file</a>';



            }
            $('#divAttachmentsDialog1Contents').html(html);



            // Create the "Save" button.
            html = '';
            html += '<div id="btnAttachmentsDialog1SaveMetadata" class="divDialogButton" onclick="$(\'.bwAttachments:first\').bwAttachments(\'cmdSaveAttachmentMetadata\', \'' + bwBudgetRequestId + '\', \'' + filename + '\');">Save</div>';
            $('#spanAttachmentsDialog1SaveMetadataButton').html(html);

            // Create the "Delete" button.

            //alert('xcx44432 filename: ' + filename);

            html = '';
            html += '<div id="btnAttachmentsDialog1DeleteAttachment" class="divDialogButton" onclick="$(\'.bwAttachments:first\').bwAttachments(\'cmdDeleteAttachment\', \'' + bwBudgetRequestId + '\', \'' + filename + '\');">Delete</div>';
            $('#spanAttachmentsDialog1DeleteAttachmentButton').html(html);

            // 4-29-2023
            // OCR
            html = '';
            html += '<div id="btnAttachmentsDialog1_PerformOCRButton" class="divDialogButton" onclick="$(\'.bwAttachments:first\').bwAttachments(\'performOCR\', \'' + bwBudgetRequestId + '\', \'' + filename + '\');">Image OCR</div>';
            $('#spanAttachmentsDialog1_PerformOCRButton').html(html);
            // $('.bwAttachments:first').bwAttachments('launchFileConversion', 'bwBudgetRequestIdxcx234111', 'filenamexcx2423423425');


            // 10-6-2022
            // Create the "spanAttachmentsDialog1_LaunchFleConversionButton" button.
            html = '';
            html += '<div id="btnAttachmentsDialog1_LaunchFileConversionButton" class="divDialogButton" onclick="$(\'.bwAttachments:first\').bwAttachments(\'launchFileConversion\', \'' + bwBudgetRequestId + '\', \'' + filename + '\');">Launch file conversion...</div>';
            $('#spanAttachmentsDialog1_LaunchFileConversionButton').html(html);
            // $('.bwAttachments:first').bwAttachments('launchFileConversion', 'bwBudgetRequestIdxcx234111', 'filenamexcx2423423425');


            // 10-6-2022
            // Create the "Get EXIF data (metadata)" button.
            html = '';
            html += '<div id="btnAttachmentsDialog1_GetExifDataButton" class="divDialogButton" onclick="$(\'.bwAttachments:first\').bwAttachments(\'getExifData\', \'' + bwBudgetRequestId + '\', \'' + filename + '\');">Image analysis</div>';
            $('#spanAttachmentsDialog1_GetExifDataButton').html(html);
            // $('.bwAttachments:first').bwAttachments('launchFileConversion', 'bwBudgetRequestIdxcx234111', 'filenamexcx2423423425');

            // 5-29-2023
            // Repair file type
            html = '';
            html += '<div id="btnAttachmentsDialog1_PerformOCRButton" class="divDialogButton" onclick="$(\'.bwAttachments:first\').bwAttachments(\'repairFileType\', \'' + bwBudgetRequestId + '\', \'' + filename + '\');">Repair file type</div>';
            $('#spanAttachmentsDialog1_RepairFileTypeButton').html(html);
            // $('.bwAttachments:first').bwAttachments('launchFileConversion', 'bwBudgetRequestIdxcx234111', 'filenamexcx2423423425');




            //// Bind the "Save" button.
            //$('#btnAttachmentsDialog1SaveMetadata').click(function (error) {
            //    cmdSaveAttachmentMetadata(bwBudgetRequestId, filename);
            //});

            //// Bind the "Delete" button.
            //$('#btnAttachmentsDialog1DeleteAttachment').click(function (error) {
            //    cmdDeleteAttachment(bwBudgetRequestId, filename);
            //});









            // Populate the dialog with the filename and description.
            if (filename != 'undefined') {
                var extensionIndex = filename.lastIndexOf('.');
                var filenamePrefix = filename.substring(0, extensionIndex);
                var fileExtension = '.' + filename.substring(extensionIndex + 1, filename.length);
                document.getElementById('txtAttachmentsDialog1Filename').value = filenamePrefix;
                document.getElementById('spanAttachmentsDialog1FileExtension').innerHTML = fileExtension;
            } else {
                document.getElementById('txtAttachmentsDialog1Filename').value = '';
            }

            if (filename != 'description') document.getElementById('txtAttachmentsDialog1FileDescription').value = description;
            else document.getElementById('txtAttachmentsDialog1FileDescription').value = '';

        } catch (e) {
            console.log('Exception in bwAuthentication.js.displayAttachmentInDialog():2:' + e.message + ', fileUrl: ' + fileUrl + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.displayAttachmentInDialog():2:' + e.message + ', fileUrl: ' + fileUrl + ', ' + e.stack);
        }
    },

    configurationBehaviorTwoFactorAuthenticationWithSmsTextMessagingSlider_Onchange: function (isEnabled_Override, participantId) {
        try {
            console.log('In configurationBehaviorTwoFactorAuthenticationWithSmsTextMessagingSlider_Onchange().');

            if (!participantId) {
                var participantId = $('.bwAuthentication').bwAuthentication('option', 'participantId');
            }
            console.log('In configurationBehaviorTwoFactorAuthenticationWithSmsTextMessagingSlider_Onchange(). Someday come back here to validate the security mechanism. 12-25-2021');
            debugger;
            var bwTwoFactorAuthenticationEnabled = false; // 12-25-2021
            if (isEnabled_Override == false) {
                // Leave it as false;
                //bwTwoFactorAuthenticationEnabled = false; // isEnabled_Override;
            } else if (isEnabled_Override && isEnabled_Override == true) {
                bwTwoFactorAuthenticationEnabled = true;
            } else {
                var checkboxElement = document.getElementById('configurationBehaviorTwoFactorAuthenticationWithSmsTextMessagingSlider');
                if (checkboxElement && checkboxElement.checked) {
                    bwTwoFactorAuthenticationEnabled = document.getElementById('configurationBehaviorTwoFactorAuthenticationWithSmsTextMessagingSlider').checked;
                }
            }

            data = {
                bwParticipantId: participantId,
                bwTwoFactorAuthenticationEnabled: bwTwoFactorAuthenticationEnabled
            };
            var operationUri = webserviceurl + "/updateTwoFactorAuthenticationEnabledStatus";
            $.ajax({
                url: operationUri,
                type: "POST", timeout: ajaxTimeout,
                data: data,
                headers: {
                    "Accept": "application/json; odata=verbose"
                },
                success: function (data) {
                    if (data != 'SUCCESS') {
                        displayAlertDialog(data);
                    } else {
                        // Don't display anything, this works Ok.
                        //displayAlertDialog('The status has been updated successfully.');
                        console.log('In configurationBehaviorTwoFactorAuthenticationWithSmsTextMessagingSlider_Onchange(). WHY ARE WE HERE NOW?????????????????? xcx342885');
                    }
                },
                error: function (data, errorCode, errorMessage) {
                    displayAlertDialog('Error in my.js.updateTwoFactorAuthenticationEnabledStatus(): ' + errorCode + ' ' + errorMessage);
                }
            });



        } catch (e) {
            console.log('Exception in configurationBehaviorTwoFactorAuthenticationWithSmsTextMessagingSlider_Onchange(): ' + e.message + ', ' + e.stack);
        }
    },
    saveParticipantSmsNumber: function () {
        try {
            console.log('In saveParticipantSmsNumber().');

            var participantId = $('.bwAuthentication').bwAuthentication('option', 'participantId');

            var bwTwoFactorAuthenticationSmsNumber = $('#inputBwTwoFactorAuthenticationSmsNumber').val();
            //alert('inputBwTwoFactorAuthenticationSmsNumber: ' + inputBwTwoFactorAuthenticationSmsNumber);
            var data = [];
            data = {
                bwParticipantId: participantId,
                bwTwoFactorAuthenticationSmsNumber: bwTwoFactorAuthenticationSmsNumber
            };
            var operationUri = webserviceurl + "/saveParticipantSmsNumber";
            $.ajax({
                url: operationUri,
                type: "POST", timeout: ajaxTimeout,
                data: data,
                headers: {
                    "Accept": "application/json; odata=verbose"
                },
                success: function (data) {
                    if (data != 'SUCCESS') {
                        displayAlertDialog(data);
                    } else {
                        displayAlertDialog('The number has been updated successfully.');
                    }
                },
                error: function (data, errorCode, errorMessage) {
                    displayAlertDialog('Error in my.js.saveParticipantSmsNumber(): ' + errorCode + ' ' + errorMessage);
                }
            });

        } catch (e) {
            console.log('Exception in saveParticipantSmsCode(): ' + e.message + ', ' + e.stack);
        }
    },
    logonWith_BudgetWorkflow_usingSmsCode: function () {
        // The user is trying to logon. They have types in thee code and clicked the "Sign In" button. 9-2-2021
        try {
            console.log('In bwAuthentication.logonWith_BudgetWorkflow_usingSmsCode().');
            //alert('In bwAuthentication.logonWith_BudgetWorkflow_usingSmsCode().');
            var thiz = this;

            var dialogDescriptionText = '';
            if (document.getElementById('spanCustomLogonDialogInvitationDescriptionText')) {
                dialogDescriptionText = document.getElementById('spanCustomLogonDialogInvitationDescriptionText').innerHTML;
            } else {
                dialogDescriptionText = document.getElementById('spanCustomSignUpDialogInvitationDescriptionText').innerHTML;
            }

            var userSmsCode = document.getElementById('txtCustomLogonSmsCode').value;
            if (userSmsCode.trim() == '' || userSmsCode.length != 4) {
                this.displayAlertDialog('Please enter your 4-digit code before continuing the logon process.');
            } else {
                // Ok, lets see if the SMS code is correct.
                var userEmailAddress = localStorage['customlogonusername']; //this.getCookie('customlogonusername');
                var data = [];
                data = {
                    userEmailAddress: userEmailAddress,
                    userSmsCode: userSmsCode
                };
                var operationUri = this.options.operationUriPrefix + '_bw/usercustomlogontwofactorwithsmscode';
                $.ajax({
                    url: operationUri,
                    timeout: ajaxTimeout,
                    type: "POST",
                    data: data,
                    headers: {
                        "Accept": "application/json; odata=verbose"
                    },
                    success: function (data) {
                        //debugger;
                        //displayAlertDialog(data);

                        if (data.message != 'The SMS code is correct') {
                            if (data.message == 'USER_DOES_NOT_EXIST') { // xcx122134-2
                                // Since the user doesn't exist, display the "Create new user" dialog.
                                //debugger;
                                //thiz.setCookie('customlogonusername', userEmailAddress, 30);
                                //thiz.setCookie('customlogonpassword', userPassword, 30);
                                //$('.bwCircleDialog').bwCircleDialog('displayCustomSignInWithInvitationDialog', true, 'toddtest');
                                //document.getElementById('spanCustomSignUpDialogInvitationDescriptionText').innerHTML = 'toddtest22';
                                displayAlertDialog(data.message);
                            } else {
                                if (data.message) {
                                    displayAlertDialog(data.message);
                                } else {
                                    displayAlertDialog(data);
                                }
                            }
                        } else {

                            // Cookie!
                            //thiz.setCookie('customlogonusername', userEmailAddress, 30);
                            //thiz.setCookie('customlogonpassword', userPassword, 30);

                            var bwActiveStateIdentifier = data.bwActiveStateIdentifier;


                            ////debugger; // This is where the ios8.html gets redirected back to my.html. FIX IT!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 6-11-2020
                            //var location = appweburl + '/ios8.html?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                            ////var location = appweburl + '/my.html?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                            //console.log('xcx5Setting window.location: ' + location);
                            //debugger;
                            //window.location = location;


                            var location;
                            //if (window.location.href.indexOf('my.html') > -1) {
                            //    location = appweburl + '/my.html?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                            //    window.location = location;
                            if (window.location.href.indexOf('ios8.html') > -1) {
                                debugger;
                                location = appweburl + '/ios8.html?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                                alert('In bwAuthentication.js.xx(). setting window.location!! xcx343245342-3');
                                window.location = location;
                            } else {
                                //displayAlertDialog('Error xcx3: Unexpected window.location. This process cannot proceed.');
                                // THIS IS THE DEFAULT
                                if (thiz.options.backendAdministrationLogin == true) {

                                    //
                                    // Only budgetworkflow@gmail.com is allowed in here!
                                    //
                                    //if (userEmailAddress.toLowerCase() == 'budgetworkflow@gmail.com') {
                                    if (userEmailAddress.toLowerCase() == 'todd@budgetworkflow.com') {

                                        if (window.location.href.indexOf('livestatus.html') > -1) {
                                            location = appweburl + '/livestatus.html?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                                            window.location = location;
                                        } else if (window.location.href.indexOf('admin.html') > -1) {
                                            location = appweburl + '/admin.html?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                                            window.location = location;
                                        } else if (window.location.href.indexOf('admin2.html') > -1) {
                                            location = appweburl + '/admin2.html?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                                            window.location = location;
                                        } else {
                                            alert('Unrecognized URL. Unable to complete authentication.');
                                        }

                                    } else {
                                        displayAlertDialog('You do not have permission to access this location.');
                                    }



                                } else {

                                    alert('xcx88653-3 DEV:Check code.');

                                    debugger; // 12-8-2021 second try
                                    var requestId1;
                                    try {
                                        console.log('UUUUUUUUUUUUUUUUUUUUUUUUUUUUU xcx123123-1');
                                        console.log('xcx234324324-4 getUrlParams [request]');
                                        console.log('UUUUUUUUUUUUUUUUUUUUUUUUUUUUU xcx123123-2');
                                        requestId1 = thiz.getUrlParams()['request'].toString().split('#')[0];
                                    } catch (e) {

                                    }

                                    console.log('xcx3434235345324565645 ?ActiveStateIdentifier'); // 8-28-2021
                                    location = appweburl + '?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                                    if (requestId1) {
                                        location += '&request=' + requestId1;
                                    }
                                    alert('In bwAuthentication.js.xx(). setting window.location!! xcx343245342-4');
                                    window.location = location;


                                }
                            }
                            //console.log('xcx4Setting window.location: ' +location);
                            //debugger;


                        }
                    },
                    error: function (data, errorCode, errorMessage) {
                        // "readyState":0,"responseText":"","status":0,"statusText":"error"
                        // Todd 10-14-17: This first if statement may not be necessary, but I can't replicate the issue so I am leaving it here.
                        //if (data.readyState == 0 && data.status == 0 && data.statusText == 'error') {
                        //    displayAlertDialog('Our back end web server is not responding. Please try again in a few minutes.');
                        //} else 
                        //if (JSON.stringify(data).toUpperCase().indexOf('ERROR 503 SERVICE UNAVAILABLE') > -1) {
                        //    displayAlertDialog('Our back end web server is not responding. Please try again in a few minutes.');
                        //    WriteToErrorLog('LOGIN FAILURE1!!!!!!!!!!! Error in index.js.logonWith_BudgetWorkflow().usercustomlogon: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                        //} else {
                        //    displayAlertDialog('Error in usercustomlogon. Incorrect .js file version: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                        //    WriteToErrorLog('Error in usercustomlogon. Incorrect .js file version: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                        //}

                        if (errorCode === "timeout") {
                            //alert("got timeout");
                            displayAlertDialog('Our back end server/database is not responding. Please try again in a few minutes.');
                            WriteToErrorLog('LOGIN FAILURE1!!!!!!!!!!! Error in bwAuthentication.logonWith_BudgetWorkflow_usingSmsCode(): ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));

                        } else if (JSON.stringify(data).toUpperCase().indexOf('ERROR 503 SERVICE UNAVAILABLE') > -1) {
                            displayAlertDialog('Our back end database is not responding. Please try again in a few minutes.');
                            WriteToErrorLog('LOGIN FAILURE1!!!!!!!!!!! Error in bwAuthentication.logonWith_BudgetWorkflow_usingSmsCode(): ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                        } else {
                            displayAlertDialog('Error in bwAuthentication.logonWith_BudgetWorkflow(). Incorrect .js file version:1-2: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                            WriteToErrorLog('Error in bwAuthentication.logonWith_BudgetWorkflow_usingSmsCode(). Incorrect .js file version: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                        }
                    }
                });
            }
            //}
        } catch (e) {
            console.log('Exception in logonWith_BudgetWorkflow_usingSmsCode(): ' + e.message + ', ' + e.stack);
        }
    },
    //getParticipantDetailsAndAcceptInvitation_Microsoft: function () {
    //    try {
    //        //debugger;
    //        console.log('In getParticipantDetailsAndAcceptInvitation_Microsoft().');
    //        var thiz = this;
    //        //
    //        // Documentation for MSAL.js v.1
    //        // https://github.com/AzureAD/microsoft-authentication-library-for-js/tree/dev/lib/msal-core
    //        //
    //        // CODING DOCS: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL.js-1.0.0-api-release
    //        //
    //        // Azure settings:
    //        // Display name: beta.budgetworkflow.com
    //        // Application (client) ID: 55d270fb-e669-465a-a792-ab44f4ac23f0
    //        // Directory (tenant) ID: 0477f091-c206-45cd-ad68-a1b256fac8b8
    //        // Object ID: 06e0bee6-c9d5-487d-8035-b1a907d1faf9

    //        //debugger; // >>>>>>>>>>>>>> Check for client_info & session_state here!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    //        let loginRequest = {
    //            scopes: ['user.read'], //, 'user.write'],
    //            prompt: 'select_account',
    //        }

    //        let accessTokenRequest = {
    //            scopes: ['user.read'] //, 'user.write']
    //        }
    //        //debugger; // WE SHOULD ONLY EVER COME HERE 1 TIME!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! shouldn't we???????????????????????????
    //        this.options.msalInstance.acquireTokenSilent(accessTokenRequest).then(function (response) {
    //            try {
    //                //debugger;
    //                if (!response.account) {

    //                    displayAlertDialog('ERROR in getParticipantDetailsAndAcceptInvitation_Microsoft.acquireTokenSilent');

    //                } else {
    //                    //debugger;
    //                    participantLogonType = 'microsoft';
    //                    //participantId = response.account.accountIdentifier;
    //                    participantFriendlyName = response.account.name;
    //                    participantEmail = response.account.userName;
    //                    //debugger;


    //                    // It is now only coming here 1 time! Yeah!








    //                    //
    //                    // This is where we check for Invitation and Unsubscribe.
    //                    //
    //                    //debugger;
    //                    // TODO: 8-12-2020:
    //                    //
    //                    // Copy webservice registerandinviteanewusercustom and rename to registerandinviteanewusermicrosoft << DONE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    //                    //
    //                    var bwInvitationId; //, unsubscribe;
    //                    //try {
    //                    //    inviteeId = getUrlParams()['invitation'].toString().split('#')[0];
    //                    //} catch (e) {}
    //                    //try {
    //                    //    unsubscribe = getUrlParams()['unsubscribe'].toString().split('#')[0];
    //                    //} catch (e) { }
    //                    try {
    //                        bwInvitationId = this.getUrlParams()['invitation'].toString().split('#')[0];
    //                    } catch (e) { }

    //                    if (bwInvitationId) {
    //                        //debugger;
    //                        var data = [];
    //                        data = {
    //                            newUserFriendlyName: participantFriendlyName,
    //                            newUserEmailAddress: participantEmail,
    //                            //newUserPassword: null,
    //                            appweburl: appweburl,
    //                            bwInvitationId: bwInvitationId
    //                        };
    //                        var operationUri = webserviceurl + "/bwworkflow/registerandinviteanewusermicrosoft";

    //                        //debugger; // This is where it works, but not for a completely new user, as it does not ass the new user to the invited bwWorkflowApp <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

    //                        $.ajax({
    //                            url: operationUri,
    //                            type: "POST",
    //                            timeout: thiz.options.ajaxTimeout,
    //                            data: data,
    //                            headers: {
    //                                "Accept": "application/json; odata=verbose"
    //                            },
    //                            success: function (data) {
    //                                try {
    //                                    //debugger;
    //                                    if (data.message == 'This email address is already in use') {
    //                                        displayAlertDialog('This email address is already registered with us. Please enter a different one, or login using the existing credentials.xcx1-2');
    //                                        //document.getElementById('txtCustomLogonEmail').focus();
    //                                    } else if (data.message.indexOf('NO_INVITATION_FOUND') > -1) {
    //                                        //displayAlertDialog('NO_INVITATION_FOUND');
    //                                        displayAlertDialog(data.message);
    //                                    } else if (data.message == 'SUCCESS' || data.message == 'USER_IS_ALREADY_A_MEMBER') {
    //                                        //debugger;
    //                                        // Cookie!
    //                                        //thiz.setCookie('customlogonusername', newUserEmailAddress, 30);
    //                                        //thiz.setCookie('customlogonpassword', newUserPassword, 30);

    //                                        //participantId = data.participant.bwParticipantId;
    //                                        //participantFriendlyName = data.participant.bwParticipantFriendlyName;
    //                                        //participantEmail = data.participant.bwParticipantEmail;
    //                                        //tenantId = data.participant.bwTenantId;
    //                                        //workflowAppId = data.participant.bwLastSelectedWorkflowAppId;
    //                                        //workflowAppTitle = data.participant.bwWorkflowAppTitle;
    //                                        //participantLogonType = 'custom';
    //                                        //participantLogonTypeUserId = participantId;

    //                                        //emailNotificationFrequency = data.participant.bwEmailNotificationFrequency;
    //                                        //emailNotificationTypes = data.participant.bwEmailNotificationTypes;

    //                                        //if (data.participant.bwTipsDisplayOn == 'true') tipsDisplayOn = true;
    //                                        //else tipsDisplayOn = false;

    //                                        //if (data.participant.bwInvitationsOnHomePageDisplayOn == 'true') displayInvitationsOnHomePageDisplayOn = true;
    //                                        //else displayInvitationsOnHomePageDisplayOn = false;





    //                                        //
    //                                        // This was the "Logon created successfully" notification. Maybe we don't need it and just log them in directly... 8-12-2020
    //                                        // Maybe this message on the home screen the first time around would be good????????????????
    //                                        //
    //                                        //$('.bwCircleDialog').bwCircleDialog('displaySignInDialog', true, 'Your login was created successfully. You will receive an introductory email in the next few minutes. Click the "Sign In" button to begin using your budget request system.<br />', true);









    //                                        var data = {
    //                                            participantLogonType: 'microsoft', // 'microsoft'
    //                                            //logonId: participantLogonTypeUserId, // ad884437-4a60-4c26-ac6a-3afa0860e0cf
    //                                            participantFriendlyName: participantFriendlyName, // Todd Hiltz
    //                                            participantEmail: participantEmail, // todd@budgetrequests.com
    //                                            appweburl: appweburl
    //                                        };
    //                                        //var operationUri = appweburl + "/getparticipantdetails/" + participantLogonType + "/" + participantLogonTypeUserId.toString() + "/" + participantFriendlyName + "/" + participantEmail;
    //                                        //debugger;
    //                                        var operationUri = webserviceurl + "/getparticipantdetails";
    //                                        $.ajax({
    //                                            url: operationUri,
    //                                            type: "POST",
    //                                            timeout: thiz.options.ajaxTimeout,
    //                                            data: data,
    //                                            headers: {
    //                                                "Accept": "application/json; odata=verbose"
    //                                            },
    //                                            success: function (userData) {
    //                                                try {
    //                                                    //debugger; // IS THE USER REGISTERED WITH BudgetWorkflow.com?? xcx1

    //                                                    if (userData.result && userData.result == 'USER_DOES_NOT_EXIST') { // xcx122134-3
    //                                                        //debugger;
    //                                                        var proceed = confirm('YOU ARE LOGGING IN FOR THE FIRST TIME. Would you like to create your own request system?\n\n\nClick the OK button to proceed...');
    //                                                        if (proceed) {
    //                                                            //debugger;
    //                                                            //thiz.newUserProvisioning_Microsoft(JSON.stringify(data));

    //                                                        } else {
    //                                                            //debugger;
    //                                                        }

    //                                                        //displayAlertDialog('In renderWelcomeScreen.POST.getparticipantdetails(): USER_DOES_NOT_EXIST. ' + userData.message);
    //                                                        //
    //                                                        // PROMPT THE USER TO ASK IF THEY WANT TO CREATE THEIR OWN TENANT ETC
    //                                                        //


    //                                                    } else {
    //                                                        debugger;

    //                                                        participantId = userData.participant.bwParticipantId; // added 9-5-2020
    //                                                        participantLogonTypeUserId = userData.participant.bwParticipantLogonTypeUserId;

    //                                                        tenantId = userData.participant.bwLastSelectedTenantId; // added 8-8-2020 9-30pm adt


    //                                                        if (userData.participant.bwLastSelectedTenantId) {
    //                                                            tenantId = userData.participant.bwLastSelectedTenantId;
    //                                                        } else {
    //                                                            if (userData.participant.bwTenantId) {
    //                                                                tenantId = userData.participant.bwTenantId;
    //                                                            } else {
    //                                                                displayAlertDialog('ERROR: TRACK THIS xcx12392142-2');
    //                                                            }
    //                                                        }

    //                                                        //debugger; // xcx 33734 <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
    //                                                        workflowAppId = userData.participant.bwLastSelectedWorkflowAppId; // added 8-8-2020 9-30pm adt
    //                                                        //thiz.loadRemainingJsAndCssAndBWMData();
    //                                                        thiz.getRemainingParticipantDetailsAndWorkflowAppTitle();
    //                                                    }

    //                                                } catch (e) {
    //                                                    //debugger; // xcx39840236
    //                                                    displayAlertDialog('xcx39840236-1: ' + e.message + ', ' + e.stack);
    //                                                }
    //                                            },
    //                                            error: function (data, errorCode, errorMessage) {
    //                                                //handleExceptionWithAlert('Error in Start.js.displayConnectedWorkflows()', '1:' + errorCode + ', ' + errorMessage);
    //                                                //debugger;
    //                                                displayAlertDialog('There has been an error contacting the serverxcx1.\n\n' + errorMessage); // + ' data:' + data);
    //                                            }
    //                                        });

    //                                    } else {

    //                                        displayAlertDialog('Error xcx9231: ' + data.message);
    //                                    }
    //                                } catch (e) {
    //                                    //debugger;
    //                                    console.log('Exception in bwAuthentication.getParticipantDetailsAndAcceptInvitation_Microsoft(): ' + e.message + ', ' + e.stack);
    //                                    displayAlertDialog('Exception in bwAuthentication.getParticipantDetailsAndAcceptInvitation_Microsoft(): ' + e.message + ', ' + e.stack);
    //                                }
    //                            },
    //                            error: function (data, errorCode, errorMessage) {
    //                                //debugger;
    //                                //handleExceptionWithAlert('Error in Start.js.displayConnectedWorkflows()', '1:' + errorCode + ', ' + errorMessage);
    //                                displayAlertDialog('Error in getParticipantDetailsAndAcceptInvitation_Microsoft().registeranewuser:1:xcx1: ' + errorMessage);
    //                            }
    //                        });


    //                    } else {




    //                        // This is a regular login, not an invitation one.
    //                        //participantLogonType = 'microsoft';
    //                        ////participantId = response.account.accountIdentifier;
    //                        //participantFriendlyName = response.account.name;
    //                        //participantEmail = response.account.userName;


    //                        //alert('ms logon participantEmail: ' + participantEmail);

    //                        var data = {
    //                            participantLogonType: 'microsoft', // 'microsoft'
    //                            //logonId: participantLogonTypeUserId, // ad884437-4a60-4c26-ac6a-3afa0860e0cf
    //                            participantFriendlyName: participantFriendlyName, // Todd Hiltz
    //                            participantEmail: participantEmail, // todd@budgetrequests.com
    //                            appweburl: appweburl
    //                        };
    //                        //var operationUri = appweburl + "/getparticipantdetails/" + participantLogonType + "/" + participantLogonTypeUserId.toString() + "/" + participantFriendlyName + "/" + participantEmail;
    //                        //debugger;
    //                        var operationUri = webserviceurl + "/getparticipantdetails";
    //                        $.ajax({
    //                            url: operationUri,
    //                            type: "POST",
    //                            timeout: thiz.options.ajaxTimeout,
    //                            data: data,
    //                            headers: {
    //                                "Accept": "application/json; odata=verbose"
    //                            },
    //                            success: function (userData) {
    //                                try {
    //                                    //debugger; // IS THE USER REGISTERED WITH BudgetWorkflow.com?? xcx1
    //                                    if (!userData.result) {
    //                                        //debugger;
    //                                        console.log('In bwAuthentication.getParticipantDetailsAndAcceptInvitation_Microsoft(). xcx77635: ' + JSON.stringify(userData));
    //                                        alert('In bwAuthentication.getParticipantDetailsAndAcceptInvitation_Microsoft(). xcx77635: ' + userData);
    //                                    } else if (userData.result && userData.result == 'USER_DOES_NOT_EXIST') { // xcx122134-4
    //                                        //debugger;
    //                                        var proceed = confirm('YOU ARE LOGGING IN FOR THE FIRST TIME. Would you like to create your own request system?\n\n\nClick the OK button to proceed...');
    //                                        if (proceed) {
    //                                            //debugger;
    //                                            thiz.newUserProvisioning_Microsoft(JSON.stringify(data));


    //                                            //thiz.loadRemainingJsAndCssAndBWMData();


    //                                        } else {
    //                                            //debugger;
    //                                        }

    //                                        //displayAlertDialog('In renderWelcomeScreen.POST.getparticipantdetails(): USER_DOES_NOT_EXIST. ' + userData.message);
    //                                        //
    //                                        // PROMPT THE USER TO ASK IF THEY WANT TO CREATE THEIR OWN TENANT ETC
    //                                        //


    //                                    } else {
    //                                        //debugger;
    //                                        participantId = userData.participant.bwParticipantId; // added 9-5-2020
    //                                        participantLogonTypeUserId = userData.participant.bwParticipantLogonTypeUserId;

    //                                        tenantId = userData.participant.bwLastSelectedTenantId; // added 8-8-2020 9-30pm adt


    //                                        if (userData.participant.bwLastSelectedTenantId) {
    //                                            tenantId = userData.participant.bwLastSelectedTenantId;
    //                                        } else {
    //                                            if (userData.participant.bwTenantId) {
    //                                                tenantId = userData.participant.bwTenantId;
    //                                            } else {
    //                                                displayAlertDialog('ERROR: TRACK THIS xcx12392142-2');
    //                                            }
    //                                        }

    //                                        //debugger; // xcx 33735 WE SHOULD BE GETTIN HERE 9-5-2020<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
    //                                        workflowAppId = userData.participant.bwLastSelectedWorkflowAppId; // added 8-8-2020 9-30pm adt
    //                                        //thiz.loadRemainingJsAndCssAndBWMData();
    //                                        thiz.getRemainingParticipantDetailsAndWorkflowAppTitle();
    //                                    }

    //                                } catch (e) {
    //                                    //debugger; // xcx39840236
    //                                    displayAlertDialog('xcx39840236-2: ' + e.message + ', ' + e.stack);
    //                                }
    //                            },
    //                            error: function (data, errorCode, errorMessage) {
    //                                //handleExceptionWithAlert('Error in Start.js.displayConnectedWorkflows()', '1:' + errorCode + ', ' + errorMessage);
    //                                //debugger;
    //                                displayAlertDialog('There has been an error contacting the serverxcx2.\n\n' + errorMessage); // + ' data:' + data);
    //                            }
    //                        });














    //                    }
































    //                }
    //            } catch (e) {
    //                //debugger;
    //                console.log('Exception in 7655844-2: ' + e.message + ', ' + e.stack);
    //            }
    //        }).then(function (error) {
    //            //Acquire token silent failure, and send an interactive request
    //            //debugger;
    //            //console.log(error);
    //            //if (error.errorMessage.indexOf("interaction_required") !== -1) {
    //            //    userAgentApplication.acquireTokenRedirect(accessTokenRequest);
    //            //}
    //        }).catch(function (error) {
    //            //Acquire token silent failure, and send an interactive request
    //            //debugger;
    //            console.log(error);
    //            if (error.errorMessage.indexOf("interaction_required") !== -1) {
    //                userAgentApplication.acquireTokenRedirect(accessTokenRequest);
    //            }
    //        }).finally(function () {


    //            //debugger;

    //        });






    //    } catch (e) {
    //        //debugger;
    //        // TODD: PUT THIS BACK!!!!!!!
    //        this.displayAlertDialog('There was a problem logging you in. Please try again. Error: ' + e.message + ', ' + e.stack);
    //        //window.location.href = globalUrlPrefix + globalUrl;
    //    }
    //},
    getParticipantDetailsAndAcceptInvitation_BudgetWorkflow: function () {
        try {
            console.log('In bwAuthentication.js.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow().');
            var thiz = this;

            //
            // This is where we check for Invitation and Unsubscribe.
            //
            console.log('In bwAuthentication.js.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow(). This is where we check for Invitation and Unsubscribe. xcx23547');

            //var unsubscribe = this.getUrlParams('unsubscribe');
            var bwInvitationId = this.getUrlParams('invitation');
            var activeStateIdentifier = this.getUrlParams('ActiveStateIdentifier');
            var forestAdministratorLoginToTenant_ActiveStateIdentifier = this.getUrlParams('ForestAdministratorLoginToTenant_ActiveStateIdentifier');

            if (bwInvitationId) {

                var data = [];
                data = {
                    newUserFriendlyName: this.options.participantFriendlyName,
                    newUserEmailAddress: this.options.participantEmail,
                    newUserPassword: null,
                    appweburl: this.options.appweburl,
                    bwInvitationId: bwInvitationId
                };

                // This is where it works, but not for a completely new user, as it does not ask the new user to the invited bwWorkflowApp <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
                var operationUri = webserviceurl + "/bwworkflow/registerandinviteanewusercustom";
                $.ajax({
                    url: operationUri,
                    type: "POST",
                    data: data,
                    headers: {
                        "Accept": "application/json; odata=verbose"
                    },
                    success: function (data) {
                        try {

                            if (data.message == 'This email address is already in use') {

                                displayAlertDialog('This email address is already registered with us. Please enter a different one, or login using the existing credentials.xcx1-3');
                                //document.getElementById('txtCustomLogonEmail').focus();

                            } else if (data.message == 'SUCCESS') {

                                localStorage['customlogonusername'] = newUserEmailAddress;
                                localStorage['customlogonpassword'] = newUserPassword;

                                $('.bwCircleDialog').bwCircleDialog('displaySignInDialog', true, 'Your login was created successfully. You will receive an introductory email in the next few minutes. Click the "Sign In" button to begin using your budget request system.<br />', true);

                            } else {

                                displayAlertDialog(data.message);

                            }

                        } catch (e) {
                            conole.log('Exception in bwAuthentication.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow(): ' + e.message + ', ' + e.stack);
                            displayAlertDialog('Exception in bwAuthentication.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow(): ' + e.message + ', ' + e.stack);
                        }
                    },
                    error: function (data, errorCode, errorMessage) {
                        console.log('Error in bwAuthentication.js.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow(). registeranewuser:1:xcx2-2: ' + errorMessage);
                        displayAlertDialog('Error in bwAuthentication.js.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow(). registeranewuser:1:xcx2-2: ' + errorMessage);
                    }
                });

            } else if (activeStateIdentifier) { // This means we are logged in already. 

                var operationUri = thiz.options.operationUriPrefix + "_bw/getparticipantdetailsusingactivestateidentifier/" + activeStateIdentifier;
                //alert('xcx213256 operationUri: ' + operationUri);
                $.ajax({
                    url: operationUri,
                    method: "GET",
                    headers: {
                        "Accept": "application/json; odata=verbose"
                    },
                    success: function (data) {
                        try {

                            if (data.d.message == 'ERROR') {

                                alert('xcx34235421: Error: ' + data.d.error);

                            } else if (data.d.message == 'SUCCESS') {

                                // Load the global variables!!!!!!!
                                thiz.options.participantId = data.d.results[0].bwParticipantId;
                                thiz.options.participantLogonType = data.d.results[0].bwParticipantLogonType; //'custom';
                                thiz.options.participantLogonTypeUserId = data.d.results[0].bwParticipantId;
                                //debugger;
                                thiz.options.participantFriendlyName = data.d.results[0].bwParticipantFriendlyName;
                                thiz.options.participantEmail = data.d.results[0].bwParticipantEmail;

                                thiz.options.activeStateIPAddress = data.d.results[0].activeStateIPAddress;

                                // Get the bwTenantId
                                if (data.d.results[0].bwLastSelectedTenantId) {
                                    thiz.options.tenantId = data.d.results[0].bwLastSelectedTenantId;
                                } else {
                                    if (data.d.results[0].bwTenantId) {
                                        thiz.options.tenantId = data.d.results[0].bwTenantId; // Get the first one.
                                    } else {
                                        displayAlertDialog('Error: Could not determine tenantId: ' + data.d.results[0].bwTenantId);
                                    }
                                }
                                //thiz.options.bwLastSelectedWorkflowAppId = data.d.results[0].bwLastSelectedWorkflowAppId;

                                // Get the bwWorkflowAppID
                                if (data.d.results[0].bwLastSelectedWorkflowAppId) {
                                    thiz.options.workflowAppId = data.d.results[0].bwLastSelectedWorkflowAppId;
                                } else {
                                    if (data.d.results[0].bwWorkflowAppId) {
                                        thiz.options.workflowAppId = data.d.results[0].bwWorkflowAppId; // Get the first one.
                                    } else {
                                        displayAlertDialog('Error: Could not determine workflowAppId: ' + data.d.results[0].bwWorkflowAppId);
                                    }
                                }

                                console.log('');
                                console.log('THE USER IS AUTHENTICATED >> "' + thiz.options.participantFriendlyName + '" - ' + thiz.options.participantEmail + ' (ip: ' + thiz.options.activeStateIPAddress + '), single-factor authentication. workflowAppId: ' + thiz.options.workflowAppId);
                                console.log('');

                                console.log('xcx21324234 Redirecting console.log to storage array console.logs. We will include this with the screenshot when a user wants to report an error. REPORT_AN_ERROR');
                                console.log('');
                                console.stdlog = console.log.bind(console);
                                console.logs = [];
                                console.log = function () {

                                    var x = {
                                        timestamp: new Date(),
                                        message: Array.from(arguments)
                                    }

                                    //console.logs.push(Array.from(arguments));
                                    console.logs.push(x); // 4-12-2023.
                                    console.stdlog.apply(console, arguments);
                                }

                                //alert('THE USER IS AUTHENTICATED >> "' + thiz.options.participantFriendlyName + '" - ' + thiz.options.participantEmail + ' (ip: ' + thiz.options.activeStateIPAddress + '), single-factor authentication. workflowAppId: ' + thiz.options.workflowAppId);
                                //var openrequest;
                                //try {

                                //    var tmpRequest1 = thiz.getUrlParams()['openrequest'];
                                //    if (tmpRequest1) {
                                //        openrequest = tmpRequest1.toString().split('#')[0];
                                //        console.log('xcx12342344 Called bwAuthentication.js.getUrlParams() and got this value for openrequest: ' + openrequest);
                                //    }

                                //} catch (e) {
                                //    console.log('xcx5679 Caught Exception in my3.js.page_Load() getting urlparam openrequest: ' + e.message + ', ' + e.stack);
                                //    //alert('Caught Exception in my3.js.page_Load() getting urlparam openrequest: ' + e.message + ', ' + e.stack);
                                //}

                                var openrequest = thiz.getUrlParams('openrequest');
                                var request1 = thiz.getUrlParams('request');

                                if (openrequest && request1) {

                                    alert('xcx23124 THIS MUST BE A LINK FROM AN EMAIL.... TRYING TO OPEN A SINGLE REQUEST IN ITS OWN WINDOW.');

                                    console.log('');
                                    console.log('/////////////////////////////////////');
                                    console.log('In bwAuthentication.js.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow(). xcx23124 THIS MUST BE A LINK FROM AN EMAIL.... TRYING TO OPEN A SINGLE REQUEST IN ITS OWN WINDOW. openrequest: ' + openrequest + ', request1: ' + request1);
                                    console.log('/////////////////////////////////////');
                                    console.log('');

                                } else {
                                    console.log('In bwAuthentication.js.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow(). openrequest: ' + openrequest + ', request: ' + request1);
                                }

                                //participantId = data.d.results[0].bwParticipantId;
                                //participantLogonType = 'custom';
                                //participantLogonTypeUserId = data.d.results[0].bwParticipantId;
                                //participantFriendlyName = data.d.results[0].bwParticipantFriendlyName;
                                //participantEmail = data.d.results[0].bwParticipantEmail;
                                //if (data.d.results[0].bwLastSelectedTenantId) {
                                //    tenantId = data.d.results[0].bwLastSelectedTenantId;
                                //} else {
                                //    if (data.d.results[0].bwTenantId) {
                                //        tenantId = data.d.results[0].bwTenantId;
                                //    } else {
                                //        displayAlertDialog('ERROR: TRACK THIS xcx12392142: ' + data.d.results[0].bwTenantId);
                                //    }
                                //}
                                //workflowAppId = data.d.results[0].bwLastSelectedWorkflowAppId;
                                //
                                // Replacing globals and storing in bwAuthentication 11-29-2021
                                //



                                // 9-9-2021
                                thiz.options.bwLastSelectedExecutiveSummariesExpandedOrCollapsed = data.d.results[0].bwLastSelectedExecutiveSummariesExpandedOrCollapsed;
                                //alert('bwLastSelectedExecutiveSummariesExpandedOrCollapsed: ' + data.d.results[0].bwLastSelectedExecutiveSummariesExpandedOrCollapsed);


                                //debugger;
                                //for (var i = 0; i < data.d.results.length; i++) {
                                //    if (data.d.results[i].bwLastSelectedWorkflowAppId == workflowAppId) {
                                //        workflowAppTitle = data.d.results[i].bwWorkflowAppTitle; //bwLastSelectedWorkflowAppId;
                                //    }
                                //}

                                //try { // This try-catch is for the admin, where we don't need to reload the bwRequest widget... we don't even use it in th eadmin. 
                                //    //debugger;
                                //    //// Now we have to reload bwRequest so it goes to the database and gets the active forms. 
                                //    console.log('In bwAuthentication.js.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow(). Calling bwRequest.reload() so it goes to the database and gets the active forms. xcx654-1.');

                                //    alert('xcx1111123');

                                //    //$('.bwRequest').bwRequest('reload');
                                //} catch (e) { }


                                //debugger; // This is where it happens 6-11-2020
                                //thiz.loadRemainingJsAndCssAndBWMData();
                                thiz.getRemainingParticipantDetailsAndWorkflowAppTitle();

                                //alert('xcx1111123');

                                //
                                // Log the login/authenticated ip activity.
                                //
                                var tenantId = $('.bwAuthentication').bwAuthentication('option', 'tenantId');
                                var workflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
                                var workflowAppTitle = $('.bwAuthentication').bwAuthentication('option', 'workflowAppTitle');
                                var participantId = $('.bwAuthentication').bwAuthentication('option', 'participantId');
                                var participantEmail = $('.bwAuthentication').bwAuthentication('option', 'participantEmail');
                                var participantFriendlyName = $('.bwAuthentication').bwAuthentication('option', 'participantFriendlyName');
                                data = {
                                    bwTenantId: tenantId,
                                    bwWorkflowAppId: workflowAppId,
                                    //bwWebsiteTrafficLogUserLogonType: participantLogonType,
                                    //bwWebsiteTrafficLogUserLogonTypeId: participantLogonTypeUserId,
                                    bwParticipantId: participantId,
                                    bwParticipantFriendlyName: participantFriendlyName,
                                    bwParticipantEmail: participantEmail
                                };

                                var operationUri = webserviceurl + "/logonactivityvisitorcounter";
                                $.ajax({
                                    url: operationUri,
                                    type: "POST",
                                    data: data,
                                    headers: {
                                        "Accept": "application/json; odata=verbose"
                                    },
                                    success: function (data) {

                                        console.log('');
                                        console.log('Success calling logonactivityvisitorcounter.');
                                        console.log('');

                                    },
                                    error: function (data, errorCode, errorMessage) {

                                        console.log('');
                                        console.log('Error calling logonactivityvisitorcounter: ' + errorCode + ', ' + errorMessage);
                                        console.log('');

                                    }
                                });

                            } else {





                                // In bwActiveMenu.js.renderHomePageContent(). Ping the server to make sure it is running. If not, put a message on the screen.
                                //try {
                                if ($('.bwActiveMenu') && $('.bwActiveMenu').length) {
                                    $('.bwActiveMenu').bwActiveMenu('renderHomePageContent');
                                }
                                //} catch (e) {
                                //    console.log("Exception in bwAuthentication.js.xx(). xcx2314137 Called $('.bwActiveMenu').bwActiveMenu('renderHomePageContent'): " + e.message + ", " + e.stack);
                                //}





                                console.log('Your session has expired. Please Sign In again. In bwAuthentication.js.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow(). data: ' + JSON.stringify(data));
                                //alert('Your session has expired. Please Sign In again. ' + JSON.stringify(data));

                                // 11-9-2022 Changed to show the circle dialog here.... this is the beginning of the code which shows the circle dialog when we get an authorized from a web service call....
                                console.log('11-9-2022 Changed to show the circle dialog here.... this is the beginning of the code which shows the circle dialog when we get an authorized from a web service call....');
                                thiz.displaySignInDialog(true);


                                //debugger;
                                //var location;
                                ////if (window.location.href.indexOf('my.html') > -1) {
                                ////location = globalUrlPrefix + globalUrl + '/my.html?logontype=custom';
                                //if (window.location.href.indexOf('ios8.html') > -1) {
                                //    //location = globalUrlPrefix + globalUrl + '/ios8.html?logontype=custom';
                                //} else {
                                //    //displayAlertDialog('Error xcx2: Unexpected window.location. This process cannot proceed.');
                                //    //location = globalUrlPrefix + globalUrl + '?logontype=custom';
                                //    document.getElementById('spanHomePageStatusText').innerHTML = 'You session has expired. Please Sign In again.';
                                //}
                                //console.log('xcx2Setting window.location: ' + location);
                                ////debugger;
                                //window.location = location;
                                //var html = '';
                                //html += '<span>';
                                //html += 'This is not a valid session.';
                                //html += '</span>';
                                //html += '<br />';

                                //$('#spanCustomLogonDialogInvitationDescriptionText').html(html);

                                //// First we have to show the logon dialog box.
                                //$("#divCustomLogonDialog").dialog({
                                //    modal: true,
                                //    resizable: false,
                                //    //closeText: "Cancel",
                                //    closeOnEscape: false, // Hit the ESC key to hide! Yeah!
                                //    title: 'Sign In',
                                //    width: "760px",
                                //    dialogClass: "no-close", // No close button in the upper right corner.
                                //    hide: false//, // This means when hiding just disappear with no effects.
                                //    //buttons: {
                                //    //    "Close": function () {
                                //    //        $(this).dialog("close");
                                //    //    }
                                //    //}
                                //});

                                //$("#divCustomLogonDialog").dialog().parents(".ui-dialog").find(".ui-dialog-titlebar").remove();
                            }

                        } catch (e) {
                            var msg = 'Exception in bwAuthentication.js.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow(): xcx22327 ' + e.message + ', ' + e.stack;
                            console.log(msg);
                            displayAlertDialog(msg);
                        }

                    },
                    error: function (data, errorCode, errorMessage) {
                        //handleExceptionWithAlert('Error in Start.js.displayConnectedWorkflows()', '1:' + errorCode + ', ' + errorMessage);
                        console.log('Error in my.js.initializeTheLogon():1: thiz.options.operationUriPrefix: ' + thiz.options.operationUriPrefix + ', ' + errorCode + ', ' + errorMessage + ' data:' + JSON.stringify(data));
                        displayAlertDialog('Error in my.js.initializeTheLogon():1: thiz.options.operationUriPrefix: ' + thiz.options.operationUriPrefix + ', ' + errorCode + ', ' + errorMessage + ' data:' + JSON.stringify(data));
                    }
                });

            } else if (forestAdministratorLoginToTenant_ActiveStateIdentifier) { // This means we are logged in already. 

                console.log('GETTING ready to authenticate using forestAdministratorLoginToTenant_ActiveStateIdentifier.');

                var json = {
                    bwActiveStateIdentifier: forestAdministratorLoginToTenant_ActiveStateIdentifier
                };

                var operationUri = this.options.operationUriPrefix + "_bw/ForestAdministratorLoginToTenant2";
                $.ajax({
                    url: operationUri,
                    type: "POST",
                    data: json,
                    headers: {
                        "Accept": "application/json; odata=verbose"
                    },
                    success: function (result) {

                        //if (result.message != 'SUCCESS') {
                        //    displayAlertDialog('ERROR: FAILED TO AUTHENTICATE: ' + result.message);
                        //} else {
                        //    var bwActiveStateIdentifier = result.bwActiveStateIdentifier;
                        //    window.open('https://budgetworkflow.com?ForestAdministratorLoginToTenant_ActiveStateIdentifier=' + bwActiveStateIdentifier + '');
                        //    //window.open('https://budgetworkflow.com?ActiveStateIdentifier=' + bwActiveStateIdentifier + ''); // 9-8-2021
                        //    //location.href = 'https://budgetworkflow.com/my.html?ForestAdministratorLoginToTenant_ActiveStateIdentifier=' + bwActiveStateIdentifier;
                        //}


                        if (result.message != 'SUCCESS') {

                            displayAlertDialog('ERROR: FAILED TO AUTHENTICATE: ' + result.message);

                        } else {

                            console.log('');
                            console.log('THE USER IS AUTHENTICATED - FOREST ADMIN USING ForestAdministratorLoginToTenant_ActiveStateIdentifier');
                            console.log('');

                            thiz.options.participantLogonType = result.participantLogonType; //'custom';
                            thiz.options.participantId = result.participantId;
                            thiz.options.participantLogonTypeUserId = result.participantId;
                            thiz.options.participantFriendlyName = result.participantFriendlyName;
                            thiz.options.participantEmail = result.participantEmail;

                            thiz.options.tenantId = result.bwTenantId;
                            thiz.options.workflowAppId = result.bwWorkflowAppId;

                            try { // This try-catch is for the admin, where we don't need to reload the bwRequest widget... we don't even use it in th eadmin. 
                                // Now we have to reload bwRequest so it goes to the database and gets the active forms. 
                                console.log('In bwAuthentication.js.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow(). Calling bwRequest.reload() so it goes to the database and gets the active forms. xcx654-2.');
                                $('.bwRequest').bwRequest('reload');
                            } catch (e) { }

                            thiz.getRemainingParticipantDetailsAndWorkflowAppTitle();

                        }
                    },
                    error: function (data, errorCode, errorMessage) {

                        displayAlertDialog('Error in logInAsTenantOrganizationOwner(): ' + errorMessage);
                    }
                });

            } else {

                //var bwInvitationId = this.getUrlParams('invitation');
                //var activeStateIdentifier = this.getUrlParams('ActiveStateIdentifier');
                //var forestAdministratorLoginToTenant_ActiveStateIdentifier = this.getUrlParams('ForestAdministratorLoginToTenant_ActiveStateIdentifier');

                console.log('Error in bwAuthentication.js.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow(). Expected a value for 1 of the following. bwInvitationId: ' + bwInvitationId + ', activeStateIdentifier: ' + activeStateIdentifier + ', forestAdministratorLoginToTenant_ActiveStateIdentifier: ' + forestAdministratorLoginToTenant_ActiveStateIdentifier);
                displayAlertDialog('Error in bwAuthentication.js.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow(). Expected a value for 1 of the following. bwInvitationId: ' + bwInvitationId + ', activeStateIdentifier: ' + activeStateIdentifier + ', forestAdministratorLoginToTenant_ActiveStateIdentifier: ' + forestAdministratorLoginToTenant_ActiveStateIdentifier);

            }

        } catch (e) {
            console.log('Exception in bwAuthentication.js.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('There was a problem logging you in. Please try again. Exception in bwAuthentication.js.getParticipantDetailsAndAcceptInvitation_BudgetWorkflow(): ' + e.message + ', ' + e.stack);
            //window.location.href = globalUrlPrefix + globalUrl;
        }
    },
    newUserProvisioning_Custom: function () {
        try {
            console.log('In newUserProvisioning_Custom().');
            var thiz = this;

            // This is where the user creates their new logon!
            // Note: We are using cryptographic salted password hashing in order to prevent storing the passwords.

            var newUserFriendlyName = document.getElementById('txtCustomSignUpFriendlyName').value;
            var newUserEmailAddress = document.getElementById('txtCustomSignUpEmail').value;
            var newUserPassword = document.getElementById('txtCustomSignUpPassword').value;
            if (newUserFriendlyName.trim() == '') {
                this.displayAlertDialog('Please enter a Name before continuing the registration process.');
                document.getElementById('txtCustomSignUpFriendlyName').focus();
            } else if (newUserEmailAddress.trim() == '') {
                this.displayAlertDialog('Please enter an Email Address before continuing the registration process.');
                document.getElementById('txtCustomSignUpEmail').focus();
            } else if (newUserPassword.trim() == '') {
                this.displayAlertDialog('Please enter an Password before continuing the registration process.');
            } else if (newUserPassword.trim().length < 4 || newUserPassword.trim().length > 15) {
                this.displayAlertDialog('Please enter an Password that is 4-15 characters in length.');
                document.getElementById('txtCustomSignUpPassword').focus();
            } else {

                // This is where we call the registration web service.
                var bwInvitationId = this.getUrlParams('invitation');
                if (bwInvitationId) {

                    data = {
                        newUserFriendlyName: newUserFriendlyName,
                        newUserEmailAddress: newUserEmailAddress,
                        newUserPassword: newUserPassword,
                        appweburl: appweburl,
                        bwInvitationId: bwInvitationId
                    };
                    var operationUri = webserviceurl + "/registeranewuseroranewuserwithaninvitation"; // 12-13-2021 bwworkflow/registerandinviteanewusercustom";

                    //debugger; // This is where it works, but not for a completely new user, as it does not add the new user to the invited bwWorkflowApp <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

                    $.ajax({
                        url: operationUri,
                        type: "POST",
                        data: data,
                        headers: {
                            "Accept": "application/json; odata=verbose"
                        },
                        success: function (data) {
                            try {

                                if (data.message == 'This email address is already in use') {

                                    displayAlertDialog('This email address is already registered with us. Please enter a different one, or login using the existing credentials.xcx1-4');
                                    //document.getElementById('txtCustomLogonEmail').focus();

                                } else if (data.message == 'SUCCESS') {

                                    localStorage['customlogonusername'] = newUserEmailAddress;
                                    localStorage['customlogonpassword'] = newUserPassword;

                                    console.log('Your login was created successfully. You will receive an introductory email in the next few minutes. Click the "Sign In" button to begin using your budget request system.');

                                    thiz.displaySignInDialog(true, 'Your login was created successfully. You will receive an introductory email in the next few minutes. Click the "Sign In" button to begin using your budget request system.<br />', true);

                                } else {

                                    displayAlertDialog(data.message);

                                }

                            } catch (e) {
                                conole.log('Exception in bwAuthentication.newUserProvisioning_Custom(): ' + e.message + ', ' + e.stack);
                                displayAlertDialog('Exception in bwAuthentication.newUserProvisioning_Custom(): ' + e.message + ', ' + e.stack);
                            }
                        },
                        error: function (data, errorCode, errorMessage) {
                            console.log('Error in newUserProvisioning_Custom().registeranewuser:1:xcx3: ' + errorMessage);
                            displayAlertDialog('Error in newUserProvisioning_Custom().registeranewuser:1:xcx3: ' + errorMessage);
                        }
                    });

                } else {

                    var data = {
                        bwParticipantLogonType: 'custom',
                        newUserFriendlyName: newUserFriendlyName,
                        newUserEmailAddress: newUserEmailAddress,
                        newUserPassword: newUserPassword,
                        appweburl: appweburl
                    };
                    var operationUri = webserviceurl + "/registeranewuseroranewuserwithaninvitation";
                    $.ajax({
                        url: operationUri,
                        type: "POST",
                        data: data,
                        headers: {
                            "Accept": "application/json; odata=verbose"
                        },
                        success: function (data) {
                            try {

                                if (data.message == 'This email address is already in use') {

                                    displayAlertDialog('This email address is already registered with us. Please enter a different one, or login using the existing credentials.xcx2');

                                } else if (data.message == 'SUCCESS') {

                                    localStorage['customlogonusername'] = newUserEmailAddress;
                                    localStorage['customlogonpassword'] = newUserPassword;

                                    $('.bwAuthentication').bwAuthentication('displaySignInDialog', true, 'Your login was created successfully. You will receive an introductory email in the next few minutes. Click the "Sign In" button to begin using your budget request system.<br />', true);

                                } else {

                                    displayAlertDialog(data.message);

                                }
                            } catch (e) {
                                console.log('Exception in bwAuthentication.newUserProvisioning_Custom()2: ' + e.message + ', ' + e.stack);
                                displayAlertDialog('Exception in bwAuthentication.newUserProvisioning_Custom()2: ' + e.message + ', ' + e.stack);
                            }
                        },
                        error: function (data, errorCode, errorMessage) {
                            console.log('Error in newUserProvisioning_Custom().registeranewuser:2: ' + errorMessage);
                            displayAlertDialog('Error in newUserProvisioning_Custom().registeranewuser:2: ' + errorMessage);
                        }
                    });
                }

            }
        } catch (e) {
            console.log('Exception in newUserProvisioning_Custom(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in newUserProvisioning_Custom(): ' + e.message + ', ' + e.stack);
        }
    },
    //newUserProvisioning_Microsoft: function (data) {
    //    try {
    //        //debugger;
    //        console.log('In newUserProvisioning_Microsoft().');
    //        // This is where the user creates their new logon!
    //        // Note: We are using cryptographic salted password hashing in order to prevent storing the passwords.
    //        //this.displayAlertDialog('In newUserProvisioning_Microsoft(). This functionality is incomplete. Coming soon! YOU ARE LOGGING IN FOR THE FIRST TIME. WOULD you like to create your own request system?');
    //        var thiz = this;
    //        var userData = JSON.parse(data);
    //        //debugger;
    //        var newUserFriendlyName = userData.participantFriendlyName;
    //        var newUserEmailAddress = userData.participantEmail;
    //        var bwParticipantLogonType = 'microsoft'; //userData.logonProvider; // eg: 'microsoft'
    //        var appweburl = userData.appweburl;

    //        //data = {
    //        //    logonProvider: participantLogonType,
    //        //    logonId: participantLogonTypeUserId,
    //        //    participantFriendlyName: participantFriendlyName,
    //        //    participantEmail: participantEmail,
    //        //    appweburl: appweburl
    //        //};


    //        //var newUserFriendlyName = document.getElementById('txtCustomSignUpFriendlyName').value;
    //        //var newUserEmailAddress = document.getElementById('txtCustomSignUpEmail').value;
    //        //var newUserPassword = document.getElementById('txtCustomSignUpPassword').value;
    //        //if (newUserFriendlyName.trim() == '') {
    //        //    this.displayAlertDialog('Please enter a Name before continuing the registration process.');
    //        //    document.getElementById('txtCustomSignUpFriendlyName').focus();
    //        //} else if (newUserEmailAddress.trim() == '') {
    //        //    this.displayAlertDialog('Please enter an Email Address before continuing the registration process.');
    //        //    document.getElementById('txtCustomSignUpEmail').focus();
    //        //} else if (newUserPassword.trim() == '') {
    //        //    this.displayAlertDialog('Please enter an Password before continuing the registration process.');
    //        //} else if (newUserPassword.trim().length < 4 || newUserPassword.trim().length > 15) {
    //        //    this.displayAlertDialog('Please enter an Password that is 4-15 characters in length.');
    //        //    document.getElementById('txtCustomSignUpPassword').focus();
    //        //} else {
    //        //displayAlertDialog('Looks good. Proceeding to the next step of the registration process...');
    //        // This is where we call the registration web service.

    //        var bwInvitationId;
    //        try {
    //            debugger;
    //            bwInvitationId = this.getUrlParams()['invitation'].toString().split('#')[0];
    //        } catch (e) {
    //            //bwInvitationId = '';
    //        }
    //        //debugger;
    //        if (bwInvitationId) {

    //            var data = [];
    //            data = {
    //                newUserFriendlyName: newUserFriendlyName,
    //                newUserEmailAddress: newUserEmailAddress,
    //                //newUserPassword: newUserPassword,
    //                bwParticipantLogonType: bwParticipantLogonType,
    //                appweburl: appweburl,
    //                bwInvitationId: bwInvitationId
    //            };
    //            var operationUri = webserviceurl + "/bwworkflow/registerandinviteanewusermicrosoft";

    //            //debugger; // This is where it works, but not for a completely new user, as it does not ass the new user to the invited bwWorkflowApp <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

    //            $.ajax({
    //                url: operationUri,
    //                type: "POST",
    //                timeout: this.options.ajaxTimeout,
    //                data: data,
    //                headers: {
    //                    "Accept": "application/json; odata=verbose"
    //                },
    //                success: function (data) {
    //                    try {
    //                        //debugger;
    //                        if (data.message == 'This email address is already in use') {
    //                            displayAlertDialog('This email address is already registered with us. Please enter a different one, or login using the existing credentials.xcx3');
    //                            //document.getElementById('txtCustomLogonEmail').focus();
    //                        } else if (data.message == 'SUCCESS') {
    //                            //debugger;
    //                            // Cookie!
    //                            //thiz.setCookie('customlogonusername', newUserEmailAddress, 30);
    //                            //thiz.setCookie('customlogonpassword', newUserPassword, 30);

    //                            //participantId = data.participant.bwParticipantId;
    //                            //participantFriendlyName = data.participant.bwParticipantFriendlyName;
    //                            //participantEmail = data.participant.bwParticipantEmail;
    //                            //tenantId = data.participant.bwTenantId;
    //                            //workflowAppId = data.participant.bwLastSelectedWorkflowAppId;
    //                            //workflowAppTitle = data.participant.bwWorkflowAppTitle;
    //                            //participantLogonType = 'custom';
    //                            //participantLogonTypeUserId = participantId;

    //                            //emailNotificationFrequency = data.participant.bwEmailNotificationFrequency;
    //                            //emailNotificationTypes = data.participant.bwEmailNotificationTypes;

    //                            //if (data.participant.bwTipsDisplayOn == 'true') tipsDisplayOn = true;
    //                            //else tipsDisplayOn = false;

    //                            //if (data.participant.bwInvitationsOnHomePageDisplayOn == 'true') displayInvitationsOnHomePageDisplayOn = true;
    //                            //else displayInvitationsOnHomePageDisplayOn = false;



    //                            $('.bwCircleDialog').bwCircleDialog('displaySignInDialog', true, 'Your login was created successfully. You will receive an introductory email in the next few minutes. Click the "Sign In" button to begin using your budget request system.<br />', true);




    //                            //debugger; 
    //                            //$('#divCustomLogonDialog').dialog('close'); // Close the sign in dialog.
    //                            //$('#divCustomSignUpDialog').dialog('close'); // Close the create your account dialog.
    //                            //initializeTheForm();

    //                            //displayCustomLogonDialog();

    //                        } else {
    //                            displayAlertDialog('Error xcx9232: ' + data.message);
    //                        }
    //                    } catch (e) {
    //                        //debugger;
    //                        conole.log('Exception in bwAuthentication.newUserProvisioning_Microsoft(): ' + e.message + ', ' + e.stack);
    //                        displayAlertDialog('Exception in bwAuthentication.newUserProvisioning_Microsoft(): ' + e.message + ', ' + e.stack);
    //                    }
    //                },
    //                error: function (data, errorCode, errorMessage) {
    //                    //debugger;
    //                    //handleExceptionWithAlert('Error in Start.js.displayConnectedWorkflows()', '1:' + errorCode + ', ' + errorMessage);
    //                    displayAlertDialog('Error in newUserProvisioning_Microsoft().registeranewuser:1: ' + errorMessage);
    //                }
    //            });


    //        } else {
    //            //debugger;
    //            var data = [];
    //            data = {
    //                newUserFriendlyName: newUserFriendlyName,
    //                newUserEmailAddress: newUserEmailAddress,
    //                //newUserPassword: null, //newUserPassword,
    //                bwParticipantLogonType: bwParticipantLogonType,
    //                appweburl: appweburl
    //                //bwInvitationId: bwInvitationId
    //            };
    //            var operationUri = webserviceurl + "/registeranewuseroranewuserwithaninvitation"; // 12-11-2021 bwworkflow/registeranewuser"; // bwworkflow/registeranewuser xcx2

    //            //debugger; // This is where it works, but not for a completely new user, as it does not ass the new user to the invited bwWorkflowApp <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

    //            $.ajax({
    //                url: operationUri,
    //                type: "POST",
    //                timeout: ajaxTimeout,
    //                data: data,
    //                headers: {
    //                    "Accept": "application/json; odata=verbose"
    //                },
    //                success: function (data) {
    //                    try {
    //                        //debugger;
    //                        if (data.message == 'This email address is already in use') {
    //                            displayAlertDialog('This email address is already registered with us. Please enter a different one, or login using the existing credentials.xcx4');
    //                            //document.getElementById('txtCustomLogonEmail').focus();
    //                        } else if (data.message == 'SUCCESS') {
    //                            //debugger;
    //                            // Cookie!
    //                            //thiz.setCookie('customlogonusername', newUserEmailAddress, 30);
    //                            //thiz.setCookie('customlogonpassword', newUserPassword, 30);

    //                            //participantId = data.participant.bwParticipantId;
    //                            //participantFriendlyName = data.participant.bwParticipantFriendlyName;
    //                            //participantEmail = data.participant.bwParticipantEmail;
    //                            //tenantId = data.participant.bwTenantId;
    //                            //workflowAppId = data.participant.bwLastSelectedWorkflowAppId;
    //                            //workflowAppTitle = data.participant.bwWorkflowAppTitle;
    //                            //participantLogonType = 'custom';
    //                            //participantLogonTypeUserId = participantId;

    //                            //emailNotificationFrequency = data.participant.bwEmailNotificationFrequency;
    //                            //emailNotificationTypes = data.participant.bwEmailNotificationTypes;

    //                            //if (data.participant.bwTipsDisplayOn == 'true') tipsDisplayOn = true;
    //                            //else tipsDisplayOn = false;

    //                            //if (data.participant.bwInvitationsOnHomePageDisplayOn == 'true') displayInvitationsOnHomePageDisplayOn = true;
    //                            //else displayInvitationsOnHomePageDisplayOn = false;



    //                            //$('.bwCircleDialog').bwCircleDialog('displaySignInDialog', true);
    //                            //$('.bwCircleDialog').bwCircleDialog('displaySignInDialog', true, 'Your login was created successfully. You will receive an introductory email in the next few minutes. Click the "Sign In" button to begin using your budget request system.<br />', true);
    //                            displayAlertDialog('Your login was created successfully. Enjoy using this Budget Request system at BudgetWorkflow.com. You will receive an introductory email in the next few minutes.');

    //                            thiz.loadRemainingJsAndCssAndBWMData();


    //                            //debugger; 
    //                            //$('#divCustomLogonDialog').dialog('close'); // Close the sign in dialog.
    //                            //$('#divCustomSignUpDialog').dialog('close'); // Close the create your account dialog.
    //                            //initializeTheForm();

    //                            //displayCustomLogonDialog();

    //                        } else {
    //                            //debugger;
    //                            displayAlertDialog(data.message);
    //                        }
    //                    } catch (e) {
    //                        //debugger;
    //                        conole.log('Exception in bwAuthentication.newUserProvisioning_Microsoft()2: ' + e.message + ', ' + e.stack);
    //                        displayAlertDialog('Exception in bwAuthentication.newUserProvisioning_Microsoft()2: ' + e.message + ', ' + e.stack);
    //                    }
    //                },
    //                error: function (data, errorCode, errorMessage) {
    //                    //debugger;
    //                    //handleExceptionWithAlert('Error in Start.js.displayConnectedWorkflows()', '1:' + errorCode + ', ' + errorMessage);
    //                    displayAlertDialog('Error in newUserProvisioning_Microsoft().registeranewuser:2: ' + errorMessage);
    //                }
    //            });
    //        }

    //        //}
    //    } catch (e) {
    //        //debugger;
    //        console.log('Exception in newUserProvisioning_Microsoft(): ' + e.message + ', ' + e.stack);
    //    }
    //},
    cmdSaveUserOptions: function () {
        try {
            console.log('In bwAuthentication.cmdSaveUserOptions().');
            // This is the Save button on the user options page from the use options in the logged in drop down. It lets you change and save the user friendly name, email address.

            var participantId = this.options.participantId; //$('.bwAuthentication').bwAuthentication('option', 'participantId'); // The user is changing their own details here.
            var participantEmail = this.options.participantEmail; //$('.bwAuthentication').bwAuthentication('option', 'participantEmail');
            var participantFriendlyName = this.options.participantFriendlyName; //$('.bwAuthentication').bwAuthentication('option', 'participantFriendlyName');

            var bwParticipantFriendlyName = $('#txtUserOptionsFriendlyName').val();
            //var bwParticipantEmail = $('#txtUserOptionsEmail').val(); // 9-8-2022 We aren't allowing email address changes at this time. If they want to do this, they will get in touch and will have to be vetted. A forest administrator task.

            if (!bwParticipantFriendlyName) {

                var msg = 'Error: Unexpected value for bwParticipantFriendlyName: ' + bwParticipantFriendlyName;
                console.log(msg);
                displayAlertDialog(msg);

            } else {

                var _userDetails = {
                    bwParticipantId: participantId,
                    bwParticipantFriendlyName: bwParticipantFriendlyName, // This is the change.
                    bwParticipantEmail: participantEmail,
                    modifiedById: participantId,
                    modifiedByFriendlyName: participantFriendlyName,
                    modifiedByEmail: participantEmail
                };
                var operationUri = webserviceurl + "/bwparticipant/updateuserdetails";
                $.ajax({
                    url: operationUri,
                    type: "POST",
                    data: _userDetails,
                    headers: {
                        "Accept": "application/json; odata=verbose"
                    },
                    success: function (data) {
                        try {

                            console.log('In bwAuthentication.cmdSaveUserOptions():2.');
                            //$("#AccountDetailsDialog").dialog('close');
                            $('.bwCircleDialog').bwCircleDialog('hideAndDestroyCircleDialog');

                            displayAlertDialog(data.message);
                            renderWelcomeScreen(); // This redraws the screen so that the menu button reflects the new user name, if it has been changed. Not sure this is the best approach but will do for now, the user won't be doing this very often.... 2-3-2022

                        } catch (e) {
                            console.log('Exception in bwAuthentication.cmdSaveUserOptions():2: ' + e.message + ', ' + e.stack);
                            displayAlertDialog('Exception in bwAuthentication.cmdSaveUserOptions():2: ' + e.message + ', ' + e.stack);
                        }
                    },
                    error: function (data, errorCode, errorMessage) {
                        displayAlertDialog('Error in bwAuthentication.cmdSaveUserOptions(): ' + errorCode + ' ' + errorMessage);
                    }
                });
            }

        } catch (e) {
            console.log('Exception in bwAuthentication.cmdSaveUserOptions(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.cmdSaveUserOptions(): ' + e.message + ', ' + e.stack);
        }
    },
    cmdSaveUserOptions_ADMIN: function (bwParticipantId) {
        try {
            console.log('In bwAuthentication.js.cmdSaveUserOptions_ADMIN().');
            // This is the Save button on the ADMIN page. It lets the FOREST ADMIN change and save the user friendly name, email address.

            var participantId = this.options.participantId; //$('.bwAuthentication').bwAuthentication('option', 'participantId'); // The ADMIN is changing the user details here.
            var participantEmail = this.options.participantEmail; //$('.bwAuthentication').bwAuthentication('option', 'participantEmail');
            var participantFriendlyName = this.options.participantFriendlyName; //$('.bwAuthentication').bwAuthentication('option', 'participantFriendlyName');

            var bwParticipantFriendlyName = $('#txtUserOptionsFriendlyName').val();
            var bwParticipantEmail = $('#txtUserOptionsEmail').val();

            if (!(bwParticipantFriendlyName && bwParticipantEmail)) {

                var msg = 'Error: Unexpected value(s) for bwParticipantFriendlyName: ' + bwParticipantFriendlyName + ', bwParticipantEmail: ' + bwParticipantEmail;
                console.log(msg);
                displayAlertDialog(msg);

            } else {
                var _userDetails = {
                    bwParticipantId: bwParticipantId,
                    bwParticipantFriendlyName: bwParticipantFriendlyName,
                    bwParticipantEmail: bwParticipantEmail,
                    modifiedById: participantId,
                    modifiedByFriendlyName: participantFriendlyName,
                    modifiedByEmail: participantEmail
                };
                var operationUri = webserviceurl + "/bwparticipant/updateuserdetails";
                $.ajax({
                    url: operationUri,
                    type: "POST", timeout: ajaxTimeout,
                    data: _userDetails,
                    headers: {
                        "Accept": "application/json; odata=verbose"
                    },
                    success: function (data) {
                        try {
                            console.log('In bwAuthentication.cmdSaveUserOptions_ADMIN():2.');
                            //$("#AccountDetailsDialog").dialog('close');
                            $('.bwCircleDialog').bwCircleDialog('hideAndDestroyCircleDialog');

                            displayAlertDialog(data.message);
                            //renderWelcomeScreen();
                        } catch (e) {
                            console.log('Exception in bwAuthentication.cmdSaveUserOptions_ADMIN():2: ' + e.message + ', ' + e.stack);
                            displayAlertDialog('Exception in bwAuthentication.cmdSaveUserOptions_ADMIN():2: ' + e.message + ', ' + e.stack);
                        }
                    },
                    error: function (data, errorCode, errorMessage) {
                        console.log('Error in bwAuthentication.cmdSaveUserOptions_ADMIN(): ' + errorCode + ' ' + errorMessage);
                        displayAlertDialog('Error in bwAuthentication.cmdSaveUserOptions_ADMIN(): ' + errorCode + ' ' + errorMessage);
                    }
                });
            }

        } catch (e) {
            console.log('Exception in bwAuthentication.cmdSaveUserOptions_ADMIN(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.cmdSaveUserOptions_ADMIN(): ' + e.message + ', ' + e.stack);
        }
    },

    getRemainingParticipantDetailsAndWorkflowAppTitle: function () {
        try {
            console.log('In bwAuthentication.js.getRemainingParticipantDetailsAndWorkflowAppTitle().');
            //alert('In bwAuthentication.js.getRemainingParticipantDetailsAndWorkflowAppTitle().');
            var thiz = this;

            var workflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
            var participantId = $('.bwAuthentication').bwAuthentication('option', 'participantId');
            var participantEmail = $('.bwAuthentication').bwAuthentication('option', 'participantEmail');
            var participantLogonType = $('.bwAuthentication').bwAuthentication('option', 'participantLogonType');

            //if (!(thiz.options.tenantId && thiz.options.workflowAppId && thiz.options.participantId && thiz.options.participantFriendlyName && thiz.options.participantEmail && thiz.options.participantLogonType && thiz.options.participantLogonTypeUserId && invitationAlreadyAccepted == false)) {
            if (!(thiz.options.tenantId && thiz.options.workflowAppId && thiz.options.participantId && thiz.options.participantFriendlyName && thiz.options.participantEmail && thiz.options.participantLogonTypeUserId && invitationAlreadyAccepted == false)) {

                this.displayAlertDialog('Error in bwAuthentication.getRemainingParticipantDetailsAndWorkflowAppTitle(). Undefined value: tenantId: ' + thiz.options.tenantId + ',  workflowAppId: ' + thiz.options.workflowAppId + ', participantId: ' + thiz.options.participantId + ', participantFriendlyName: ' + thiz.options.participantFriendlyName + ', participantEmail: ' + thiz.options.participantEmail + ', participantLogonType: ' + thiz.options.participantLogonType + ', participantLogonTypeUserId: ' + thiz.options.participantLogonTypeUserId + ', invitationAlreadyAccepted: ' + invitationAlreadyAccepted);

            } else {

                var activeStateIdentifier = $('.bwAuthentication:first').bwAuthentication('getActiveStateIdentifier');
                //alert('>>>>>>>>>>>>>>>>>xcx123142134323 calling /getparticipantdetails(). activeStateIdentifier: ' + JSON.stringify(activeStateIdentifier));
                var data = {
                    bwParticipantId_LoggedIn: participantId,
                    bwActiveStateIdentifier: activeStateIdentifier,
                    bwWorkflowAppId_LoggedIn: workflowAppId,

                    participantLogonType: participantLogonType, //'custom',
                    //participantFriendlyName: participantFriendlyName,
                    participantEmail: participantEmail,
                    participantId: participantId, // changed 9-4-2020 3-19pm adt
                    appweburl: appweburl
                };
                var operationUri = webserviceurl + "/getparticipantdetails";
                $.ajax({
                    url: operationUri,
                    type: 'POST',
                    data: data,
                    headers: {
                        "Accept": "application/json; odata=verbose"
                    },
                    success: function (results) { //userData) {
                        try {

                            if (results.status != 'SUCCESS') {

                                displayAlertDialog('Error: ' + results.status + ', ' + results.message + ', ' + JSON.stringify(results));

                            } else {
                                //debugger;

                                var userData = results.data;

                                if (!userData.participant || userData.result == 'USER_DOES_NOT_EXIST') { // xcx122134-5

                                    //                //$('.bwAuthentication').bwAuthentication('newUserProvisioning_Microsoft', '' + JSON.stringify(data) + '');
                                    displayAlertDialog('In bwAuthentication.getRemainingParticipantDetailsAndWorkflowAppTitle.POST.getparticipantdetails(): userData.participant: ' + userData.participant + ', userData.result: ' + userData.result + ', userData.message: ' + userData.message + ', userData: ' + userData);
                                    //                //
                                    //                // PROMPT THE USER TO ASK IF THEY WANT TO CREATE THEIR OWN TENANT ETC
                                    //                //


                                } else {

                                    if (thiz.options.backendAdministrationLogin == true) {





                                        console.log('Getting ready to render the home screen. Calling renderWelcomeScreen_BackendAdministration().');

                                        // renderWelcomeScreen_BackendAdministration(); // commented out 12-14-2022


                                        // new 12-14-2022
                                        //thiz.loadRemainingJsAndCssAndBWMData();

                                        //alert('xcx5556789');
                                        renderWelcomeScreen_BackendAdministration();














                                    } else {
                                        //                //tenantId = userData.participant.bwTenantId; // global. todd this needs to accomodate multiple tenant membership eventually. // bwLastSelectedTenantId
                                        //                // fixed 6-24-2020
                                        //                debugger;
                                        //                tenantId = userData.participant.bwLastSelectedTenantId;
                                        //                workflowAppId = userData.participant.bwLastSelectedWorkflowAppId;

                                        if (!userData.participant.bwLastSelectedWorkflowAppId) { // Check if bwLastSelectedWorkflowAppId is undefined..... if so that means we have to select one some other way. 12-12-2021
                                            //debugger; // The BwWorkflowApp no longer exists, it must have been deleted.... SO WE ARE just picking the first one here. A somewhat graceful recovery.

                                            console.log('The BwWorkflowApp no longer exists, it may have been deleted, or bwLastSelectedWorkflowAppId has not yet been set because this is a new user.');
                                            thiz.options.workflowAppId = userData.participant.participantWorkflowApps[0].bwWorkflowAppId;
                                            thiz.options.workflowAppTitle = userData.participant.participantWorkflowApps[0].bwWorkflowAppTitle;

                                            thiz.options.workflowAppFiscalYear = userData.participant.participantWorkflowApps[0].workflowAppFiscalYear;
                                            thiz.options.workflowAppTheme = userData.participant.participantWorkflowApps[0].bwWorkflowAppTheme;



                                            thiz.options.externallyFacingUrlForAttachments = userData.participant.participantWorkflowApps[0].bwExternallyFacingUrlForAttachments; // 6-29-2022
                                            thiz.options.externallyFacingUrlForAttachmentsSourceFolder = userData.participant.participantWorkflowApps[0].bwExternallyFacingUrlForAttachmentsSourceFolder; // 6-29-2022




                                        } else {
                                            //debugger; //xcx55467 ------ GET workflowAppTitle <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
                                            for (var i = 0; i < userData.participant.participantWorkflowApps.length; i++) {
                                                if (userData.participant.participantWorkflowApps[i].bwWorkflowAppId == thiz.options.workflowAppId) {
                                                    thiz.options.workflowAppTitle = userData.participant.participantWorkflowApps[i].bwWorkflowAppTitle;

                                                    thiz.options.workflowAppFiscalYear = userData.participant.participantWorkflowApps[i].workflowAppFiscalYear;
                                                    thiz.options.workflowAppTheme = userData.participant.participantWorkflowApps[i].bwWorkflowAppTheme;

                                                    thiz.options.externallyFacingUrlForAttachments = userData.participant.participantWorkflowApps[0].bwExternallyFacingUrlForAttachments; // 6-29-2022
                                                    thiz.options.externallyFacingUrlForAttachmentsSourceFolder = userData.participant.participantWorkflowApps[0].bwExternallyFacingUrlForAttachmentsSourceFolder; // 6-29-2022


                                                }
                                            }
                                        }



                                        //debugger;
                                        //$.ajax({
                                        //    url: webserviceurl + "/RequestTypes/" + thiz.options.tenantId + "/" + thiz.options.workflowAppId, // + "/true", //
                                        //    dataType: "json",
                                        //    contentType: "application/json",
                                        //    type: "Get"
                                        //}).done(function (RequestTypesResult) {
                                        var data = {
                                            bwParticipantId_LoggedIn: participantId,
                                            bwActiveStateIdentifier: activeStateIdentifier,
                                            bwWorkflowAppId_LoggedIn: workflowAppId,

                                            bwWorkflowAppId: workflowAppId
                                        }
                                        var operationUri = thiz.options.operationUriPrefix + "_bw/RequestTypes";
                                        $.ajax({
                                            url: operationUri,
                                            type: 'POST',
                                            data: data,
                                            headers: {
                                                "Accept": "application/json; odata=verbose"
                                            },
                                            success: function (RequestTypesResult) {
                                                try {
                                                    //debugger;












                                                    if (!(RequestTypesResult && RequestTypesResult.RequestTypes && RequestTypesResult.RequestTypes.length && RequestTypesResult.RequestTypes.length > 0)) {
                                                        // 2-23-2022
                                                        //console.log('Error: No request types were returned. Please create at least one. Go to "Configuration > Organization Settings". tenantId: ' + thiz.options.tenantId + ', workflowAppId: ' + thiz.options.workflowAppId);
                                                        //displayAlertDialog('Error: No request types were returned. Please create at least one. Go to "Configuration > Organization Settings". tenantId: ' + thiz.options.tenantId + ', workflowAppId: ' + thiz.options.workflowAppId);

                                                        console.log('Error: No request types were returned. Please select a different organization from the drop-down at the top of the page. workflowAppId: ' + thiz.options.workflowAppId + ', tenantId: ' + thiz.options.tenantId + ', RequestTypesResult: ' + JSON.stringify(RequestTypesResult));
                                                        displayAlertDialog('Error: No request types were returned. Please select a different organization from the drop-down at the top of the page. workflowAppId: ' + thiz.options.workflowAppId + ', tenantId: ' + thiz.options.tenantId + ', RequestTypesResult: ' + JSON.stringify(RequestTypesResult));

                                                        RequestTypesResult = {
                                                            bwRequestTypeId: '1234-5678-9101112-1314151617',
                                                            bwWorkflowAppId: thiz.options.workflowAppId,
                                                            Abbreviation: 'BR',
                                                            SingletonName: 'Budget Request',
                                                            PluralName: 'Budget Requests',
                                                            isActive: true//,
                                                            //message: 'SUCCESS'
                                                        }
                                                    }














                                                    ////
                                                    //// WE NEED TO FIND OUT IF THE USER HAS ANY OTHER BwWorkflowApps, and if so recover to one of those istead of this one.
                                                    //// - Also make a severe entry and an email to the admin regarding a corrupted BwWorkflowApp.
                                                    ////
                                                    //var userMessageDisplayed = false;
                                                    //var bwWorkflowAppTitle, bwTenantId, tempTenantOwnerEmail;
                                                    //for (var i = 0; i < userData.participant.participantWorkflowApps.length; i++) {
                                                    //    if (thiz.options.workflowAppId == userData.participant.participantWorkflowApps[i].bwWorkflowAppId) {

                                                    //        debugger; // ???????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
                                                    //        bwWorkflowAppTitle = userData.participant.participantWorkflowApps[i].bwWorkflowAppTitle;
                                                    //        bwTenantId = userData.participant.participantWorkflowApps[i].bwTenantId;

                                                    //        var operationUri = webserviceurl + "/gettenantdetails/" + bwTenantId;
                                                    //        $.ajax({
                                                    //            url: operationUri,
                                                    //            type: "GET",
                                                    //            contentType: 'application/json',
                                                    //            success: function (data) {
                                                    //                try {
                                                    //                    debugger;

                                                    //                    var bwTenantOwnerEmail = data.d.results[0].bwTenantOwnerEmail;

                                                    //                    userMessageDisplayed = true;
                                                    //                    console.log('Error: No request types were returned. This process cannot continue for "' + bwWorkflowAppTitle + '" (bwTenantId: ' + bwTenantId + ', bwWorkflowAppId: ' + thiz.options.workflowAppId + '), bwTenantOwnerEmail: ' + bwTenantOwnerEmail);
                                                    //                    alert('Error: No request types were returned. This process cannot continue for "' + bwWorkflowAppTitle + '" (bwTenantId: ' + bwTenantId + ', bwWorkflowAppId: ' + thiz.options.workflowAppId + '), bwTenantOwnerEmail: ' + bwTenantOwnerEmail);


                                                    //                } catch (e) {
                                                    //                    displayAlertDialog('xcx57897-1: ' + e.message + ', ' + e.stack);
                                                    //                }
                                                    //            },
                                                    //            error: function (data, errorCode, errorMessage) {
                                                    //                try {
                                                    //                    debugger;

                                                    //                } catch (e) {
                                                    //                    displayAlertDialog('xcx57897-2: ' + e.message + ', ' + e.stack);
                                                    //                }
                                                    //            }
                                                    //        });

                                                    //    }
                                                    //}

                                                    //if (userMessageDisplayed == false) {
                                                    //    alert('Error: No request types were returned. This process cannot continue for workflowAppId "' + thiz.options.workflowAppId + '".');
                                                    //}

                                                    //} else {
                                                    //debugger; // 8-14-2020 MAKE SURE THIS IS GETTING POPULATED!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
                                                    if (RequestTypesResult.status != 'SUCCESS') {
                                                        //var html = '';
                                                        //html += '<span style="font-size:24pt;color:red;">bwRequestTypeEditor: CANNOT RENDER</span>';
                                                        //html += '<br />';
                                                        //html += '<span style="">Error in bwRequestTypeEditor.Create(): ' +result.message + '</span>';
                                                        //thiz.element.html(html);
                                                        console.log('ERROR: This process cannot continue. In my.js.renderWelcomeScreen.RequestTypesResult.message: ' + RequestTypesResult.message);
                                                        displayAlertDialog('ERROR: This process cannot continue. In my.js.renderWelcomeScreen.RequestTypesResult.message: ' + RequestTypesResult.message);
                                                    } else {

                                                        //
                                                        // *********************************************************************
                                                        // THIS IS THE ONLY PLACE WE SHOULD BE READING IN ENABLED REQUEST TYPES. [1-2-2022 also do it in bwRequestTypeEditor] THIS IS A GLOBAL VARIABLE AND SHOULD BE REFERENCED EVERYWHERE ELSE!!!!!!!!!!!!!!!!!!!!!!!! 7-8-2020.
                                                        // (actually this also happens in Configuration > Settings, when the request types are turned on or off.)
                                                        // *********************************************************************
                                                        //
                                                        //alert('In bwAuthentication.js.xx(). RequestTypesResult.RequestTypes: ' + JSON.stringify(RequestTypesResult)); //.RequestTypes));

                                                        thiz.options.bwEnabledRequestTypes = {
                                                            EnabledItems: []
                                                        }
                                                        for (var rt = 0; rt < RequestTypesResult.RequestTypes.length; rt++) {
                                                            if (RequestTypesResult.RequestTypes[rt].isActive == true) {

                                                                var request = {
                                                                    bwRequestTypeId: RequestTypesResult.RequestTypes[rt].bwRequestTypeId,
                                                                    isActive: RequestTypesResult.RequestTypes[rt].isActive,
                                                                    hasWorkflow: RequestTypesResult.RequestTypes[rt].hasWorkflow, // added 8-10-2023.
                                                                    Abbreviation: RequestTypesResult.RequestTypes[rt].Abbreviation,
                                                                    SingletonName: RequestTypesResult.RequestTypes[rt].SingletonName,
                                                                    PluralName: RequestTypesResult.RequestTypes[rt].PluralName
                                                                    //RequestType: RequestTypesResult.RequestTypes[rt].RequestType, // Removed 1-1-2022

                                                                }
                                                                thiz.options.bwEnabledRequestTypes.EnabledItems.push(request);
                                                            }
                                                        }
                                                        thiz.options.selectedRequestType = thiz.options.bwEnabledRequestTypes.EnabledItems[0]; // On the initial load, we just default to the top item in the list. At some point we want to remember the users preference. We had this at one point... LastSelectedReqyestType or something??? 11-29-2021.

                                                    }

                                                    // This is where the workflow app is set when the page loads, so we have to GET THE LICENSING HERE!
                                                    console.log('');
                                                    console.log('********************************');
                                                    console.log('xcx333 This is where the workflow app is set when the page loads, so we have to GET THE LICENSING HERE!');
                                                    var reqData = {
                                                        bwWorkflowAppId: thiz.options.workflowAppId
                                                    };
                                                    var operationUri = webserviceurl + "/bwworkflowapplicensesforworkflow";
                                                    $.ajax({
                                                        url: operationUri,
                                                        type: "POST",
                                                        data: reqData,
                                                        headers: {
                                                            "Accept": "application/json; odata=verbose"
                                                        },
                                                        success: function (licenseData) {
                                                            try {
                                                                //debugger;
                                                                console.log('xcx1231242 loading ' + licenseData.length + ' licenses for ' + workflowAppId);
                                                                console.log('********************************');
                                                                console.log('');

                                                                globalLicenses = new Array();
                                                                for (var li = 0; li < licenseData.length; li++) {

                                                                    //displayAlertDialog('bwWorkflowAppId: ' + licenseData[li].bwWorkflowAppId);


                                                                    var tmpLicense = new Array(5);
                                                                    tmpLicense[0] = licenseData[li].LicensePackageCategory; // eg: 'gold'
                                                                    tmpLicense[1] = licenseData[li].LicensePackageCategory; // eg: 'Gold', Todd: This field is not getting populated from the email parsing routine properly.
                                                                    tmpLicense[2] = licenseData[li].bwWorkflowAppLicenseId; // eg: '665f8489-937d-439c-939a-5e27b47d08d7';
                                                                    tmpLicense[3] = licenseData[li].LicenseClaimedTimestamp; // eg: '2016-6-16T4:44:32'; // This is just temporary to provide a date.
                                                                    tmpLicense[4] = getLicenseExpiryFriendlyDate(licenseData[li].LicenseClaimedTimestamp); //'xJuly 1, 2016x';
                                                                    globalLicenses.push(tmpLicense);
                                                                    // Upgrade the global license status depending.... :)
                                                                    var licenseText = ['basic', 'bronze', 'silver', 'gold'];
                                                                    var newLicenseIndex = licenseText.indexOf(licenseData[li].LicensePackageCategory);
                                                                    var oldLicenseIndex = licenseText.indexOf(gWorkflowLicenseStatus);
                                                                    //displayAlertDialog('from the DB: ' + licenseData[li].LicensePackageCategory + '     gWorkflowLicenseStatus: ' + gWorkflowLicenseStatus + '     newLicenseIndex: ' + newLicenseIndex + '   oldLicenseIndex: ' + oldLicenseIndex);
                                                                    if (newLicenseIndex > oldLicenseIndex) {
                                                                        gWorkflowLicenseStatus = licenseText[newLicenseIndex];
                                                                    }

                                                                }
                                                                //displayAlertDialog('gWorkflowLicenseStatus: ' + gWorkflowLicenseStatus);

                                                                // The following is the EFFECTIVE STATUS OF THE LICENSING!!! This is determined from what licenses have been assigned to the workflow.
                                                                //var gWorkflowLicenseStatus = 'bronze'; // basic, bronze, silver, gold. THIS IS THE FLAG WE ARE USING THROUGHOUT TO TURN ON/OFF FUNCTIONALITY.

                                                                console.log('');
                                                                console.log('****************************************');
                                                                console.log('Number of workflow apps this user belongs to: ' + userData.participant.participantWorkflowApps.length);
                                                                console.log('****************************************');
                                                                console.log('');

                                                                //alert('Number of workflows this user belongs to: ' + userData.participant.participantWorkflowApps.length);

                                                                // Locate the selected WorkflowAppId and get the Title into the global variable. 
                                                                //debugger;
                                                                var menuHasBeenInstantiated = false;
                                                                for (var wa = 0; wa < userData.participant.participantWorkflowApps.length; wa++) {
                                                                    if (thiz.options.workflowAppId == userData.participant.participantWorkflowApps[wa].bwWorkflowAppId) {

                                                                        //debugger; // ???????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
                                                                        thiz.options.workflowAppTitle = userData.participant.participantWorkflowApps[wa].bwWorkflowAppTitle;

                                                                        thiz.options.workflowAppFiscalYear = userData.participant.participantWorkflowApps[wa].bwFiscalYear;
                                                                        thiz.options.workflowAppTheme = userData.participant.participantWorkflowApps[wa].bwWorkflowAppTheme;


                                                                        // TODD: ALSO DO THIS FOR THE SETTINGS
                                                                        bwLastSelectedArchiveScreenRequestType = userData.participant.participantWorkflowApps[wa].bwLastSelectedArchiveScreenRequestType;
                                                                        //
                                                                        thiz.options.LastSelected_bwRequestTypeId = userData.participant.participantWorkflowApps[wa].LastSelected_bwRequestTypeId; // bwLastSelectedNewRequestType <<< THIS WAS THE OLD VALUE
                                                                        //


                                                                        console.log('@@@@@@@@@@@@@@@@@@@@@@@@ userData.participant.participantWorkflowApps[wa].LastSelected_OpenAccordionDrawers: ' + userData.participant.participantWorkflowApps[wa].LastSelected_OpenAccordionDrawers);
                                                                        // 9-2-2023.
                                                                        if (userData.participant.participantWorkflowApps[wa].LastSelected_OpenAccordionDrawers) {
                                                                            thiz.options.LastSelected_OpenAccordionDrawers = userData.participant.participantWorkflowApps[wa].LastSelected_OpenAccordionDrawers;
                                                                        }


                                                                        thiz.options.UserData_PinnedRequestsArray = userData.participant.participantWorkflowApps[wa].PinnedRequests;

                                                                        //alert('In bwAuthentication.js.getRemainingParticipantDetailsAndWorkflowAppTitle(). Loading UserData_PinnedRequestsArray. Length: ' + thiz.options.UserData_PinnedRequestsArray.length);



                                                                        selectedCurrencySymbol = userData.participant.participantWorkflowApps[wa].bwSelectedCurrencySymbol;

                                                                        try { // backend admin does not support this yet or maybe never will
                                                                            renderFavicon(false); // May not need this line... not sure. Leaving it for now.
                                                                        } catch (e) { }

                                                                        newBudgetRequestManagerTitle = userData.participant.participantWorkflowApps[wa].bwNewBudgetRequestManagerTitle;

                                                                        if (userData.participant.participantWorkflowApps[wa].bwRequireStartEndDates == 'true') requireStartEndDates = true;
                                                                        else requireStartEndDates = false;
                                                                        //
                                                                        if (userData.participant.participantWorkflowApps[wa].bwRequireRequestDetails == 'true') requireRequestDetails = true;
                                                                        else requireRequestDetails = false;
                                                                        //
                                                                        if (userData.participant.participantWorkflowApps[wa].bwEnableNewRequestAttachments == 'true') enableNewRequestAttachments = true;
                                                                        else enableNewRequestAttachments = false;

                                                                        if (userData.participant.participantWorkflowApps[wa].bwEnableNewRequestBarcodeAttachments == 'true') enableNewRequestBarcodeAttachments = true;
                                                                        else enableNewRequestBarcodeAttachments = false;

                                                                        //tenantId = userData.participant.participantWorkflowApps[wa].bwTenantId;
                                                                        //displayAlertDialog('selected workflowAppId: ' + workflowAppId + ',  tenantId: ' + tenantId + ', Title: ' + workflowAppTitle + ',  Attachments? ' + enableNewRequestAttachments);

                                                                        //enableNewRequestAttachments = userData.participant.participantWorkflowApps[wa].bwEnableNewRequestAttachments;






                                                                        if (userData.participant.participantWorkflowApps[wa].bwCapitalAndExpenseTrackingEnabled == 'true') capitalAndExpenseTrackingEnabled = true;
                                                                        else capitalAndExpenseTrackingEnabled = false;


                                                                        if (userData.participant.participantWorkflowApps[wa].bwCloseoutsEnabled == 'true') closeoutsEnabled = true;
                                                                        else closeoutsEnabled = false;

                                                                        if (userData.participant.participantWorkflowApps[wa].bwSupplementalsEnabled == 'true') supplementalsEnabled = true;
                                                                        else supplementalsEnabled = false;

                                                                        //alert('userData.participant.participantWorkflowApps[wa].bwEmailEnabled: ' + userData.participant.participantWorkflowApps[wa].bwEmailEnabled);
                                                                        //debugger;
                                                                        if (userData.participant.participantWorkflowApps[wa].bwEmailEnabled == 'true') emailEnabled = true;
                                                                        else emailEnabled = false;
                                                                        //debugger;

                                                                        if (userData.participant.participantWorkflowApps[wa].bwStrictAuditingEnabled == 'true') strictAuditingEnabled = true;
                                                                        else strictAuditingEnabled = false;

                                                                        console.log('In bwAuthentication.js.getRemainingParticipantDetailsAndWorkflowAppTitle(). xcx3254>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> bwDeveloperModeEnabled: ' + userData.participant.participantWorkflowApps[wa].bwDeveloperModeEnabled);

                                                                        if (userData.participant.participantWorkflowApps[wa].bwDeveloperModeEnabled == 'true') {
                                                                            thiz.options.developerModeEnabled = true;
                                                                        } else {
                                                                            thiz.options.developerModeEnabled = false;
                                                                        }





                                                                        // 3-23-2022
                                                                        if (userData.participant.participantWorkflowApps[wa].bwLargeFileUploadEnabled == 'true') {
                                                                            thiz.options.largeFileUploadEnabled = true;
                                                                        } else {
                                                                            thiz.options.largeFileUploadEnabled = false;
                                                                        }







                                                                        console.log('In bwAuthentication.js.getRemainingParticipantDetailsAndWorkflowAppTitle(). Calling bwActiveMenu to instantiate the widget.');
                                                                        $('#divBwActiveMenu').bwActiveMenu('renderAuthenticatedHomePage');


                                                                        // Initialize this here so that we can support offline requests (on this device).
                                                                        var $bwRequest = $('#divBwRequest').bwRequest({});

                                                                        // Initialize this here so that we can support displaying org entities in the circle dialog throughout.
                                                                        //alert('Instantiating bwOrganizationEditor.');

                                                                        var div = document.getElementById('divBwOrganizationEditor');
                                                                        if (!div) {
                                                                            div = document.createElement('div');
                                                                            div.id = 'divBwOrganizationEditor';
                                                                            document.body.appendChild(div); // to place at end of document
                                                                        }


                                                                        console.log('In bwAuthentication.js.getRemainingParticipantDetailsAndWorkflowAppTitle(). Instantiating bwOrganizationEditor()');
                                                                        //alert('xcx12342342-2 Instantiating bwOrganizationEditor()');

                                                                        var options = {
                                                                            displayWorkflowPicker: true,
                                                                            bwTenantId: tenantId,
                                                                            bwWorkflowAppId: workflowAppId,
                                                                            bwEnabledRequestTypes: bwEnabledRequestTypes
                                                                        };
                                                                        var $bworgroleseditor = $("#divBwOrganizationEditor").bwOrganizationEditor(options); // This is not the right way to do this! It currently means the whole thing gets rendered invisibly.... need to move this part of the architecture around somehow in the future.


                                                                        menuHasBeenInstantiated = true;

                                                                    }
                                                                }

                                                                //if (menuHasBeenInstantiated == false) {
                                                                //    console.log('bwActiveMenu MENU HAS NOT BEEN INSTANTIATED!!!!!!!!!!!!!!!!!!!!!!!!!! Calling it now but there is an issue come to this code and figure it out.<<<<<<<<<<<<<<<<<<<<<<');
                                                                //    displayAlertDialog('bwActiveMenu MENU HAS NOT BEEN INSTANTIATED!!!!!!!!!!!!!!!!!!!!!!!!!! Calling it now but there is an issue come to this code and figure it out.');

                                                                //    console.log('Calling bwActiveMenu to instantiate the widget.xcx2');
                                                                //    alert('divBwActiveMenu xcx3');
                                                                //    $('#divBwActiveMenu').bwActiveMenu({}); // Instantiates the widget. // 12-20-2021

                                                                //    // Initialize this here so that we can support offline requests (on this device).
                                                                //    var $bwRequest = $('#divBwRequest').bwRequest({});

                                                                //}



                                                                // 1-26-2023
                                                                thiz.options.bwSelectedNotificationSound = userData.participant.bwSelectedNotificationSound;
                                                                console.log('In bwAuthentication.js.getRemainingParticipantDetailsAndWorkflowAppTitle(). Set bwSelectedNotificationSound: ' + thiz.options.bwSelectedNotificationSound);



                                                                if (userData.participant.bwTipsDisplayOn == 'true') tipsDisplayOn = true;
                                                                else tipsDisplayOn = false;

                                                                if (userData.participant.bwInvitationsOnHomePageDisplayOn == 'true') displayInvitationsOnHomePageDisplayOn = true;
                                                                else displayInvitationsOnHomePageDisplayOn = false;
                                                                //debugger;
                                                                if (userData.participant.bwDisplayTaskDetailsBeforeRequests == 'true') displayTaskDetailsBeforeRequests = true;
                                                                else displayTaskDetailsBeforeRequests = false;


                                                                //emailNotificationLevel = userData.participant.bwEmailNotificationLevel;

                                                                emailNotificationFrequency = userData.participant.bwEmailNotificationFrequency; //immediately, aggregatetwicedaily
                                                                emailNotificationTypes = userData.participant.bwEmailNotificationTypes; //allnotifications, onlymytasknotifications
                                                                emailAggregatorTwiceDailyFirstTime = userData.participant.bwEmailAggregatorTwiceDailyFirstTime;
                                                                emailAggregatorTwiceDailySecondTime = userData.participant.bwEmailAggregatorTwiceDailySecondTime;
                                                                emailAggregatorTwiceDailyTimezoneDisplayName = userData.participant.bwEmailAggregatorTwiceDailyTimezoneDisplayName;

                                                                bwTwoFactorAuthenticationEnabled = userData.participant.bwTwoFactorAuthenticationEnabled;
                                                                bwTwoFactorAuthenticationSmsNumber = userData.participant.bwTwoFactorAuthenticationSmsNumber;
                                                                //alert('xcx34543534 does this work and get data? bwTwoFactorAuthenticationEnabled: ' + bwTwoFactorAuthenticationEnabled + ', bwTwoFactorAuthenticationSmsNumber: ' + bwTwoFactorAuthenticationSmsNumber + ', userData.participant: ' + JSON.stringify(userData.participant));

                                                                var bwUnsubscribedStatus = userData.participant.bwUnsubscribedStatus;
                                                                if (bwUnsubscribedStatus == 'true') {
                                                                    // The user has unsubscribed, only show them this warning, and nothing else.
                                                                    var resubscribe = confirm('You are not subscribed. If you wish to re-subscribe and resume using BudgetWorkflow.com, then click OK.\n\n\nClick the OK button to proceed...');
                                                                    if (resubscribe) {
                                                                        // Call the resubscribe web method!
                                                                        var subscribe = {
                                                                            participantId: thiz.options.participantId
                                                                        };
                                                                        var operationUri = webserviceurl + "/subscribe";
                                                                        $.ajax({
                                                                            url: operationUri,
                                                                            type: "POST",
                                                                            data: subscribe,
                                                                            headers: {
                                                                                "Accept": "application/json; odata=verbose"
                                                                            },
                                                                            success: function (data) {
                                                                                try {

                                                                                    displayAlertDialog(data);
                                                                                    alert('In bwAuthentication.js.xx(). setting window.location!! xcx343245342-5');
                                                                                    window.location = 'index.html?logontype=' + thiz.options.participantLogonType; // This gets rid of the query string values.
                                                                                    renderWelcomeScreen();

                                                                                } catch (e) {
                                                                                    console.log('Exception in bwAuthentication.xcx34345456: ' + e.message + ', ' + e.stack);
                                                                                }
                                                                            },
                                                                            error: function (data, errorCode, errorMessage) {
                                                                                //debugger;
                                                                                displayAlertDialog('Error in my.js.renderWelcomeScreen():subscribe:' + errorMessage + ' ' + JSON.stringify(data));
                                                                                //WriteToErrorLog('Error in InitBudgetRequest.js.cmdCreateBudgetRequest()', 'Error creating the budget request in budgetrequests library: ' + errorCode + ', ' + errorMessage);
                                                                            }
                                                                        });
                                                                    }
                                                                } else {
                                                                    //debugger;
                                                                    //
                                                                    // The new participant has accepted the invitation. Now we need to display their home screen.
                                                                    //

                                                                    // The user has either logged in before.
                                                                    var operationUri = webserviceurl + "/bwtenants/" + thiz.options.tenantId;
                                                                    $.ajax({
                                                                        url: operationUri,
                                                                        method: "GET",
                                                                        headers: {
                                                                            "Accept": "application/json; odata=verbose"
                                                                        },
                                                                        success: function (tenantData) {
                                                                            try {
                                                                                //debugger;
                                                                                //var faData1 = {
                                                                                //    //"bwTenantId": "null",
                                                                                //    //"bwTenantOwnerFacebookUserId": "test1",
                                                                                //    //"bwTenantOwnerLinkedInUserId": "test1",
                                                                                //    //"bwTenantOwnerFriendlyName": "Todd Hiltz1",
                                                                                //    //"bwTenantOwnerEmail": "todd1@capexworkflow.com",
                                                                                //    //"bwWorkflows": "null"
                                                                                //};


                                                                                // Todd: Disconnecting this while testing!!!
                                                                                //gWorkflowLicenseStatus = tenantData[0].bwTenantPackage;




                                                                                //var html = '';
                                                                                //html += '<hr />';
                                                                                //html += 'Package level: ' + tenantPackage;
                                                                                //$('#divUserDropdownTenantPackageType').html(html);



                                                                                var operationUri = webserviceurl + "/bwworkflowapps/" + thiz.options.tenantId;
                                                                                $.ajax({
                                                                                    url: operationUri,
                                                                                    method: "GET",
                                                                                    headers: {
                                                                                        "Accept": "application/json; odata=verbose"
                                                                                    },
                                                                                    success: function (workflowAppData) {
                                                                                        try {
                                                                                            $.ajax({
                                                                                                url: webserviceurl + "/getfunctionalareasbyappid/" + thiz.options.workflowAppId + "/" + "RETURNALL",
                                                                                                method: "GET",
                                                                                                headers: {
                                                                                                    "Accept": "application/json; odata=verbose"
                                                                                                },
                                                                                                //contentType: 'application/json',
                                                                                                //data: JSON.stringify(faData1),
                                                                                                success: function (faData) {
                                                                                                    try {
                                                                                                        //debugger;
                                                                                                        //displayAlertDialog('participantId: ' + participantId);

                                                                                                        //if (!participantId) {
                                                                                                        //    throw 'participantId is not defined xcx1';
                                                                                                        //}

                                                                                                        // Get the list of workflow apps that the participant has been invited to!
                                                                                                        var participantData = {
                                                                                                            "bwParticipantId": thiz.options.participantId // NOT GETTING THIS!!!!!!!!!!!!!!!!!!!!!!!
                                                                                                        };
                                                                                                        $.ajax({
                                                                                                            url: webserviceurl + "/bwworkflowapps/listofworklflowappsthathavebeeninvitedto",
                                                                                                            type: "DELETE",
                                                                                                            contentType: 'application/json',
                                                                                                            data: JSON.stringify(participantData),
                                                                                                            success: function (iData) {
                                                                                                                try {
                                                                                                                    //debugger;

                                                                                                                    //thiz.loadRemainingJsAndCssAndBWMData(); // loadRemainingJsAndCssAndBWMData xcx1
                                                                                                                    renderWelcomeScreen();

                                                                                                                    //displayAlertDialog('DEV: Referencing isUserATenantOwner here. This is deprecated and needs to be fixed.');
                                                                                                                    // TODD: HARDCODED LOOK AT THIS AGIN!!!
                                                                                                                    var userIsATenantOwner = 'true';


                                                                                                                    //if (userData.isUserATenantOwner == 'true') {
                                                                                                                    if (userIsATenantOwner == 'true') {
                                                                                                                        var html = '';
                                                                                                                        // Todd commented this one out in order to try the workflow app drop down selector on the home page.
                                                                                                                        //html += '<span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 2.77em;">Your budgeting network: <span id="spanHomePageWorkflowAppTitle" style="font-weight:bold;">' + workflowAppTitle + '</span></span>';




                                                                                                                        //html += '                           <span class="printButton" title="print" onclick="cmdPrintForm();">&#x1f5a8;</span>';
                                                                                                                        html += '<table style="width:100%;">';
                                                                                                                        html += '   <tr>';
                                                                                                                        html += '       <td>';

                                                                                                                        // This is the drop down selector one. Not sure if I want this yet...
                                                                                                                        html += '<span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 2.77em;">Your organization: ';
                                                                                                                        if (iData.length == 1) {
                                                                                                                            // There is only 1 workflow, so display it as text.
                                                                                                                            html += '<span id="spanHomePageWorkflowAppTitle" style="font-weight:bold;cursor:default;white-space:nowrap;" title="You are the owner of this workflow.">' + iData[0].bwWorkflowAppTitle + '</span>';


                                                                                                                            thiz.options.SelectedOrganization = { // 9-7-2021 STARTING TO RENAME THESE VARS A BIT BETTER FOR FINAL RELEASE.
                                                                                                                                OrganizationId: iData[0].bwWorkflowAppId,
                                                                                                                                OrganizationTitle: iData[0].bwWorkflowAppTitle,
                                                                                                                                OrganizationRole: iData[0].bwParticipantRole
                                                                                                                            }


                                                                                                                            // Put the workflow title, eg: "Corporate Entity 2020" in the blue header bar for each page! :D
                                                                                                                            var workflowTitleBlueTopHeaderBarWorkflowTitle = document.getElementsByClassName('divTopBarTextContents_WorkflowTitle');
                                                                                                                            for (var t = 0; t < workflowTitleBlueTopHeaderBarWorkflowTitle.length; t++) {
                                                                                                                                workflowTitleBlueTopHeaderBarWorkflowTitle[t].innerHTML = iData[0].bwWorkflowAppTitle; // removed colon 5-14-2020 // + ': '; //'WorkflowTitle::';
                                                                                                                            }


                                                                                                                        } else {
                                                                                                                            // There is more than 1 item, so display in a drop down.
                                                                                                                            //debugger; // WHY ARE WE NOT GETTING ANY CONTENTS FOR THIS DROP DOWN??????????????
                                                                                                                            html += '<span id="spanHomePageWorkflowAppTitle">';

                                                                                                                            console.log('In bwAuthentication.js.getRemainingParticipantDetailsAndWorkflowAppTitle(). Populating [selectHomePageWorkflowAppDropDown] with ' + iData.length + ' organizations.');
                                                                                                                            //alert('In bwAuthentication.js.getRemainingParticipantDetailsAndWorkflowAppTitle(). Populating [selectHomePageWorkflowAppDropDown] with ' + iData.length + ' organizations.');

                                                                                                                            html += '<select id="selectHomePageWorkflowAppDropDown" onchange="$(\'.bwAuthentication\').bwAuthentication(\'selectHomePageWorkflowAppDropDown_change\');" class="selectHomePageWorkflowAppDropDown" style="cursor:pointer;font-weight:bold;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 1.25em;">';
                                                                                                                            for (var i = 0; i < iData.length; i++) {
                                                                                                                                if (thiz.options.workflowAppId == iData[i].bwWorkflowAppId) {
                                                                                                                                    //debugger;
                                                                                                                                    html += '<option value="' + iData[i].bwWorkflowAppId + '|' + iData[i].bwParticipantRole + '" selected>' + iData[i].bwWorkflowAppTitle + '</option>';

                                                                                                                                    thiz.options.SelectedOrganization = { // 9-7-2021 STARTING TO RENAME THESE VARS A BIT BETTER FOR FINAL RELEASE.
                                                                                                                                        OrganizationId: iData[i].bwWorkflowAppId,
                                                                                                                                        OrganizationTitle: iData[i].bwWorkflowAppTitle,
                                                                                                                                        OrganizationRole: iData[i].bwParticipantRole
                                                                                                                                    }

                                                                                                                                    //// Put the workflow title, eg: "Corporate Entity 2020" in the blue header bar for each page! :D
                                                                                                                                    //var workflowTitleBlueTopHeaderBarWorkflowTitle = document.getElementsByClassName('divTopBarTextContents_WorkflowTitle');
                                                                                                                                    //for (var t = 0; t < workflowTitleBlueTopHeaderBarWorkflowTitle.length; t++) {
                                                                                                                                    //    workflowTitleBlueTopHeaderBarWorkflowTitle[t].innerHTML = iData[i].bwWorkflowAppTitle; // removed colon 5-14-2020 // + ': '; //'WorkflowTitle::';
                                                                                                                                    //}


                                                                                                                                } else {
                                                                                                                                    html += '<option value="' + iData[i].bwWorkflowAppId + '|' + iData[i].bwParticipantRole + '" style="color:red;">' + iData[i].bwWorkflowAppTitle + '</option>';
                                                                                                                                }
                                                                                                                            }
                                                                                                                            html += '</select></span>';
                                                                                                                        }
                                                                                                                        html += '</span>';













                                                                                                                        if (thiz.options.developerModeEnabled && thiz.options.developerModeEnabled == true) {
                                                                                                                            // 1-9-2022
                                                                                                                            html += '<span style="float:right">';
                                                                                                                            html += 'View switcher: [xcx9631-1]&nbsp;&nbsp;&nbsp;[xcx9631-2]&nbsp;&nbsp;&nbsp;[xcx9631-3]&nbsp;&nbsp;&nbsp;[xcx9631-4]&nbsp;';
                                                                                                                            html += '';
                                                                                                                            html += '';
                                                                                                                            html += '</span>';
                                                                                                                        }







                                                                                                                        // search box. This exists elsewhere. Maybe it should be a widget.? 10-11-2022
                                                                                                                        html += '<span id="" style="float:right;white-space:nowrap;">';
                                                                                                                        html += '   Search: ';
                                                                                                                        html += '   <span id="searchbox">';
                                                                                                                        html += '       <input type="text" id="inputBwAuthentication_SearchBox" onkeydown="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'searchBox_OnKeyDown\', event);" style="WIDTH: 60%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;" />';
                                                                                                                        html += '       &nbsp;&nbsp;';
                                                                                                                        html += '       <span class="emailEditor_newMessageButton" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'search\');">Search</span>';
                                                                                                                        html += '   </span>';
                                                                                                                        html += '</span>';












                                                                                                                        html += '       </td>';
                                                                                                                        html += '       <td style="text-align:right;">';
                                                                                                                        //html += '           <span id="spanHomePagePrintButton" style="text-align:right;">[spanHomePagePrintButton]</span>';
                                                                                                                        html += '       </td>';
                                                                                                                        html += '   </tr>';
                                                                                                                        html += '</table>';







                                                                                                                        //// This is the drop down selector one. Not sure if I want this yet...
                                                                                                                        //html += '<span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 2.77em;">Your budgeting network: ';
                                                                                                                        //if (iData.length == 1) {
                                                                                                                        //    // There is only 1 workflow, so display it as text.
                                                                                                                        //    html += '<span id="spanHomePageWorkflowAppTitle" style="font-weight:bold;cursor:default;white-space:nowrap;" title="You are the owner of this workflow.">' + iData[0].bwWorkflowAppTitle + '</span>';
                                                                                                                        //} else {
                                                                                                                        //    // There is more than 1 item, so display in a drop down.
                                                                                                                        //    html += '<span id="spanHomePageWorkflowAppTitle">';
                                                                                                                        //    html += '<select id="selectHomePageWorkflowAppDropDown" onchange="selectHomePageWorkflowAppDropDown_change();" class="selectHomePageWorkflowAppDropDown" style="cursor:pointer;font-weight:bold;border-color:whitesmoke;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 1.25em;">';
                                                                                                                        //    for (var i = 0; i < iData.length; i++) {
                                                                                                                        //        if (workflowAppId == iData[i].bwWorkflowAppId) {
                                                                                                                        //            html += '<option value="' + iData[i].bwWorkflowAppId + '|' + iData[i].bwParticipantRole + '" selected>' + iData[i].bwWorkflowAppTitle + '</option>';
                                                                                                                        //        } else {
                                                                                                                        //            html += '<option value="' + iData[i].bwWorkflowAppId + '|' + iData[i].bwParticipantRole + '" style="color:red;">' + iData[i].bwWorkflowAppTitle + '</option>';
                                                                                                                        //        }
                                                                                                                        //    }
                                                                                                                        //    html += '</select></span>';
                                                                                                                        //}
                                                                                                                        //html += '</span>';


                                                                                                                        //html += '<br />';
                                                                                                                        html += '<span id="spanHomePagePersonalizedSection"></span>';






                                                                                                                        //html += '<br /><br />';
                                                                                                                        //html += '<span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 22pt;"><strong>Send invitations</strong></span><br />';
                                                                                                                        //html += '<span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 22pt;">Invite a participant to your network by copy-and-pasting the invitation link into an email:&nbsp;<button id="btnInviteNewParticipant1" onclick="cmdInviteNewParticipant();" style="cursor:pointer;font-size:16pt;">Generate a new invitation link</button></span>';
                                                                                                                        //html += '<br /><br />';
                                                                                                                        //html += '<span id="invitationLink"></span>';
                                                                                                                        //html += '<br /><br />';
                                                                                                                        //html += '<div id="divHomePageAlert"></div>';
                                                                                                                        //html += '<br />';
                                                                                                                        if (faData.length == 0) {
                                                                                                                            $('#divMenuMasterDivNewRequestButton').hide(); // Hide this button for now.
                                                                                                                            $('#divMenuMasterDivSummaryButton').hide();
                                                                                                                            $('#divMenuMasterDivMyStuffButton').hide();
                                                                                                                            html += 'You need to create at least one financial area before you can begin using your budget workflow.<br />';
                                                                                                                            html += '<a href="javascript:populateStartPageItem(\'divConfiguration\', \'Reports\', \'\');">Click here to create the first Financial Area</a>';
                                                                                                                            html += '<br /><br />';
                                                                                                                            html += '';
                                                                                                                            html += '';
                                                                                                                            html += '';
                                                                                                                            html += '';
                                                                                                                            $('#divWelcomeMessage').html(html);

                                                                                                                            //debugger; // 1
                                                                                                                            // Render the Print button.
                                                                                                                            //var printButtonOptions = {
                                                                                                                            //    reportType: 'MyPendingTasksReport'
                                                                                                                            //};
                                                                                                                            //var $printbutton = $('#spanHomePagePrintButton').bwPrintButton(printButtonOptions);



                                                                                                                        } else {
                                                                                                                            //$('#divWelcomeMessage').html(html);
                                                                                                                            $('#divPageContent1').html(html); // This clears the main content section of the page (within the star trek menu buttons and top bar).

                                                                                                                            //debugger; // 2
                                                                                                                            // Render the Print button.
                                                                                                                            //var printButtonOptions = {
                                                                                                                            //    reportType: 'MyPendingTasksReport'
                                                                                                                            //};
                                                                                                                            //var $printbutton = $('#spanHomePagePrintButton').bwPrintButton(printButtonOptions);








                                                                                                                            //debugger;
                                                                                                                            //alert('Calling renderHomePagePersonalizedSection_AndRenderButtons xcx1');
                                                                                                                            console.log('Calling renderHomePagePersonalizedSection_AndRenderButtons().xcx111223-3');
                                                                                                                            thiz.renderHomePagePersonalizedSection_AndRenderButtons();























                                                                                                                        }
                                                                                                                        //html += '<br /><br /><hr />';
                                                                                                                        ////html += 'You are the owner of this budget request system, "' + tenantData[0].bwTenantTitle + '". <a href="javascript:cmdTenantAdministration();">Administration</a><br /><br />';
                                                                                                                        //html += 'You are the owner of this budget request system. <a href="javascript:cmdTenantAdministration();">Administration</a><br /><br />';

                                                                                                                        //html += '<i><a href="javascript:cmdUpgradeAndPricingOptions();">Click here to learn about upgrade options</a></i>';
                                                                                                                        //$('#divWelcomeMessage').html(html);
                                                                                                                        ////checkForAlerts();
                                                                                                                        //renderAlerts();
                                                                                                                        //renderTenantOwnerStuff();
                                                                                                                        //loadWorkflowAppConfigurationDetails();










                                                                                                                    } else {
                                                                                                                        // This section is for users who are participants and not tenant owners.
                                                                                                                        var html = '';
                                                                                                                        for (var i = 0; i < workflowAppData.d.results.length; i++) {
                                                                                                                            html += '<span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 2.77em;">Your budgeting networkxx2: <strong>' + workflowAppData.d.results[i].bwWorkflowAppTitle + '</strong></span>';
                                                                                                                        }
                                                                                                                        html += '<br /><br />';
                                                                                                                        html += '<div id="divHomePageAlert"></div>';
                                                                                                                        html += '<br /><br /><br />';
                                                                                                                        if (faData.length == 0) {
                                                                                                                            $('#divMenuMasterDivNewRequestButton').hide(); // Hide this button for now.
                                                                                                                            $('#divMenuMasterDivSummaryButton').hide();
                                                                                                                            $('#divMenuMasterDivMyStuffButton').hide();
                                                                                                                            html += 'You need to create at least one financial area before you can begin using your budget workflow.<br />';
                                                                                                                            html += '<a href="javascript:populateStartPageItem(\'divConfiguration\', \'Reports\', \'\');">Click here to create the first Financial Area</a>';
                                                                                                                            html += '<br /><br />';
                                                                                                                            html += '';
                                                                                                                            html += '';
                                                                                                                            html += '';
                                                                                                                            html += '';
                                                                                                                        }
                                                                                                                        html += '<br /><br /><hr />';
                                                                                                                        html += 'You are a participant for this tenant, "' + tenantData[0].bwTenantTitle + '". <a href="javascript:cmdContactTheTenantAdministrator();">Contact the Tenant Administrator</a><br /><br />';
                                                                                                                        //html += '<i><a href="javascript:cmdUpgradeAndPricingOptions();">Click here to learn about upgrade options</a></i>';
                                                                                                                        $('#divWelcomeMessage').html(html);






                                                                                                                        //debugger;
                                                                                                                        renderAlerts2('xcx2'); // xcx2
                                                                                                                        //loadWorkflowAppConfigurationDetails9();
                                                                                                                    }




                                                                                                                } catch (e) {
                                                                                                                    console.log('Exception in bwAuthentication.xcx000344: ' + e.message + ', ' + e.stack);
                                                                                                                    displayAlertDialog('Exception in bwAuthentication.xcx000344: ' + e.message + ', ' + e.stack);
                                                                                                                }

                                                                                                            },
                                                                                                            error: function (data, errorCode, errorMessage) {
                                                                                                                //debugger;
                                                                                                                //window.waitDialog.close();
                                                                                                                //handleExceptionWithAlert('Error in index.js.cmdCreateANewTenant()', errorCode + ', ' + errorMessage);
                                                                                                                console.log('Error in my.js.renderWelcomeScreen():2.1:' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                                                                                                                displayAlertDialog('Error in my.js.renderWelcomeScreen():2.1:' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                                                                                                            }
                                                                                                        });
                                                                                                    } catch (e) {
                                                                                                        console.log('Exception in bwAuthentication.xcx000343: ' + e.message + ', ' + e.stack);
                                                                                                        displayAlertDialog('Exception in bwAuthentication.xcx000343: ' + e.message + ', ' + e.stack);
                                                                                                    }
                                                                                                },
                                                                                                error: function (data, errorCode, errorMessage) {
                                                                                                    //debugger;
                                                                                                    //window.waitDialog.close();
                                                                                                    //handleExceptionWithAlert('Error in index.js.cmdCreateANewTenant()', errorCode + ', ' + errorMessage);
                                                                                                    console.log('Error in my.js.renderWelcomeScreen():2:' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                                                                                                    displayAlertDialog('Error in my.js.renderWelcomeScreen():2:' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                                                                                                }
                                                                                            });
                                                                                        } catch (e) {
                                                                                            console.log('Exception in bwAuthentication.xcx000342: ' + e.message + ', ' + e.stack);
                                                                                            displayAlertDialog('Exception in bwAuthentication.xcx000342: ' + e.message + ', ' + e.stack);
                                                                                        }
                                                                                    },
                                                                                    error: function (data, errorCode, errorMessage) {
                                                                                        //debugger;
                                                                                        //handleExceptionWithAlert('Error in Start.js.displayConnectedWorkflows()', '1:' + errorCode + ', ' + errorMessage);
                                                                                        console.log('Error in my.js.renderWelcomeScreen():3:', errorCode + ', ' + errorMessage);
                                                                                        displayAlertDialog('Error in my.js.renderWelcomeScreen():3:', errorCode + ', ' + errorMessage);
                                                                                    }
                                                                                });
                                                                            } catch (e) {
                                                                                console.log('Exception in bwAuthentication.xcx00034: ' + e.message + ', ' + e.stack);
                                                                                displayAlertDialog('Exception in bwAuthentication.xcx00034: ' + e.message + ', ' + e.stack);
                                                                            }
                                                                        },
                                                                        error: function (data, errorCode, errorMessage) {
                                                                            //debugger;
                                                                            //handleExceptionWithAlert('Error in Start.js.displayConnectedWorkflows()', '1:' + errorCode + ', ' + errorMessage);
                                                                            console.log('Error in my.js.renderWelcomeScreen():4:', errorCode + ', ' + errorMessage);
                                                                            displayAlertDialog('Error in my.js.renderWelcomeScreen():4:', errorCode + ', ' + errorMessage);
                                                                        }
                                                                    });


























                                                                    ////displayAlertDialog('renderWelcomeScreen2:' + JSON.stringify(userData));
                                                                    //// So at this point, we will always get user data back, even if it is the first time, an entry is made in the database and a new participantId has been generated.
                                                                    ////debugger;
                                                                    //// First we will enable Forest Administrator access.
                                                                    //if (userData.participant.bwParticipantRole == 'Forest Administrator') {
                                                                    //    // This is where we display the Forest Administration link.
                                                                    //    var html = '';
                                                                    //    html += '<hr />';
                                                                    //    html += '<a href="admin.html">Forest Administration</a>';
                                                                    //    $('#divForestAdministratorLinks').html(html);
                                                                    //}
                                                                    ///////////////////////////////////////////////////////////////////
                                                                    //// THE FOLLOWING ARE THE SCREENS FOR THE DIFFERENT USER SCENARIOS
                                                                    ///////////////////////////////////////////////////////////////////
                                                                    //if (requestId1 != '') {
                                                                    //    // User clicked the link in the email to view the budget request.
                                                                    //    //else if (requestId && participantId) {
                                                                    //    // This is the url when the user clicks the link from the email to view the budget request.
                                                                    //    //displayAlertDialog('The user wants to view the budget request. This functionality will be completed shortly.');




                                                                    //    // This is where we have to get the WorkflowAppId for the request, and load the values for this, just like if the drop-down is selected to switch the workflow App.




                                                                    //    $('#divMenuMasterDivWelcomeButton').click(function () {
                                                                    //        debugger;
                                                                    //        window.location = 'my.html?logontype=' + participantLogonType;
                                                                    //    });

                                                                    //    renderLeftButtons('divWelcomePageLeftButtons');
                                                                    //    displayArOnTheHomePage(requestId1, participantId, 'x3x3x3');



                                                                    //} else if (inviteeId != '' && invitationAlreadyAccepted == false) { // USER RECEIVED AN INVITATION.
                                                                    //    // Get the invitation details. We need the tenant id, the workflow app id, the role, the created by Id (the person who created the invitation) and friendly name.
                                                                    //    var operationUri = webserviceurl + "/bwinvitations/" + inviteeId;
                                                                    //    $.ajax({
                                                                    //        url: operationUri,
                                                                    //        method: "GET",
                                                                    //        headers: {
                                                                    //            "Accept": "application/json; odata=verbose"
                                                                    //        },
                                                                    //        success: function (inviteeData) {
                                                                    //            debugger;
                                                                    //            // We got rid of the notice below, and just automatically accept the invitation!
                                                                    //            //cmdAcceptInvitation(inviteeId, inviteeData.d.results[0].bwTenantId, inviteeData.d.results[0].bwWorkflowAppId, inviteeData.d.results[0].bwWorkflowAppTitle, inviteeData.d.results[0].bwInvitationParticipantRole);

                                                                    //            //var html = '';
                                                                    //            //html += '<span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 2.77em;">Welcome to your Budgeting Social Network</span>';
                                                                    //            //html += '<br /><br />';
                                                                    //            //html += '<span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 22pt;">You were invited by ' + inviteeData.d.results[0].bwInvitationCreatedByFriendlyName + '</span>';
                                                                    //            //html += '<br /><br />';
                                                                    //            //html += '<span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 10pt;"><strong>Step 1.</strong> Click here to accept the invitation and start using this budget request system:&nbsp;<input type="button" id="btnAcceptInvitation" onclick="cmdAcceptInvitation(\'' + inviteeId + '\', \'' + inviteeData.d.results[0].bwTenantId + '\', \'' + inviteeData.d.results[0].bwWorkflowAppId + '\', \'' + inviteeData.d.results[0].bwWorkflowAppTitle + '\', \'' + inviteeData.d.results[0].bwInvitationParticipantRole + '\');" value="Join this Budgeting Network" style="cursor:pointer;" ></input></span>';
                                                                    //            //html += '<br /><br />';
                                                                    //            //html += '<span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 10pt;"><strong>Step 2.</strong> You will be taken to your Home page, where you can begin creating budget requests and participating in the decision making process.</span>';
                                                                    //            //html += '<br /><br /><br />';
                                                                    //            //html += '<span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 10pt;"><em><a target="_blank" href="http://budgetworkflow.com/support/kb14101">Click here for more information...</a></em></span>';
                                                                    //            //html += '<br /><br />';
                                                                    //            //$('#divWelcomeMessage').html(html);
                                                                    //            //renderAlerts();
                                                                    //        },
                                                                    //        error: function (data, errorCode, errorMessage) {
                                                                    //            debugger;
                                                                    //            //handleExceptionWithAlert('Error in Start.js.displayConnectedWorkflows()', '1:' + errorCode + ', ' + errorMessage);
                                                                    //            displayAlertDialog('Error in my.js.renderWelcomeScreen():1:', errorCode + ', ' + errorMessage + ' data:' + data);
                                                                    //        }
                                                                    //    });
                                                                    //} else if (unsubscribe != '') {
                                                                    //    renderLeftButtons('divWelcomePageLeftButtons');

                                                                    //    $('#divWelcomePageLeftButtonsWelcomeButton').click(function () {
                                                                    //        debugger;
                                                                    //        window.location = 'my.html?logontype=' + participantLogonType;
                                                                    //        //renderWelcomeScreen();
                                                                    //        // window.location = 'my.html?logontype=' + participantLogonType;
                                                                    //    });




                                                                    //    var html = '';
                                                                    //    html += '<br />';
                                                                    //    html += '<span style="font-weight:bold;">Unsubscribe</span>';
                                                                    //    html += '<hr />';
                                                                    //    html += '<br /><br /><br />';


                                                                    //    html += '<a href="javascript:cmdUnsubscribe();">Click here to unsubscribe</a><br /><br />';
                                                                    //    //html += '<hr>';
                                                                    //    html += '<br /><br /><br />';
                                                                    //    html += '<i>You will receive a final confirmation email. We send this out to ensure you have authorized this request.<br /><br />';
                                                                    //    html += '<i>Receiving emails is integral to the functioning of this website, so you will also be removed from the ....<br /><br />';
                                                                    //    html += 'We will also notify the participants of the workflow that you no longer participate.</i>';
                                                                    //    html += '<br />';
                                                                    //    //html += '<hr />';


                                                                    //    //html += '<table>';
                                                                    //    //html += '    <tr><td>&nbsp;</td><td></td></tr>';
                                                                    //    //html += '    <tr><td>This functionality is incomplete, we are working on it. Dev notes:</td></tr>';
                                                                    //    //html += '    <tr><td>- Mark the participant as unsubscribed in the database.</td></tr>';
                                                                    //    //html += '    <tr><td>- Notify the tenant owner that the user has chosen to unsubscribe.</td></tr>';
                                                                    //    //html += '    <tr><td>- Notify participants in the workflow that the user has chosen to unsubscribe.</td></tr>';
                                                                    //    //html += '    <tr><td>- Somehow we have to have a way for them to substitute the user in any functional areas, and places where an approval process will get held up.</td></tr>';
                                                                    //    //html += '    <tr><td>- Perhaps disable a financial area where they are involved until they have had a replacement assigned.</td></tr>';
                                                                    //    //html += '</table>';
                                                                    //    //html += '';
                                                                    //    //html += '';
                                                                    //    //html += '';
                                                                    //    // LOOK AT THIS LINE!!!!!!!!!!!!! DOES IT WORK?????????????????????????? 8-7-2020
                                                                    //    //html += '<input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->';
                                                                    //    $('#divWelcomeMessage').html(html);

                                                                    //    $('#divWelcomeMasterDivTitle').text('Unsubscribe');

                                                                    //    //$('#divMenuMasterDivWelcomeButton').css({
                                                                    //    //    'height': '28px', 'width': '92%', 'white-space': 'nowrap', 'border-radius': '0 0 0 0', 'padding': '12px 0 0 20px', 'margin': '0 0 0 0', 'border-width': '0 0 0 0', 'background-color': '#6682b5', 'color': 'white', 'outline': 'none', 'cursor': 'pointer'
                                                                    //    //});
                                                                    //    //$('#divMenuMasterDivWelcomeButton').click(function () {
                                                                    //    //    window.location = 'my.html?logontype=' + participantLogonType;
                                                                    //    //});

                                                                    //    document.getElementById('divWelcomePageLeftButtonsWelcomeButton').className = 'divLeftButton';
                                                                    //    $('#divWelcomePageLeftButtonsWelcomeButton').click(function () {
                                                                    //        debugger;
                                                                    //        renderWelcomeScreen();
                                                                    //        // window.location = 'my.html?logontype=' + participantLogonType;
                                                                    //    });



                                                                    //    //} else if (tenantId == null) { // USER HAS LOGGED IN FOR THE FIRST TIME AND DOESN'T HAVE A TenantId.
                                                                    //    //    // A user has logged in for the first time. They should be able to initialize their new system, and choose that they may have received an invitation so warn them if it didn't work correctly.

                                                                    //    //    cmdCreateANewTenant();
                                                                    //    //    //}



                                                                    //} else { // USER HAS LOGGED IN BEFORE AND HAS A TenantId.


                                                                    //    //displayAlertDialog('USER HAS LOGGED IN BEFORE AND HAS A TenantId: ' + tenantId);


                                                                    //}
                                                                }
                                                                //debugger;
                                                                // Apply Participant configurations to the display.
                                                                if (tipsDisplayOn == true) {
                                                                    //$('#spanAlertLink').html('Tips!&nbsp;&nbsp;&nbsp;&nbsp;');
                                                                    //$('#spanAlertLinkNewRequest').html('Tips!&nbsp;&nbsp;&nbsp;&nbsp;');
                                                                    //$('#spanAlertLinkMyStuff').html('Tips!&nbsp;&nbsp;&nbsp;&nbsp;');
                                                                    //$('#spanAlertLinkSummary').html('Tips!&nbsp;&nbsp;&nbsp;&nbsp;');
                                                                    //$('#spanAlertLinkConfiguration').html('Tips!&nbsp;&nbsp;&nbsp;&nbsp;');
                                                                    //$('#spanAlertLinkHelp').html('Tips!&nbsp;&nbsp;&nbsp;&nbsp;');
                                                                    $('#spanAlertLink').show();
                                                                    $('#spanAlertLinkNewRequest').show();
                                                                    $('#spanAlertLinkMyStuff').show();
                                                                    $('#spanAlertLinkSummary').show();
                                                                    $('#spanAlertLinkConfiguration').show();
                                                                    $('#spanAlertLinkHelp').show();
                                                                } //else {
                                                                //$('#spanAlertLink').html('&nbsp;');
                                                                //$('#spanAlertLinkNewRequest').html('&nbsp;');
                                                                //$('#spanAlertLinkMyStuff').html('&nbsp;');
                                                                //$('#spanAlertLinkSummary').html('&nbsp;');
                                                                //$('#spanAlertLinkConfiguration').html('&nbsp;');
                                                                //$('#spanAlertLinkHelp').html('&nbsp;');
                                                                //}

                                                                // Check to show the Invitation section on the home page.
                                                                // displayInvitationsOnHomePageDisplayOn

                                                            } catch (e) {
                                                                //debugger; // 8-10-2020 IF YOU GET HERE YAY CODE COMPILED!
                                                                console.log('Exception in 3423423: ' + e.message + ', ' + e.stack);
                                                                displayAlertDialog('Exception in 3423423: ' + e.message + ', ' + e.stack);
                                                            }



                                                        },
                                                        error: function (data, errorCode, errorMessage) {
                                                            //debugger;
                                                            console.log('Error in my.js.renderWelcomeScreen():GET bwworkflowapplicenses:' + errorMessage);
                                                            displayAlertDialog('Error in my.js.renderWelcomeScreen():GET bwworkflowapplicenses:' + errorMessage);
                                                            //WriteToErrorLog('Error in InitBudgetRequest.js.cmdCreateBudgetRequest()', 'Error creating the budget request in budgetrequests library: ' + errorCode + ', ' + errorMessage);
                                                        }
                                                    });
                                                    //}




                                                } catch (e) {
                                                    //debugger;
                                                    console.log('Exception in my.js.renderWelcomeScreen():6:.RequestTypes().xx.Get:1: ' + e.message + ', ' + e.stack);
                                                    displayAlertDialog('Exception in my.js.renderWelcomeScreen():6:.RequestTypes().xx.Get:1: ' + e.message + ', ' + e.stack);
                                                }

                                                //}).fail(function (data) {
                                            },
                                            error: function (data, errorCode, errorMessage) {

                                                //lpSpinner.Hide();
                                                //debugger;
                                                console.log('In bwAuthentication.renderWelcomeScreen():6:.RequestTypes.fail(): ' + JSON.stringify(data));
                                                var msg;
                                                if (JSON.stringify(data).indexOf('The specified URL cannot be found.') > -1) {
                                                    msg = 'There has been an error contacting the server. A firewall or network appliance may be interrupting this traffic.';
                                                } else {
                                                    msg = JSON.stringify(data);
                                                }
                                                displayAlertDialog('Exception in bwAuthentication.renderWelcomeScreen.RequestTypes():6: ' + msg); //+ error.message.value + ' ' + error.innererror.message); // 
                                                console.log('Exception in bwAuthentication.renderWelcomeScreen.RequestTypes():6: ' + JSON.stringify(data));
                                                //console.log('Fail in CarForm3.aspx.populateSpendForecastNotReadOnly().spendForecastItems.update: ' + JSON.stringify(data));
                                                //var error = JSON.parse(data.responseText)["odata.error"];
                                                //alert('Exception in CarForm3.aspx.populateSpendForecastNotReadOnly().spendForecastItems.update: ' + error.message.value + ' ' + error.innererror.message); // + ', EntityValidationErrors: ' + data.EntityValidationErrors);
                                            }
                                        });
                                    }
                                }
                            }

                        } catch (e) {
                            console.log('Error in bwAuthentication.renderWelcomeScreen():5:' + e.message + ', ' + e.stack);
                            displayAlertDialog('Error in bwAuthentication.renderWelcomeScreen():5:' + e.message + ', ' + e.stack);
                        }

                    },
                    error: function (data, errorCode, errorMessage) {

                        if (data.status != 401) {
                            console.log('Error in bwAuthentication.renderWelcomeScreen.xx.error(). ' + errorMessage + ' data.status:' + data.status);
                            displayAlertDialog('Error in bwAuthentication.renderWelcomeScreen.xx.error(). ' + errorMessage + ' data.status:' + data.status);
                        }

                    }
                });
            }

            try {
                // This throws exception when logging into the back end.
                $('#spanAlertLink').qtip({
                    content: {
                        text: '<span style="font-size:18px;">Click here to display the tips!</span>'
                    },
                    position: {
                        at: 'left bottom'
                    }
                    //position: { at: 'left center', adjust: { method: 'Shift' } },
                    //style: { tip: { corner: true } }
                });
            } catch (e) { }
            //$('#spanAlertLink').qtip('toggle', true);

        } catch (e) {
            console.log('Exception in getRemainingParticipantDetailsAndWorkflowAppTitle(): ' + e.message + ', ' + e.stack);
            this.displayAlertDialog('Exception in getRemainingParticipantDetailsAndWorkflowAppTitle(). There was a problem logging you in. Please try again. Error: ' + e.message + ', ' + e.stack);
        }
    },



    cmdSaveWorkflowExternallyFacingUrlForAttachments: function () {
        try {
            console.log('In bwAuthentication.js.cmdSaveWorkflowExternallyFacingUrlForAttachments().');
            var thiz = this;

            var workflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
            var participantId = $('.bwAuthentication').bwAuthentication('option', 'participantId');
            var participantEmail = $('.bwAuthentication').bwAuthentication('option', 'participantEmail');
            var participantFriendlyName = $('.bwAuthentication').bwAuthentication('option', 'participantFriendlyName');

            var url = $('#txtWorkflowAppExternallyFacingUrlForAttachments').val();

            var json = {
                bwWorkflowAppId: workflowAppId,
                bwParticipantId: participantId,
                bwParticipantFriendlyName: participantFriendlyName,
                bwParticipantEmail: participantEmail,
                url: url
            };
            $.ajax({
                url: this.options.operationUriPrefix + '_files/SaveExternallyFacingUrl',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(json),
                success: function (result) {
                    try {

                        if (result.message == 'SUCCESS') {

                            displayAlertDialog('New publically shared attachments will use this URL.');

                        } else {
                            displayAlertDialog(JSON.stringify(result));
                        }

                    } catch (e) {
                        console.log('Exception in bwAuthentication.js.cmdSaveWorkflowExternallyFacingUrlForAttachments(): ' + e.message + ', ' + e.stack);
                        displayAlertDialog('Exception in bwAuthentication.js.cmdSaveWorkflowExternallyFacingUrlForAttachments(): ' + e.message + ', ' + e.stack);
                    }
                },
                error: function (data, errorCode, errorMessage) {
                    console.log('Error in bwAuthentication.js.cmdSaveWorkflowExternallyFacingUrlForAttachments(): ' + errorCode + ', ' + errorMessage);
                    displayAlertDialog('Error in bwAuthentication.js.cmdSaveWorkflowExternallyFacingUrlForAttachments(): ' + errorCode + ', ' + errorMessage);
                }
            });

        } catch (e) {
            console.log('Exception in bwAuthentication.js.cmdSaveWorkflowExternallyFacingUrlForAttachments(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.cmdSaveWorkflowExternallyFacingUrlForAttachments(): ' + e.message + ', ' + e.stack);
        }
    },
    cmdSaveWorkflowExternallyFacingUrlForAttachmentsSourceFolder: function () {
        try {
            console.log('In bwAuthentication.js.cmdSaveWorkflowExternallyFacingUrlForAttachments().');
            var thiz = this;

            var workflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
            var participantId = $('.bwAuthentication').bwAuthentication('option', 'participantId');
            var participantEmail = $('.bwAuthentication').bwAuthentication('option', 'participantEmail');
            var participantFriendlyName = $('.bwAuthentication').bwAuthentication('option', 'participantFriendlyName');

            var sourceFolder = $('#txtWorkflowAppExternallyFacingUrlForAttachmentsSourceFolder').val();

            var json = {
                bwWorkflowAppId: workflowAppId,
                bwParticipantId: participantId,
                bwParticipantFriendlyName: participantFriendlyName,
                bwParticipantEmail: participantEmail,
                sourceFolder: sourceFolder
            };
            $.ajax({
                url: this.options.operationUriPrefix + '_files/SaveExternallyFacingUrlSourceFolder',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(json),
                success: function (result) {
                    try {

                        if (result.message == 'PATH_EXISTS_WITH_READ_WRITE_PERMISSIONS_AND_BWWORKFLOWAPP_UPDATED') {

                            displayAlertDialog('This path exists and has been updated.<br />New publically shared attachments will use this location.');

                        } else {
                            displayAlertDialog(JSON.stringify(result));
                        }

                    } catch (e) {
                        console.log('Exception in bwAuthentication.js.cmdSaveWorkflowExternallyFacingUrlForAttachmentsSourceFolder(): ' + e.message + ', ' + e.stack);
                        displayAlertDialog('Exception in bwAuthentication.js.cmdSaveWorkflowExternallyFacingUrlForAttachmentsSourceFolder(): ' + e.message + ', ' + e.stack);
                    }
                },
                error: function (data, errorCode, errorMessage) {
                    console.log('Error in bwAuthentication.js.cmdSaveWorkflowExternallyFacingUrlForAttachmentsSourceFolder(): ' + errorCode + ', ' + errorMessage);
                    displayAlertDialog('Error in bwAuthentication.js.cmdSaveWorkflowExternallyFacingUrlForAttachmentsSourceFolder(): ' + errorCode + ', ' + errorMessage);
                }
            });

        } catch (e) {
            console.log('Exception in bwAuthentication.js.cmdSaveWorkflowExternallyFacingUrlForAttachmentsSourceFolder(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.cmdSaveWorkflowExternallyFacingUrlForAttachmentsSourceFolder(): ' + e.message + ', ' + e.stack);
        }
    },

    renderHomePagePersonalizedSection_AndRenderButtons: function () {
        try {
            console.log('In bwAuthentication.js.renderHomePagePersonalizedSection_AndRenderButtons().');
            //alert('In renderHomePagePersonalizedSection_AndRenderButtons().');

            var workflowAppId = this.options.workflowAppId; //$('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
            var developerModeEnabled = this.options.developerModeEnabled; //$('.bwAuthentication').bwAuthentication('option', 'developerModeEnabled');

            // Get the custom organization image. If none found, use the default one specified in the html.
            var preventCachingGuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });

            //var imagePath = globalUrlPrefix + globalUrl + '/_files/' + workflowAppId + '/orgimages/' + 'root' + '/' + 'orgimage.png?v=' + imageVersionGuid; // This just makes sure a fresh image is loaded every time. No caching.



            var imagePath;

            var activeStateIdentifier = JSON.parse($('.bwAuthentication:first').bwAuthentication('getActiveStateIdentifier'));

            if (activeStateIdentifier.status != 'SUCCESS') {

                imagePath = '[No image. Unauthorized. xcx213124-34556-34-234]';

            } else {

                //html += '<img id="attachmentstest1" xcx="xcx2312-2-2" src="' + thiz.options.operationUriPrefix + fileUrl_Thumbnail + '?v=' + preventCachingGuid + '&ActiveStateIdentifier=' + activeStateIdentifier.ActiveStateIdentifier + '" style="height:120px;display:block;margin-left:auto;margin-right:auto;cursor:pointer;max-width:250px;border:1px solid gray;border-radius:0 30px 0 0;" alt="" ';

                imagePath = this.options.operationUriPrefix + '_files/' + workflowAppId + '/orgimages/' + 'root' + '/' + 'orgimage.png?v=' + preventCachingGuid + '&ActiveStateIdentifier=' + activeStateIdentifier.ActiveStateIdentifier;

            }










            if (!document.getElementById('orgImage_root_blueheaderbar')) {
                console.log('ERROR: FAILED TO set orgImage_root_blueheaderbar attribute "title". xcx3386');
                alert('ERROR: FAILED TO set orgImage_root_blueheaderbar attribute "title". xcx3386');
            } else {
                document.getElementById('orgImage_root_blueheaderbar').title = workflowAppId; // On hover, the user will see the bwWOrkflowAppId. Get rid of this for production, but keep here for a year or so for testing.

                //
                // THIS IS THE ABILITY TO CLICK ON THE TOP LEFT IMAGE TO CHANGE IT FROM THE HOME PAGE.
                // Turned off for now. 4-29-2022
                //
                //$('#orgImage_root_blueheaderbar').off('click').click(function (error) {
                //    try {
                //        console.log('In renderHomePagePersonalizedSection_AndRenderButtons.orgImage_root_blueheaderbar.click().');
                //        alert('In renderHomePagePersonalizedSection_AndRenderButtons.orgImage_root_blueheaderbar.click().');

                //        debugger;
                //        if (!$('.bwOrganizationEditor').is('.bwOrganizationEditor')) {
                //            $('#divBwOrganizationEditor').bwOrganizationEditor();
                //        }
                //        setTimeout(function () {
                //            debugger;
                //            //$('.bwOrganizationEditor').bwOrganizationEditor('displayOrgRoleEditorInACircle', true, 'root', 'undefined', 'undefined', 'undefined');
                //            $('.bwOrganizationEditor').bwOrganizationEditor('displayOrgRoleEditorInACircle', true, 'root');
                //        }, 2000);


                //    } catch (e) {
                //        console.log('Exception in deleteARequestType.click(): ' + e.message + ', ' + e.stack);
                //        displayAlertDialog('Exception in deleteARequestType.click(): ' + e.message + ', ' + e.stack);
                //    }
                //});

            }

            var lookForOrgImage = function (imagePath) {
                return new Promise(function (resolve, reject) {
                    $.get(imagePath).done(function () {
                        var img = new Image();
                        img.src = imagePath;
                        img.onload = function (e) {
                            try {

                                // This automaticagically populates the image at the top left of the top blue bar. 8-20-2020
                                document.getElementById('orgImage_root_blueheaderbar').src = imagePath;

                            } catch (e) {
                                console.log('Exception in renderLeftButtons().img.onload(): ' + e.message + ', ' + e.stack);

                                document.getElementById('orgImage_root_blueheaderbar').src = globalUrlPrefix + globalUrl + '/images/corporeal.png'; // We do this here so that if a user switches between organizations, the correct logo is always displayed in the top left corner.

                                reject();
                            }
                        }
                    }).fail(function () {
                        // do nothing, it just didn't find an image.
                        document.getElementById('orgImage_root_blueheaderbar').src = globalUrlPrefix + globalUrl + '/images/corporeal.png'; // We do this here so that if a user switches between organizations, the correct logo is always displayed in the top left corner.

                        resolve();
                    });
                });
            }
            //alert('imagePath: ' + imagePath);
            lookForOrgImage(imagePath);


            //try {

            if (!document.getElementById('tableMainMenu1')) {
                console.log('ELEMENT tableMainMenu1 DOES NOT EXIST IN THE DOM xcx3245');
                alert('ELEMENT tableMainMenu1 DOES NOT EXIST IN THE DOM xcx3245');
            } else {
                document.getElementById('tableMainMenu1').style.display = 'inline';
            }

            console.log('Calling bwActiveMenu_Admin.adjustLeftSideMenu(). No timer setTimeout(). xcx123423521-3.');
            $('.bwActiveMenu').bwActiveMenu('adjustLeftSideMenu');

            //window.onresize = function () {
            //    console.log('In bwAuthentication.js.window.resize(). Calling adjustLeftSideMenu().');
            //    $('.bwActiveMenu').bwActiveMenu('adjustLeftSideMenu');
            //}

            console.log('Getting selected organization xcx23543654');
            var selectedOrganization = this.getSelectedOrganization(); //$('.bwAuthentication').bwAuthentication('getSelectedOrganization');

            if (selectedOrganization.OrganizationTitle) { // This may not be necessary as this methos gets called twice in the beginning, the first time th evalue is null, keep an eye on this maybe fix it up sometime. 9-9-2021
                var organizationNameInUppercase = selectedOrganization.OrganizationTitle.toUpperCase();
                $('#divTopBar_OrganizationName').html(organizationNameInUppercase); // This populates the organization name in the top bar. // 9-6-2021
            }

            this.securityTrimTheLeftMenuButtons(); //$('.bwAuthentication').bwAuthentication('securityTrimTheLeftMenuButtons');

            var html = '';

            //html += '<div id="divBwTipsCarousel"></div>';
            html += '<div id="divBwInvitation"></div>';
            html += '<br />';





            html += '<div id="divBwExecutiveSummariesCarousel2">';

            // Trying out a progress bar here. 8-1-2022
            //html += '<div id="divBwActivitySpinner_WaitingForAjax"></div>';

            //
            //
            // THIS IS THE "Loading..." ACTIVITY SPINNER FOR THE HOME PAGE EXECUTIVE SUMMARIES CAROUSEL. 8-18-2023.
            //
            //
            html += '<div id="bwExecutiveSummariesCarousel2_divActivitySpinner_WorkingOnItDialog" style="display:inline;">';
            html += '   <div style="white-space:nowrap;color: rgb(38, 38, 38); font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif; font-size: 2.77em;">';
            //html += '       &nbsp;&nbsp;<img style="width:100px;height:100px;vertical-align:middle;white-space:nowrap;" src="/images/ajax-loader.gif" />&nbsp;&nbsp;<span id="divActivitySpinner_WorkingOnItDialog_spinnerText" style="font-size:25pt;white-space:nowrap;">Working on it...</span>';
            html += '       &nbsp;&nbsp;<img style="width:100px;height:100px;vertical-align:middle;white-space:nowrap;" src="/images/ajax-loader.gif" />&nbsp;&nbsp;<span id="divActivitySpinner_WorkingOnItDialog_spinnerText" style="font-size:25pt;white-space:nowrap;">Loading...</span>';
            html += '   </div>';
            html += '</div>';

            html += '</div>';





            html += '<br />';
            html += '<table>';
            html += '   <tr>';
            html += '       <td style="vertical-align:top;">';
            html += '           <div id="divHomePageAlert"></div>';
            html += '       </td>';
            html += '       <td style="vertical-align:top;">';

            html += '           <div id="tdExecutiveSummaries" class="tdExecutiveSummaries"  style="border:1px dotted red;vertical-align:top;display:none;">';

            html += '</div>';

            html += '       </td>';
            html += '   </tr>';
            html += '</table>';
            html += '<br /><br />';

            if (selectedOrganization.OrganizationRole == 'owner') {
                // Make sure the relevent configuration items are displayed. 
                html += '<hr />';
                html += '<span style="cursor:help;" title="There is only one owner.">You are the owner of this budget request system.</span>';
                html += '<br /><br />';
                $('#spanHomePagePersonalizedSection').html(html);

                $('#divBwInvitation').bwInvitation({}); // Instantiate the tips widget.

                if (displayInvitationsOnHomePageDisplayOn == true) {
                    $('#divInvitationSectionOnHomePage').show();
                } else {
                    $('#divInvitationSectionOnHomePage').hide();
                }


                //$('#divBwActivitySpinner_WaitingForAjax').bwActivitySpinner_FileUpload({});
                //$('#divBwActivitySpinner_WaitingForAjax').bwActivitySpinner_FileUpload('show', 'XCX12342523463765756876867');






                console.log('In bwAuthentication.js.xx(). WE WERE CALLING renderAlerts2() BUT NOW INSTANTIATING an empty bwExecutiveSummariesCarousel2. This widget will take over the loading of the data in an optimized way.');
                //alert('In bwAuthentication.js.xx(). WE WERE CALLING renderAlerts2() BUT NOW INSTANTIATING an empty bwExecutiveSummariesCarousel2. This widget will take over the loading of the data in an optimized way.');
                //this.renderAlerts2('thisistheone_maybe'); // xcx3
                $('#divBwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2({}); // We start with an empty carousel.


                //
                // THIS IS WHAT IS PRESENTLY HAPPENING THROUGH THE METHOD CALLS 8-30-2023.
                //
                //var html = bwCommonScripts.generateCustomerHomePageNotificationScreenHtml(1, appweburl, workflowAppId, myBrData, false); // this is a promise
                //var html = bwCommonScripts.generateCustomerHomePageNotificationScreenHtml(1, appweburl, workflowAppId, null, false); 


                //
                // end: THIS IS WHAT IS PRESENTLY HAPPENING THROUGH THE METHOD CALLS
                //



                //renderTenantOwnerStuff();

            } else if (selectedOrganization.OrganizationRole == 'customer') {

                // 1-21-2022
                html += '<table>';
                html += '   <tr>';
                html += '       <td style="vertical-align:top;">';
                html += '           <div id="divHomePageAlert"></div>';
                html += '       </td>';
                html += '       <td style="vertical-align:top;">';
                html += '           <div id="tdExecutiveSummaries" class="tdExecutiveSummaries"  style="border:1px dotted red;vertical-align:top;display:none;"></div>';
                html += '       </td>';
                html += '   </tr>';
                html += '</table>';

                html += '<br /><br /><hr />';
                html += 'You are a customer of this organization.<br /><br />';
                //html += '<i><a href="javascript:cmdUpgradeAndPricingOptions();">Click here to learn about upgrade options</a></i>';
                $('#spanHomePagePersonalizedSection').html(html);

                $('#divBwInvitation').html('<br /><br /><br /><br /><br /><br /><br /><br />'); // Fill in the space since we are not instantiating the widget.

                this.renderAlerts2('xcx4'); // xcx4
                //renderTenantOwnerStuff();

            } else if (selectedOrganization.OrganizationRole == 'vendor') {

                // 1-21-2022
                html += '<table>';
                html += '   <tr>';
                html += '       <td style="vertical-align:top;">';
                html += '           <div id="divHomePageAlert"></div>';
                html += '       </td>';
                html += '       <td style="vertical-align:top;">';
                html += '           <div id="tdExecutiveSummaries" class="tdExecutiveSummaries"  style="border:1px dotted red;vertical-align:top;display:none;"></div>';
                html += '       </td>';
                html += '   </tr>';
                html += '</table>';

                html += '<br /><br /><hr />';
                html += 'You are a vendor to this organization.<br /><br />';
                //html += '<i><a href="javascript:cmdUpgradeAndPricingOptions();">Click here to learn about upgrade options</a></i>';
                $('#spanHomePagePersonalizedSection').html(html);

                $('#divBwInvitation').html('<br /><br /><br /><br /><br /><br /><br /><br />'); // Fill in the space since we are not instantiating the widget.

                this.renderAlerts2('xcx4'); // xcx4
                //renderTenantOwnerStuff();

            } else if (selectedOrganization.OrganizationRole == 'participant') {

                // 1-21-2022
                html += '<table>';
                html += '   <tr>';
                html += '       <td style="vertical-align:top;">';
                html += '           <div id="divHomePageAlert"></div>';
                html += '       </td>';
                html += '       <td style="vertical-align:top;">';
                html += '           <div id="tdExecutiveSummaries" class="tdExecutiveSummaries"  style="border:1px dotted red;vertical-align:top;display:none;"></div>';
                html += '       </td>';
                html += '   </tr>';
                html += '</table>';

                html += '<br /><br /><hr />';
                html += 'You are a participant (participant) in this budget request system.<br /><br />';
                //html += '<i><a href="javascript:cmdUpgradeAndPricingOptions();">Click here to learn about upgrade options</a></i>';
                $('#spanHomePagePersonalizedSection').html(html);

                $('#divBwInvitation').html('<br /><br /><br /><br /><br /><br /><br /><br />'); // Fill in the space since we are not instantiating the widget.

                this.renderAlerts2('xcx4'); // xcx4
                //renderTenantOwnerStuff();

            } else if (selectedOrganization.OrganizationRole == 'archiveviewer') {

                html += '<br />';
                html += '<br /><br />';
                html += '<div id="divHomePageAlert"></div>';
                html += '<br /><br /><hr />';
                html += 'You are a participant (archiveviewer) in this budget request system.<br /><br />';
                //html += '<i><a href="javascript:cmdUpgradeAndPricingOptions();">Click here to learn about upgrade options</a></i>';
                $('#spanHomePagePersonalizedSection').html(html);

                $('#divBwInvitation').html('<br /><br /><br /><br /><br /><br /><br /><br />'); // Fill in the space since we are not instantiating the widget.

                this.renderAlerts2('xcx5'); // xcx5
                //renderTenantOwnerStuff();

            } else if (selectedOrganization.OrganizationRole == 'reportviewer') {

                html += '<br />';
                html += '<br /><br />';

                // 1-21-2022
                html += '<table>';
                html += '   <tr>';
                html += '       <td style="vertical-align:top;">';
                html += '           <div id="divHomePageAlert"></div>';
                html += '       </td>';
                html += '       <td style="vertical-align:top;">';

                // todd 8-9-2021 5-34pm adt
                html += '           <div id="tdExecutiveSummaries" class="tdExecutiveSummaries"  style="border:1px dotted red;vertical-align:top;display:none;"></div>';
                html += '       </td>';
                html += '   </tr>';
                html += '</table>';
                html += '<br /><br /><hr />';
                html += 'You are a participant (reportviewer) in this budget request system.<br /><br />';
                //html += '<i><a href="javascript:cmdUpgradeAndPricingOptions();">Click here to learn about upgrade options</a></i>';
                $('#spanHomePagePersonalizedSection').html(html);

                $('#divBwInvitation').html('<br /><br /><br /><br /><br /><br /><br /><br />'); // Fill in the space since we are not instantiating the widget.

                this.renderAlerts2('xcx6'); // xcx6
                //renderTenantOwnerStuff();

            } else if (selectedOrganization.OrganizationRole == 'configurationmanager') {
                // Hide the relevant stuff in the configuration section.
                //alert('configurationmanager');

                html += '<hr />';
                html += 'You are a participant (configurationmanager) in this budget request system.';
                html += '<br /><br />';
                //html += '<i><a href="javascript:cmdUpgradeAndPricingOptions();">Click here to learn about upgrade options</a></i>';
                $('#spanHomePagePersonalizedSection').html(html);

                $('#divBwInvitation').bwInvitation({}); // Instantiate the tips widget.

                if (displayInvitationsOnHomePageDisplayOn == true) {
                    $('#divInvitationSectionOnHomePage').show();
                } else {
                    $('#divInvitationSectionOnHomePage').hide();
                }

                debugger;
                this.renderAlerts2('xcx7');
                //renderTenantOwnerStuff();

            } else {

                html += '<br />';
                html += '<br /><br />ERROR';

                html += '<table>';
                html += '   <tr>';
                html += '       <td style="vertical-align:top;">';
                html += '           <div id="divHomePageAlert"></div>';
                html += '       </td>';
                html += '       <td style="vertical-align:top;">';

                // todd 8-9-2021 5-34pm adt
                html += '           <div id="tdExecutiveSummaries" class="tdExecutiveSummaries"  style="border:1px dotted red;vertical-align:top;display:none;"></div>';

                html += '       </td>';
                html += '   </tr>';
                html += '</table>';

                html += '<br />';
                html += '<br /><br /><hr />';
                html += 'You are neither an owner or participant (no role xcx05013) in this budget request system.<br /><br />';
                //html += '<i><a href="javascript:cmdUpgradeAndPricingOptions();">Click here to learn about upgrade options</a></i>';
                $('#spanHomePagePersonalizedSection').html(html);

                $('#divBwInvitation').html('<br /><br /><br /><br /><br /><br /><br /><br />'); // Fill in the space since we are not instantiating the widget.

                this.renderAlerts2();
                //renderTenantOwnerStuff();

            }

            var requestId1 = this.getUrlParams('request');
            //try {

            if (requestId1) {

                console.log('UUUUUUUUUUUUUUUUUUUUUUUUUUUUU xcx123199-1');
                console.log('xcx234324324-5 getUrlParams [request]. In bwAuthentication.js.renderHomePagePersonalizedSection_AndRenderButtons(). getUrlParams()[\'request\']: ' + requestId1 + ', calling displayArInDialog().');
                console.log('UUUUUUUUUUUUUUUUUUUUUUUUUUUUU xcx123199-1');

                $('.bwRequest').bwRequest('displayArInDialog', 'https://budgetworkflow.com', requestId1, '', '', '', '');

            } //else if (this.getUrlParams()['request_poppedout']) {

            //console.log('UUUUUUUUUUUUUUUUUUUUUUUUUUUUU');
            //console.log('xcx234324324-5-2 getUrlParams [request_poppedout]. In bwAuthentication.js.renderHomePagePersonalizedSection_AndRenderButtons().');
            //console.log('UUUUUUUUUUUUUUUUUUUUUUUUUUUUU');

            //bwBudgetRequestId = this.getUrlParams()['request_poppedout'].toString().split('#')[0];

            ////var rect = document.getElementById(requestDialogId).getBoundingClientRect();
            //var height = 700; //?????????? //rect.bottom - rect.top;
            //var width = 700; //??????????? //rect.right - rect.left;

            //// When opening a request in a new browser window, we need to use a distinct url. For example: https://budgetworkflow.com/?ActiveStateIdentifier=3e4e2de9-7d5b-476f-a34e-a4eaa0472b44&request=4691d358-c148-4df8-aa1b-70ee1bde0cc0

            ////var activeStateIdentifier = JSON.parse($('.bwAuthentication:first').bwAuthentication('getActiveStateIdentifier')).ActiveStateIdentifier;
            //var activeStateIdentifier = 'xcx324654747';

            ////var url = this.options.operationUriPrefix + '?ActiveStateIdentifier=' + activeStateIdentifier + '&request=' + bwBudgetRequestId + '&taskid=' + bwWorkflowTaskItemId + '&openrequest=1';
            //var url = this.options.operationUriPrefix + '?ActiveStateIdentifier=' + activeStateIdentifier + '&request=' + bwBudgetRequestId + '&openrequest=1';



            //if (!window) {
            //    alert('xcx21312421 NO WINDOW OBJECT');
            //}




            //// When the window.open is called, bwAuthentication.js.checkIfAuthenticatedAndProcessQuerystringParameters() handles the loading of the request form... by calling bwRequest.js.displayRequestFormInNewBrowserWindow().
            ////$('#' + requestDialogId).dialog({ bwForceClose: true }); // Doing this at the top so we avoid a race condition. Keep this here for readability.
            //var requestDialogId = 'divRequestFormDialog_' + bwBudgetRequestId;
            //var windowObjectReference = window.open(url, requestDialogId, 'toolbar=no,width=' + width + ',height=' + height + ',left=500,top=200,status=no,scrollbars=no,resize=no,location=0');

            //if (!windowObjectReference) {

            //    // The window wasn't allowed to open. This is likely caused by built-in popup blockers.
            //    displayAlertDialog('The window wasn\'t allowed to open. This is likely caused by built-in popup blockers. url: ' + url);

            //} else {

            //    // Store this instance of a popped-out window in bwAuthentication.options.poppedOutRequestWindows
            //    var poppedOutRequestWindows = $('.bwAuthentication:first').bwAuthentication('option', 'poppedOutRequestWindows');
            //    if (!(poppedOutRequestWindows && poppedOutRequestWindows.length)) {
            //        poppedOutRequestWindows = [];
            //    }
            //    var poppedOutWindow = {
            //        requestDialogId: requestDialogId,
            //        bwBudgetRequestId: bwBudgetRequestId,
            //        bwWorkflowTaskItemId: bwWorkflowTaskItemId,
            //        windowObjectReference: windowObjectReference
            //    }
            //    poppedOutRequestWindows.push(poppedOutWindow);
            //    $('.bwAuthentication:first').bwAuthentication({ poppedOutRequestWindows: poppedOutRequestWindows });

            //}

            //}

            //} catch (e) {

            //    // Don't need to see this error. 12-26-2021.
            //    console.log('Exception in bwAuthentication.js.renderHomePagePersonalizedSection():3: ' + e.message + ', ' + e.stack);
            //    alert('Exception in bwAuthentication.js.renderHomePagePersonalizedSection():3: ' + e.message + ', ' + e.stack);

            //}

        } catch (e) {
            console.log('Exception in renderHomePagePersonalizedSection():1: ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in renderHomePagePersonalizedSection():1: ' + e.message + ', ' + e.stack);
        }
    },


    renderAlerts2: function (invocationLocation) {
        try {
            // Render the pending items. Only do this if the home page is displayed!!!
            console.log('In renderAlerts2(). invocationLocation: ' + invocationLocation);

            if (invocationLocation == 'thisistheone_maybe') {
                alert('In renderAlerts2(). invocationLocation: ' + invocationLocation + '. THIS SHOULD LOAD EMPTY BECAUSE DATA SHOULD NOT HAVE BEEN CALLED FOR YET. THIS is our new optimized loading/minimal traffic process. On-demand, with pre-load/lazy-load.');
            } else {
                alert('In renderAlerts2(). invocationLocation: ' + invocationLocation);
            }

            var thiz = this;

            var tenantId = this.options.tenantId; //$('.bwAuthentication').bwAuthentication('option', 'tenantId');
            var workflowAppId = this.options.workflowAppId; //$('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
            var participantId = this.options.participantId; //$('.bwAuthentication').bwAuthentication('option', 'participantId');
            var participantEmail = this.options.participantEmail; //$('.bwAuthentication').bwAuthentication('option', 'participantEmail');

            var selectedOrganization = $('.bwAuthentication').bwAuthentication('getSelectedOrganization');

            if (selectedOrganization.OrganizationRole == 'customer') {

                alert('Calling bwActiveMenu_Admin.adjustLeftSideMenu(). xcx123423521-4.');
                $('.bwActiveMenu').bwActiveMenu('adjustLeftSideMenu');

                var queryData = {
                    bwTenantId: tenantId,
                    bwWorkflowAppId: workflowAppId,
                    bwParticipantId: participantId,
                    bwParticipantEmail: participantEmail
                };
                var deferredIndex = 'bwExecutiveSummariesCarousel2'; // We only have 1 workflow to display, but if we want to display multiple, use this value. 
                alert('Calling generateCustomerHomePageNotificationScreen(). xcx1231231231.');
                var promise = thiz.generateCustomerHomePageNotificationScreen(deferredIndex, queryData);  // generateHomePageNotificationScreen(deferredIndex, queryData);
                promise.then(function (result) {
                    try {
                        debugger;
                        //// 2-12-2022 Place the executive summaries at the top.
                        //if (developerModeEnabled == true) {
                        //    var html = '';
                        //    html += result.html.html;
                        //    $('#divHomePageAlert').html(html);
                        //}
                        alert('CALLING WRONG CAROUSEL..????????');
                        $('#divBwExecutiveSummariesCarousel2').bwCustomerSummariesCarousel({ myBrData: result.myBrData }); // Since we already made the web service call, we may as well re-use it this way.




                        //var html = '';
                        //html += 'Display requests that this customer has access to. xcx23142353.';
                        //html += '';
                        //html += '';
                        //$('#divHomePageAlert').html(html);




                    } catch (e) {
                        console.log('Exception in bwAuthentication.js.renderAlerts2():1334-2: ' + e.message + ', ' + e.stack);
                        displayAlertDialog('Exception in bwAuthentication.js.renderAlerts2():1334-2: ' + e.message + ', ' + e.stack);
                    }
                });

            } else {

                var developerModeEnabled = this.options.developerModeEnabled; //$('.bwAuthentication').bwAuthentication('option', 'developerModeEnabled');

                //
                //  // 7-18-2020 TURNING OFF THIS REGULAR CHECK FOR THE MOMENT UNTIL I GET THE NEW APPROACH WITH THE bwParticipant table "participantHasNothingNewInThisAppSinceTheyLastChecked" field!!!!!!
                // renderAlerts2('xcx1'); <<<< search for this. The timer action 15 seconds happens in timedCheckForAlertsForIosBadgeUpdateUsingTitle().
                //
                //
                var aDialogWindowIsOpen = false; // 7-18-2020 TURNING OFF THIS REGULAR CHECK FOR THE MOMENT UNTIL I GET THE NEW APPROACH WITH THE bwParticipant table "participantHasNothingNewInThisAppSinceTheyLastChecked" field!!!!!!
                try {
                    // Add all the dialog tests here. Currently just checking for this one.
                    if ($('#ArDialog').dialog('isOpen')) {
                        aDialogWindowIsOpen = true;
                    }
                    // ToDo: Add more dialog references... :D
                } catch (e) {
                    // do nothing.
                }





                if (aDialogWindowIsOpen != true && $('#divHomePageAlert').is(':visible') != false && $('#divHomePageAlert').is(':visible') == true) { // This may seem strange, but I think a lag in the DOM processing makes != false better than == true.

                    $('#invitationLink2').empty();

                    //var deferredIndex = 1; // We only have 1 workflow to display, but if we want to display multiple, use this value. // 
                    var deferredIndex = 'bwExecutiveSummariesCarousel2'; // We only have 1 workflow to display, but if we want to display multiple, use this value.

                    //alert('xcx213124142 CALLING generateHomePageNotificationScreen().');

                    //developerModeEnabled == true



                    //ShowActivitySpinner('Loading...');

                    var queryData = {
                        //"bwTenantId": tenantId,
                        bwWorkflowAppId: workflowAppId,
                        bwParticipantId: participantId //,
                        //"bwParticipantEmail": participantEmail
                    };
                    console.log('Calling getDataForHomePageNotificationScreen_FASTFIRSTPASS(). xcx2134566666.');
                    //var promise = thiz.generateHomePageNotificationScreen(deferredIndex, queryData);




                    //alert('11111 In bwAuthentication.js.renderAlerts2(). Calling getDataForHomePageNotificationScreen_FASTFIRSTPASS().');

                    var promise = thiz.getDataForHomePageNotificationScreen_FASTFIRSTPASS(deferredIndex, queryData);
                    promise.then(function (result) {
                        try {

                            // 2-12-2022 Place the executive summaries at the top.
                            if (developerModeEnabled == true) {
                                var html = '';
                                html += result.html.html;
                                $('#divHomePageAlert').html(html);
                            }

                            $('#divBwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2({ invitationData: result.invitationData, taskData: result.taskData, tenantData: result.tenantData, participantsData: result.participantsData, brData: result.brData, myBrData: result.myBrData }); // Since we already made the web service call, we may as well re-use it this way.

                            // Set the "Home" button as selected. We have to do this because this is the default that appears when the Configuration button is selected.
                            var workflowAppTheme = thiz.options.workflowAppTheme; //$('.bwAuthentication').bwAuthentication('option', 'workflowAppTheme');
                            var workflowAppTheme_SelectedButton = workflowAppTheme + '_SelectedButton';
                            $('#divWelcomeButton').addClass(workflowAppTheme_SelectedButton).removeClass(workflowAppTheme);

                            //var bwLastSelectedExecutiveSummariesExpandedOrCollapsed = thiz.getLastSelectedExecutiveSummariesExpandedOrCollapsed();
                            //if (bwLastSelectedExecutiveSummariesExpandedOrCollapsed == 'expanded') {
                            //    bwCommonScripts.expandOrCollapseExecutiveSummaries();
                            //}


                            //alert('xcx22221 Expanding the My Tasks section on the home page.');
                            //console.log('');
                            //console.log('**********************************************');
                            //console.log('Expanding the My Tasks section on the home page.');
                            //console.log('**********************************************');
                            //console.log('');
                            //$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('expandOrCollapseAlertsSection', 'functionalAreaRow_bwExecutiveSummariesCarousel2_1', 'alertSectionImage_bwExecutiveSummariesCarousel2_1', 'alertSectionRow_bwExecutiveSummariesCarousel2_1');

                            //localStorage.setItem('bwDisplayFormat', 'ExecutiveSummaries');



                            //
                            //
                            // SECOND PASS 8-20-2023.
                            //
                            //
                            //var promise = thiz.generateHomePageNotificationScreen(deferredIndex, queryData); // rename and call getDataForHomePageNotificationScreen_FASTSECONDPASS
                            var promise = thiz.getDataForHomePageNotificationScreen_FASTSECONDPASS(deferredIndex, queryData); // rename and call getDataForHomePageNotificationScreen_FASTSECONDPASS
                            promise.then(function (results) {
                                try {

                                    //// 2-12-2022 Place the executive summaries at the top.
                                    //if (developerModeEnabled == true) {
                                    //    var html = '';
                                    //    html += result.html.html;
                                    //    $('#divHomePageAlert').html(html);
                                    //}


                                    //alert('99999999 SECOND PASS 8-20-2023. Calling bwExecutiveSummariesCarousel2.js.renderEmptyExecutiveSummariesCarousel(). xcx1231312333.');
                                    //debugger;
                                    //$('#divBwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2({ invitationData: result.invitationData, taskData: result.taskData, tenantData: result.tenantData, participantsData: result.participantsData, brData: result.brData, myBrData: result.myBrData }); // Since we already made the web service call, we may as well re-use it this way.






                                    // Load data.
                                    $('#divBwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'taskData', results.taskData);
                                    //$('#divBwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'participantsData', results.participantsData);
                                    $('#divBwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'brData', results.brData);
                                    $('#divBwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'myBrData', results.myBrData);
                                    //debugger;
                                    var myUnsubmittedRequests = [];
                                    if (results.myBrData.MyRequests && results.myBrData.MyRequests.length) {
                                        for (var i = 0; i < results.myBrData.MyRequests.length; i++) {
                                            if (results.myBrData.MyRequests[i].BudgetWorkflowStatus == 'NOT_SUBMITTED') {
                                                // This is one! Add it to the array.
                                                myUnsubmittedRequests.push(results.myBrData.MyRequests[i]);
                                            }
                                        }
                                    }
                                    $('#divBwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('option', 'myUnsubmittedRequests', myUnsubmittedRequests);

                                    // Render.
                                    $('#divBwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('renderExecutiveSummaries_PINNED_REQUESTS');
                                    $('#divBwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('renderExecutiveSummaries_AllActiveRequests');
                                    $('#divBwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('renderExecutiveSummaries_MySubmittedRequests');
                                    $('#divBwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('renderExecutiveSummaries_MyUnsubmittedRequests');

                                    //$('#divBwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('renderExecutiveSummaries_MyPendingTasks');
                                    $('#divBwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('renderExecutiveSummaries_MyPendingTasks_FASTSECONDPASS'); // This appends rather than re-writing the UI for this section.








                                    //alert('xcx2334566693834756 In bwAuthentication.js.renderAlerts2(). EVERYTHING SHOULD LOOK GOOD..<<<<<<<<');


                                    //// Set the "Home" button as selected. We have to do this because this is the default that appears when the Configuration button is selected.
                                    //var workflowAppTheme = thiz.options.workflowAppTheme; //$('.bwAuthentication').bwAuthentication('option', 'workflowAppTheme');
                                    //var workflowAppTheme_SelectedButton = workflowAppTheme + '_SelectedButton';
                                    //$('#divWelcomeButton').addClass(workflowAppTheme_SelectedButton).removeClass(workflowAppTheme);

                                    //var bwLastSelectedExecutiveSummariesExpandedOrCollapsed = thiz.getLastSelectedExecutiveSummariesExpandedOrCollapsed();
                                    //if (bwLastSelectedExecutiveSummariesExpandedOrCollapsed == 'expanded') {
                                    //    bwCommonScripts.expandOrCollapseExecutiveSummaries();
                                    //}

                                    //console.log('');
                                    //console.log('**********************************************');
                                    //console.log('Expanding the My Tasks section on the home page.');
                                    //console.log('**********************************************');
                                    //console.log('');
                                    //$('.bwExecutiveSummariesCarousel2').bwExecutiveSummariesCarousel2('expandOrCollapseAlertsSection', 'functionalAreaRow_bwExecutiveSummariesCarousel2_1', 'alertSectionImage_bwExecutiveSummariesCarousel2_1', 'alertSectionRow_bwExecutiveSummariesCarousel2_1');

                                    //localStorage.setItem('bwDisplayFormat', 'ExecutiveSummaries');

                                } catch (e) {
                                    console.log('Exception in bwAuthentication.js.renderAlerts2():1334-1-1: ' + e.message + ', ' + e.stack);
                                    displayAlertDialog('Exception in bwAuthentication.js.renderAlerts2():1334-1-1: ' + e.message + ', ' + e.stack);
                                }
                            });

                            //
                            //
                            // end: SECOND PASS 8-20-2023.
                            //
                            //



























                            ////
                            //// Fifth section, "Saved on My Device" summary. //
                            ////
                            //try {
                            //    //setTimeout(function () { // This is only done because maybe we need to look at the order of events again... or maybe it is Ok!
                            //    // Check if we have created the indexDB. If not, load the XSL files that we will need in case of losing the network connection.
                            //    var db = $('.bwCoreComponent').bwCoreComponent('getIndexDbInstance');
                            //    if (db.objectStoreCachedRequests) {
                            //        var transaction = db.transaction('objectStoreCachedRequests', 'readonly');
                            //        var request = transaction.objectStore('objectStoreCachedRequests').count();

                            //        transaction.oncomplete = function (event) {
                            //            var numberOfRequests = event.target.result;
                            //        };

                            //        transaction.onerror = function (event) {
                            //            //debugger;
                            //        };

                            //        request.onsuccess = function (event) {
                            //            var html2 = '';
                            //            var rowId = 'functionalAreaRow_' + deferredIndex.toString() + '_5';
                            //            var imageId = 'alertSectionImage_' + deferredIndex.toString() + '_5';
                            //            var collapsibleRowId = 'alertSectionRow_' + deferredIndex.toString() + '_5';
                            //            html2 += '<tr id="' + rowId + '" class="bwFunctionalAreaRow" onclick="expandOrCollapseAlertsSection(\'' + rowId + '\', \'' + imageId + '\', \'' + collapsibleRowId + '\');" >';
                            //            var numberOfRequests = event.target.result;
                            //            if (numberOfRequests > 0) {
                            //                // Display the requests stored on this device.
                            //                console.log('If this device is in PRIVACY mode, your web browser will delete them without asking you when you close the browser.xcx1');
                            //                if (numberOfRequests == 1) {
                            //                    html2 += '<td style="width:11px;vertical-align:top;"></td>';
                            //                    html2 += '<td style="padding-left:11px;" class="bwHPNDrillDownLinkCell2">';
                            //                    html2 += '<img title="collapse" id="' + imageId + '" style="cursor:pointer;width:45px;height:45px;vertical-align:middle;" src="images/drawer-open.png">';
                            //                    html2 += '<span>You have ' + numberOfRequests + ' un-submitted request saved on this device.</span>';
                            //                } else if (numberOfRequests > 1) {
                            //                    html2 += '<td style="width:11px;vertical-align:top;"></td>';
                            //                    html2 += '<td style="padding-left:11px;" class="bwHPNDrillDownLinkCell2">';
                            //                    html2 += '<img title="collapse" id="' + imageId + '" style="cursor:pointer;width:45px;height:45px;vertical-align:middle;" src="images/drawer-open.png">';
                            //                    html2 += '<span>You have ' + numberOfRequests + ' un-submitted requests saved on this device.</span>';
                            //                }
                            //                html2 += '    </td>';
                            //                html2 += '    <td class="bwHPNDrillDownLinkCell2"></td>';
                            //                html2 += '  </tr>';

                            //                html2 += '  <tr id="' + collapsibleRowId + '" style="display:none;">';
                            //                html2 += '      <td style="vertical-align:top;"></td>';
                            //                html2 += '      <td colspan="2" xcx="1111">';

                            //                html2 += '           <table>';
                            //                html2 += '               <tr>';

                            //                html2 += '                   <td style="vertical-align:top;width:60px;">';

                            //                html2 += '                       <table id="buttonDisplayRequestsAsTiles" class="divCarouselButton" onclick="$(\'.bwAuthentication\').bwAuthentication(\'displayExecutiveSummaries_OnThisDevice\');">';
                            //                html2 += '                           <tr>';
                            //                html2 += '                               <td>';
                            //                html2 += '                                   <div class="divCarouselButton_SmallButton"></div>';
                            //                html2 += '                               </td>';
                            //                html2 += '                               <td>';
                            //                html2 += '                                   <div class="divCarouselButton_SmallButton"></div>';
                            //                html2 += '                               </td>';
                            //                html2 += '                               <td>';
                            //                html2 += '                                   <div class="divCarouselButton_SmallButton"></div>';
                            //                html2 += '                               </td>';
                            //                html2 += '                           </tr>';
                            //                html2 += '                           <tr>';
                            //                html2 += '                               <td>';
                            //                html2 += '                                   <div class="divCarouselButton_SmallButton"></div>';
                            //                html2 += '                               </td>';
                            //                html2 += '                               <td>';
                            //                html2 += '                                   <div class="divCarouselButton_SmallButton"></div>';
                            //                html2 += '                               </td>';
                            //                html2 += '                               <td>';
                            //                html2 += '                                   <div class="divCarouselButton_SmallButton"></div>';
                            //                html2 += '                               </td>';
                            //                html2 += '                           </tr>';
                            //                html2 += '                       </table>';

                            //                html2 += '                       <div style="height:5px;"></div>'; // Button spacer. <br /> is too much.

                            //                html2 += '                       <table id="buttonDisplayRequestsAsDetailedList" class="divCarouselButton_Selected" style="width:70px;padding: 4px 4px 4px 4px !important;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'displayDetailedList_OnThisDevice\');">';
                            //                html2 += '                           <tr>';
                            //                html2 += '                               <td style="white-space:nowrap;">';
                            //                html2 += '                                   <div style="width: 100%; overflow: hidden;vertical-align:middle;">';
                            //                html2 += '                                       <div class="divCarouselButton_SmallButton2" style="float:left;vertical-align:middle;"></div><div style="float:right;vertical-align:middle;margin:-4px;color:gray;">-----</div>';
                            //                html2 += '                                   </div>';
                            //                html2 += '                               </td>';
                            //                html2 += '                           </tr>';
                            //                html2 += '                           <tr>';
                            //                html2 += '                               <td style="white-space:nowrap;">';
                            //                html2 += '                                   <div style="width: 100%; overflow: hidden;vertical-align:middle;">';
                            //                html2 += '                                       <div class="divCarouselButton_SmallButton2" style="float:left;vertical-align:middle;"></div><div style="float:right;vertical-align:middle;margin:-4px;color:gray;">-----</div>';
                            //                html2 += '                                   </div>';
                            //                html2 += '                               </td>';
                            //                html2 += '                           </tr>';
                            //                html2 += '                           <tr>';
                            //                html2 += '                               <td style="white-space:nowrap;">';
                            //                html2 += '                                   <div style="width: 100%; overflow: hidden;vertical-align:middle;">';
                            //                html2 += '                                       <div class="divCarouselButton_SmallButton2" style="float:left;vertical-align:middle;"></div><div style="float:right;vertical-align:middle;margin:-4px;color:gray;">-----</div>';
                            //                html2 += '                                   </div>';
                            //                html2 += '                               </td>';
                            //                html2 += '                           </tr>';
                            //                html2 += '                       </table>';

                            //                html2 += '                  </td>';
                            //                html2 += '                  <td colspan="2" xcx="222">';
                            //                html2 += '                      <table>';

                            //                var objectStore = db.transaction("objectStoreCachedRequests").objectStore("objectStoreCachedRequests");
                            //                objectStore.openCursor().onsuccess = function (event) {
                            //                    try {
                            //                        var cursor = event.target.result;
                            //                        if (cursor) {
                            //                            var projectTitle = '';
                            //                            console.log('Retrieved request: ' + cursor.value.ProjectTitle.value + ': ' + cursor.value.bwBudgetRequestId);
                            //                            html2 += '<tr>';
                            //                            html2 += '  <td style="width:10px;"></td>';
                            //                            //html2 += '  <td style="width:10px;"></td>';
                            //                            //html2 += '  <td style="width:45px;"></td>';

                            //                            html2 += '  <td style="background-color:white;width:25px;" ';
                            //                            html2 += '      onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'' + '' + '\', \'' + cursor.value.ProjectTitle.value + '\', \'' + '' + '\', \'' + workflowAppId + '\', \'' + cursor.value.bwBudgetRequestId + '\', \'' + cursor.value.bwOrgId + '\', \'' + cursor.value.bwOrgName + '\', this);" ';
                            //                            html2 += '      onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">';
                            //                            html2 += '    <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg" />';
                            //                            html2 += '  </td>';

                            //                            html2 += '  <td style="padding:10px;cursor:pointer;background-color:#d8d8d8;" onclick="cmdRenderAndLoadNewRequestFormWithUnsubmittedRequest_loggedin_IndexDb(\'' + cursor.value.bwBudgetRequestId + '\');" onMouseOver="this.style.backgroundColor=\'lightgoldenrodyellow\';" onMouseOut="this.style.backgroundColor=\'#d8d8d8\';">';

                            //                            html2 += '    <div style="display:inline-block;" bwtrace="xcx778452">';
                            //                            html2 += '      &nbsp;&nbsp;' + cursor.value.ProjectTitle.value;
                            //                            html2 += '      &nbsp;&nbsp;<img src="images/trash-can.png" onclick="cmdDisplayDeleteUnsubmittedBudgetRequestDialog(\'' + cursor.value.bwBudgetRequestId + '\', \'' + cursor.value.ProjectTitle.value + '\');" title="Delete" style="cursor:pointer;" />';
                            //                            html2 += '    </div>';
                            //                            html2 += '  </td>';
                            //                            html2 += '</tr>';
                            //                            cursor.continue();
                            //                        } else {
                            //                            console.log('In renderAlerts2(). Done looping, so rendering. In the future cache and compare to determine if rendering is necessary.');

                            //                            html2 += '          </table>';

                            //                            // All done, close the table tags.
                            //                            html2 += '      </td>';
                            //                            html2 += '  </tr>';

                            //                            html2 += '</table>';

                            //                            html2 += '</td>';
                            //                            html2 += '</tr>';

                            //                            //debugger;
                            //                            //alert('tblHomePageAlertSectionForWorkflow1 xcx242534'); // tblHomePageAlertSectionForWorkflowbwExecutiveSummariesCarousel2
                            //                            //$('#tblHomePageAlertSectionForWorkflow1 > tbody:last-child').append(html2);
                            //                            //$('#tblHomePageAlertSectionForWorkflow1 > tbody:last-child').prepend(html2); // 2-11-2022
                            //                            $('#tblHomePageAlertSectionForWorkflowbwExecutiveSummariesCarousel2 > tbody:first-child').prepend(html2);

                            //                        }

                            //                    } catch (e) {
                            //                        console.log('xxyyyfgError: ' + e.message + ', ' + e.stack);
                            //                        displayAlertDialog('xxyyyfgError: ' + e.message + ', ' + e.stack);
                            //                    }
                            //                };

                            //            }
                            //        };

                            //        request.onerror = function (evt) {
                            //            console.error('In bwAuthentication.js.renderAlerts2(). add error', this.error);
                            //            displayAlertDialog('In bwAuthentication.js.renderAlerts2(). add error', this.error);
                            //        };

                            //    }
                            //    //}, 2000); // 2000 = 2 seconds.

                            //} catch (e) {
                            //    console.log('Exception in bwAuthentication.js.renderAlerts2():1334-2: ' + e.message + ', ' + e.stack);
                            //    displayAlertDialog('Exception in bwAuthentication.js.renderAlerts2():1334-2: ' + e.message + ', ' + e.stack);
                            //}















                        } catch (e) {
                            console.log('Exception in bwAuthentication.js.renderAlerts2():1334-1-2: ' + e.message + ', ' + e.stack);
                            displayAlertDialog('Exception in bwAuthentication.js.renderAlerts2():1334-1-2: ' + e.message + ', ' + e.stack);
                        }
                    });

                }
            }

        } catch (e) {
            console.log('Exception in bwAuthentication.js.renderAlerts2(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.renderAlerts2(): ' + e.message + ', ' + e.stack);
        }
    },


    //displayExecutiveSummaries_OnThisDevice: function () {
    //    try {
    //        console.log('In displayExecutiveSummaries().');

    //        alert('In displayExecutiveSummaries(). This functionality is incomplete. Coming soon!');

    //        //document.getElementById('buttonDisplayRequestsAsTiles').classList.remove('divCarouselButton');
    //        //document.getElementById('buttonDisplayRequestsAsTiles').classList.add('divCarouselButton_Selected');

    //        //document.getElementById('buttonDisplayRequestsAsDetailedList').classList.remove('divCarouselButton_Selected');
    //        //document.getElementById('buttonDisplayRequestsAsDetailedList').classList.add('divCarouselButton');

    //        //$('#divBwExecutiveSummariesCarousel222').html('');

    //        //this.getTheLatestRequestsAndRender_OnThisDevice();

    //    } catch (e) {
    //        console.log('Exception in displayExecutiveSummaries(): ' + e.message + ', ' + e.stack);
    //        displayAlertDialog('Exception in displayExecutiveSummaries(): ' + e.message + ', ' + e.stack);
    //    }
    //},
    displayDetailedList_OnThisDevice: function () {
        try {
            console.log('In displayDetailedList_OnThisDevice().');

            // displayDetailedList // divCarouselButton_Selected
            // buttonDisplayRequestsAsTiles
            // buttonDisplayRequestsAsDetailedList

            document.getElementById('buttonDisplayRequestsAsTiles').classList.remove('divCarouselButton_Selected');
            document.getElementById('buttonDisplayRequestsAsTiles').classList.add('divCarouselButton');

            document.getElementById('buttonDisplayRequestsAsDetailedList').classList.remove('divCarouselButton');
            document.getElementById('buttonDisplayRequestsAsDetailedList').classList.add('divCarouselButton_Selected');

            var html = '';

            //html += this.generateHomePageNotificationScreenHtml_new();



            var workflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');

            var bwRequestTypeId = $('#selectRequestTypeDropDown option:selected').val(); // This is the drop-down at the top of the page.

            html += '<style>';
            html += '.dataGridTable { border: 1px solid gainsboro; font-size:14px; font-family: "Helvetica Neue","Segoe UI",Helvetica,Verdana,sans-serif; }';
            html += '.dataGridTable td { border-left: 0px; border-right: 1px solid gainsboro; }';
            html += '.headerRow { background-color:white; color:gray;border-bottom:1px solid gainsboro; }';
            html += '.headerRow td { border-bottom:1px solid gainsboro; padding-top:3px;padding-bottom:5px;padding-right:10px;padding-left:10px; }';
            html += '.filterRow td { border-bottom:1px solid whitesmoke; padding-top:3px;padding-bottom:5px;padding-right:10px;padding-left:10px; }';
            html += '.alternatingRowLight { background-color:white; }';
            html += '.alternatingRowLight:hover { background-color:lightgoldenrodyellow; }';
            html += '.alternatingRowDark { background-color:whitesmoke; }';
            html += '.alternatingRowDark:hover { background-color:lightgoldenrodyellow; }';
            html += '</style>';


            //html += '<div style="height:800px;overflow-y: scroll;" onscroll="$(\'.bwDataGrid\').bwDataGrid(\'dataGrid_OnScroll\', this);">';
            html += '<div id="divDataGridTable" style="overflow-y: scroll;" onscroll="$(\'.bwDataGrid\').bwDataGrid(\'dataGrid_OnScroll\', this, \'' + bwRequestTypeId + '\');">';

            //html += '                               <span id="spanEmailPicker"></span>';
            //html += '                           </div>';











            html += '<table id="dataGridTable" class="dataGridTable" bwworkflowappid="' + workflowAppId + '" >';

            html += '  <tr class="headerRow">';
            html += '    <td></td>';

            // "Location" column header.
            html += '   <td style="white-space:nowrap;">';
            //html += '       Location';
            html += '       <div style="vertical-align:middle;display:inline-block;">Location&nbsp;</div>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order descending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'OrgName\', \'descending\', this);">';
            html += '           <img src="images/descending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order ascending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'OrgName\', \'ascending\', this);">';
            html += '           <img src="images/ascending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '   </td>';

            // "Title" column header.
            html += '    <td style="white-space:nowrap;">';
            html += '       <div style="vertical-align:middle;display:inline-block;">Title&nbsp;</div>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order descending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'Title\', \'descending\', this);">';
            html += '           <img src="images/descending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order ascending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'Title\', \'ascending\', this);">';
            html += '           <img src="images/ascending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '   </td>';

            // "Description" column header.
            html += '    <td style="white-space:nowrap;">';
            html += '       <div style="vertical-align:middle;display:inline-block;">Description&nbsp;</div>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order descending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'ProjectTitle\', \'descending\', this);">';
            html += '           <img src="images/descending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order ascending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'ProjectTitle\', \'ascending\', this);">';
            html += '           <img src="images/ascending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '   </td>';

            // "Fiscal year" column header.
            html += '    <td style="white-space:nowrap;">';
            html += '       <div style="vertical-align:middle;display:inline-block;">Fiscal year&nbsp;</div>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order descending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'bwFiscalYear\', \'descending\', this);">';
            html += '           <img src="images/descending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order ascending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'bwFiscalYear\', \'ascending\', this);">';
            html += '           <img src="images/ascending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '   </td>';

            html += '    <td>Request Type Id</td>';

            // "Created Date" column header.
            html += '    <td style="white-space:nowrap;">';
            html += '       <div style="vertical-align:middle;display:inline-block;">Created Date&nbsp;</div>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order descending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'Created\', \'descending\', this);">';
            html += '           <img src="images/descending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order ascending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'Created\', \'ascending\', this);">';
            html += '           <img src="images/ascending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '   </td>';


            html += '    <td style="white-space:nowrap;">Financial Area</td>';
            html += '    <td>OrgId</td>';

            // "Status" column header.
            //html += '    <td>Status</td>';
            html += '    <td style="white-space:nowrap;">';
            html += '       <div style="vertical-align:middle;display:inline-block;">Status&nbsp;</div>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order descending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'BudgetWorkflowStatus\', \'descending\', this);">';
            html += '           <img src="images/descending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order ascending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'BudgetWorkflowStatus\', \'ascending\', this);">';
            html += '           <img src="images/ascending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '   </td>';

            // "AR Status" column header.
            html += '    <td style="white-space:nowrap;">';
            html += '       <div style="vertical-align:middle;display:inline-block;">Status&nbsp;</div>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order descending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'ARStatus\', \'descending\', this);">';
            html += '           <img src="images/descending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order ascending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'ARStatus\', \'ascending\', this);">';
            html += '           <img src="images/ascending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '   </td>';

            // "Current Owner(s)" column header. 
            html += '    <td style="white-space:nowrap;">';
            html += '       <div style="vertical-align:middle;display:inline-block;">Current Owner(s)&nbsp;</div>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order descending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'CurrentOwner\', \'descending\', this);">';
            html += '           <img src="images/descending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order ascending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'CurrentOwner\', \'ascending\', this);">';
            html += '           <img src="images/ascending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '   </td>';

            // "Capital Cost" column header. 
            html += '    <td style="white-space:nowrap;">';
            html += '       <div style="vertical-align:middle;display:inline-block;">Capital Cost&nbsp;</div>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order descending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'RequestedCapital\', \'descending\', this);">';
            html += '           <img src="images/descending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order ascending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'RequestedCapital\', \'ascending\', this);">';
            html += '           <img src="images/ascending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '   </td>';

            // "Expense" column header.
            html += '    <td style="white-space:nowrap;">';
            html += '       <div style="vertical-align:middle;display:inline-block;">Expense&nbsp;</div>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order descending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'RequestedExpense\', \'descending\', this);">';
            html += '           <img src="images/descending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order ascending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'RequestedExpense\', \'ascending\', this);">';
            html += '           <img src="images/ascending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '   </td>';

            html += '    <td>Lease</td>';
            html += '    <td>Total</td>';
            html += '    <td>Simple Payback</td>';

            // "Modified Date" column header. 
            //html += '    <td>Modified Date</td>';
            html += '    <td style="white-space:nowrap;">';
            html += '       <div style="vertical-align:middle;display:inline-block;">Modified Date&nbsp;</div>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order descending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'Modified\', \'descending\', this);">';
            html += '           <img src="images/descending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '       <span style="cursor:pointer;font-size:20pt;" title="Order ascending..." onclick="$(\'.bwDataGrid\').bwDataGrid(\'sortDataGrid\', \'Modified\', \'ascending\', this);">';
            html += '           <img src="images/ascending.png" style="width:25px;vertical-align:middle;" />';
            html += '       </span>';
            html += '   </td>';

            html += '    <td></td>';
            html += '  </tr>';

            html += '  <tr class="filterRow">';
            // Magnifying glass
            html += '    <td></td>';

            // Location
            html += '    <td></td>';

            // Request #
            //html += '    <td style="white-space:nowrap;"><span style="cursor:pointer;font-size:20pt;" title="Order ascending..." onclick="alert(\'Order ascending...\');">☝</span><span style="cursor:pointer;font-size:20pt;" title="Order descending..." onclick="alert(\'Order descending...\');">☟</span></td>';
            html += '    <td style="white-space:nowrap;">';
            //html += '       <span style="cursor:pointer;font-size:20pt;" title="Order descending..." onclick="alert(\'Order descending...\');">';
            //html += '           <img src="images/descending.png" style="width:25px;" />';
            //html += '       </span>';
            //html += '       <span style="cursor:pointer;font-size:20pt;" title="Order ascending..." onclick="alert(\'Order ascending...\');">';
            //html += '           <img src="images/ascending.png" style="width:25px;" />';
            //html += '       </span>';
            html += '   </td>';


            // Description
            html += '   <td style="white-space:nowrap;">';
            html += '       <input type="text" id="txtArchivePageDescriptionFilter" class="archivePageFilterBox" title="Type here to limit search results, using * as a wildcard character."/>';
            html += '   </td>';

            // Fiscal year
            html += '   <td style="white-space:nowrap;">';
            html += '       <input type="text" id="txtArchivePageDescriptionFilter" class="archivePageFilterBox" title="Type here to limit search results, using * as a wildcard character."/>';
            html += '   </td>';

            // Request Type.
            html += '    <td></td>';

            // Created Date
            html += '    <td></td>';
            // Financial Areas.
            html += '    <td style="white-space:nowrap;">';
            html += '      <select id="ddlArchivePageFinancialAreaDropDownFilter" class="archivePageFilterDropDown" title="Select here to limit the search results.">';
            for (var x = 0; x < BWMData[0].length; x++) {
                if (BWMData[0][x][0] == workflowAppId) {
                    // Now put the empty option.
                    html += '<option value="" class="archivePageFilterOptionDropDown">Show all...</option>';
                    for (var y = 0; y < BWMData[0][x][4].length; y++) {
                        var faId = BWMData[0][x][4][y][0];
                        var faTitle = BWMData[0][x][4][y][1];
                        html += '<option value="' + faId + '" class="archivePageFilterOptionDropDown">';
                        html += faTitle;
                        html += '</option>';
                    }

                }
            }
            html += '      </select>';
            html += '    </td>';

            // OrgId
            html += '    <td></td>';


            // Status
            html += '    <td style="white-space:nowrap;">';
            html += '<select id="selectArchivePageFilterDropDown" class="archivePageFilterDropDown" title="Select here to limit the search results.">';
            // Now put the empty option.
            html += '<option value="" class="archivePageFilterOptionDropDown">Show all...</option>';
            // statusesForTheStatusDropdown

            var statusesForTheStatusDropdown = ['firststatus', 'secondstatus', 'thirdstatus'];

            for (var s = 0; s < statusesForTheStatusDropdown.length; s++) {
                html += '<option value="' + statusesForTheStatusDropdown[s] + '" class="archivePageFilterOptionDropDown">' + statusesForTheStatusDropdown[s] + '</option>';
            }
            html += '</select>&nbsp;<img src="images/icon-down.png" title="Sort order" style="cursor:pointer;" />';
            html += '    </td>';



            // ARStatus
            html += '    <td></td>';
            // Current Owner(s)
            html += '    <td></td>';
            // Capital Cost
            html += '    <td></td>';
            // Expense
            html += '    <td></td>';
            // Lease
            html += '    <td></td>';
            // Total
            html += '    <td style="white-space:nowrap;"><input type="text" id="txtArchivePageBudgetAmountFilter" class="archivePageFilterBox" title="Enter a number. Shows all equal to or greater than."/>&nbsp;<img src="images/icon-down.png" title="Sort order" style="cursor:pointer;" /></td>';
            // Simple Payback
            html += '    <td>[simplepaybackfilter]</td>';
            // Modified Date
            html += '    <td></td>';
            // Trash Bin
            html += '    <td></td>';

            html += '  </tr>';

            var orgsImageFetchingInformation = [];


            var budgetRequests = []; // 3-12-2022 just trying to get code going needs lots more work...





            var alternatingRow = 'light'; // Use this to color the rows.
            for (var i = 0; i < budgetRequests.length; i++) {
                //debugger;
                //var imageUrl = 'https://budgetworkflow.com/_files/af316d1a-ca6d-4c1d-bf8d-66b05920292f/ac778618-4412-48c5-a282-5850e972fd36/edthetalkinghorse.jpg';

                // 2-8-2022
                var ProjectTitle_clean = String(budgetRequests[i].ProjectTitle).replace(/["]/g, '&quot;').replace(/[']/g, '&#39;'); // This is done because if the ProjectTitle (description) has a quote in it, there will be issues! The click event will fail to invoke the method. 


                var bwWorkflowAppId = budgetRequests[i].bwWorkflowAppId;
                var bwBudgetRequestId = budgetRequests[i].bwBudgetRequestId;
                var BriefDescriptionOfProject;
                if (budgetRequests[i].bwRequestJson) {
                    BriefDescriptionOfProject = JSON.parse(budgetRequests[i].bwRequestJson).BriefDescriptionOfProject;
                } else {
                    BriefDescriptionOfProject = 'ERROR: Invalid bwRequestJson.';
                }

                if (alternatingRow == 'light') {
                    html += '<tr class="alternatingRowLight" style="cursor:pointer;" ';
                    //html += ' onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'' + budgetRequests[i].Title + '\', \'' + budgetRequests[i].ProjectTitle + '\', \'' + BriefDescriptionOfProject + '\', \'' + bwWorkflowAppId + '\', \'' + bwBudgetRequestId + '\', \'' + budgetRequests[i].OrgId + '\', \'' + budgetRequests[i].OrgName + '\');this.style.backgroundColor=\'lightgoldenrodyellow\';" ';
                    //html += ' onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');this.style.backgroundColor=\'white\';"';
                    //html += ' onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + thiz.options.operationUriPrefix + '\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + budgetRequests[i].Title + '\', \'' + budgetRequests[i].ProjectTitle + '\', \'' + budgetRequests[i].Title + '\');"';
                    html += '>';
                    alternatingRow = 'dark';
                } else {
                    //html += '  <tr class="alternatingRowDark" style="cursor:pointer;" onmouseover="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'' + budgetRequests[i].Title + '\', \'' + budgetRequests[i].ProjectTitle + '\', \'' + JSON.parse(budgetRequests[i].bwRequestJson).BriefDescriptionOfProject + '\', \'' + bwWorkflowAppId + '\', \'' + bwBudgetRequestId + '\', \'' + budgetRequests[i].OrgId + '\', \'' + budgetRequests[i].OrgName + '\');"  >';
                    html += '<tr class="alternatingRowDark" style="cursor:pointer;" ';
                    //html += ' onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'' + budgetRequests[i].Title + '\', \'' + budgetRequests[i].ProjectTitle + '\', \'' + BriefDescriptionOfProject + '\', \'' + bwWorkflowAppId + '\', \'' + bwBudgetRequestId + '\', \'' + budgetRequests[i].OrgId + '\', \'' + budgetRequests[i].OrgName + '\');this.style.backgroundColor=\'lightgoldenrodyellow\';" ';
                    //html += ' onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');this.style.backgroundColor=\'whitesmoke\';"';
                    //html += ' onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + thiz.options.operationUriPrefix + '\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + budgetRequests[i].Title + '\', \'' + budgetRequests[i].ProjectTitle + '\', \'' + budgetRequests[i].Title + '\');"';
                    html += '>';
                    alternatingRow = 'light';
                }

                // Magnifying glass.
                html += '   <td style="padding:5px;" ';
                html += ' onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'' + budgetRequests[i].Title + '\', \'' + ProjectTitle_clean + '\', \'' + BriefDescriptionOfProject + '\', \'' + bwWorkflowAppId + '\', \'' + bwBudgetRequestId + '\', \'' + budgetRequests[i].OrgId + '\', \'' + budgetRequests[i].OrgName + '\');this.style.backgroundColor=\'lightgoldenrodyellow\';" ';
                html += ' onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');this.style.backgroundColor=\'white\';"';
                html += '   ><img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg"></td>';


                // Location
                //html += '      <td style="padding:5px;" onclick="$(\'.bwRequest\').bwRequest(\'displayRequestFormDialog\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + participantId + '\', \'' + budgetRequests[i].Title + '\');">';
                //html += '      <td style="padding:5px;" ';
                //html += '       <img id="orgImage_' + i + '" style="width:40px;height:40px;" src="' + thiz.options.operationUriPrefix + 'images/corporeal.png" />';
                //html += budgetRequests[i].OrgName;
                //html += '       </td>';
                html += '   <td style="padding:5px;" ';
                html += '       onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + thiz.options.operationUriPrefix + '\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + budgetRequests[i].Title + '\', \'' + ProjectTitle_clean + '\', \'' + budgetRequests[i].Title + '\');"';
                html += '   >';
                html += '       <img id="orgImage_' + i + '" style="width:40px;height:40px;" src="' + thiz.options.operationUriPrefix + 'images/corporeal.png" />';
                html += budgetRequests[i].OrgName;
                html += '   </td>';












                // Request #
                //html += '      <td style="padding:5px;" onclick="$(\'.bwRequest\').bwRequest(\'displayRequestFormDialog\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + participantId + '\', \'' + budgetRequests[i].Title + '\');">' + budgetRequests[i].Title + '</td>';
                //html += '      <td style="padding:5px;">' + budgetRequests[i].Title + '</td>';
                html += '   <td style="padding:5px;" ';
                html += '       onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + thiz.options.operationUriPrefix + '\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + budgetRequests[i].Title + '\', \'' + ProjectTitle_clean + '\', \'' + budgetRequests[i].Title + '\');"';
                html += '   >' + '<span style="white-space:nowrap;">' + budgetRequests[i].Title + '</span></td>';



                // Description
                //html += '      <td style="padding:5px;" onclick="$(\'.bwRequest\').bwRequest(\'displayRequestFormDialog\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + participantId + '\', \'' + budgetRequests[i].Title + '\');">' + budgetRequests[i].ProjectTitle + '</td>';
                //html += '      <td style="padding:5px;">' + budgetRequests[i].ProjectTitle + '</td>';
                html += '   <td style="padding:5px;" ';
                html += '       onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + thiz.options.operationUriPrefix + '\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + budgetRequests[i].Title + '\', \'' + ProjectTitle_clean + '\', \'' + budgetRequests[i].Title + '\');"';

                // 2-8-2022
                html += '   >' + ProjectTitle_clean + '</td>';
                //var ProjectTitle_clean = budgetRequests[i].ProjectTitle.replace((/["]/g, '&quot;'));
                //html += '   >' + ProjectTitle_clean + '</td>';



                // Fiscal year
                html += '   <td style="padding:5px;" ';
                html += '       onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + thiz.options.operationUriPrefix + '\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + budgetRequests[i].Title + '\', \'' + ProjectTitle_clean + '\', \'' + budgetRequests[i].Title + '\');"';
                html += '   >' + budgetRequests[i].bwFiscalYear + '</td>';





                // Request Type Id.
                //html += '      <td style="padding:5px;" onclick="$(\'.bwRequest\').bwRequest(\'displayRequestFormDialog\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + participantId + '\', \'' + budgetRequests[i].Title + '\');">' + budgetRequests[i].bwRequestType + '</td>';
                //html += '      <td style="padding:5px;">' + budgetRequests[i].bwRequestType + '</td>';
                html += '   <td style="padding:5px;" ';
                html += '       onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + thiz.options.operationUriPrefix + '\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + budgetRequests[i].Title + '\', \'' + ProjectTitle_clean + '\', \'' + budgetRequests[i].Title + '\');"';
                html += '   >' + budgetRequests[i].bwRequestTypeId + '</td>';


                // Created Date
                var timestamp4 = bwCommonScripts.getBudgetWorkflowStandardizedDate(budgetRequests[i].Created);
                html += '   <td style="padding:5px;" ';
                html += '       onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + thiz.options.operationUriPrefix + '\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + budgetRequests[i].Title + '\', \'' + ProjectTitle_clean + '\', \'' + budgetRequests[i].Title + '\');"';
                //html += '   >' + getFriendlyDateAndTime(budgetRequests[i].Created) + '</td>';
                html += '   >' + timestamp4 + '</td>';



                // Financial Area
                var displayFinancialArea = false;
                for (var x = 0; x < BWMData[0].length; x++) {
                    if (BWMData[0][x][0] == workflowAppId) {
                        for (var y = 0; y < BWMData[0][x][4].length; y++) {
                            if (displayFinancialArea == false && BWMData[0][x][4][y][0] == budgetRequests[i].FunctionalAreaId) {
                                // We have found the financial area, so we have the title! Yay!
                                var faTitle = BWMData[0][x][4][y][1];
                                //html += '<td style="padding:5px;" onclick="$(\'.bwRequest\').bwRequest(\'displayRequestFormDialog\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + participantId + '\', \'' + budgetRequests[i].Title + '\');" >';
                                //html += '<td style="padding:5px;">';
                                //html += faTitle;
                                //html += '</td>';
                                html += '   <td style="padding:5px;" ';
                                html += '       onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + thiz.options.operationUriPrefix + '\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + budgetRequests[i].Title + '\', \'' + ProjectTitle_clean + '\', \'' + budgetRequests[i].Title + '\');"';
                                html += '   >' + faTitle + '</td>';
                                displayFinancialArea = true;
                            }
                        }
                    }
                }

                if (displayFinancialArea == false) {
                    //html += '<td style="padding:5px;"></td>';
                    html += '   <td style="padding:5px;" ';
                    html += '       onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + thiz.options.operationUriPrefix + '\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + budgetRequests[i].Title + '\', \'' + ProjectTitle_clean + '\', \'' + budgetRequests[i].Title + '\');"';
                    html += '   ></td>';
                }



                // Org Id
                html += '   <td style="padding:5px;" ';
                html += '       onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + thiz.options.operationUriPrefix + '\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + budgetRequests[i].Title + '\', \'' + ProjectTitle_clean + '\', \'' + budgetRequests[i].Title + '\');"';
                html += '   >';
                //html += '       <img id="orgImage_' + i + '" style="width:40px;height:40px;" src="' + thiz.options.operationUriPrefix + 'images/corporeal.png" />';
                html += budgetRequests[i].OrgId;
                html += '   </td>';




                // Use this to retrieve the images after the fact, farther below in this code.
                var orgImageFetchingInformation = {
                    imageId: 'orgImage_' + i,
                    bwOrgId: budgetRequests[i].OrgId
                };
                orgsImageFetchingInformation.push(orgImageFetchingInformation);



                // Status
                //html += '    <td style="padding:5px;" onclick="$(\'.bwRequest\').bwRequest(\'displayRequestFormDialog\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + participantId + '\', \'' + budgetRequests[i].Title + '\');">' + budgetRequests[i].BudgetWorkflowStatus + '</td>';
                //html += '    <td style="padding:5px;">' + budgetRequests[i].BudgetWorkflowStatus + '</td>';
                html += '   <td style="padding:5px;" ';
                html += '       onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + thiz.options.operationUriPrefix + '\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + budgetRequests[i].Title + '\', \'' + ProjectTitle_clean + '\', \'' + budgetRequests[i].Title + '\');"';
                html += '   >' + budgetRequests[i].BudgetWorkflowStatus + '</td>';

                // ARStatus
                //html += '    <td style="padding:5px;" onclick="$(\'.bwRequest\').bwRequest(\'displayRequestFormDialog\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + participantId + '\', \'' + budgetRequests[i].Title + '\');">' + budgetRequests[i].ARStatus + '</td>';
                //html += '    <td style="padding:5px;">' + budgetRequests[i].ARStatus + '</td>';
                html += '   <td style="padding:5px;" ';
                html += '       onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + thiz.options.operationUriPrefix + '\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + budgetRequests[i].Title + '\', \'' + ProjectTitle_clean + '\', \'' + budgetRequests[i].Title + '\');"';
                html += '   >' + budgetRequests[i].ARStatus + '</td>';

                // Current Owner(s)
                //html += '    <td style="padding:5px;" onclick="$(\'.bwRequest\').bwRequest(\'displayRequestFormDialog\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + participantId + '\', \'' + budgetRequests[i].Title + '\');">' + budgetRequests[i].CurrentOwner + '</td>';
                //html += '    <td style="padding:5px;">' + budgetRequests[i].CurrentOwner + '</td>';
                html += '   <td style="padding:5px;" ';
                html += '       onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + thiz.options.operationUriPrefix + '\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + budgetRequests[i].Title + '\', \'' + ProjectTitle_clean + '\', \'' + budgetRequests[i].Title + '\');"';
                html += '   ><span style="color:purple;font-weight:bold;">' + budgetRequests[i].CurrentOwner + '</span></td>';

                // Capital Cost
                html += '    <td style="text-align:right;">';
                html += formatCurrency(budgetRequests[i].RequestedCapital);
                html += '   </td>';
                // Expense
                html += '    <td style="text-align:right;">';
                html += formatCurrency(budgetRequests[i].RequestedExpense);
                html += '</td>';
                // Lease
                html += '    <td>na</td>';
                // Total. Strikethrough the budget amount for a rejected AR.
                if (budgetRequests[i].ARStatus == 'Rejected') {
                    //html += '    <td style="text-align:right;padding:5px;" onclick="$(\'.bwRequest\').bwRequest(\'displayRequestFormDialog\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + participantId + '\', \'' + budgetRequests[i].Title + '\');"><strike>' + formatCurrency(budgetRequests[i].BudgetAmount) + '</strike></td>';
                    //html += '    <td style="text-align:right;padding:5px;"><strike>' + formatCurrency(budgetRequests[i].BudgetAmount) + '</strike></td>';
                    html += '   <td style="text-align:right;padding:5px;" ';
                    html += '       onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + thiz.options.operationUriPrefix + '\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + budgetRequests[i].Title + '\', \'' + ProjectTitle_clean + '\', \'' + budgetRequests[i].Title + '\');"';
                    html += '   >' + '<strike>' + formatCurrency(budgetRequests[i].BudgetAmount) + '</strike>' + '</td>';

                } else {
                    //html += '    <td style="text-align:right;padding:5px;" onclick="$(\'.bwRequest\').bwRequest(\'displayRequestFormDialog\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + participantId + '\', \'' + budgetRequests[i].Title + '\');">' + formatCurrency(budgetRequests[i].BudgetAmount) + '</td>';
                    //html += '    <td style="text-align:right;padding:5px;">' + formatCurrency(budgetRequests[i].BudgetAmount) + '</td>';
                    html += '   <td style="text-align:right;padding:5px;" ';
                    html += '       onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + thiz.options.operationUriPrefix + '\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + budgetRequests[i].Title + '\', \'' + ProjectTitle_clean + '\', \'' + budgetRequests[i].Title + '\');"';
                    html += '   >' + formatCurrency(budgetRequests[i].BudgetAmount) + '</td>';

                }

                //html += '    <td>';
                //tempCloseOutXml = budgetRequests[i].bwDocumentXml;
                //html += '       <a href="javascript:displayForm_DisplayCloseOut();" style="white-space:nowrap;">Close Out</a>';
                //html += '    </td>';

                // Simple Payback
                html += '    <td style="text-align:center;">Nox</td>';





                // Modified Date
                var timestamp4 = bwCommonScripts.getBudgetWorkflowStandardizedDate(budgetRequests[i].Modified);
                //html += '    <td style="text-align:center;">' + getFriendlyDateAndTime(budgetRequests[i].Modified) + '</td>';
                html += '    <td style="text-align:center;">' + timestamp4 + '</td>';




                // Trash Bin
                html += '<td style="padding:5px;" onclick="$(\'.bwDataGrid\').bwDataGrid(\'cmdDisplayDeleteBudgetRequestDialog\', \'' + budgetRequests[i].bwBudgetRequestId + '\', \'' + budgetRequests[i].Title + '\');">';
                html += '  <img src="images/trash-can.png" title="Delete" style="cursor:pointer;" />';
                html += '</td>';

                html += '  </tr>';
                for (var x = 0; x < supplementals[i].length; x++) {
                    // Display the supplementals.
                    html += '  <tr style="font-style:italic;font-size:small;">';
                    //html += '      <td><a href="javascript:displayArOnTheHomePage(\'' + supplementals[i][x].bwBudgetRequestId + '\', \'' + participantId + '\', \'' + supplementals[i][x].Title + '\');">' + supplementals[i][x].ProjectTitle + '</a></td>';
                    html += '      <td><a onclick="$(\'.bwRequest\').bwRequest(\'displayRequestFormDialog\', \'' + supplementals[i][x].bwBudgetRequestId + '\', \'' + participantId + '\', \'' + supplementals[i][x].Title + '\');">' + supplementals[i][x].ProjectTitle + '</a></td>';
                    for (var x2 = 0; x2 < BWMData[0].length; x2++) {
                        if (BWMData[0][x2][0] == workflowAppId) {
                            for (var y = 0; y < BWMData[0][x2][4].length; y++) {
                                if (BWMData[0][x2][4][y][0] == supplementals[i][x].FunctionalAreaId) {
                                    // We have found the financial area, so we have the title! Yay!
                                    var faTitle = BWMData[0][x2][4][y][1];
                                    html += '<td>';
                                    html += faTitle;
                                    html += '</td>';
                                }
                            }
                        }
                    }
                    html += '    <td style="text-align:right;">' + supplementals[i][x].BudgetAmount + '</td>';
                    html += '    <td>' + supplementals[i][x].BudgetWorkflowStatus + '</td>';
                    html += '    <td></td>';
                    html += '    <td>' + supplementals[i][x].CurrentOwner + '</td>';
                    html += '  </tr>';
                }
            }
            html += '<tr><td colspan="12"></td></tr>'; // DONE
            html += '</table>';



            html += '</div>';






            html += this.generateHomePageNotificationScreenHtml_new();






            $('#divBwExecutiveSummariesCarousel222').html(html);

        } catch (e) {
            console.log('Exception in displayDetailedList(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in displayDetailedList(): ' + e.message + ', ' + e.stack);
        }
    },



    generateHomePageNotificationScreenHtml_new: function () {
        try {
            console.log('In generateHomePageNotificationScreenHtml_new().');
            alert('In generateHomePageNotificationScreenHtml_new().');

            var taskData = this.options.taskData;
            var brData = this.options.brData;
            var myBrData = this.options.myBrData
            var serverside = false;
            var deferredIndex = this.options.deferredIndex;
            var bwWorkflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
            var invitationData = null;

            if (!(taskData && taskData.length)) {

                console.log('In generateHomePageNotificationScreenHtml_new(). Unexpected error: no taskData.');
                displayAlertDialog('In generateHomePageNotificationScreenHtml_new(). Unexpected error: no taskData.');

            } else {

                html += '       <table><tbody>';
                for (var i = 0; i < taskData.length; i++) {
                    var bwWorkflowTaskItemId = taskData[i].bwWorkflowTaskItemId; // added 12-23-2021
                    var taskTitle = taskData[i].bwTaskTitle;
                    var appWebUrl = appweburl;
                    var budgetRequestId = taskData[i].bwRelatedItemId;
                    var arName = taskData[i].Title; // DUPLICATE
                    var brTitle = taskData[i].ProjectTitle;
                    var title = taskData[i].Title;
                    var budgetAmount = taskData[i].BudgetAmount;
                    var requestedCapital = taskData[i].RequestedCapital;
                    var requestedExpense = taskData[i].RequestedExpense;
                    var taskType = taskData[i].TaskType;
                    var bwAssignedToRaciRoleAbbreviation = taskData[i].bwAssignedToRaciRoleAbbreviation;
                    var bwAssignedToRaciRoleName = taskData[i].bwAssignedToRaciRoleName;
                    var orgId = taskData[i].OrgId;
                    var orgName = taskData[i].OrgName;
                    var currentAmount = 0;
                    if (budgetAmount == 'null') {
                        currentAmount = Number(requestedCapital) + Number(requestedExpense);
                    } else {
                        currentAmount = budgetAmount;
                    }
                    var daysSinceTaskCreated = 0;
                    debugger; // 3-1-2022
                    if (taskData[i].Created) {
                        var cd = taskData[i].Created;
                        var year = cd.split('-')[0];
                        var month = cd.split('-')[1];
                        var day = cd.split('-')[2].split('T')[0];
                        var taskCreatedDate = new Date(Number(year), Number(month) - 1, Number(day) - 1); // +1 because we're using overdue date.
                        var todaysDate = new Date();
                        var utc1 = Date.UTC(taskCreatedDate.getFullYear(), taskCreatedDate.getMonth(), taskCreatedDate.getDate());
                        var utc2 = Date.UTC(todaysDate.getFullYear(), todaysDate.getMonth(), todaysDate.getDate());
                        var _MS_PER_DAY = 1000 * 60 * 60 * 24;
                        daysSinceTaskCreated = Math.floor((utc2 - utc1) / _MS_PER_DAY);
                    } else {
                        daysSinceTaskCreated = '<span title="This is likely an old task, created before the Create date format was changed." alt="This is likely an old task, created before the Create date format was changed.">[error xcx232135-1-3-1]</span>';
                    }

                    html += '       <tr>';
                    html += '           <td style="width:10px;"></td>';
                    html += '           <td style="width:10px;"></td>';
                    var functionalAreaId = taskData[i].FinancialAreaId; // Find the functional area name.
                    var functionalAreaName = '';
                    try {
                        if (BWMData[0]) {
                            for (var x = 0; x < BWMData[0].length; x++) {
                                if (BWMData[0][x][0] = bwWorkflowAppId) { // We have the correct workflow!
                                    for (var fai = 0; fai < BWMData[0][x][4].length; fai++) {
                                        if (functionalAreaId == BWMData[0][x][4][fai][0]) {
                                            functionalAreaName = BWMData[0][x][4][fai][1];
                                        }
                                    }
                                }
                            }
                        }
                    } catch (e) {
                    }
                    if (taskType == 'RECURRING_EXPENSE_NOTIFICATION_TASK') {
                        html += '       <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;" colspan="5">';
                        html += '           <div style="display:inline-block;">';
                        html += '               <a style="cursor:pointer;" onclick="displayRecurringExpenseOnTheHomePage(\'' + budgetRequestId + '\', \'' + participantId + '\', \'' + title + '\');" target="_blank" title="Click to view the recurring expense...">' + daysSinceTaskCreated.toString() + ' days overduexcx1: Recurring expense <em>(' + brTitle + ' - ' + functionalAreaName + ') is due to be submitted</em></a>';
                        html += '           </div>';
                        html += '       </td>';
                    } else if (taskType == 'BUDGET_REQUEST_WORKFLOW_TASK') {
                        html += '       <td style="width:45px;"></td>';
                        html += '       <td style="background-color:white;" ';
                        html += '           onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'' + title + '\', \'' + brTitle + '\', \'' + '' + '\', \'' + bwWorkflowAppId + '\', \'' + budgetRequestId + '\', \'' + orgId + '\', \'' + orgName + '\', this);" ';
                        html += '           onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');" ';
                        html += '>';
                        html += '           <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="' + imageRootPath + '/images/zoom.jpg" />';
                        html += '       </td>';
                        html += '       <td colspan="3" style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" ';
                        html += '           onmouseenter="this.style.backgroundColor=\'lightgoldenrodyellow\';bwCommonScripts.highlightExecutiveSummaryForRequest(\'' + budgetRequestId + '\');" ';
                        html += '           onmouseleave="this.style.backgroundColor=\'#d8d8d8\';bwCommonScripts.unHighlightExecutiveSummaryForRequest(\'' + budgetRequestId + '\');"  ';

                        var ProjectTitle_clean = brTitle.replace(/["]/g, '&quot;').replace(/[']/g, '&#39;'); // This is done because if the ProjectTitle (description) has a quote in it, there will be issues! The click event will fail to invoke the method. 


                        html += '           onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'' + appWebUrl + '\', \'' + budgetRequestId + '\', \'' + arName + '\', \'' + ProjectTitle_clean + '\', \'' + title + '\', \'' + bwAssignedToRaciRoleAbbreviation + '\', \'' + bwWorkflowTaskItemId + '\');" ';
                        html += '>';
                        html += '           <div style="display:inline-block;" bwtrace="xcx778451">';
                        if (daysSinceTaskCreated == 1) {
                            html += '           &nbsp;&nbsp;' + daysSinceTaskCreated.toString() + ' day overduexcx1: ';
                        } else {
                            html += '           &nbsp;&nbsp;' + daysSinceTaskCreated.toString() + ' days overduexcx2: ';
                        }
                        html += '               <em>';
                        html += title + ' - ' + brTitle + ' - ' + formatCurrency(currentAmount) + ' - ' + functionalAreaName + ' ' + '[(' + bwAssignedToRaciRoleAbbreviation + ') ' + bwAssignedToRaciRoleName + ']';
                        html += '               </em>';
                        html += '           </div>';
                        html += '       </td>';
                    } else {
                        html += '       <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;" colspan="5">UNKNOWN TASK TYPE</td>';
                    }
                    html += '       </tr>';
                }
                html += '       </tbody></table>';

                return html;

            }

        } catch (e) {
            console.log('Exception in generateHomePageNotificationScreenHtml_new():1335-1: ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in generateHomePageNotificationScreenHtml_new():1335-1: ' + e.message + ', ' + e.stack);
            var result = {
                html: 'Exception in generateHomePageNotificationScreenHtml_new():1335-1: ' + e.message + ', ' + e.stack
            }
            return result;
        }
    },




    getTheLatestRequestsAndRender_OnThisDevice: function (spinnerText) {
        try {
            console.log('In bwAuthentication.getTheLatestRequestsAndRender_OnThisDevice().');
            var thiz = this;
            alert('In getTheLatestRequestsAndRender_OnThisDevice(). This functionality is incomplete. Coming soon!');
            debugger;
            //var workflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');

            //var carouselItemIndex = 0;
            //for (var i = (this.options.taskData.length - 1) ; i > -1; i--) {
            //    if (carouselItemIndex < 100) { // This is where we set how many tasks we will display in the carousel. Zero-based, so < 5 means display 5 tasks.

            //        var bwBudgetRequestId = this.options.taskData[i].bwRelatedItemId;
            //        var bwWorkflowTaskItemId = this.options.taskData[i].bwWorkflowTaskItemId;

            //        var carouselItem_Id = 'bwExecutiveSummariesCarousel2_executiveSummaryInCarousel_' + carouselItemIndex;

            //        var html = '';

            //        html += '   <div id="' + carouselItem_Id + '" class="executiveSummaryInCarousel" bwbudgetrequestid="" style="min-width:300px;display:inline-block;white-space:nowrap;color: rgb(38, 38, 38); font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif; font-size: 1.25em;" ';
            //        //this.carouselItem_AddOnClick(carouselItem_Id, bwBudgetRequestId, this.options.taskData[i].Title, this.options.taskData[i].ProjectTitle, this.options.taskData[i].bwAssignedToRaciRoleAbbreviation, bwWorkflowTaskItemId);
            //        html += '       onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'https://budgetworkflow.com\', \'' + bwBudgetRequestId + '\', \'' + this.options.taskData[i].Title + '\', \'' + this.options.taskData[i].ProjectTitle + '\', \'' + this.options.taskData[i].Title + '\', \'' + this.options.taskData[i].bwAssignedToRaciRoleAbbreviation + '\', \'' + bwWorkflowTaskItemId + '\');" ';
            //        html += '   >';


            //        html += '<br />';
            //        //html += '<span style="font-size:18pt;color:purple;font-weight:bold;">Task: <span style="color:goldenrod;font-size:18pt;font-weight:bold;">' + this.options.taskData[i].bwTaskTitle + '</span></span>'; // font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;
            //        html += '<span style="color:goldenrod;font-size:18pt;font-weight:bold;">' + this.options.taskData[i].bwTaskTitle + '</span>'; // font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;










            //        html += '<br />';
            //        html += '<span style="color:black;font-size:12pt;font-weight:normal;">Your role: <span style="font-weight:bold;">' + this.options.taskData[i].bwAssignedToRaciRoleName + ' (' + this.options.taskData[i].bwAssignedToRaciRoleAbbreviation + ')</span></span>';



            //        html += '<br />';
            //        var timestamp4 = bwCommonScripts.getBudgetWorkflowStandardizedDate(this.options.taskData[i].Created);
            //        html += '<span style="color:black;font-size:12pt;font-weight:normal;">Task created: ' + timestamp4.toString() + '</span>';



            //        html += '<br />';
            //        if (this.options.taskData[i].bwStatus.toString().toLowerCase() == 'collaboration') {
            //            html += '<span style="font-size:12pt;color:black;font-weight:normal;">bwStatus: <span style="font-weight:bold;">' + this.options.taskData[i].bwStatus + ' </span><span style="color:black;font-size:12pt;font-weight:normal;">[xx time left]</span></span>'; // font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;
            //        } else {
            //            html += '<span style="font-size:12pt;color:black;font-weight:normal;">bwStatus: <span style="font-weight:bold;">' + this.options.taskData[i].bwStatus + ' </span><span style="color:black;font-size:12pt;font-weight:normal;">[xx days old]</span></span>'; // font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;
            //            // bwStatus, bwRelatedItemId, bwWorkflowTaskItemId
            //        }









            //        html += '<br />';
            //        html += '<hr style="color:skyblue;" />';

            //        html += '<span style="font-size:12pt;"><span style="color:goldenrod;font-size:18pt;font-weight:bold;">' + this.options.taskData[i].Title + '</span></span>';
            //        html += '<br />';
            //        //html += '<span style="font-size:12pt;">Description: <span style="color:goldenrod;font-size:18pt;font-weight:bold;">' + this.options.taskData[i].ProjectTitle + '</span></span>';
            //        html += '<span style="color:goldenrod;font-size:18pt;font-weight:bold;">' + this.options.taskData[i].ProjectTitle + '</span>';
            //        html += '<br />';

            //        html += '<span style="color:black;font-size:12pt;font-weight:normal;">Requested by: ' + this.options.taskData[i].CreatedBy + '</span>';
            //        html += '<br />';




            //        // 2-8-2022
            //        var RequestedCapital_cleaned = $('.bwAuthentication').bwAuthentication('getBudgetWorkflowStandardizedCurrency', this.options.taskData[i].RequestedCapital);
            //        html += '<span style="color:black;font-size:12pt;font-weight:normal;">Requested capital: <span style="color:purple;font-size:18pt;">' + RequestedCapital_cleaned + '</span></span>';
            //        html += '<br />';




            //        debugger;
            //        var timestamp4;
            //        var requestCreatedDate;
            //        for (var r = 0; r < this.options.brData.PendingBudgetRequests.length; r++) {
            //            if (bwBudgetRequestId == this.options.brData.PendingBudgetRequests[r].bwBudgetRequestId) {
            //                // We found it!
            //                requestCreatedDate = this.options.brData.PendingBudgetRequests[r].Created;
            //            }
            //        }
            //        if (requestCreatedDate) {
            //            timestamp4 = bwCommonScripts.getBudgetWorkflowStandardizedDate(requestCreatedDate);
            //        } else {
            //            timestamp4 = '[not available]';
            //        }
            //        html += '<span style="color:black;font-size:12pt;font-weight:normal;">Request created: ' + timestamp4 + '</span>';
            //        html += '<br />';





            //        html += '<span style="color:black;font-size:12pt;font-weight:normal;">Org: <span style="">' + this.options.taskData[i].OrgName + '</span></span>';
            //        html += '<br />';
            //        html += '<br />';

            //        var bwWorkflowTaskItemId = this.options.taskData[i].bwWorkflowTaskItemId;
            //        html += '        <div id="bwExecutiveSummariesCarousel_spanBwExecutiveSummariesCarouselPrimaryImages_' + bwWorkflowTaskItemId + '" style="text-align: center;">';
            //        html += '        </div>';
            //        html += '   </div>';

            //        //debugger;
            //        $('#divBwExecutiveSummariesCarousel222').append(html); // Create the html in the div tag.

            //        console.log('Calling carouselItem_AddOnClick() xcx124254235');
            //        // Now add the onclick event.
            //        //var bwWorkflowTaskItemId = this.options.taskData[i].bwWorkflowTaskItemId;
            //        //this.carouselItem_AddOnClick(carouselItem_Id, bwBudgetRequestId, this.options.taskData[i].Title, this.options.taskData[i].ProjectTitle, this.options.taskData[i].bwAssignedToRaciRoleAbbreviation, bwWorkflowTaskItemId);

            //        carouselItemIndex += 1;





            //        //
            //        // Display inventory images
            //        //
            //        // 

            //        var InventoryItems = [];
            //        for (var j = 0; j < this.options.brData.PendingBudgetRequests.length; j++) {
            //            //debugger;
            //            //var x = '';
            //            if (bwBudgetRequestId == this.options.brData.PendingBudgetRequests[j].bwBudgetRequestId) {
            //                //debugger;
            //                var tmpJson = this.options.brData.PendingBudgetRequests[j].bwRequestJson;
            //                var json = JSON.parse(tmpJson);
            //                //debugger;


            //                if (json && json.bwSelectInventoryItems && json.bwSelectInventoryItems.value) {
            //                    InventoryItems = json.bwSelectInventoryItems.value; //this.options.brData.PendingBudgetRequests[j].bwRequestJson;
            //                }
            //                break;
            //            }
            //        }

            //        if (InventoryItems.length > 0) {
            //            var guid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            //                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
            //                return v.toString(16);
            //            });
            //            for (var j = 0; j < InventoryItems.length; j++) {
            //                //debugger;
            //                var html = '';

            //                //var imagePath = thiz.options.operationUriPrefix + '_files/' + workflowAppId + '/inventoryimages/' + InventoryItems[j].bwInventoryItemId + '/inventoryimage.png?v=' + guid;
            //                var imagePath = globalUrlPrefix + globalUrl + '/_files/' + workflowAppId + '/inventoryimages/' + InventoryItems[j].bwInventoryItemId + '/inventoryimage.png?v=' + guid;
            //                html += '<img src="' + imagePath + '" style="height:150px;" />';
            //                html += '<br />';

            //                $('#bwExecutiveSummariesCarousel_spanBwExecutiveSummariesCarouselPrimaryImages_' + bwWorkflowTaskItemId).append(html);

            //            }
            //        }

            //        //
            //        // end: Display inventory images
            //        //


            //        var renderAttachments = function (bwWorkflowTaskItemId) {
            //            try {
            //                //debugger;
            //                var operationUri = globalUrlPrefix + globalUrl + '/_files/' + 'getprimaryimageforbudgetrequest/' + workflowAppId + '/' + bwBudgetRequestId; // _files allows us to use nginx to route these to a dedicated file server.
            //                $.ajax({
            //                    url: operationUri,
            //                    method: "GET",
            //                    headers: {
            //                        "Accept": "application/json; odata=verbose"
            //                    },
            //                    success: function (data) {
            //                        try {

            //                            var bwBudgetRequestId;
            //                            if (data[0]) {
            //                                bwBudgetRequestId = data[0].bwBudgetRequestId;
            //                            }
            //                            var html = '';
            //                            try {
            //                                for (var i = 0; i < data.length; i++) {
            //                                    if (bwBudgetRequestId) {
            //                                        var fileName = data[i].Filename;
            //                                        if ((fileName.toUpperCase().indexOf('.XLSX') > -1) || (fileName.toUpperCase().indexOf('.XLS') > -1)) {

            //                                            html += '<img src="images/excelicon.png" style="width:100px;height:46px;cursor:pointer;" />';

            //                                        } else if (fileName.toUpperCase().indexOf('.MP4') > -1) {

            //                                            html += '<img src="images/mp4.jfif" style="width:100px;cursor:pointer;" />';

            //                                        } else {

            //                                            var imageUrl = globalUrlPrefix + globalUrl + '/_files/' + workflowAppId + '/' + bwBudgetRequestId + '/' + fileName;
            //                                            html += '<img src="' + imageUrl + '" style="height:150px;" />';
            //                                            html += '<br />';

            //                                        }
            //                                    }
            //                                }

            //                            } catch (e) {
            //                                console.log('Didn\'t find an image for data: ' + JSON.stringify(data));
            //                                html = '[no image found]';
            //                                //document.getElementById('spanExecutiveSummaryPrimaryImages_' + bwBudgetRequestId).innerHTML = html;
            //                            }
            //                            if (bwBudgetRequestId) {
            //                                //document.getElementById('bwExecutiveSummariesCarousel_spanBwExecutiveSummariesCarouselPrimaryImages_' + bwBudgetRequestId).innerHTML = html;
            //                                $('#bwExecutiveSummariesCarousel_spanBwExecutiveSummariesCarouselPrimaryImages_' + bwWorkflowTaskItemId).append(html); // 1-25-2022  bwBudgetRequestId).append(html);
            //                            }
            //                        } catch (e) {
            //                            if (e.number) {
            //                                displayAlertDialog('Error in populateAttachments():1-1: ' + e.number + ', "' + e.message + '", ' + e.stack);
            //                            } else {
            //                                // This most likely means that the folders are there on the file services server, but there is nothing in them.
            //                                //
            //                                // Fileservices has an error, so show nothing! We will put a red exclamation pin in the attachments section eventually! - 10-1-17 todd
            //                                //displayAlertDialog('Fileservices has an error: ' + ' "' + e.message + '"');
            //                            }
            //                        }
            //                    },
            //                    error: function (data, errorCode, errorMessage) {
            //                        if (errorCode === 'timeout' && errorMessage === 'timeout') {
            //                            displayAlertDialog('SERVICE UNAVAILABLE. File services is not respondingxcx2. communication timeout is set at ' + ajaxTimeout / 1000 + ' seconds: ' + errorCode + ', ' + errorMessage);
            //                        } else {


            //                            console.log('');
            //                            console.log('********************************************************************');
            //                            console.log('Error in bwEecutiveSummariesCarousel.js.showRowHoverDetails:2:3 ' + errorCode + ', ' + errorMessage);
            //                            console.log('********************************************************************');
            //                            console.log('');

            //                            //displayAlertDialog('Error in showRowHoverDetails:2:3 ' + errorCode + ', ' + errorMessage);





            //                            // The latest error 1-17-2018 is errorCode:'error' and errorMessage:'Not Found'.
            //                            // What does this mean? You can replicate this error!
            //                            // at Url: https://budgetworkflow.com/ios8.html, view an offline (Un-submitted) request, and try to add an attachment.
            //                        }
            //                    }
            //                });
            //            } catch (e) {
            //                console.log('Exception in bwAuthentication.js.renderAttachments(): ' + e.message + ', ' + e.stack);
            //                displayAlertDialog('Exception in bwAuthentication.js.renderAttachments(): ' + e.message + ', ' + e.stack);
            //            }
            //        }

            //        console.log('>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>Calling renderAttachments(). bwWorkflowTaskItemId: ' + bwWorkflowTaskItemId);
            //        renderAttachments(bwWorkflowTaskItemId);

            //    } else {
            //        break;
            //    }
            //}

        } catch (e) {
            //debugger;
            console.log('Exception in bwAuthentication.getTheLatestRequestsAndRender_OnThisDevice(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.getTheLatestRequestsAndRender_OnThisDevice(): ' + e.message + ', ' + e.stack);
        }
    },




    generateHomePageNotificationScreenHtml: function () {
        try {
            console.log('In bwAuthentication.js.generateHomePageNotificationScreenHtml().');
            alert('In bwAuthentication.js.generateHomePageNotificationScreenHtml().');

            var taskData = this.options.taskData;
            var brData = this.options.brData;
            var myBrData = this.options.myBrData
            var serverside = false;
            var deferredIndex = this.options.deferredIndex;
            var bwWorkflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
            var invitationData = null;

            // Change the page title to indicate the # of tasks. This will show up in the browser tab and is a cool way to show the user they have alerts.
            if (taskData.length > 0) {
                //debugger;
                if (myBrData && myBrData.MyRequests && myBrData.MyRequests.length & myBrData.MyRequests.length > 0) {
                    document.title = myBrData.MyRequests[0].OrgName + ' (' + taskData.length + ')';
                } else {
                    //document.title = 'Budget items (' + taskData.length + ')';
                    document.title = taskData.length + ' budget items';
                }

                // Change the css to red/orange.
                //swapStyleSheet("css/bw.core.colors.red.orange.css");
                // Change the currency indicator to the one with the red dot. This obviously depends upon consistent naming!
                renderFavicon(true);
            } else {
                document.title = 'No pending tasks'; // 4-18-2022 changed from 'No budget items'; //'My Budgetsxcx2';
                // Change the css to blue/blue.
                //swapStyleSheet("css/bw.core.colors.blue.blue.css");
                // Change the currency indicator to the one without the red dot. This obviously depends upon consistent naming!
                renderFavicon(false);
            }
            //} catch (e) { }

            var html = '';

            html += '<style>';
            html += '.bwExecutiveSummariesCarousel2_SelectorButton {';
            html += '   border:2px solid gray;';
            html += '   padding:3px 3px 3px 3px;';
            html += '   border-radius:20px 20px 20px 20px;';
            html += '   width:25px;height:25px;';
            html += '   display:inline-block;';
            html += '   cursor:pointer;';
            html += '}';
            html += '.bwExecutiveSummariesCarousel2_SelectorButton:hover {';
            html += '   border:2px solid goldenrod;';
            html += '}';
            html += '</style>';
            //
            // Display the pending tasks.
            //
            if (taskData.length == 0 && brData.PendingBudgetRequests.length == 0 && brData.PendingPOBudgetRequests.length == 0) {
                html += 'You have no pending tasks, and there are no pending requests.';
            }

            if (serverside && serverside == true) {
                html += '<table id="tblHomePageAlertSectionForWorkflow' + deferredIndex.toString() + '" style="cursor:default;opacity:0.5;" >'; // Makes the email/serverside rendering have an opacity setting.
            } else {
                html += '<table id="tblHomePageAlertSectionForWorkflow' + deferredIndex.toString() + '" style="cursor:default;" >';
            }
            //html += '<tbody>';













            //
            // Top row, "My Tasks" summary.
            //
            var rowId = 'functionalAreaRow_' + deferredIndex.toString() + '_1';
            var imageId = 'alertSectionImage_' + deferredIndex.toString() + '_1';
            var collapsibleRowId = 'alertSectionRow_' + deferredIndex.toString() + '_1';

            html += '<tr id="' + rowId + '" class="bwFunctionalAreaRow bwNoUserSelect" >';
            if (taskData.length > 0) {
                if (taskData.length == 1) {
                    html += '<td style="width:11px;vertical-align:top;" class="bwNoUserSelect" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'expandOrCollapseAlertsSection\', \'' + rowId + '\', \'' + imageId + '\', \'' + collapsibleRowId + '\');" ><img src="' + imageRootPath + '/images/red-dot.png" width="11" height="11" alt="" style="cursor:pointer;vertical-align:top;float:right;" /></td>';
                    html += '<td style="padding-left:11px;" class="bwHPNDrillDownLinkCell2 bwNoUserSelect" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'expandOrCollapseAlertsSection\', \'' + rowId + '\', \'' + imageId + '\', \'' + collapsibleRowId + '\');" >';
                    html += '   <img title="expand" id="' + imageId + '" style="cursor:pointer;width:45px;height:45px;vertical-align:middle;" src="' + imageRootPath + '/images/drawer-open.png">';
                } else {
                    html += '<td style="width:11px;vertical-align:top;" class="bwNoUserSelect" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'expandOrCollapseAlertsSection\', \'' + rowId + '\', \'' + imageId + '\', \'' + collapsibleRowId + '\');" ><img src="' + imageRootPath + '/images/red-dot.png" width="11" height="11" alt="" style="cursor:pointer;vertical-align:top;float:right;" /></td>';
                    html += '<td style="padding-left:11px;" class="bwHPNDrillDownLinkCell2 bwNoUserSelect" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'expandOrCollapseAlertsSection\', \'' + rowId + '\', \'' + imageId + '\', \'' + collapsibleRowId + '\');" >';
                    html += '   <img title="expand" id="' + imageId + '" style="cursor:pointer;width:45px;height:45px;vertical-align:middle;float:none;" src="' + imageRootPath + '/images/drawer-open.png">';
                }
            } else {
                html += '   <td style="width:11px;" class="bwNoUserSelect" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'expandOrCollapseAlertsSection\', \'' + rowId + '\', \'' + imageId + '\', \'' + collapsibleRowId + '\');" ></td>';
                html += '   <td style="padding-left:60px;height:45px;" class="bwHPNDrillDownLinkCell2 bwNoUserSelect" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'expandOrCollapseAlertsSection\', \'' + rowId + '\', \'' + imageId + '\', \'' + collapsibleRowId + '\');"  >';
            }
            html += '           <span class="bwNoUserSelect"  >';
            if (taskData.length == 1) {
                html += 'You have ' + taskData.length + ' pending task.';
            } else {
                html += 'You have ' + taskData.length + ' pending tasks.';
            }
            html += '           </span>';


            html += '       </td>';
            html += '       <td style="width:2%;" class="bwHPNDrillDownLinkCell2">';
            //html += '           <div style="float:right;padding-top:10px;">';// The new Expand/Collapse button for the executive summaries and image display. 10-15-2020.
            //html += '               <span id="spanExpandOrCollapseRightSliderPaneButton" style="cursor:pointer;" onclick="bwCommonScripts.expandOrCollapseExecutiveSummaries();">';
            //html += '                   <span title="View executive summaries..." style="width:200px;padding:5px 10px 5px 10px;margin:0 0 0 20px;white-space:nowrap;vertical-align:top;border:1px solid lightblue;cursor:pointer;font-weight:normal;font-size:20pt;">';
            //html += '                       <span style="display:inline-block;">+/- Executive Summaries</span>';
            //html += '                   </span>';
            //html += '                   <span id="divEmailEditorHorizontalSliderPane" style="width:200px;display:inline;"></span>';
            //html += '               </span>';
            //html += '           </div>';
            html += '       </td>';
            html += '</tr>';


            // Top row, "My Tasks" details.
            //html += '<tr id="' + collapsibleRowId + '" style="display:table-row;">'; // style="display:none;"
            html += '<tr id="' + collapsibleRowId + '" style="display:none;">';
            html += '   <td style="vertical-align:top;">';

            //html += '       <div class="bwExecutiveSummariesCarousel2_SelectorButton" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'displayExecutiveSummaries\');" title="Display executive summaries..." >';
            //html += '           <img src="/images/tiles.png" style="width:50px;height:50px;" />';
            //html += '       </div>';
            //html += '       &nbsp;';
            //html += '       <div class="bwExecutiveSummariesCarousel2_SelectorButton" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'displayDetailedList\');" title="Display detailed list..." >';
            //html += '           <img src="/images/detailedlist.png" style="width:50px;height:50px;" />';
            //html += '       </div>';

            html += '   </td>';
            html += '   <td colspan="2">';

            html += '<table><tr><td style="vertical-align:top;width:60px;">';
            html += '       <div class="bwExecutiveSummariesCarousel2_SelectorButton" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'displayExecutiveSummaries\');" title="Display executive summaries..." >';
            html += '           <img src="/images/tiles.png" style="width:50px;height:50px;" />';
            html += '       </div>';






            //// 2-20-2022 This is the new button I am working on.
            //html += '<style>';
            //html += '   .divCarouselButton {';
            //html += '       transform: scale(0.25);';
            //html += '       padding:20px 20px 20px 20px;';
            //html += '       border:2px solid gray;';
            //html += '       width:200px;';
            //html += '   }';
            //html += '   .divCarouselButton:hover {';
            //html += '       background-color:goldenrod;';
            //html += '       cursor:pointer;';
            //html += '   }';
            //html += '   .divCarouselButton_SmallButton {';
            //html += '       border:5px solid skyblue;';
            //html += '       border-radius:20px 20px 20px 20px;';
            //html += '       width:80px;height:80px;';
            //html += '   }';
            //html += '   .divCarouselButton_SmallButton:hover {';
            //html += '       background-color:skyblue;';
            //html += '   }';
            //html += '</style>';
            //html += '       <div style="display:inline:block;" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'displayExecutiveSummaries\');" title="Display executive summaries..." >';
            //html += '           <div class="divCarouselButton" style="">';
            //html += '               <table>';
            //html += '                   <tr>';
            //html += '                       <td>';
            //html += '                           <div class="divCarouselButton_SmallButton" ></div>';
            //html += '                       </td>';
            //html += '                       <td>';
            //html += '                           <div class="divCarouselButton_SmallButton" ></div>';
            //html += '                       </td>';
            //html += '                   </tr>';
            //html += '                   <tr>';
            //html += '                       <td>';
            //html += '                           <div class="divCarouselButton_SmallButton" ></div>';
            //html += '                       </td>';
            //html += '                       <td>';
            //html += '                           <div class="divCarouselButton_SmallButton" ></div>';
            //html += '                       </td>';
            //html += '                   </tr>';
            //html += '               </table>';
            //html += '           </div>';
            //html += '       </div>';







            html += '       &nbsp;';
            html += '       <div class="bwExecutiveSummariesCarousel2_SelectorButton" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'displayDetailedList\');" title="Display detailed list..." >';
            html += '           <img src="/images/detailedlist.png" style="width:50px;height:50px;" />';
            html += '       </div>';

            html += '</td><td>';


            var display = 'carousel';
            if (display == 'displaytext') { // Display the items as text, not the executive summary carousel.
                html += '       <table><tbody>';
                for (var i = 0; i < taskData.length; i++) {
                    var bwWorkflowTaskItemId = taskData[i].bwWorkflowTaskItemId; // added 12-23-2021
                    var taskTitle = taskData[i].bwTaskTitle;
                    var appWebUrl = appweburl;
                    var budgetRequestId = taskData[i].bwRelatedItemId;
                    var arName = taskData[i].Title; // DUPLICATE
                    var brTitle = taskData[i].ProjectTitle;
                    var title = taskData[i].Title;
                    var budgetAmount = taskData[i].BudgetAmount;
                    var requestedCapital = taskData[i].RequestedCapital;
                    var requestedExpense = taskData[i].RequestedExpense;
                    var taskType = taskData[i].TaskType;
                    var bwAssignedToRaciRoleAbbreviation = taskData[i].bwAssignedToRaciRoleAbbreviation;
                    var bwAssignedToRaciRoleName = taskData[i].bwAssignedToRaciRoleName;
                    var orgId = taskData[i].OrgId;
                    var orgName = taskData[i].OrgName;
                    var currentAmount = 0;
                    if (budgetAmount == 'null') {
                        currentAmount = Number(requestedCapital) + Number(requestedExpense);
                    } else {
                        currentAmount = budgetAmount;
                    }
                    var daysSinceTaskCreated = 0;
                    if (taskData[i].Created) {
                        var cd = taskData[i].Created;
                        var year = cd.split('-')[0];
                        var month = cd.split('-')[1];
                        var day = cd.split('-')[2].split('T')[0];
                        var taskCreatedDate = new Date(Number(year), Number(month) - 1, Number(day) - 1); // +1 because we're using overdue date.
                        var todaysDate = new Date();
                        var utc1 = Date.UTC(taskCreatedDate.getFullYear(), taskCreatedDate.getMonth(), taskCreatedDate.getDate());
                        var utc2 = Date.UTC(todaysDate.getFullYear(), todaysDate.getMonth(), todaysDate.getDate());
                        var _MS_PER_DAY = 1000 * 60 * 60 * 24;
                        daysSinceTaskCreated = Math.floor((utc2 - utc1) / _MS_PER_DAY);
                    } else {
                        daysSinceTaskCreated = '[error xcx232135-1-2]';
                    }

                    html += '       <tr>';
                    html += '           <td style="width:10px;"></td>';
                    html += '           <td style="width:10px;"></td>';
                    var functionalAreaId = taskData[i].FinancialAreaId; // Find the functional area name.
                    var functionalAreaName = '';
                    try {
                        if (BWMData[0]) {
                            for (var x = 0; x < BWMData[0].length; x++) {
                                if (BWMData[0][x][0] = bwWorkflowAppId) { // We have the correct workflow!
                                    for (var fai = 0; fai < BWMData[0][x][4].length; fai++) {
                                        if (functionalAreaId == BWMData[0][x][4][fai][0]) {
                                            functionalAreaName = BWMData[0][x][4][fai][1];
                                        }
                                    }
                                }
                            }
                        }
                    } catch (e) { }
                    if (taskType == 'RECURRING_EXPENSE_NOTIFICATION_TASK') {
                        html += '       <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;" colspan="5">';
                        html += '           <div style="display:inline-block;">';
                        html += '               <a style="cursor:pointer;" onclick="displayRecurringExpenseOnTheHomePage(\'' + budgetRequestId + '\', \'' + participantId + '\', \'' + title + '\');" target="_blank" title="Click to view the recurring expense...">' + daysSinceTaskCreated.toString() + ' days overduexcx1: Recurring expense <em>(' + brTitle + ' - ' + functionalAreaName + ') is due to be submitted</em></a>';
                        html += '           </div>';
                        html += '       </td>';
                    } else if (taskType == 'BUDGET_REQUEST_WORKFLOW_TASK') {
                        html += '       <td style="width:45px;"></td>';
                        html += '       <td style="background-color:white;" ';
                        html += '           onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'' + title + '\', \'' + brTitle + '\', \'' + '' + '\', \'' + bwWorkflowAppId + '\', \'' + budgetRequestId + '\', \'' + orgId + '\', \'' + orgName + '\', this);" ';
                        html += '           onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');" ';
                        html += '>';
                        html += '           <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="' + imageRootPath + '/images/zoom.jpg" />';
                        html += '       </td>';
                        html += '       <td colspan="3" style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" ';
                        html += '           onmouseenter="this.style.backgroundColor=\'lightgoldenrodyellow\';bwCommonScripts.highlightExecutiveSummaryForRequest(\'' + budgetRequestId + '\');" ';
                        html += '           onmouseleave="this.style.backgroundColor=\'#d8d8d8\';bwCommonScripts.unHighlightExecutiveSummaryForRequest(\'' + budgetRequestId + '\');"  ';
                        html += '           onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'' + appWebUrl + '\', \'' + budgetRequestId + '\', \'' + arName + '\', \'' + encodeHtmlAttribute(brTitle) + '\', \'' + title + '\', \'' + bwAssignedToRaciRoleAbbreviation + '\', \'' + bwWorkflowTaskItemId + '\');" ';
                        html += '>';
                        html += '           <div style="display:inline-block;" bwtrace="xcx778451">';
                        if (daysSinceTaskCreated == 1) {
                            html += '           &nbsp;&nbsp;' + daysSinceTaskCreated.toString() + ' day overduexcx1: ';
                        } else {
                            html += '           &nbsp;&nbsp;' + daysSinceTaskCreated.toString() + ' days overduexcx2: ';
                        }
                        html += '               <em>';
                        html += title + ' - ' + brTitle + ' - ' + formatCurrency(currentAmount) + ' - ' + functionalAreaName + ' ' + '[(' + bwAssignedToRaciRoleAbbreviation + ') ' + bwAssignedToRaciRoleName + ']';
                        html += '               </em>';
                        html += '           </div>';
                        html += '       </td>';
                    } else {
                        html += '       <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;" colspan="5">UNKNOWN TASK TYPE</td>';
                    }
                    html += '       </tr>';
                }
                html += '       </tbody></table>';

            } else {
                // Display as the executive summary carousel.

                debugger;
                html += '<div id="divBwExecutiveSummariesCarousel222"></div>';



            }



            html += '</td></tr></table>';


            html += '   </td>';
            html += '</tr>';






















            //
            // Second row, "Active Requests" summary.
            //
            var rowId = 'functionalAreaRow_' + deferredIndex.toString() + '_2';
            var imageId = 'alertSectionImage_' + deferredIndex.toString() + '_2';
            var collapsibleRowId = 'alertSectionRow_' + deferredIndex.toString() + '_2';
            html += '<tr style="white-space:nowrap;" id="' + rowId + '" class="bwFunctionalAreaRow bwNoUserSelect" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'expandOrCollapseAlertsSection\', \'' + rowId + '\', \'' + imageId + '\', \'' + collapsibleRowId + '\');" >';
            if (brData.PendingBudgetRequests.length > 0) {
                if (brData.PendingBudgetRequests.length == 1) {
                    html += '<td style="width:11px;vertical-align:top;" class="bwNoUserSelect" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'expandOrCollapseAlertsSection\', \'' + rowId + '\', \'' + imageId + '\', \'' + collapsibleRowId + '\');"></td>';
                    html += '<td style="padding-left:11px;white-space:nowrap;" class="bwHPNDrillDownLinkCell2 bwNoUserSelect" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'expandOrCollapseAlertsSection\', \'' + rowId + '\', \'' + imageId + '\', \'' + collapsibleRowId + '\');">';
                    html += '<img title="expand" id="' + imageId + '" style="cursor:pointer;width:45px;height:45px;vertical-align:middle;" src="' + imageRootPath + '/images/drawer-open.png">';
                } else {
                    html += '<td style="width:11px;vertical-align:top;white-space:nowrap;" class="bwNoUserSelect" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'expandOrCollapseAlertsSection\', \'' + rowId + '\', \'' + imageId + '\', \'' + collapsibleRowId + '\');"></td><td style="padding-left:11px;" class="bwHPNDrillDownLinkCell2 bwNoUserSelect" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'expandOrCollapseAlertsSection\', \'' + rowId + '\', \'' + imageId + '\', \'' + collapsibleRowId + '\');">';
                    html += '<img title="expand" id="' + imageId + '" style="cursor:pointer;width:45px;height:45px;vertical-align:middle;" src="' + imageRootPath + '/images/drawer-open.png">';
                }
            } else {
                html += '<td style="width:11px;" class="bwNoUserSelect" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'expandOrCollapseAlertsSection\', \'' + rowId + '\', \'' + imageId + '\', \'' + collapsibleRowId + '\');"></td>';
                html += '<td style="padding-left:60px;height:45px;white-space:nowrap;" class="bwHPNDrillDownLinkCell2 bwNoUserSelect" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'expandOrCollapseAlertsSection\', \'' + rowId + '\', \'' + imageId + '\', \'' + collapsibleRowId + '\');">';
            }
            html += '       <span class="bwNoUserSelect" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'expandOrCollapseAlertsSection\', \'' + rowId + '\', \'' + imageId + '\', \'' + collapsibleRowId + '\');">';
            if (brData.PendingBudgetRequests.length == 1) {
                html += 'There is ' + brData.PendingBudgetRequests.length + ' budget request going through the approval process.';
            } else {
                html += 'There are ' + brData.PendingBudgetRequests.length + ' budget requests going through the approval process.';
            }
            html += '       </span>';
            html += '   </td>';


            html += '<td class="bwHPNDrillDownLinkCell2"></td>';


            html += '</tr>';


            // Second row, "Active Requests" details.
            html += '<tr id="' + collapsibleRowId + '" style="display:none;">';
            html += '<td></td>';
            html += '<td colspan="2"><table><tbody>';
            for (var i = 0; i < brData.PendingBudgetRequests.length; i++) {
                var appWebUrl = appweburl;
                var budgetRequestId = brData.PendingBudgetRequests[i].bwBudgetRequestId;
                var projectTitle = brData.PendingBudgetRequests[i].ProjectTitle;
                var title = brData.PendingBudgetRequests[i].Title;
                var budgetAmount = brData.PendingBudgetRequests[i].BudgetAmount;
                var requestedCapital = brData.PendingBudgetRequests[i].RequestedCapital;
                var requestedExpense = brData.PendingBudgetRequests[i].RequestedExpense;
                var currentAmount = 0;
                if (budgetAmount == 'null') {
                    currentAmount = Number(requestedCapital) + Number(requestedExpense);
                } else {
                    currentAmount = budgetAmount;
                }
                html += '   <tr>';
                html += '       <td style="width:10px;"></td>';
                html += '       <td style="width:10px;"></td>';
                var functionalAreaId = brData.PendingBudgetRequests[i].FinancialAreaId; // Find the functional area name.
                var functionalAreaName = '';
                try {
                    if (BWMData[0]) {
                        for (var x = 0; x < BWMData[0].length; x++) {
                            if (BWMData[0][x][0] = bwWorkflowAppId) { // We have the correct workflow!
                                for (var fai = 0; fai < BWMData[0][x][4].length; fai++) {
                                    if (functionalAreaId == BWMData[0][x][4][fai][0]) {
                                        functionalAreaName = BWMData[0][x][4][fai][1];
                                    }
                                }
                            }
                        }
                    }
                } catch (e) { }
                if (currentAmount == 0) {
                    html += '<td style="width:45px;"></td>';
                    html += '    <td style="background-color:white;" ';
                    html += 'onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'' + title + '\', \'' + projectTitle + '\', \'' + '' + '\', \'' + bwWorkflowAppId + '\', \'' + budgetRequestId + '\', \'' + orgId + '\', \'' + orgName + '\', this);" ';
                    html += 'onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');" ';
                    html += '>';
                    html += '       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="' + imageRootPath + '/images/zoom.jpg" />';
                    html += '    </td>';

                    html += '            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="4" xcx="xcx33999945-1" ';
                    html += 'onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + appWebUrl + '\', \'' + budgetRequestId + '\', \'' + title + '\', \'' + encodeHtmlAttribute(projectTitle) + '\', \'' + title + '\', \'' + '' + '\', \'' + bwWorkflowTaskItemId + '\');" target="_blank" >';
                    html += '' + title + ': <em>' + projectTitle + ' - ' + 'no budget assigned' + ' - ' + functionalAreaName + '</em>';
                    html += '</td>';
                } else {
                    html += '<td style="width:45px;"></td>';
                    html += '    <td style="background-color:white;" ';
                    html += 'onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'' + title + '\', \'' + projectTitle + '\', \'' + '' + '\', \'' + bwWorkflowAppId + '\', \'' + budgetRequestId + '\', \'' + orgId + '\', \'' + orgName + '\', this);" ';
                    html += 'onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');" ';
                    html += '>';
                    html += '       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="' + imageRootPath + '/images/zoom.jpg" />';
                    html += '    </td>';

                    html += '            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="4" xcx="xcx33999945-2" ';
                    html += ' onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'' + appWebUrl + '\', \'' + budgetRequestId + '\', \'' + title + '\', \'' + encodeHtmlAttribute(projectTitle) + '\', \'' + title + '\', \'' + '' + '\', \'' + bwWorkflowTaskItemId + '\');" target="_blank" >' + title + ': <em>' + projectTitle + ' - ' + formatCurrency(currentAmount) + ' - ' + functionalAreaName + ' - waiting for ' + participantFriendlyName + '(' + 'participantEmailAddress xcx342' + ')' + ' to complete their task.' + '</em></td>';
                    html += '            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="4" xcx="xcx33999945-3" >';
                    html += '' + title + ': <em>' + projectTitle + ' - ' + 'no budget assigned' + ' - ' + functionalAreaName + '</em>';
                    html += '</td>';
                }
                html += '</tr>';
            }
            html += '</table></td>';
            html += '</tr>';


            //
            // Third row, "Unclaimed Invitations" summary.
            //
            if (invitationData && invitationData.length && (invitationData.length != 0)) { // Only display this section if there is more than 0 invitations. If there are none, don't even bother displaying.
                var rowId = 'functionalAreaRow_' + deferredIndex.toString() + '_3';
                var imageId = 'alertSectionImage_' + deferredIndex.toString() + '_3';
                var collapsibleRowId = 'alertSectionRow_' + deferredIndex.toString() + '_3';
                html += '<tr id="' + rowId + '" class="bwFunctionalAreaRow" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'expandOrCollapseAlertsSection\', \'' + rowId + '\', \'' + imageId + '\', \'' + collapsibleRowId + '\');" >';
                if (invitationData.length > 0) {
                    if (invitationData.length == 1) {
                        html += '<td style="width:11px;vertical-align:top;"></td>';
                        html += '<td style="padding-left:11px;" class="bwHPNDrillDownLinkCell2">';
                        html += '<img title="expand" id="' + imageId + '" style="cursor:pointer;width:45px;height:45px;vertical-align:middle;" src="' + imageRootPath + '/images/drawer-open.png">';
                    } else {
                        html += '<td style="width:11px;vertical-align:top;"></td><td style="padding-left:11px;" class="bwHPNDrillDownLinkCell2">';
                        html += '<img title="expand" id="' + imageId + '" style="cursor:pointer;width:45px;height:45px;vertical-align:middle;" src="' + imageRootPath + '/images/drawer-open.png">';
                    }
                } else {
                    html += '<td style="width:11px;"></td>';
                    html += '<td style="padding-left:60px;height:45px;" class="bwHPNDrillDownLinkCell2">';
                }
                html += '       <span>';
                if (invitationData.length == 1) {
                    html += 'There is ' + invitationData.length + ' unclaimed invitation.';
                } else if (invitationData.length > 0) {
                    html += 'There are ' + invitationData.length + ' unclaimed invitations.';
                } else {
                    html += 'There are ' + invitationData.length + ' unclaimed invitations. Dont display this...';
                }
                html += '       </span>';
                html += '   </td>';

                html += '<td class="bwHPNDrillDownLinkCell2"></td>';


                html += '</tr>';
                // Third row, "Unclaimed Invitations" details.
                html += '<tr id="' + collapsibleRowId + '" style="display:none;">';
                html += '<td></td>';
                html += '<td colspan="2"><table><tbody>';
                for (var i = 0; i < invitationData.length; i++) {
                    html += '   <tr>';
                    html += '       <td style="width:10px;"></td>';
                    html += '       <td style="width:10px;"></td>';
                    html += '            <td style="width:90px;"></td>';
                    html += '            <td>&nbsp;&nbsp;</td>';
                    var invitationChar = (globalUrlPrefix + globalUrl + '?invitation=' + invitationData[i].bwInvitationId).indexOf('=') + 1; // notifications[ntypeindex][2][pi][0].indexOf('=') + 1;
                    var invitationGuid = (globalUrlPrefix + globalUrl + '?invitation=' + invitationData[i].bwInvitationId).substring(invitationChar);
                    html += '            <td colspan="5" class="tdHomePageSubNotificationIos8"><div id="tdUnclaimedInvitationLinkSwipeEnabled' + i + '"><a style="cursor:pointer;" onclick="cmdViewInvitation(\'' + invitationGuid + '\');" target="_blank" title="Send this link in an email to invite someone to participate in this workflow. You will be notified when they have confirmed their participation.">' + globalUrlPrefix + globalUrl + '?invitation=' + invitationData[i].bwInvitationId + '</a></div></td>';
                    html += '        </tr>';
                }
                html += '</tbody></table></td>';
                html += '</tr>';
            }

            //
            // Fourth section, "My Requests" summary.
            //
            var rowId = 'functionalAreaRow_' + deferredIndex.toString() + '_4';
            var imageId = 'alertSectionImage_' + deferredIndex.toString() + '_4';
            var collapsibleRowId = 'alertSectionRow_' + deferredIndex.toString() + '_4';
            html += '<tr id="' + rowId + '" class="bwFunctionalAreaRow" onclick="$(\'.bwExecutiveSummariesCarousel2\').bwExecutiveSummariesCarousel2(\'expandOrCollapseAlertsSection\', \'' + rowId + '\', \'' + imageId + '\', \'' + collapsibleRowId + '\');" >';
            if (myBrData && myBrData.MyRequests && myBrData.MyRequests.length && (myBrData.MyRequests.length > 0)) {
                if (myBrData.MyRequests.length == 1) {
                    html += '<td style="width:11px;vertical-align:top;"></td>';
                    html += '<td style="padding-left:11px;" class="bwHPNDrillDownLinkCell2">';
                    html += '<img title="collapse" id="' + imageId + '" style="cursor:pointer;width:45px;height:45px;vertical-align:middle;" src="' + imageRootPath + '/images/drawer-open.png">';
                } else {
                    html += '<td style="width:11px;vertical-align:top;"></td>';
                    html += '<td style="padding-left:11px;" class="bwHPNDrillDownLinkCell2">';
                    html += '<img title="collapse" id="' + imageId + '" style="cursor:pointer;width:45px;height:45px;vertical-align:middle;" src="' + imageRootPath + '/images/drawer-open.png">';
                }
            } else {
                html += '<td style="width:11px;"></td>';
                html += '<td style="padding-left:60px;height:45px;" class="bwHPNDrillDownLinkCell2">';
            }
            html += '       <span>';
            if (myBrData && myBrData.MyRequests && myBrData.MyRequests.length && (myBrData.MyRequests.length == 1)) {
                html += 'You have submitted ' + myBrData.MyRequests.length + ' request.';
            } else {
                html += 'You have submitted ' + myBrData.MyRequests.length + ' requests.';
            }
            html += '       </span>';
            html += '   </td>';

            html += '<td class="bwHPNDrillDownLinkCell2"></td>';

            html += '</tr>';


            // Fourth section, "My Requests" details.
            html += '<tr id="' + collapsibleRowId + '" style="display:none;">';
            html += '   <td></td>';
            html += '   <td colspan="2"><table><tbody>';
            if (myBrData && myBrData.MyRequests && myBrData.MyRequests.length && (myBrData.MyRequests.length > 0)) {
                for (var i = 0; i < myBrData.MyRequests.length; i++) {
                    var taskTitle = myBrData.MyRequests[i].bwTaskTitle;
                    var appWebUrl = appweburl;
                    var budgetRequestId = myBrData.MyRequests[i].bwBudgetRequestId;
                    var arName = myBrData.MyRequests[i].Title; // DUPLICATE
                    var brTitle = myBrData.MyRequests[i].ProjectTitle;
                    var title = myBrData.MyRequests[i].Title;
                    var budgetAmount = myBrData.MyRequests[i].BudgetAmount;
                    var requestedCapital = myBrData.MyRequests[i].RequestedCapital;
                    var requestedExpense = myBrData.MyRequests[i].RequestedExpense;
                    var taskType = myBrData.MyRequests[i].TaskType;
                    var bwAssignedToRaciRoleAbbreviation = myBrData.MyRequests[i].bwAssignedToRaciRoleAbbreviation;
                    var bwAssignedToRaciRoleName = myBrData.MyRequests[i].bwAssignedToRaciRoleName;
                    var orgId = myBrData.MyRequests[i].OrgId;
                    var orgName = myBrData.MyRequests[i].OrgName;
                    var currentAmount = 0;
                    if (budgetAmount == 'null') {
                        currentAmount = Number(requestedCapital) + Number(requestedExpense);
                    } else {
                        currentAmount = budgetAmount;
                    }
                    var daysSinceTaskCreated = 0;
                    try {
                        var cd = myBrData.MyRequests[i].bwDueDate;
                        var year = cd.split('-')[0];
                        var month = cd.split('-')[1];
                        var day = cd.split('-')[2].split('T')[0];
                        var taskCreatedDate = new Date(Number(year), Number(month) - 1, Number(day) - 1); // +1 because we're using overdue date.
                        var todaysDate = new Date();
                        var utc1 = Date.UTC(taskCreatedDate.getFullYear(), taskCreatedDate.getMonth(), taskCreatedDate.getDate());
                        var utc2 = Date.UTC(todaysDate.getFullYear(), todaysDate.getMonth(), todaysDate.getDate());
                        var _MS_PER_DAY = 1000 * 60 * 60 * 24;
                        daysSinceTaskCreated = Math.floor((utc2 - utc1) / _MS_PER_DAY);
                    } catch (e) {
                        // TODD: THIS NEEDS TO BE REEXAMINED, we are catching this error when the new recurring tasks came into play! //thisMustBeADifferentKindOfTask = true;
                    }
                    html += '   <tr>';
                    html += '       <td style="width:10px;"></td>';
                    html += '       <td style="width:10px;"></td>';
                    var functionalAreaId = myBrData.MyRequests[i].FinancialAreaId; // Find the functional area name.
                    var functionalAreaName = '';
                    try {
                        if (BWMData[0]) {
                            for (var x = 0; x < BWMData[0].length; x++) {
                                if (BWMData[0][x][0] = bwWorkflowAppId) { // We have the correct workflow!
                                    for (var fai = 0; fai < BWMData[0][x][4].length; fai++) {
                                        if (functionalAreaId == BWMData[0][x][4][fai][0]) {
                                            functionalAreaName = BWMData[0][x][4][fai][1];
                                        }
                                    }
                                }
                            }
                        }
                    } catch (e) { }
                    html += '<td style="width:45px;"></td>';
                    html += '    <td style="background-color:white;" ';
                    //html += 'style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" ';
                    html += '       onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'' + title + '\', \'' + brTitle + '\', \'' + '' + '\', \'' + bwWorkflowAppId + '\', \'' + budgetRequestId + '\', \'' + orgId + '\', \'' + orgName + '\', this);" ';
                    html += '       onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');"  ';
                    //html += '       onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'' + appWebUrl + '\', \'' + budgetRequestId + '\', \'' + arName + '\', \'' + encodeHtmlAttribute(brTitle) + '\', \'' + title + '\', \'' + bwAssignedToRaciRoleAbbreviation + '\');" ';
                    html += '>';


                    html += '       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="' + imageRootPath + '/images/zoom.jpg" />';
                    html += '    </td>';

                    html += '            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="3" ';
                    html += 'onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'' + appWebUrl + '\', \'' + budgetRequestId + '\', \'' + arName + '\', \'' + encodeHtmlAttribute(brTitle) + '\', \'' + title + '\', \'' + bwAssignedToRaciRoleAbbreviation + '\', \'' + bwWorkflowTaskItemId + '\');" >';



                    html += '    <div style="display:inline-block;" bwtrace="xcx778451">';
                    html += daysSinceTaskCreated.toString() + ' days overduexcx3: ';
                    html += '        <em>';
                    html += title + ' - ' + brTitle + ' - ' + formatCurrency(currentAmount) + ' - ' + functionalAreaName + ' ' + '[(' + bwAssignedToRaciRoleAbbreviation + ') ' + bwAssignedToRaciRoleName + ']';
                    html += '        </em>';
                    html += '    </div>';
                    html += '</td>';

                    html += '</tr>';
                }
            }
            html += '</tbody></table>';
            html += '</td>';
            html += '</tr>';



            //
            // Render all but the Fifth section.
            //
            var unitTable1 = '';
            unitTable1 += '<div id="BWFunctionalAreaDiv' + deferredIndex.toString() + '" style="cursor:pointer;" >';
            unitTable1 += '<table id="BWFunctionalArea' + deferredIndex.toString() + '" style="vertical-align:top;width:100%;">';
            unitTable1 += html;
            unitTable1 += '</tbody></table>';
            unitTable1 += '</div>';




            //var test = '<div id="BWFunctionalAreaDiv1" style="cursor:pointer;"><table id="BWFunctionalArea1" style="vertical-align:top;width:100%;"></table><table id="tblHomePageAlertSectionForWorkflow1" style="cursor:default;"><tbody><tr id="functionalAreaRow_1_1" class="bwFunctionalAreaRow" onclick="expandOrCollapseAlertsSection(\'functionalAreaRow_1_1\', \'alertSectionImage_1_1\', \'alertSectionRow_1_1\');"><td style="width:11px;vertical-align:top;"><img src="/images/red-dot.png" width="11" height="11" alt="" style="cursor:pointer;vertical-align:top;"></td><td style="padding-left:11px;" class="bwHPNDrillDownLinkCell2"><img title="collapse" id="alertSectionImage_1_1" style="cursor:pointer;width:45px;height:45px;vertical-align:middle;" src="images/drawer-close.png">       <span>You have 10 pending tasks.       </span>   </td></tr><tr id="alertSectionRow_1_1" style="display:table-row;">   <td></td>   <td><table>   <tbody><tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200002\', \'Pizza\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'c7c7836b-fb17-4d46-9f62-5bfac6795cea\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td><td colspan="3" style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" onmouseenter="this.style.backgroundColor=\'lightgoldenrodyellow\';" onmouseleave="this.style.backgroundColor=\'#d8d8d8\';" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'c7c7836b-fb17-4d46-9f62-5bfac6795cea\', \'BR-200002\', \'Pizza\', \'BR-200002\', \'ADMIN\');">       <div style="display:inline-block;" bwtrace="xcx778451">       &nbsp;&nbsp;34 days overdue:        <em>BR-200002 - Pizza - $0.00 -  [(ADMIN) ADMIN]       </em>       </div></td></tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200003\', \'Tractor\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'cd2bf528-aaf7-4a66-8fa7-09235108244f\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td><td colspan="3" style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" onmouseenter="this.style.backgroundColor=\'lightgoldenrodyellow\';" onmouseleave="this.style.backgroundColor=\'#d8d8d8\';" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'cd2bf528-aaf7-4a66-8fa7-09235108244f\', \'BR-200003\', \'Tractor\', \'BR-200003\', \'ADMIN\');">       <div style="display:inline-block;" bwtrace="xcx778451">       &nbsp;&nbsp;34 days overdue:        <em>BR-200003 - Tractor - $0.00 -  [(ADMIN) ADMIN]       </em>       </div></td></tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200004\', \'Car\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'4335e979-e768-4020-a74a-4041ecff56ee\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td><td colspan="3" style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" onmouseenter="this.style.backgroundColor=\'lightgoldenrodyellow\';" onmouseleave="this.style.backgroundColor=\'#d8d8d8\';" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'4335e979-e768-4020-a74a-4041ecff56ee\', \'BR-200004\', \'Car\', \'BR-200004\', \'ADMIN\');">       <div style="display:inline-block;" bwtrace="xcx778451">       &nbsp;&nbsp;24 days overdue:        <em>BR-200004 - Car - $0.00 -  [(ADMIN) ADMIN]       </em>       </div></td></tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200005\', \'Supper\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'8827c5cc-4231-445c-8fb3-56895cdf1395\', \'xxxx-xxx-xcxccx-xxxxxx13\', \'Kentville\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td><td colspan="3" style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" onmouseenter="this.style.backgroundColor=\'lightgoldenrodyellow\';" onmouseleave="this.style.backgroundColor=\'#d8d8d8\';" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'8827c5cc-4231-445c-8fb3-56895cdf1395\', \'BR-200005\', \'Supper\', \'BR-200005\', \'ADMIN\');">       <div style="display:inline-block;" bwtrace="xcx778451">       &nbsp;&nbsp;24 days overdue:        <em>BR-200005 - Supper - $0.00 -  [(ADMIN) ADMIN]       </em>       </div></td></tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200003\', \'Cupcake\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'2f8d6164-1dad-42e6-9853-c15cbc88c8c7\', \'94837554-76e3-4766-8fde-c95005ba110e\', \'Truro\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td><td colspan="3" style="background-color: rgb(216, 216, 216); padding: 10px; cursor: pointer;" onmouseenter="this.style.backgroundColor=\'lightgoldenrodyellow\';" onmouseleave="this.style.backgroundColor=\'#d8d8d8\';" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'2f8d6164-1dad-42e6-9853-c15cbc88c8c7\', \'BR-200003\', \'Cupcake\', \'BR-200003\', \'AVP\');">       <div style="display:inline-block;" bwtrace="xcx778451">       &nbsp;&nbsp;13 days overdue:        <em>BR-200003 - Cupcake - $0.00 -  [(AVP) Assistant Vice President]       </em>       </div></td></tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200003\', \'Cupcake\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'2f8d6164-1dad-42e6-9853-c15cbc88c8c7\', \'94837554-76e3-4766-8fde-c95005ba110e\', \'Truro\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td><td colspan="3" style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" onmouseenter="this.style.backgroundColor=\'lightgoldenrodyellow\';" onmouseleave="this.style.backgroundColor=\'#d8d8d8\';" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'2f8d6164-1dad-42e6-9853-c15cbc88c8c7\', \'BR-200003\', \'Cupcake\', \'BR-200003\', \'VP\');">       <div style="display:inline-block;" bwtrace="xcx778451">       &nbsp;&nbsp;13 days overdue:        <em>BR-200003 - Cupcake - $0.00 -  [(VP) Vice President]       </em>       </div></td></tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200003\', \'Cupcake\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'2f8d6164-1dad-42e6-9853-c15cbc88c8c7\', \'94837554-76e3-4766-8fde-c95005ba110e\', \'Truro\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td><td colspan="3" style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" onmouseenter="this.style.backgroundColor=\'lightgoldenrodyellow\';" onmouseleave="this.style.backgroundColor=\'#d8d8d8\';" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'2f8d6164-1dad-42e6-9853-c15cbc88c8c7\', \'BR-200003\', \'Cupcake\', \'BR-200003\', \'CIO\');">       <div style="display:inline-block;" bwtrace="xcx778451">       &nbsp;&nbsp;13 days overdue:        <em>BR-200003 - Cupcake - $0.00 -  [(CIO) Chief Information Officer]       </em>       </div></td></tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200006\', \'35lb barbell\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'8ef7510d-a604-4d6a-83c5-88d5935486f5\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td><td colspan="3" style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" onmouseenter="this.style.backgroundColor=\'lightgoldenrodyellow\';" onmouseleave="this.style.backgroundColor=\'#d8d8d8\';" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'8ef7510d-a604-4d6a-83c5-88d5935486f5\', \'BR-200006\', \'35lb barbell\', \'BR-200006\', \'ADMIN\');">       <div style="display:inline-block;" bwtrace="xcx778451">       &nbsp;&nbsp;8 days overdue:        <em>BR-200006 - 35lb barbell - $0.00 -  [(ADMIN) ADMIN]       </em>       </div></td></tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200007\', \'test of bwWorkflowId\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'b50b80e1-8812-4e02-8425-b6c7e1fb261c\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td><td colspan="3" style="background-color: rgb(216, 216, 216); padding: 10px; cursor: pointer;" onmouseenter="this.style.backgroundColor=\'lightgoldenrodyellow\';" onmouseleave="this.style.backgroundColor=\'#d8d8d8\';" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'b50b80e1-8812-4e02-8425-b6c7e1fb261c\', \'BR-200007\', \'test of bwWorkflowId\', \'BR-200007\', \'ADMIN\');">       <div style="display:inline-block;" bwtrace="xcx778451">       &nbsp;&nbsp;3 days overdue:        <em>BR-200007 - test of bwWorkflowId - $0.00 -  [(ADMIN) ADMIN]       </em>       </div></td></tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200008\', \'Oatmeal\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'ce1c2c0b-3be5-4b96-8c99-837bd52c8211\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td><td colspan="3" style="background-color: rgb(216, 216, 216); padding: 10px; cursor: pointer;" onmouseenter="this.style.backgroundColor=\'lightgoldenrodyellow\';" onmouseleave="this.style.backgroundColor=\'#d8d8d8\';" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'ce1c2c0b-3be5-4b96-8c99-837bd52c8211\', \'BR-200008\', \'Oatmeal\', \'BR-200008\', \'ADMIN\');">       <div style="display:inline-block;" bwtrace="xcx778451">       &nbsp;&nbsp;1 day overdue:        <em>BR-200008 - Oatmeal - $0.00 -  [(ADMIN) ADMIN]       </em>       </div></td></tr></tbody></table></td></tr><tr id="functionalAreaRow_1_2" class="bwFunctionalAreaRow" onclick="expandOrCollapseAlertsSection(\'functionalAreaRow_1_2\', \'alertSectionImage_1_2\', \'alertSectionRow_1_2\');"><td style="width:11px;vertical-align:top;"></td><td style="padding-left:11px;" class="bwHPNDrillDownLinkCell2"><img title="expand" id="alertSectionImage_1_2" style="cursor:pointer;width:45px;height:45px;vertical-align:middle;" src="images/drawer-open.png">       <span>There are 8 budget requests going through the approval process.       </span>   </td></tr><tr id="alertSectionRow_1_2" style="display:none;"><td></td><td><table>   <tbody><tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200003\', \'Cupcake\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'2f8d6164-1dad-42e6-9853-c15cbc88c8c7\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td>            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="4" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'https://budgetworkflow.com\', \'2f8d6164-1dad-42e6-9853-c15cbc88c8c7\', \'BR-200003\', \'Cupcake\', \'BR-200003\');" target="_blank">BR-200003: <em>Cupcake - no budget assigned - </em></td>        </tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200002\', \'Pizza\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'c7c7836b-fb17-4d46-9f62-5bfac6795cea\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td>            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="4" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'https://budgetworkflow.com\', \'c7c7836b-fb17-4d46-9f62-5bfac6795cea\', \'BR-200002\', \'Pizza\', \'BR-200002\');" target="_blank">BR-200002: <em>Pizza - no budget assigned - </em></td>        </tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200003\', \'Tractor\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'cd2bf528-aaf7-4a66-8fa7-09235108244f\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td>            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="4" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'https://budgetworkflow.com\', \'cd2bf528-aaf7-4a66-8fa7-09235108244f\', \'BR-200003\', \'Tractor\', \'BR-200003\');" target="_blank">BR-200003: <em>Tractor - no budget assigned - </em></td>        </tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200005\', \'Supper\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'8827c5cc-4231-445c-8fb3-56895cdf1395\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td>            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="4" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'https://budgetworkflow.com\', \'8827c5cc-4231-445c-8fb3-56895cdf1395\', \'BR-200005\', \'Supper\', \'BR-200005\');" target="_blank">BR-200005: <em>Supper - no budget assigned - </em></td>        </tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200004\', \'Car\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'4335e979-e768-4020-a74a-4041ecff56ee\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td>            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="4" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'https://budgetworkflow.com\', \'4335e979-e768-4020-a74a-4041ecff56ee\', \'BR-200004\', \'Car\', \'BR-200004\');" target="_blank">BR-200004: <em>Car - no budget assigned - </em></td>        </tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200006\', \'35lb barbell\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'8ef7510d-a604-4d6a-83c5-88d5935486f5\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td>            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="4" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'https://budgetworkflow.com\', \'8ef7510d-a604-4d6a-83c5-88d5935486f5\', \'BR-200006\', \'35lb barbell\', \'BR-200006\');" target="_blank">BR-200006: <em>35lb barbell - no budget assigned - </em></td>        </tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200007\', \'test of bwWorkflowId\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'b50b80e1-8812-4e02-8425-b6c7e1fb261c\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td>            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="4" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'https://budgetworkflow.com\', \'b50b80e1-8812-4e02-8425-b6c7e1fb261c\', \'BR-200007\', \'test of bwWorkflowId\', \'BR-200007\');" target="_blank">BR-200007: <em>test of bwWorkflowId - no budget assigned - </em></td>        </tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200008\', \'Oatmeal\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'ce1c2c0b-3be5-4b96-8c99-837bd52c8211\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td>            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="4" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\', \'https://budgetworkflow.com\', \'ce1c2c0b-3be5-4b96-8c99-837bd52c8211\', \'BR-200008\', \'Oatmeal\', \'BR-200008\');" target="_blank">BR-200008: <em>Oatmeal - no budget assigned - </em></td>        </tr></tbody></table></td></tr><tr id="functionalAreaRow_1_3" class="bwFunctionalAreaRow" onclick="expandOrCollapseAlertsSection(\'functionalAreaRow_1_3\', \'alertSectionImage_1_3\', \'alertSectionRow_1_3\');"><td style="width:11px;vertical-align:top;"></td><td style="padding-left:11px;" class="bwHPNDrillDownLinkCell2"><img title="expand" id="alertSectionImage_1_3" style="cursor:pointer;width:45px;height:45px;vertical-align:middle;" src="images/drawer-open.png">       <span>There are 2 unclaimed invitations.       </span>   </td></tr><tr id="alertSectionRow_1_3" style="display:none;"><td></td><td><table>   <tbody><tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td>            <td style="width:90px;"></td>            <td>&nbsp;&nbsp;</td>            <td colspan="5" class="tdHomePageSubNotificationIos8"><div id="tdUnclaimedInvitationLinkSwipeEnabled0"><a style="cursor:pointer;" onclick="cmdViewInvitation(\'df6eb834-644d-4158-aba7-4f1cd6e7fc28\');" target="_blank" title="Send this link in an email to invite someone to participate in this workflow. You will be notified when they have confirmed their participation.">https://budgetworkflow.com?invitation=df6eb834-644d-4158-aba7-4f1cd6e7fc28</a></div></td>        </tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td>            <td style="width:90px;"></td>            <td>&nbsp;&nbsp;</td>            <td colspan="5" class="tdHomePageSubNotificationIos8"><div id="tdUnclaimedInvitationLinkSwipeEnabled1"><a style="cursor:pointer;" onclick="cmdViewInvitation(\'155f6e08-15da-437f-b413-4816ef1d81b7\');" target="_blank" title="Send this link in an email to invite someone to participate in this workflow. You will be notified when they have confirmed their participation.">https://budgetworkflow.com?invitation=155f6e08-15da-437f-b413-4816ef1d81b7</a></div></td>        </tr></tbody></table></td></tr><tr id="functionalAreaRow_1_4" class="bwFunctionalAreaRow" onclick="expandOrCollapseAlertsSection(\'functionalAreaRow_1_4\', \'alertSectionImage_1_4\', \'alertSectionRow_1_4\');"><td style="width:11px;vertical-align:top;"></td><td style="padding-left:11px;" class="bwHPNDrillDownLinkCell2"><img title="collapse" id="alertSectionImage_1_4" style="cursor:pointer;width:45px;height:45px;vertical-align:middle;" src="images/drawer-open.png">       <span>You have submitted 8 requests.       </span>   </td></tr><tr id="alertSectionRow_1_4" style="display:none;">   <td></td>   <td><table>   <tbody><tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200003\', \'Cupcake\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'2f8d6164-1dad-42e6-9853-c15cbc88c8c7\', \'94837554-76e3-4766-8fde-c95005ba110e\', \'Truro\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td>            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="3" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'2f8d6164-1dad-42e6-9853-c15cbc88c8c7\', \'BR-200003\', \'Cupcake\', \'BR-200003\', \'undefined\');">    <div style="display:inline-block;" bwtrace="xcx778451">0 days overduexcx3:         <em>BR-200003 - Cupcake - $0.00 -  [(undefined) undefined]        </em>    </div></td></tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200002\', \'Pizza\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'c7c7836b-fb17-4d46-9f62-5bfac6795cea\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td>            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="3" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'c7c7836b-fb17-4d46-9f62-5bfac6795cea\', \'BR-200002\', \'Pizza\', \'BR-200002\', \'undefined\');">    <div style="display:inline-block;" bwtrace="xcx778451">0 days overduexcx3:         <em>BR-200002 - Pizza - $0.00 -  [(undefined) undefined]        </em>    </div></td></tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200003\', \'Tractor\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'cd2bf528-aaf7-4a66-8fa7-09235108244f\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td>            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="3" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'cd2bf528-aaf7-4a66-8fa7-09235108244f\', \'BR-200003\', \'Tractor\', \'BR-200003\', \'undefined\');">    <div style="display:inline-block;" bwtrace="xcx778451">0 days overduexcx3:         <em>BR-200003 - Tractor - $0.00 -  [(undefined) undefined]        </em>    </div></td></tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200005\', \'Supper\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'8827c5cc-4231-445c-8fb3-56895cdf1395\', \'xxxx-xxx-xcxccx-xxxxxx13\', \'Kentville\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td>            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="3" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'8827c5cc-4231-445c-8fb3-56895cdf1395\', \'BR-200005\', \'Supper\', \'BR-200005\', \'undefined\');">    <div style="display:inline-block;" bwtrace="xcx778451">0 days overduexcx3:         <em>BR-200005 - Supper - $0.00 -  [(undefined) undefined]        </em>    </div></td></tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200004\', \'Car\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'4335e979-e768-4020-a74a-4041ecff56ee\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td>            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="3" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'4335e979-e768-4020-a74a-4041ecff56ee\', \'BR-200004\', \'Car\', \'BR-200004\', \'undefined\');">    <div style="display:inline-block;" bwtrace="xcx778451">0 days overduexcx3:         <em>BR-200004 - Car - $0.00 -  [(undefined) undefined]        </em>    </div></td></tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200006\', \'35lb barbell\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'8ef7510d-a604-4d6a-83c5-88d5935486f5\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td>            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="3" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'8ef7510d-a604-4d6a-83c5-88d5935486f5\', \'BR-200006\', \'35lb barbell\', \'BR-200006\', \'undefined\');">    <div style="display:inline-block;" bwtrace="xcx778451">0 days overduexcx3:         <em>BR-200006 - 35lb barbell - $0.00 -  [(undefined) undefined]        </em>    </div></td></tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200007\', \'test of bwWorkflowId\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'b50b80e1-8812-4e02-8425-b6c7e1fb261c\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td>            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="3" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'b50b80e1-8812-4e02-8425-b6c7e1fb261c\', \'BR-200007\', \'test of bwWorkflowId\', \'BR-200007\', \'undefined\');">    <div style="display:inline-block;" bwtrace="xcx778451">0 days overduexcx3:         <em>BR-200007 - test of bwWorkflowId - $0.00 -  [(undefined) undefined]        </em>    </div></td></tr>   <tr>       <td style="width:10px;"></td>       <td style="width:10px;"></td><td style="width:45px;"></td>    <td style="background-color:white;" onmouseenter="$(\'.bwCoreComponent\').bwCoreComponent(\'showRowHoverDetails\', \'BR-200008\', \'Oatmeal\', \'\', \'6f308d4e-66fd-4e6f-925e-714b3135fef3\', \'ce1c2c0b-3be5-4b96-8c99-837bd52c8211\', \'root\', \'Stark Enterprises\', this);" onmouseleave="$(\'.bwCoreComponent\').bwCoreComponent(\'hideRowHoverDetails\');">       <img class="gridMagnifyingGlass" style="vertical-align:middle;width:25px;height:25px;" src="/images/zoom.jpg">    </td>            <td style="background-color:#d8d8d8;padding:10px 10px 10px 10px;cursor:pointer;" colspan="3" onclick="$(\'.bwRequest\').bwRequest(\'displayArInDialog\',\'https://budgetworkflow.com\', \'ce1c2c0b-3be5-4b96-8c99-837bd52c8211\', \'BR-200008\', \'Oatmeal\', \'BR-200008\', \'undefined\');">    <div style="display:inline-block;" bwtrace="xcx778451">0 days overduexcx3:         <em>BR-200008 - Oatmeal - $0.00 -  [(undefined) undefined]        </em>    </div></td></tr></tbody></table></td></tr></tbody></table></div>';





            var result = {
                html: unitTable1
            }
            return result;

            //} catch (e) {
            //    console.log('Exception in generateHomePageNotificationScreenHtml():1335-1: ' + e.message + ', ' + e.stack);
            //    displayAlertDialog('Exception in generateHomePageNotificationScreenHtml():1335-1: ' + e.message + ', ' + e.stack);
            //    var result = {
            //        html: 'Exception in generateHomePageNotificationScreenHtml():1335-1: ' + e.message + ', ' + e.stack
            //    }
            //    return result;
            //}
        } catch (e) {
            console.log('Exception in generateHomePageNotificationScreenHtml():1335-1: ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in generateHomePageNotificationScreenHtml():1335-1: ' + e.message + ', ' + e.stack);
            var result = {
                html: 'Exception in generateHomePageNotificationScreenHtml():1335-1: ' + e.message + ', ' + e.stack
            }
            return result;
        }
    },
    //generateHomePageNotificationScreen_FASTFIRSTPASS: function (deferredIndex, queryData) {
    getDataForHomePageNotificationScreen_FASTFIRSTPASS: function (deferredIndex, queryData) {
        return new Promise(function (resolve, reject) {
            // This is used on the client side (here), and also on the server side for generating this content to be included in emails. (OverdueTasksTimer). 
            try {
                console.log('');
                console.log('******************************');
                console.log('In getDataForHomePageNotificationScreen_FASTFIRSTPASS(). We need to add our new authorization code here 11-16-2022...');
                console.log('******************************');
                console.log('');

                alert('In bwAuthentication.js.getDataForHomePageNotificationScreen_FASTFIRSTPASS(). GETTING DATA.');

                var thiz = this;

                var workflowAppId = queryData.bwWorkflowAppId;

                var activeStateIdentifier = $('.bwAuthentication:first').bwAuthentication('getActiveStateIdentifier');
                queryData["bwActiveStateIdentifier"] = activeStateIdentifier; // Add this for the authorization.

                console.log('Making 4 web service calls in bwAuthentication.js.getDataForHomePageNotificationScreen_FASTFIRSTPASS().');

                $.ajax({
                    url: webserviceurl + "/bwtasksoutstanding_FASTFIRSTPASS",
                    type: "Post",
                    contentType: 'application/json',
                    data: JSON.stringify(queryData),
                    success: function (results) {
                        try {
                            // Expect to get the following:
                            //var result = {
                            //    status: 'SUCCESS',
                            //    message: msg,
                            //    taskResult: taskResult,
                            //    brResult: brResult
                            //}

                            var taskResult = results.taskResult;
                            var brResult = results.brResult;
                            var taskData = [];

                            var bwRecurringExpensesEnabled = 'true'; // THIS IS HARDCODED REMOVE. 8-20-2023.

                            // Ok now populate it.
                            //debugger;
                            //for (var i = 0; i < taskResult.length; i++) { // Doing this backwards so that when an item is pushed, the array is in the correct order.
                            for (var i = (taskResult.length - 1); i > -1; i--) { // Doing this backwards so that when an item is pushed, the array is in the correct order.

                                //displayAlertDialog_Persistent('xcx123123: ' + JSON.stringify(taskResult[i]));

                                if (taskResult[i].TaskType == 'BUDGET_REQUEST_WORKFLOW_TASK') {
                                    // Get the information from the budget request. We have to iterate through the budget requests to make sure we match up the relatedItemId and the budgetRequestId.
                                    for (var j = 0; j < brResult.length; j++) { // doesn't need wrap.
                                        if (brResult[j].bwBudgetRequestId == taskResult[i].bwRelatedItemId) {
                                            var task = {

                                                bwWorkflowTaskItemId: taskResult[i].bwWorkflowTaskItemId, // Added 12-23-2021
                                                bwTaskTitle: taskResult[i].bwTaskTitle,
                                                TaskType: taskResult[i].TaskType, //String, // BUDGET_REQUEST_WORKFLOW_TASK, RECURRING_EXPENSE_NOTIFICATION_TASK,

                                                WorkflowStepId: taskResult[i].WorkflowStepId, //String, // Not currently used, but we need to move this towards using a GUID.????
                                                WorkflowStepName: taskResult[i].WorkflowStepName, // String, // eg: 'Collaboration'??????
                                                RoleCategory: taskResult[i].RoleCategory, //String, // Approver, Collaborator.

                                                bwStatus: taskResult[i].bwStatus,
                                                bwTaskOutcome: taskResult[i].bwTaskOutcome, ///String, // eg: Budget Assigned by Todd Hiltz
                                                bwPercentComplete: taskResult[i].bwPercentComplete,
                                                bwRelatedItemId: taskResult[i].bwRelatedItemId,


                                                //
                                                // Data from brResult. Not sure this is the best way to do things but sticking with it for now. 8-20-2023.
                                                //
                                                Title: brResult[j].Title,
                                                ProjectTitle: brResult[j].ProjectTitle,

                                                OrgId: brResult[j].OrgId,
                                                OrgName: brResult[j].OrgName,

                                                BudgetAmount: brResult[j].BudgetAmount,
                                                RequestedCapital: brResult[j].RequestedCapital,
                                                RequestedExpense: brResult[j].RequestedExpense,
                                                FinancialAreaId: brResult[j].FunctionalAreaId,
                                                CreatedBy: brResult[j].CreatedBy,

                                                bwRequestJson: brResult[j].bwRequestJson,
                                                //
                                                // end: Data from brResult. Not sure this is the best way to do things but sticking with it for now. 8-20-2023.
                                                //




                                                Created: taskResult[i].Created,
                                                bwDueDate: taskResult[i].bwDueDate,
                                                bwHasBeenProcessedByTheWorkflowEngine: taskResult[i].bwHasBeenProcessedByTheWorkflowEngine,
                                                bwAssignedTo: taskResult[i].bwAssignedTo,
                                                bwAssignedToId: taskResult[i].bwAssignedToId,
                                                bwWorkflowAppId: taskResult[i].bwWorkflowAppId,
                                                TaskType: taskResult[i].TaskType,

                                                DailyOverdueTaskNotificationDate: taskResult[i].DailyOverdueTaskNotificationDate,

                                                bwAssignedToRaciRoleAbbreviation: taskResult[i].bwAssignedToRaciRoleAbbreviation, // eg: PM
                                                bwAssignedToRaciRoleName: taskResult[i].bwAssignedToRaciRoleName // eg: Project Manager
                                            };
                                            taskData.push(task);
                                            break;
                                        }
                                    }
                                } else if (taskResult[i].TaskType == 'RECURRING_EXPENSE_NOTIFICATION_TASK') {
                                    if (bwRecurringExpensesEnabled == 'true') {
                                        console.log('bwRecurringExpensesEnabled == true, refResult.length: ' + refResult.length);
                                        for (var j = 0; j < refResult.length; j++) { // doesn't need wrap.
                                            console.log('refResult[j].bwRecurringExpenseId: ' + refResult[j].bwRecurringExpenseId + ', taskResult[i].bwRelatedItemId: ' + taskResult[i].bwRelatedItemId);
                                            if (refResult[j].bwRecurringExpenseId == taskResult[i].bwRelatedItemId) {

                                                var task = {
                                                    bwTaskTitle: taskResult[i].bwTaskTitle,
                                                    bwRelatedItemId: taskResult[i].bwRelatedItemId,
                                                    bwStatus: taskResult[i].bwStatus,
                                                    bwPercentComplete: taskResult[i].bwPercentComplete,

                                                    //Title: brResult[j].Title,
                                                    ProjectTitle: refResult[j].ProjectTitle,

                                                    OrgId: refResult[j].OrgId,
                                                    OrgName: refResult[j].OrgName,

                                                    //BudgetAmount: brResult[j].BudgetAmount,
                                                    //RequestedCapital: brResult[j].RequestedCapital,
                                                    //RequestedExpense: brResult[j].RequestedExpense,
                                                    FinancialAreaId: refResult[j].FunctionalAreaId,
                                                    //CreatedBy: brResult[j].CreatedBy,

                                                    Created: taskResult[i].Created,
                                                    bwDueDate: taskResult[i].bwDueDate,
                                                    bwHasBeenProcessedByTheWorkflowEngine: taskResult[i].bwHasBeenProcessedByTheWorkflowEngine,
                                                    bwAssignedTo: taskResult[i].bwAssignedTo,
                                                    bwAssignedToId: taskResult[i].bwAssignedToId,
                                                    bwWorkflowAppId: taskResult[i].bwWorkflowAppId,
                                                    TaskType: taskResult[i].TaskType,

                                                    DailyOverdueTaskNotificationDate: taskResult[i].DailyOverdueTaskNotificationDate,

                                                    bwAssignedToRaciRoleAbbreviation: taskResult[i].bwAssignedToRaciRoleAbbreviation, // eg: PM
                                                    bwAssignedToRaciRoleName: taskResult[i].bwAssignedToRaciRoleName // eg: Project Manager
                                                };
                                                taskData.push(task);
                                                break;
                                            }
                                        }
                                    }
                                }
                            }












                            var participantsData = [];
                            var brData = [];
                            var myBrData = [];

                            //var html = bwCommonScripts.generateHomePageNotificationScreenHtml(deferredIndex, appweburl, workflowAppId, null, taskData, null, participantsData, brData, myBrData, false);

                            var result = {
                                //html: html,
                                workflowAppId: workflowAppId,
                                taskData: taskData,
                                participantsData: participantsData,
                                brData: brData, // Sending this so that we can access bwRequestJson and get at our selected inventory, so we can display the images in the home page carousel.
                                myBrData: myBrData
                            }
                            resolve(result);

























                            //$.ajax({
                            //    url: webserviceurl + "/bwparticipants",
                            //    type: "POST",
                            //    contentType: 'application/json',
                            //    data: JSON.stringify(queryData),
                            //    success: function (participantsData) {
                            //        $.ajax({
                            //            url: webserviceurl + "/bwbudgetrequestspending",
                            //            type: "DELETE",
                            //            contentType: 'application/json',
                            //            data: JSON.stringify(queryData),
                            //            success: function (brData) {
                            //                $.ajax({
                            //                    url: webserviceurl + "/mybudgetrequests",
                            //                    type: "DELETE",
                            //                    contentType: 'application/json',
                            //                    data: JSON.stringify(queryData),
                            //                    success: function (myBrData) {
                            //                        try {

                            //                            debugger;

                            //                            var html = bwCommonScripts.generateHomePageNotificationScreenHtml(deferredIndex, appweburl, workflowAppId, null, taskData, null, participantsData, brData, myBrData, false);

                            //                            var result = {
                            //                                html: html,
                            //                                workflowAppId: workflowAppId,
                            //                                taskData: taskData,
                            //                                participantsData: participantsData,
                            //                                brData: brData, // Sending this so that we can access bwRequestJson and get at our selected inventory, so we can display the images in the home page carousel.
                            //                                myBrData: myBrData
                            //                            }
                            //                            resolve(result);

                            //                        } catch (e) {

                            //                        }
                            //                    },
                            //                    error: function (data, errorCode, errorMessage) {

                            //                        displayAlertDialog('Error in my.js.renderAlerts()2:144:' + errorCode + ', ' + errorMessage + ' I believe this happens when wifi goes down. SERVICE UNAVAILABLE ');

                            //                        reject();
                            //                    }
                            //                });
                            //            },
                            //            error: function (data, errorCode, errorMessage) {

                            //                displayAlertDialog('Error in my.js.renderAlerts2():1:' + errorCode + ', ' + errorMessage + ' I believe this happens when wifi goes down. SERVICE UNAVAILABLE ');

                            //                reject();
                            //            }
                            //        });
                            //    },
                            //    error: function (data, errorCode, errorMessage) {

                            //        displayAlertDialog('Note: Validate that WriteToErrorLog() works here. Error in my.js.renderAlerts2():2: ' + errorCode + ', ' + errorMessage);

                            //        WriteToErrorLog('xcx2131425', errorMessage);

                            //        reject();
                            //    }
                            //});

                        } catch (e) {

                            console.log('Exception in getDataForHomePageNotificationScreen_FASTFIRSTPASS():44: ' + e.message + ', ' + e.stack);
                            displayAlertDialog('Exception in getDataForHomePageNotificationScreen_FASTFIRSTPASS():44: ' + e.message + ', ' + e.stack);

                            reject();

                        }
                    },
                    error: function (data, errorCode, errorMessage) {

                        displayAlertDialog('Error in my.js.renderAlerts2():4:' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));

                        reject();
                    }
                });

            } catch (e) {
                console.log('Exception in getDataForHomePageNotificationScreen_FASTFIRSTPASS(). ' + e.message + ', ' + e.stack);
                displayAlertDialog('Exception in getDataForHomePageNotificationScreen_FASTFIRSTPASS(). ' + e.message + ', ' + e.stack);

                reject();
            }
        });
    },
    getDataForHomePageNotificationScreen_FASTSECONDPASS: function (deferredIndex, queryData) {
        return new Promise(function (resolve, reject) {
            // This is used on the client side (here), and also on the server side for generating this content to be included in emails. (OverdueTasksTimer). 
            try {
                console.log('');
                console.log('******************************');
                console.log('In getDataForHomePageNotificationScreen_FASTSECONDPASS(). We need to add our new authorization code here 11-16-2022...');
                console.log('******************************');
                console.log('');
                var thiz = this;

                alert('In getDataForHomePageNotificationScreen_FASTSECONDPASS(). We need to add our new authorization code here 11-16-2022...');

                var workflowAppId = queryData.bwWorkflowAppId;

                var activeStateIdentifier = $('.bwAuthentication:first').bwAuthentication('getActiveStateIdentifier');
                queryData["bwActiveStateIdentifier"] = activeStateIdentifier; // Add this for the authorization.

                console.log('In getDataForHomePageNotificationScreen_FASTSECONDPASS(). Making 4 web service calls in bwAuthentication.js.getDataForHomePageNotificationScreen_FASTSECONDPASS().');


                $.ajax({
                    url: webserviceurl + "/getDataForHomePageNotificationScreen_FASTSECONDPASS", //"/bwtasksoutstanding_FASTSECONDPASS",
                    type: "POST",
                    contentType: 'application/json',
                    data: JSON.stringify(queryData),
                    success: function (results) {



                        //$.ajax({
                        //    url: webserviceurl + "/bwtasksoutstanding_FASTSECONDPASS",
                        //    type: "Post",
                        //    contentType: 'application/json',
                        //    data: JSON.stringify(queryData),
                        //    success: function (results) {
                        //                $.ajax({
                        //                    url: webserviceurl + "/bwbudgetrequestspending_FASTSECONDPASS", // "/bwbudgetrequestspending",
                        //                    type: "POST",
                        //                    contentType: 'application/json',
                        //                    data: JSON.stringify(queryData),
                        //                    success: function (brData) {
                        //                        $.ajax({
                        //                            url: webserviceurl + "/mybudgetrequests",
                        //                            type: "DELETE",
                        //                            contentType: 'application/json',
                        //                            data: JSON.stringify(queryData),
                        //                            success: function (myBrData) {
                        try {

                            var taskResult = results.taskResult;
                            var brResult = results.brResult;
                            var taskData = [];

                            var bwRecurringExpensesEnabled = 'true'; // THIS IS HARDCODED REMOVE. 8-20-2023.

                            // Ok now populate it.
                            //debugger;
                            //for (var i = 0; i < taskResult.length; i++) { // Doing this backwards so that when an item is pushed, the array is in the correct order.
                            for (var i = (taskResult.length - 1); i > -1; i--) { // Doing this backwards so that when an item is pushed, the array is in the correct order.

                                //displayAlertDialog_Persistent('xcx123123: ' + JSON.stringify(taskResult[i]));

                                if (taskResult[i].TaskType == 'BUDGET_REQUEST_WORKFLOW_TASK') {
                                    // Get the information from the budget request. We have to iterate through the budget requests to make sure we match up the relatedItemId and the budgetRequestId.
                                    for (var j = 0; j < brResult.length; j++) { // doesn't need wrap.
                                        if (brResult[j].bwBudgetRequestId == taskResult[i].bwRelatedItemId) {
                                            var task = {

                                                bwWorkflowTaskItemId: taskResult[i].bwWorkflowTaskItemId, // Added 12-23-2021
                                                bwTaskTitle: taskResult[i].bwTaskTitle,
                                                TaskType: taskResult[i].TaskType, //String, // BUDGET_REQUEST_WORKFLOW_TASK, RECURRING_EXPENSE_NOTIFICATION_TASK,

                                                WorkflowStepId: taskResult[i].WorkflowStepId, //String, // Not currently used, but we need to move this towards using a GUID.????
                                                WorkflowStepName: taskResult[i].WorkflowStepName, // String, // eg: 'Collaboration'??????
                                                RoleCategory: taskResult[i].RoleCategory, //String, // Approver, Collaborator.

                                                bwStatus: taskResult[i].bwStatus,
                                                bwTaskOutcome: taskResult[i].bwTaskOutcome, ///String, // eg: Budget Assigned by Todd Hiltz
                                                bwPercentComplete: taskResult[i].bwPercentComplete,
                                                bwRelatedItemId: taskResult[i].bwRelatedItemId,


                                                //
                                                // Data from brResult. Not sure this is the best way to do things but sticking with it for now. 8-20-2023.
                                                //
                                                Title: brResult[j].Title,
                                                ProjectTitle: brResult[j].ProjectTitle,

                                                OrgId: brResult[j].OrgId,
                                                OrgName: brResult[j].OrgName,

                                                BudgetAmount: brResult[j].BudgetAmount,
                                                RequestedCapital: brResult[j].RequestedCapital,
                                                RequestedExpense: brResult[j].RequestedExpense,
                                                FinancialAreaId: brResult[j].FunctionalAreaId,
                                                CreatedBy: brResult[j].CreatedBy,

                                                bwRequestJson: brResult[j].bwRequestJson,
                                                //
                                                // end: Data from brResult. Not sure this is the best way to do things but sticking with it for now. 8-20-2023.
                                                //




                                                Created: taskResult[i].Created,
                                                bwDueDate: taskResult[i].bwDueDate,
                                                bwHasBeenProcessedByTheWorkflowEngine: taskResult[i].bwHasBeenProcessedByTheWorkflowEngine,
                                                bwAssignedTo: taskResult[i].bwAssignedTo,
                                                bwAssignedToId: taskResult[i].bwAssignedToId,
                                                bwWorkflowAppId: taskResult[i].bwWorkflowAppId,
                                                TaskType: taskResult[i].TaskType,

                                                DailyOverdueTaskNotificationDate: taskResult[i].DailyOverdueTaskNotificationDate,

                                                bwAssignedToRaciRoleAbbreviation: taskResult[i].bwAssignedToRaciRoleAbbreviation, // eg: PM
                                                bwAssignedToRaciRoleName: taskResult[i].bwAssignedToRaciRoleName // eg: Project Manager
                                            };
                                            taskData.push(task);
                                            break;
                                        }
                                    }
                                } else if (taskResult[i].TaskType == 'RECURRING_EXPENSE_NOTIFICATION_TASK') {
                                    if (bwRecurringExpensesEnabled == 'true') {
                                        console.log('bwRecurringExpensesEnabled == true, refResult.length: ' + refResult.length);
                                        for (var j = 0; j < refResult.length; j++) { // doesn't need wrap.
                                            console.log('refResult[j].bwRecurringExpenseId: ' + refResult[j].bwRecurringExpenseId + ', taskResult[i].bwRelatedItemId: ' + taskResult[i].bwRelatedItemId);
                                            if (refResult[j].bwRecurringExpenseId == taskResult[i].bwRelatedItemId) {

                                                //var task = {
                                                //    bwTaskTitle: taskResult[i].bwTaskTitle,
                                                //    bwRelatedItemId: taskResult[i].bwRelatedItemId,

                                                //    bwStatus: taskResult[i].bwStatus,
                                                //    bwPercentComplete: taskResult[i].bwPercentComplete,

                                                //    //Title: brResult[j].Title,
                                                //    ProjectTitle: refResult[j].ProjectTitle,

                                                //    OrgId: refResult[j].OrgId,
                                                //    OrgName: refResult[j].OrgName,

                                                //    //BudgetAmount: brResult[j].BudgetAmount,
                                                //    //RequestedCapital: brResult[j].RequestedCapital,
                                                //    //RequestedExpense: brResult[j].RequestedExpense,
                                                //    FinancialAreaId: refResult[j].FunctionalAreaId,
                                                //    //CreatedBy: brResult[j].CreatedBy,

                                                //    Created: taskResult[i].Created,
                                                //    bwDueDate: taskResult[i].bwDueDate,
                                                //    bwHasBeenProcessedByTheWorkflowEngine: taskResult[i].bwHasBeenProcessedByTheWorkflowEngine,
                                                //    bwAssignedTo: taskResult[i].bwAssignedTo,
                                                //    bwAssignedToId: taskResult[i].bwAssignedToId,
                                                //    bwWorkflowAppId: taskResult[i].bwWorkflowAppId,
                                                //    TaskType: taskResult[i].TaskType,

                                                //    DailyOverdueTaskNotificationDate: taskResult[i].DailyOverdueTaskNotificationDate,

                                                //    bwAssignedToRaciRoleAbbreviation: taskResult[i].bwAssignedToRaciRoleAbbreviation, // eg: PM
                                                //    bwAssignedToRaciRoleName: taskResult[i].bwAssignedToRaciRoleName // eg: Project Manager
                                                //};

                                                var task = {

                                                    bwWorkflowTaskItemId: taskResult[i].bwWorkflowTaskItemId, // Added 12-23-2021
                                                    bwTaskTitle: taskResult[i].bwTaskTitle,
                                                    TaskType: taskResult[i].TaskType, //String, // BUDGET_REQUEST_WORKFLOW_TASK, RECURRING_EXPENSE_NOTIFICATION_TASK,

                                                    WorkflowStepId: taskResult[i].WorkflowStepId, //String, // Not currently used, but we need to move this towards using a GUID.????
                                                    WorkflowStepName: taskResult[i].WorkflowStepName, // String, // eg: 'Collaboration'??????
                                                    RoleCategory: taskResult[i].RoleCategory, //String, // Approver, Collaborator.

                                                    bwStatus: taskResult[i].bwStatus,
                                                    bwTaskOutcome: taskResult[i].bwTaskOutcome, ///String, // eg: Budget Assigned by Todd Hiltz
                                                    bwPercentComplete: taskResult[i].bwPercentComplete,
                                                    bwRelatedItemId: taskResult[i].bwRelatedItemId,


                                                    //
                                                    // Data from brResult. Not sure this is the best way to do things but sticking with it for now. 8-20-2023.
                                                    //
                                                    Title: brResult[j].Title,
                                                    ProjectTitle: brResult[j].ProjectTitle,

                                                    OrgId: brResult[j].OrgId,
                                                    OrgName: brResult[j].OrgName,

                                                    BudgetAmount: brResult[j].BudgetAmount,
                                                    RequestedCapital: brResult[j].RequestedCapital,
                                                    RequestedExpense: brResult[j].RequestedExpense,
                                                    FinancialAreaId: brResult[j].FunctionalAreaId,
                                                    CreatedBy: brResult[j].CreatedBy,

                                                    bwRequestJson: brResult[j].bwRequestJson,
                                                    //
                                                    // end: Data from brResult. Not sure this is the best way to do things but sticking with it for now. 8-20-2023.
                                                    //




                                                    Created: taskResult[i].Created,
                                                    bwDueDate: taskResult[i].bwDueDate,
                                                    bwHasBeenProcessedByTheWorkflowEngine: taskResult[i].bwHasBeenProcessedByTheWorkflowEngine,
                                                    bwAssignedTo: taskResult[i].bwAssignedTo,
                                                    bwAssignedToId: taskResult[i].bwAssignedToId,
                                                    bwWorkflowAppId: taskResult[i].bwWorkflowAppId,
                                                    TaskType: taskResult[i].TaskType,

                                                    DailyOverdueTaskNotificationDate: taskResult[i].DailyOverdueTaskNotificationDate,

                                                    bwAssignedToRaciRoleAbbreviation: taskResult[i].bwAssignedToRaciRoleAbbreviation, // eg: PM
                                                    bwAssignedToRaciRoleName: taskResult[i].bwAssignedToRaciRoleName // eg: Project Manager
                                                };
                                                taskData.push(task);
                                                break;
                                            }
                                        }
                                    }

                                } else {

                                    alert('Error in bwAuthentication.js.getDataForHomePageNotificationScreen_FASTSECONDPASS(). Invalid value for taskResult[i].TaskType: ' + taskResult[i].TaskType);

                                }
                            }


                            //var participantsData = [];
                            //var brData = [];
                            //var myBrData = [];

                            //var html = bwCommonScripts.generateHomePageNotificationScreenHtml(deferredIndex, appweburl, workflowAppId, null, taskData, null, participantsData, brData, myBrData, false);
                            //debugger;
                            var result = {
                                //html: html,
                                workflowAppId: workflowAppId,
                                taskData: taskData,
                                //participantsData: participantsData,
                                brData: {
                                    brResult: results.brResult, // Sending this so that we can access bwRequestJson and get at our selected inventory, so we can display the images in the home page carousel.
                                    PendingBudgetRequests: results.PendingBudgetRequests
                                },
                                myBrData: {
                                    MyRequests: results.MyRequests
                                }

                            }
                            resolve(result);

                            // myBrData.MyRequests


                            ////alert('xcx2131231232-1 calling generateHomePageNotificationScreenHtml().');
                            ////var html = bwCommonScripts.generateHomePageNotificationScreenHtml(deferredIndex, appweburl, workflowAppId, null, taskData, null, participantsData, brData, myBrData, false);

                            //var result = {
                            //    //html: html,
                            //    workflowAppId: workflowAppId,
                            //    taskData: taskData,
                            //    participantsData: participantsData,
                            //    brData: brData, // Sending this so that we can access bwRequestJson and get at our selected inventory, so we can display the images in the home page carousel.
                            //    myBrData: myBrData
                            //}
                            //resolve(result);

                        } catch (e) {
                            console.log('Exception in getDataForHomePageNotificationScreen_FASTSECONDPASS().xc3312312: ' + e.message + ', ' + e.stack);
                            displayAlertDialog('Exception in getDataForHomePageNotificationScreen_FASTSECONDPASS().xc3312312: ' + e.message + ', ' + e.stack);

                            reject();
                        }
                        //                            },
                        //                            error: function (data, errorCode, errorMessage) {

                        //                                displayAlertDialog('Error in my.js.renderAlerts()2:144:' + errorCode + ', ' + errorMessage + ' I believe this happens when wifi goes down. SERVICE UNAVAILABLE ');

                        //                                reject();
                        //                            }
                        //                        });
                        //                    },
                        //                    error: function (data, errorCode, errorMessage) {

                        //                        displayAlertDialog('Error in my.js.renderAlerts2():1:' + errorCode + ', ' + errorMessage + ' I believe this happens when wifi goes down. SERVICE UNAVAILABLE ');

                        //                        reject();
                        //                    }
                        //                });

                        //    },
                        //    error: function (data, errorCode, errorMessage) {

                        //        displayAlertDialog('Error in my.js.renderAlerts2():4:' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));

                        //        reject();
                        //    }
                        //});



                    },
                    error: function (data, errorCode, errorMessage) {
                        console.log('Error in my.js.renderAlerts2():4:' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                        displayAlertDialog('Error in my.js.renderAlerts2():4:' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));

                        reject();
                    }
                });

            } catch (e) {
                console.log('Exception in getDataForHomePageNotificationScreen_FASTSECONDPASS(). ' + e.message + ', ' + e.stack);
                displayAlertDialog('Exception in getDataForHomePageNotificationScreen_FASTSECONDPASS(). ' + e.message + ', ' + e.stack);

                reject();
            }
        });
    },


    getPagedDataFor_PINNED_REQUESTS: function (pageNumber, pageSize) {
        var thiz = this;
        return new Promise(function (resolve, reject) {
            // This is used on the client side (here), and also on the server side for generating this content to be included in emails. (OverdueTasksTimer). 
            try {
                console.log('');
                console.log('******************************');
                console.log('In getPagedDataFor_PINNED_REQUESTS(). We need to add our new authorization code here 11-16-2022...');
                console.log('******************************');
                console.log('');

                var workflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
                var participantId = $('.bwAuthentication').bwAuthentication('option', 'participantId');

                var activeStateIdentifier = $('.bwAuthentication').bwAuthentication('getActiveStateIdentifier');

                var PinnedRequestsArray = $('.bwAuthentication').bwAuthentication('option', 'UserData_PinnedRequestsArray');

                var data = {
                    bwParticipantId_LoggedIn: participantId,
                    bwActiveStateIdentifier: activeStateIdentifier,
                    bwWorkflowAppId_LoggedIn: workflowAppId,

                    bwWorkflowAppId: workflowAppId,
                    bwParticipantId: participantId,
                    pageNumber: pageNumber,
                    pageSize: pageSize,
                    bwBudgetRequestId_Array: PinnedRequestsArray
                }
                var operationUri = webserviceurl + '/getPagedDataFor_PINNED_REQUESTS'; // The validation/validity-check of the PinnedRequestsArray has to happen on the server in this method/web-service.
                $.ajax({
                    url: operationUri,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function (results) {
                        try {

                            if (results.status != 'SUCCESS') {

                                var msg = 'Error in bwAuthentication.js.getPagedDataFor_PINNED_REQUESTS(): ' + JSON.stringify(results); // results.message;

                                console.log(msg);
                                displayAlertDialog(msg);

                                var result = {
                                    status: results.status,
                                    message: msg
                                }
                                reject(result);

                            } else {

                                //
                                //
                                // The validation/validity-check of the PinnedRequestsArray has to happen here using the results of this method/web-service.
                                //
                                //

                                if (results.results.length != PinnedRequestsArray.length) {

                                    console.log('The pinned requests quantity does not match. FORCE REMEDIATION.');

                                    var div = document.getElementById('divRemediate_PINNED_REQUESTS');
                                    if (!div) {

                                        console.log('In bwAuthentication.js.getPagedDataFor_PINNED_REQUESTS(). adding element to the dom: ' + 'divRemediate_PINNED_REQUESTS');

                                        div = document.createElement('div');
                                        div.id = 'divRemediate_PINNED_REQUESTS';
                                        div.style.display = 'none';
                                        document.body.appendChild(div); // Place at end of document

                                        var html = '';

                                        html += '        <table style="width:100%;">';
                                        html += '            <tr>';
                                        html += '                <td style="width:90%;">';
                                        html += '                    <span id="spanDeleteAnAttachmentOfflineDialogTitlexxx" style="color: #3f3f3f;font-size: 60pt;font-weight:bold;">Remediate Pinned Request List</span>';
                                        html += '                </td>';
                                        html += '                <td style="width:9%;"></td>';
                                        html += '                <td style="width:1%;cursor:pointer;vertical-align:top;">';
                                        html += '                    <span class="dialogXButton" style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;font-size: 120pt;font-weight:bold;" onclick="$(\'#divRemediate_PINNED_REQUESTS\').dialog(\'close\');">X</span>';
                                        html += '                </td>';
                                        html += '            </tr>';
                                        html += '        </table>';
                                        html += '        <br /><br />';
                                        html += '        <!--<span id="spanDeleteAnAttachmentOfflineDialogTitle" style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 40pt;font-weight:bold;">Delete Slide</span>';
                                        html += '        <br /><br />-->';
                                        html += '        <span id="spanDeleteAnAttachmentOfflineDialogDependencyDetails" style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 30pt;">';

                                        html += 'Some of your pinned requests may have been deleted. The amount of pinned requests has changed. Click Ok to automatically update your list.<br /><br />(In the future we will add functionality for missing pinned requests)';

                                        html += '       </span>';
                                        html += '        <br /><br />';
                                        html += '        <span id="spanDeleteAnAttachmentOfflineDialogTopMessage"></span>';
                                        html += '        <br />';
                                        html += '        <div id="divDeleteAnAttachmentOfflineDialogDeleteRequestButtonxxxx" class="divDialogButton" onclick="$(\'#divRemediate_PINNED_REQUESTS\').dialog(\'close\');">';
                                        html += '            Ok';
                                        html += '        </div>';
                                        //html += '        <br /><br />';
                                        //html += '       <div class="divDialogButton" onclick="$(\'#divDeleteASlideDialog\').dialog(\'close\');">';
                                        //html += '           Close';
                                        //html += '        </div>';
                                        html += '        <br /><br />';
                                        html += '        <br /><br />';

                                        div.innerHTML = html;
                                    }


                                    $('#divRemediate_PINNED_REQUESTS').dialog({
                                        modal: true,
                                        resizable: false,
                                        closeText: "Cancel",
                                        closeOnEscape: true, // Hit the ESC key to hide! Yeah!
                                        width: "1000", //"570px",
                                        dialogClass: "no-close", // No close button in the upper right corner.
                                        hide: false, // This means when hiding just disappear with no effects.
                                        open: function () {
                                            $('.ui-widget-overlay').bind('click', function () {
                                                $("#divRemediate_PINNED_REQUESTS").dialog('close');
                                            });
                                        }
                                    });

                                    // Hide the title bar.
                                    $("#divRemediate_PINNED_REQUESTS").dialog().parents(".ui-dialog").find(".ui-dialog-titlebar").remove();
                                    // Set the title.
                                    //document.getElementById('spanDeleteAnAttachmentOfflineDialogTitle').innerHTML = 'Delete ' + fileName;

                                    // Set the click event for the Delete button.
                                    //$('#divDeleteAnAttachmentOfflineDialogDeleteRequestButton').off('click').click(function (error) {
                                    //    try {
                                    //        var fileserviceurl = globalUrlPrefix + globalUrlForWebServices + '/_files';
                                    //        var data = {
                                    //            FolderName: folderName,
                                    //            FileName: fileName
                                    //        };
                                    //        var operationUri = fileserviceurl + "/deleteaslide";
                                    //        $.ajax({
                                    //            url: operationUri,
                                    //            type: "POST",
                                    //            data: data,
                                    //            headers: {
                                    //                "Accept": "application/json; odata=verbose"
                                    //            },
                                    //            success: function (data) {
                                    //                try {
                                    //                    $("#divDeleteASlideDialog").dialog('close');

                                    //                    if (JSON.stringify(data).toUpperCase().indexOf('THE SLIDE WAS DELETED') > -1) {

                                    //                        $('.bwSlideshowAdmin').bwSlideshowAdmin('loadFoldersAndFiles'); // Reload and redraw.

                                    //                    } else {

                                    //                        alert(data);
                                    //                        $('.bwSlideshowAdmin').bwSlideshowAdmin('loadFoldersAndFiles'); // Reload and redraw.

                                    //                    }
                                    //                } catch (e) {
                                    //                    console.log('Exception in bwCampaign.js.deleteSlide.post.removeattachment.success(): ' + e.message + ', ' + e.stack);
                                    //                    displayAlertDialog('Exception in bwCampaign.js.deleteSlide.post.removeattachment.success(): ' + e.message + ', ' + e.stack);
                                    //                }
                                    //            },
                                    //            error: function (data, errorCode, errorMessage) {
                                    //                console.log('Error in bwCampaign.js.deleteSlide.post.removeattachment.error(): ' + e.message + ', ' + e.stack);
                                    //                displayAlertDialog('Error in bwCampaign.js.deleteSlide.post.removeattachment.error(): bwBudgetRequestId: ' + bwBudgetRequestId + ', filename: ' + filename + ', errorMessage: ' + errorMessage);
                                    //            }
                                    //        });
                                    //    } catch (e) {
                                    //        console.log('Exception in bwCampaign.js.cmdDeleteSlide.deletebutton.click(): ' + e.message + ', ' + e.stack);
                                    //        displayAlertDialog('Exception in bwCampaign.js.cmdDeleteSlide.deletebutton.click(): ' + e.message + ', ' + e.stack);
                                    //    }
                                    //});











                                    thiz.options.PINNED_REQUESTS = results.results;

                                    resolve(results);








                                } else {

                                    thiz.options.PINNED_REQUESTS = results.results;

                                    resolve(results);

                                }

                            }

                        } catch (e) {

                            var msg = 'Exception in bwAuthentication.js.getPagedDataFor_PINNED_REQUESTS():2: ' + e.message + ', ' + e.stack;
                            console.log(msg);
                            displayAlertDialog(msg);

                            var result = {
                                status: 'EXCEPTION',
                                message: msg
                            }
                            reject(result);

                        }
                    },
                    error: function (data, errorCode, errorMessage) {

                        var msg = 'Error in bwAuthentication.js.getPagedDataFor_PINNED_REQUESTS(): errorCode: ' + errorCode + ', errorMessage: ' + errorMessage + ', data: ' + JSON.stringify(data);

                        console.log(msg);
                        displayAlertDialog(msg);

                        var result = {
                            status: 'ERROR',
                            message: msg
                        }
                        reject(result);

                    }
                });

            } catch (e) {

                var msg = 'Exception in bwAuthentication.js.getPagedDataFor_PINNED_REQUESTS():1: ' + e.message + ', ' + e.stack;

                console.log(msg);
                displayAlertDialog(msg);

                var result = {
                    status: 'EXCEPTION',
                    message: msg
                }
                reject(result);

            }
        });
    },

    getPagedDataFor_MY_UNSUBMITTED_REQUESTS: function (pageNumber, pageSize) {
        var thiz = this;
        return new Promise(function (resolve, reject) {
            // This is used on the client side (here), and also on the server side for generating this content to be included in emails. (OverdueTasksTimer). 
            try {
                console.log('');
                console.log('******************************');
                console.log('In getPagedDataFor_MY_UNSUBMITTED_REQUESTS(). We need to add our new authorization code here 11-16-2022...');
                console.log('******************************');
                console.log('');

                var workflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
                var participantId = $('.bwAuthentication').bwAuthentication('option', 'participantId');

                var activeStateIdentifier = $('.bwAuthentication').bwAuthentication('getActiveStateIdentifier');

                var data = {
                    bwParticipantId_LoggedIn: participantId,
                    bwActiveStateIdentifier: activeStateIdentifier,
                    bwWorkflowAppId_LoggedIn: workflowAppId,

                    bwWorkflowAppId: workflowAppId,
                    bwParticipantId: participantId,
                    pageNumber: pageNumber,
                    pageSize: pageSize
                }
                var operationUri = webserviceurl + '/getPagedDataFor_MY_UNSUBMITTED_REQUESTS'; // The validation/validity-check of the PinnedRequestsArray has to happen on the server in this method/web-service.
                $.ajax({
                    url: operationUri,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function (results) {
                        try {

                            if (results.status != 'SUCCESS') {

                                var msg = 'Error in bwAuthentication.js.getPagedDataFor_MY_UNSUBMITTED_REQUESTS(): ' + JSON.stringify(results); // results.message;

                                console.log(msg);
                                displayAlertDialog(msg);

                                var result = {
                                    status: results.status,
                                    message: msg
                                }
                                reject(result);

                            } else {

                                thiz.options.MY_UNSUBMITTED_REQUESTS = results.results;

                                resolve(results);

                            }

                        } catch (e) {

                            var msg = 'Exception in bwAuthentication.js.getPagedDataFor_MY_UNSUBMITTED_REQUESTS():2: ' + e.message + ', ' + e.stack;
                            console.log(msg);
                            displayAlertDialog(msg);

                            var result = {
                                status: 'EXCEPTION',
                                message: msg
                            }
                            reject(result);

                        }
                    },
                    error: function (data, errorCode, errorMessage) {

                        var msg = 'Error in bwAuthentication.js.getPagedDataFor_MY_UNSUBMITTED_REQUESTS(): errorCode: ' + errorCode + ', errorMessage: ' + errorMessage + ', data: ' + JSON.stringify(data);

                        console.log(msg);
                        displayAlertDialog(msg);

                        var result = {
                            status: 'ERROR',
                            message: msg
                        }
                        reject(result);

                    }
                });

            } catch (e) {

                var msg = 'Exception in bwAuthentication.js.getPagedDataFor_MY_UNSUBMITTED_REQUESTS():1: ' + e.message + ', ' + e.stack;

                console.log(msg);
                displayAlertDialog(msg);

                var result = {
                    status: 'EXCEPTION',
                    message: msg
                }
                reject(result);

            }
        });
    },

    getPagedDataFor_MY_SUBMITTED_REQUESTS: function (pageNumber, pageSize) {
        var thiz = this;
        return new Promise(function (resolve, reject) {
            // This is used on the client side (here), and also on the server side for generating this content to be included in emails. (OverdueTasksTimer). 
            try {
                console.log('');
                console.log('******************************');
                console.log('In getPagedDataFor_MY_SUBMITTED_REQUESTS(). We need to add our new authorization code here 11-16-2022...');
                console.log('******************************');
                console.log('');

                var workflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
                var participantId = $('.bwAuthentication').bwAuthentication('option', 'participantId');

                var activeStateIdentifier = $('.bwAuthentication').bwAuthentication('getActiveStateIdentifier');

                var data = {
                    bwParticipantId_LoggedIn: participantId,
                    bwActiveStateIdentifier: activeStateIdentifier,
                    bwWorkflowAppId_LoggedIn: workflowAppId,

                    bwWorkflowAppId: workflowAppId,
                    bwParticipantId: participantId,
                    pageNumber: pageNumber,
                    pageSize: pageSize
                }
                var operationUri = webserviceurl + '/getPagedDataFor_MY_SUBMITTED_REQUESTS'; // The validation/validity-check of the PinnedRequestsArray has to happen on the server in this method/web-service.
                $.ajax({
                    url: operationUri,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function (results) {
                        try {

                            if (results.status != 'SUCCESS') {

                                var msg = 'Error in bwAuthentication.js.getPagedDataFor_MY_SUBMITTED_REQUESTS(): ' + JSON.stringify(results); // results.message;

                                console.log(msg);
                                displayAlertDialog(msg);

                                var result = {
                                    status: results.status,
                                    message: msg
                                }
                                reject(result);

                            } else {

                                thiz.options.MY_SUBMITTED_REQUESTS = results.results;

                                resolve(results);

                            }

                        } catch (e) {

                            var msg = 'Exception in bwAuthentication.js.getPagedDataFor_MY_SUBMITTED_REQUESTS():2: ' + e.message + ', ' + e.stack;
                            console.log(msg);
                            displayAlertDialog(msg);

                            var result = {
                                status: 'EXCEPTION',
                                message: msg
                            }
                            reject(result);

                        }
                    },
                    error: function (data, errorCode, errorMessage) {

                        var msg = 'Error in bwAuthentication.js.getPagedDataFor_MY_SUBMITTED_REQUESTS(): errorCode: ' + errorCode + ', errorMessage: ' + errorMessage + ', data: ' + JSON.stringify(data);

                        console.log(msg);
                        displayAlertDialog(msg);

                        var result = {
                            status: 'ERROR',
                            message: msg
                        }
                        reject(result);

                    }
                });

            } catch (e) {

                var msg = 'Exception in bwAuthentication.js.getPagedDataFor_MY_SUBMITTED_REQUESTS():1: ' + e.message + ', ' + e.stack;

                console.log(msg);
                displayAlertDialog(msg);

                var result = {
                    status: 'EXCEPTION',
                    message: msg
                }
                reject(result);

            }
        });
    },

    getPagedDataFor_ACTIVE_REQUESTS: function (pageNumber, pageSize) {
        var thiz = this;
        return new Promise(function (resolve, reject) {
            // This is used on the client side (here), and also on the server side for generating this content to be included in emails. (OverdueTasksTimer). 
            try {
                console.log('');
                console.log('******************************');
                console.log('In getPagedDataFor_ACTIVE_REQUESTS(). We need to add our new authorization code here 11-16-2022...');
                console.log('******************************');
                console.log('');

                var workflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
                var participantId = $('.bwAuthentication').bwAuthentication('option', 'participantId');

                var activeStateIdentifier = $('.bwAuthentication').bwAuthentication('getActiveStateIdentifier');

                var data = {
                    bwParticipantId_LoggedIn: participantId,
                    bwActiveStateIdentifier: activeStateIdentifier,
                    bwWorkflowAppId_LoggedIn: workflowAppId,

                    bwWorkflowAppId: workflowAppId,
                    bwParticipantId: participantId,
                    pageNumber: pageNumber,
                    pageSize: pageSize
                }
                var operationUri = webserviceurl + '/getPagedDataFor_ACTIVE_REQUESTS'; // The validation/validity-check of the PinnedRequestsArray has to happen on the server in this method/web-service.
                $.ajax({
                    url: operationUri,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function (results) {
                        try {

                            if (results.status != 'SUCCESS') {

                                var msg = 'Error in bwAuthentication.js.getPagedDataFor_ACTIVE_REQUESTS(): ' + JSON.stringify(results); // results.message;

                                console.log(msg);
                                displayAlertDialog(msg);

                                var result = {
                                    status: results.status,
                                    message: msg
                                }
                                reject(result);

                            } else {

                                thiz.options.ACTIVE_REQUESTS = results.results;

                                resolve(results);

                            }

                        } catch (e) {

                            var msg = 'Exception in bwAuthentication.js.getPagedDataFor_ACTIVE_REQUESTS():2: ' + e.message + ', ' + e.stack;
                            console.log(msg);
                            displayAlertDialog(msg);

                            var result = {
                                status: 'EXCEPTION',
                                message: msg
                            }
                            reject(result);

                        }
                    },
                    error: function (data, errorCode, errorMessage) {

                        var msg = 'Error in bwAuthentication.js.getPagedDataFor_ACTIVE_REQUESTS(): errorCode: ' + errorCode + ', errorMessage: ' + errorMessage + ', data: ' + JSON.stringify(data);

                        console.log(msg);
                        displayAlertDialog(msg);

                        var result = {
                            status: 'ERROR',
                            message: msg
                        }
                        reject(result);

                    }
                });

            } catch (e) {

                var msg = 'Exception in bwAuthentication.js.getPagedDataFor_ACTIVE_REQUESTS():1: ' + e.message + ', ' + e.stack;

                console.log(msg);
                displayAlertDialog(msg);

                var result = {
                    status: 'EXCEPTION',
                    message: msg
                }
                reject(result);

            }
        });
    },

    getPagedDataFor_MY_PENDING_TASKS: function (pageNumber, pageSize) {
        var thiz = this;
        return new Promise(function (resolve, reject) {
            // This is used on the client side (here), and also on the server side for generating this content to be included in emails. (OverdueTasksTimer). 
            try {
                console.log('');
                console.log('******************************');
                console.log('In getPagedDataFor_MY_PENDING_TASKS(). We need to add our new authorization code here 11-16-2022...');
                console.log('******************************');
                console.log('');

                var workflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
                var participantId = $('.bwAuthentication').bwAuthentication('option', 'participantId');

                var activeStateIdentifier = $('.bwAuthentication').bwAuthentication('getActiveStateIdentifier');

                var data = {
                    bwParticipantId_LoggedIn: participantId,
                    bwActiveStateIdentifier: activeStateIdentifier,
                    bwWorkflowAppId_LoggedIn: workflowAppId,

                    bwWorkflowAppId: workflowAppId,
                    bwParticipantId: participantId,
                    pageNumber: pageNumber,
                    pageSize: pageSize
                }
                var operationUri = webserviceurl + '/getPagedDataFor_MY_PENDING_TASKS';
                $.ajax({
                    url: operationUri,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function (results) {
                        try {

                            if (results.status != 'SUCCESS') {

                                var msg = 'Error in bwAuthentication.js.getPagedDataFor_MY_PENDING_TASKS(): ' + results.message;

                                console.log(msg);
                                displayAlertDialog(msg);

                                var result = {
                                    status: results.status,
                                    message: msg
                                }
                                reject(result);

                            } else {

                                //var result = {
                                //    status: 'SUCCESS',
                                //    message: msg,
                                //    taskResult: wtResult,
                                //    brResult: brResult
                                //}

                                for (var i = (results.taskResult.length - 1); i > -1; i--) { // Doing this backwards so that when an item is pushed, the array is in the correct order.
                                    for (var j = 0; j < results.brResult.length; j++) {
                                        if (results.brResult[j].bwBudgetRequestId == results.taskResult[i].bwRelatedItemId) {

                                            results.taskResult[i]["bwBudgetRequestId"] = results.brResult[j].bwBudgetRequestId;
                                            results.taskResult[i]["Title"] = results.brResult[j].Title;
                                            results.taskResult[i]["ProjectTitle"] = results.brResult[j].ProjectTitle;
                                            results.taskResult[i]["OrgId"] = results.brResult[j].OrgId;
                                            results.taskResult[i]["OrgName"] = results.brResult[j].OrgName;

                                            results.taskResult[i]["Created"] = results.brResult[j].Created;
                                            results.taskResult[i]["CreatedBy"] = results.brResult[j].CreatedBy;


                                            debugger; // do we need this one? 9-5-2023.
                                            results.taskResult[i]["bwRequestTypeId"] = results.brResult[j].bwRequestTypeId;

                                            results.taskResult[i]["bwRequestJson"] = results.brResult[j].bwRequestJson; // We add the bwRequestJson property to the task.
                                            break;

                                        }
                                    }
                                }

                                thiz.options.MY_PENDING_TASKS = results.taskResult;

                                var msg = 'Successfully merged bwRequestJson with bwWOrkflowTask(s).';

                                var result = {
                                    status: 'SUCCESS',
                                    message: msg,
                                    results: results.taskResult
                                }

                                resolve(result);

                            }

                        } catch (e) {

                            var msg = 'Exception in bwAuthentication.js.getPagedDataFor_MY_PENDING_TASKS():2: ' + e.message + ', ' + e.stack;
                            console.log(msg);
                            displayAlertDialog(msg);

                            var result = {
                                status: 'EXCEPTION',
                                message: msg
                            }
                            reject(result);

                        }
                    },
                    error: function (data, errorCode, errorMessage) {

                        var msg = 'Error in bwAuthentication.js.getPagedDataFor_MY_PENDING_TASKS(): errorCode: ' + errorCode + ', errorMessage: ' + errorMessage + ', data: ' + JSON.stringify(data);

                        console.log(msg);
                        displayAlertDialog(msg);

                        var result = {
                            status: 'ERROR',
                            message: msg
                        }
                        reject(result);

                    }
                });

            } catch (e) {

                var msg = 'Exception in bwAuthentication.js.getPagedDataFor_MY_PENDING_TASKS():1: ' + e.message + ', ' + e.stack;

                console.log(msg);
                displayAlertDialog(msg);

                var result = {
                    status: 'EXCEPTION',
                    message: msg
                }
                reject(result);

            }
        });
    },




    generateHomePageNotificationScreen: function (deferredIndex, queryData) {
        return new Promise(function (resolve, reject) {
            // This is used on the client side (here), and also on the server side for generating this content to be included in emails. (OverdueTasksTimer). 
            try {
                console.log('');
                console.log('******************************');
                console.log('In generateHomePageNotificationScreen(). We need to add our new authorization code here 11-16-2022...');
                console.log('******************************');
                console.log('');
                var thiz = this;

                var workflowAppId = queryData.bwWorkflowAppId;

                var activeStateIdentifier = $('.bwAuthentication:first').bwAuthentication('getActiveStateIdentifier');
                queryData["bwActiveStateIdentifier"] = activeStateIdentifier; // Add this for the authorization.

                alert('In generateHomePageNotificationScreen(). Making 4 web service calls in bwAuthentication.js.generateHomePageNotificationScreen().');

                $.ajax({
                    url: webserviceurl + "/bwtasksoutstanding",
                    type: "Post",
                    contentType: 'application/json',
                    data: JSON.stringify(queryData),
                    success: function (taskData) {
                        $.ajax({
                            url: webserviceurl + "/bwparticipants",
                            type: "POST",
                            contentType: 'application/json',
                            data: JSON.stringify(queryData),
                            success: function (participantsData) {
                                $.ajax({
                                    url: webserviceurl + "/bwbudgetrequestspending",
                                    type: "DELETE",
                                    contentType: 'application/json',
                                    data: JSON.stringify(queryData),
                                    success: function (brData) {
                                        $.ajax({
                                            url: webserviceurl + "/mybudgetrequests",
                                            type: "DELETE",
                                            contentType: 'application/json',
                                            data: JSON.stringify(queryData),
                                            success: function (myBrData) {
                                                try {
                                                    alert('xcx2131231232-2 calling generateHomePageNotificationScreenHtml().');
                                                    var html = bwCommonScripts.generateHomePageNotificationScreenHtml(deferredIndex, appweburl, workflowAppId, null, taskData, null, participantsData, brData, myBrData, false);

                                                    var result = {
                                                        html: html,
                                                        workflowAppId: workflowAppId,
                                                        taskData: taskData,
                                                        participantsData: participantsData,
                                                        brData: brData, // Sending this so that we can access bwRequestJson and get at our selected inventory, so we can display the images in the home page carousel.
                                                        myBrData: myBrData
                                                    }
                                                    resolve(result);

                                                } catch (e) {

                                                }
                                            },
                                            error: function (data, errorCode, errorMessage) {

                                                displayAlertDialog('Error in my.js.renderAlerts()2:144:' + errorCode + ', ' + errorMessage + ' I believe this happens when wifi goes down. SERVICE UNAVAILABLE ');

                                                reject();
                                            }
                                        });
                                    },
                                    error: function (data, errorCode, errorMessage) {

                                        displayAlertDialog('Error in my.js.renderAlerts2():1:' + errorCode + ', ' + errorMessage + ' I believe this happens when wifi goes down. SERVICE UNAVAILABLE ');

                                        reject();
                                    }
                                });
                            },
                            error: function (data, errorCode, errorMessage) {

                                displayAlertDialog('Note: Validate that WriteToErrorLog() works here. Error in my.js.renderAlerts2():2: ' + errorCode + ', ' + errorMessage);

                                WriteToErrorLog('xcx2131425', errorMessage);

                                reject();
                            }
                        });
                    },
                    error: function (data, errorCode, errorMessage) {

                        displayAlertDialog('Error in my.js.renderAlerts2():4:' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));

                        reject();
                    }
                });

            } catch (e) {
                console.log('Exception in generateHomePageNotificationScreen(). ' + e.message + ', ' + e.stack);
                displayAlertDialog('Exception in generateHomePageNotificationScreen(). ' + e.message + ', ' + e.stack);

                reject();
            }
        });
    },

    generateCustomerHomePageNotificationScreen: function (deferredIndex, queryData) { //, taskData, brData, myBrData, invitationData) {
        return new Promise(function (resolve, reject) {
            // This is used on the client side (here), and also on the server side for generating this content to be included in emails. (OverdueTasksTimer). 
            try {
                console.log('In generateCustomerHomePageNotificationScreen().');
                var thiz = this;

                var workflowAppId = queryData.bwWorkflowAppId;

                var html = '';

                $.ajax({
                    url: webserviceurl + "/mybudgetrequests",
                    type: "DELETE",
                    contentType: 'application/json',
                    data: JSON.stringify(queryData),
                    success: function (myBrData) {
                        try {
                            debugger; // See where we can return the bwRequestJson // 1-21-2022
                            //var tenantId = $('.bwAuthentication').bwAuthentication('option', 'tenantId');
                            //var workflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');

                            //alert('xcx23345 taskData[0]: ' + JSON.stringify(taskData[0]));

                            var html = bwCommonScripts.generateCustomerHomePageNotificationScreenHtml(deferredIndex, appweburl, workflowAppId, myBrData, false);
                            //var html = thiz.generateHomePageNotificationScreenHtml(deferredIndex, appweburl, workflowAppId, invitationData, taskData, tenantData, participantsData, brData, myBrData, false);
                            //$('#divHomePageAlert').html(result.html);

                            var result = {
                                html: html,
                                workflowAppId: workflowAppId,
                                //invitationData: invitationData,
                                //taskData: taskData,
                                //tenantData: tenantData,
                                //participantsData: participantsData,
                                //brData: brData, // Sending this so that we can access bwRequestJson and get at our selected inventory, so we can display the images in the home page carousel.
                                myBrData: myBrData
                            }

                            resolve(result);

                        } catch (e) {

                        }
                    },
                    error: function (data, errorCode, errorMessage) {
                        //handleExceptionWithAlert('Error in index.js.cmdCreateANewTenant()', errorCode + ', ' + errorMessage);
                        displayAlertDialog('Error in my.js.renderAlerts()2:144:' + errorCode + ', ' + errorMessage + ' I believe this happens when wifi goes down. SERVICE UNAVAILABLE ');

                        reject();
                    }
                });

            } catch (e) {
                console.log('Exception in generateCustomerHomePageNotificationScreen(). ' + e.message + ', ' + e.stack);
                displayAlertDialog('Exception in generateCustomerHomePageNotificationScreen(). ' + e.message + ', ' + e.stack);

                reject();
            }
        });
    },


    //loadRemainingJsAndCssAndBWMData: function () {
    //    try {
    //        console.log('In bwAuthentication.js.loadRemainingJsAndCssAndBWMData().');
    //        alert('In bwAuthentication.js.loadRemainingJsAndCssAndBWMData().');
    //        //debugger;
    //        // When a user clicks the back or refresh button, this is the additional message to the "Do you want to leave this page?" dialog.
    //        // Todd: THIS DOESN'T WORK FOR IOS!!!
    //        //window.onbeforeunload = function (event) {
    //        //    return 'You may have to login again.';
    //        //};


    //        //
    //        // CHECK IF Invitation or Unsubscribe query string parameters!!! 8-10-2020
    //        //






    //        //
    //        // LOAD THE REMAINING JAVASCRIPT FILES!!!!!!!!!!!!  8-10-2020
    //        //
    //        var versionGuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) { // Prevents caching of javascript on the client side. Always the latest version! :)
    //            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
    //            return v.toString(16);
    //        });
    //        var css = [];
    //        //css.push('css/jquery/1.11.1/jquery-ui.min.css?v=' + versionGuid);
    //        css.push('css/quill.snow.css?v=' + versionGuid);
    //        css.push('css/quill.core.css?v=' + versionGuid);
    //        css.push('css/qtip/jquery.qtip.min.css?v=' + versionGuid);
    //        //css.push('css/jquery.jqplot.min.css?v=' + versionGuid);
    //        //css.push('css/contextMenu/jquery.contextMenu.css?v=' + versionGuid);
    //        //css.push('css/jsgrid/jsgrid.css?v=' + versionGuid);
    //        //css.push('css/jsgrid/jsgrid-theme.css?v=' + versionGuid);
    //        for (var i = 0; i < css.length; i++) {
    //            var link = document.createElement('link');
    //            link.type = 'text/css';
    //            link.rel = 'stylesheet';
    //            link.href = css[i];
    //            document.head.appendChild(link);
    //        }

    //        var scripts = [];
    //        //scripts.push('scripts/bw.core.min.js?v=' + versionGuid);
    //        //scripts.push('scripts/bw.utility.core.min.js?v=' + versionGuid);
    //        scripts.push('scripts/bwm.core.min.js?v=' + versionGuid);
    //        scripts.push('scripts/bwm.min.js?v=' + versionGuid);
    //        scripts.push('scripts/snap/snap.svg.min.js?v=' + versionGuid);
    //        //scripts.push('scripts/jsgrid/jsgrid.1.5.3.min.js?v=' + versionGuid);
    //        //scripts.push('scripts/contextMenu/jquery.contextMenu.js?v=' + versionGuid);
    //        //scripts.push('scripts/contextMenu/jquery.ui.position.js?v=' + versionGuid);
    //        scripts.push('scripts/quill.js?v=' + versionGuid);
    //        //scripts.push('scripts/qtip/jquery.qtip.min.js?v=' + versionGuid);
    //        //scripts.push('scripts/jqplot/jquery.jqplot.min.js?v=' + versionGuid);
    //        //scripts.push('scripts/jqplot/jqplot.pieRenderer.min.js?v=' + versionGuid);
    //        //scripts.push('scripts/jqplot/jqplot.canvasTextRenderer.js?v=' + versionGuid);
    //        //scripts.push('scripts/jqplot/jqplot.dateAxisRenderer.js?v=' + versionGuid);
    //        //scripts.push('scripts/jqplot/jqplot.canvasAxisLabelRenderer.js?v=' + versionGuid);
    //        //scripts.push('scripts/jqplot/jqplot.canvasAxisTickRenderer.js?v=' + versionGuid);
    //        //scripts.push('scripts/jqplot/jqplot.pointLabels.js?v=' + versionGuid);
    //        //scripts.push('scripts/jqplot/jqplot.cursor.js?v=' + versionGuid);
    //        //scripts.push('scripts/switchbutton/jquery.switchButton.min.js?v=' + versionGuid);
    //        scripts.push('scripts/bw.offline.core.min.js?v=' + versionGuid);
    //        for (var i = 0; i < scripts.length; i++) {
    //            var script = document.createElement('script');
    //            script.type = 'text/javascript';
    //            script.src = scripts[i];
    //            document.head.appendChild(script);
    //        }

    //        //var formWidgets = [];
    //        //formWidgets.push('formwidgets/bwAttachments.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwCommentsField.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwCostsGrid.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwDescriptionField.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwDurationInMonthsCalculatedField.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwEndDatePicker.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwDescriptionDetailsField.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwJustificationDetailsField.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwReasonDetailsField.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwCapitalInternalOrderNumberField.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwExpenseInternalOrderNumberField.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwCostCenterNumberField.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwCostCenterDescriptionField.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwProjectClassField.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwPaybackTypeField.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwLocationPicker.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwPaybackGrid.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwPeoplePicker.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwRequestedCapitalField.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwSpendGrid.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwStartDatePicker.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwYearDropDown.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwProjectTypeDropDown.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwPillarTypeDropDown.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwRequestTypeDropDown.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwProjectTypeCheckboxGroup.min.js?v=' + versionGuid);
    //        //formWidgets.push('formwidgets/bwPillarTypeCheckboxGroup.min.js?v=' + versionGuid);
    //        //formWidgets.push('scripts/html2canvas.min.js?v=0');
    //        //for (var i = 0; i < formWidgets.length; i++) {
    //        //    var script = document.createElement('script');
    //        //    script.type = 'text/javascript';
    //        //    script.src = formWidgets[i];
    //        //    document.head.appendChild(script);
    //        //}


    //        //var widgets = [];
    //        ////widgets.push('widgets/bwCoreComponent.min.js?v=' + versionGuid);
    //        //widgets.push('widgets/bwHomePage.min.js?v=' + versionGuid);
    //        ////widgets.push('widgets/bwRequest.js?v=' + versionGuid);
    //        //widgets.push('widgets/bwWorkflowEditor.min.js?v=' + versionGuid);
    //        //widgets.push('widgets/bwChecklistsEditor.min.js?v=' + versionGuid);
    //        //widgets.push('widgets/bwFormsEditor.min.js?v=' + versionGuid);
    //        //widgets.push('widgets/bwLocationEditor.min.js?v=' + versionGuid);
    //        ////widgets.push('widgets/bwOrganizationEditor.min.js?v=' + versionGuid);
    //        //widgets.push('widgets/bwOrganizationEditorAdmin.min.js?v=' + versionGuid);
    //        //widgets.push('widgets/bwMonitoringTools.min.js?v=' + versionGuid);
    //        //widgets.push('widgets/bwParticipantsEditor.min.js?v=' + versionGuid);
    //        ////widgets.push('widgets/bwDataGrid.min.js?v=' + versionGuid);
    //        ////widgets.push('widgets/bwPrintButton.min.js?v=' + versionGuid);
    //        //widgets.push('widgets/bwProjectTypeEditor.min.js?v=' + versionGuid);
    //        //widgets.push('widgets/bwRequestTypeEditor.min.js?v=' + versionGuid);
    //        //widgets.push('widgets/bwPillarTypeEditor.min.js?v=' + versionGuid);
    //        //for (var i = 0; i < widgets.length; i++) {
    //        //    var script = document.createElement('script');
    //        //    script.type = 'text/javascript';
    //        //    script.src = widgets[i];
    //        //    document.head.appendChild(script);
    //        //}





    //        //$('#divBwCoreComponent').bwCoreComponent('loadWorkflowAppConfigurationDetails9'); // commented out 5-7-2-23


    //        //debugger; // xcx88576
    //        //setTimeout(function () { // Only needs to happen for Chrome.
    //        //    renderWelcomeScreen();



    //        //    //
    //        //    // BEFORE CALLING renderWelcomeScreen MAKE SURE WE HAVE MS DATA
    //        //    // 
    //        //    debugger;


    //        //}, 5000);


    //        //$('#bwStartPageAccordion').show();

    //        //$('#liWelcome').show();
    //        //$('#liNewRequest').hide();
    //        //$('#liArchive').hide();
    //        //$('#liSummaryReport').hide();
    //        //$('#liConfiguration').hide();
    //        //$('#liHelp').hide();

    //        //try {
    //        //    document.getElementById('spanNotLoggedInBetaBanner').style.display = 'none';
    //        //    document.getElementById('spanLoggedInBetaBanner').style.display = 'block';
    //        //} catch (e) { }

    //        //var financialOrParticipantSummaryOptions = {
    //        //    checked: false, // DEFAULT TO THE FINANCIAL SUMMARY. This fixes an issue when the participant summary is rendered first. The participant summary relies on the financial summary being rendered first.
    //        //    show_labels: true,         // Should we show the on and off labels?
    //        //    labels_placement: "both",  // Position of the labels: "both", "left" or "right"
    //        //    on_label: "Participant<br />Summary",            // Text to be displayed when checked
    //        //    off_label: "Financial<br />Summary",          // Text to be displayed when unchecked
    //        //    width: 50,                 // Width of the button in pixels
    //        //    height: 22,                // Height of the button in pixels
    //        //    button_width: 24,         // Width of the sliding part in pixels
    //        //    clear_after: null         // Override the element after which the clearing div should be inserted 
    //        //};
    //        //$("input#financialOrParticipantSummary").switchButton(financialOrParticipantSummaryOptions);

    //        ////setCustomSizesDependingOnTheDevice();

    //        //$('#financialOrParticipantSummary').change(function () {


    //        //    //displayAlertDialog('financialOrParticipantSummary.change()');


    //        //    if (!$('#financialOrParticipantSummary').is(':checked')) {
    //        //        if (!$('#budgetRequestsOrQuotes').is(':checked')) {
    //        //            renderFinancialSummary9(false);
    //        //        } else if ($('#budgetRequestsOrQuotes').is(':checked')) {
    //        //            renderFinancialSummary9(true);
    //        //        } else {
    //        //            displayAlertDialog('budgetRequestsOrQuotes is in an invalid state.');
    //        //        }
    //        //    } else if ($('#financialOrParticipantSummary').is(':checked')) {
    //        //        if (!$('#budgetRequestsOrQuotes').is(':checked')) {
    //        //            renderParticipantSummary(false);
    //        //        } else if ($('#budgetRequestsOrQuotes').is(':checked')) {
    //        //            renderParticipantSummary(true);
    //        //        } else {
    //        //            displayAlertDialog('budgetRequestsOrQuotes is in an invalid state.');
    //        //        }
    //        //    } else {
    //        //        displayAlertDialog('financialOrParticipantSummary is in an invalid state.');
    //        //    }
    //        //});

    //        //setCustomSizesDependingOnTheDevice();

    //        //populateTheYearDropdown('false');



    //        //addInLicenseCheck(); // Todd: If you uncomment this line of code, the license check will proceed.


    //        // Initialize the date pickers.
    //        //displayAlertDialog('initializeTheForm');
    //        //$('#dtEstimatedStartDate').datepicker(); // todd commented out 11-15-19
    //        //$('#dtEstimatedEndDate').datepicker(); // todd commented out 11-15-19
    //        // Create a GUID for the attachments folder name.
    //        //attachmentsFolderName = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) { // todd commented out 11-15-19
    //        //    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
    //        //    return v.toString(16);
    //        //});
    //        //initializePeoplePicker('peoplePicker');
    //        //populateYear(); 
    //        //tenantId = '1';
    //        //var year = 2016;
    //        //var year = new Date().getFullYear().toString(); // todd hardcoded. // todd commented out 11-15-19
    //        //$("<option value=\"" + year.toString() + "\" selected>" + year.toString() + "</option>").appendTo($('#ddlYear'));


    //        //GetWorkflowAppConfigurationData9 = $.Deferred();
    //        //GetWorkflowAppConfigurationData9
    //        //    .done(function () {
    //        //        //displayAlertDialog('DONE');
    //        //        selectArchivePageFilterDropDown_change();
    //        //        renderLeftButtons('divArchivePageLeftButtons');
    //        //    })
    //        //    .fail(function () {
    //        //        handleExceptionWithAlert('Error in my.js.populateStartPageItem(divFunctionalAreas)', 'GetWorkflowAppConfigurationData9.fail()');
    //        //    });
    //        //loadWorkflowAppConfigurationDetails9();








    //        //debugger; // xcx664537

    //        //var checkThatTheFormHasRenderedAndTheGlobalVariablesArePopulated = function () { // This ugliness will go away as we build in promises a bit better.
    //        //    setTimeout(function () {
    //        //        debugger; // FIX THIS TIMEOUT CRAP!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 8-8-2020
    //        //        if (tenantId) {
    //        //            console.log('Calling resolve() in checkThatTheFormHasRenderedAndTheGlobalVariablesArePopulated().');


    //        //            //debugger; // we should have participantId by the time we get here!!!
    //        //            var options = {
    //        //                bwTenantId: tenantId,
    //        //                bwWorkflowAppId: workflowAppId,
    //        //                bwWorkflowAppTitle: workflowAppTitle,
    //        //                bwParticipantId: participantId,
    //        //                bwParticipantEmail: participantEmail,
    //        //                bwParticipantFriendlyName: participantFriendlyName,
    //        //                bwEnabledRequestTypes: bwEnabledRequestTypes
    //        //            };
    //        //            var $bwCoreComponent = $('#divBwCoreComponent').bwCoreComponent(options);

    //        //            $('#divBwCoreComponent').bwCoreComponent('loadWorkflowAppConfigurationDetails9');

    //        //            var options = {
    //        //                bwTenantId: tenantId,
    //        //                bwWorkflowAppId: workflowAppId,
    //        //                bwParticipantId: participantId,
    //        //                bwParticipantEmail: participantEmail,
    //        //                bwParticipantFriendlyName: participantFriendlyName,
    //        //                bwEnabledRequestTypes: bwEnabledRequestTypes
    //        //            };
    //        //            var $bwRequest = $("#divBwRequest").bwRequest(options);


    //        //            var printButtonOptions = {
    //        //                reportType: 'MyPendingTasksReport'
    //        //            };
    //        //            var $printbutton = $('#divBwPrintButton').bwPrintButton(printButtonOptions);



    //        //            // Log the page hit! When a user gets here, we are considering it a new logon.
    //        //            try {
    //        //                //debugger;
    //        //                var data = [];
    //        //                data = {
    //        //                    bwTenantId: tenantId,
    //        //                    bwWorkflowAppId: workflowAppId,
    //        //                    bwWebsiteTrafficLogUserLogonType: participantLogonType,
    //        //                    bwWebsiteTrafficLogUserLogonTypeId: participantLogonTypeUserId,
    //        //                    bwParticipantId: participantId,
    //        //                    bwParticipantFriendlyName: participantFriendlyName,
    //        //                    bwParticipantEmail: participantEmail
    //        //                };
    //        //                var operationUri = webserviceurl + "/logonactivityvisitorcounter";
    //        //                $.ajax({
    //        //                    url: operationUri,
    //        //                    type: "POST", timeout: ajaxTimeout,
    //        //                    data: data,
    //        //                    headers: {
    //        //                        "Accept": "application/json; odata=verbose"
    //        //                    },
    //        //                    success: function (data) {
    //        //                        //displayAlertDialog(data);
    //        //                    },
    //        //                    error: function (data, errorCode, errorMessage) {
    //        //                        //displayAlertDialog('Error in my.js.cmdUnsubscribe():1:' + errorMessage + ' ' + JSON.stringify(data));
    //        //                        //WriteToErrorLog('Error in InitBudgetRequest.js.cmdCreateBudgetRequest()', 'Error creating the budget request in budgetrequests library: ' + errorCode + ', ' + errorMessage);
    //        //                    }
    //        //                });
    //        //            } catch (e) {
    //        //                // Do nothing, just ignore it!
    //        //            }










    //        //            //debugger;
    //        //            //var options = {
    //        //            //    bwTenantId: tenantId,
    //        //            //    bwWorkflowAppId: workflowAppId,
    //        //            //    bwWorkflowAppTitle: workflowAppTitle,
    //        //            //    bwParticipantId: participantId,
    //        //            //    bwParticipantEmail: participantEmail,
    //        //            //    bwParticipantFriendlyName: participantFriendlyName,
    //        //            //    bwEnabledRequestTypes: bwEnabledRequestTypes
    //        //            //};
    //        //            //var $bwCoreComponent = $('#divBwCoreComponent').bwCoreComponent(options);





    //        //            //debugger;
    //        //            //var options = {
    //        //            //    bwTenantId: tenantId,
    //        //            //    bwWorkflowAppId: workflowAppId,
    //        //            //    bwParticipantId: participantId,
    //        //            //    bwParticipantEmail: participantEmail,
    //        //            //    bwParticipantFriendlyName: participantFriendlyName,
    //        //            //    bwEnabledRequestTypes: bwEnabledRequestTypes
    //        //            //};
    //        //            //var $bwRequest = $("#divBwRequest").bwRequest(options);




    //        //            //resolve();
    //        //        } else {
    //        //            debugger;
    //        //            checkThatTheFormHasRenderedAndTheGlobalVariablesArePopulated();
    //        //        }
    //        //        // Do Something Here
    //        //        // Then recall the parent function to
    //        //        // create a recursive loop.

    //        //    }, 1000);
    //        //}
    //        //checkThatTheFormHasRenderedAndTheGlobalVariablesArePopulated();

    //    } catch (e) {
    //        displayAlertDialog('Exception in loadRemainingJsAndCssAndBWMData()', e.message + ', ' + e.stack);
    //    }
    //},



    logInAsTenantOrganizationOwner: function (elementId) {
        try {
            console.log('In logInAsTenantOrganizationOwner(). elementId: ' + elementId);
            var thiz = this;
            var selectedValue = $('#' + elementId + ' option:selected').val();
            var bwTenantId = selectedValue.split('|')[0];
            var rootOrganization = selectedValue.split('|')[1];

            console.log('In logInAsTenantOrganizationOwner(). elementId: ' + elementId + ', selectedValue: ' + selectedValue + ', bwTenantId: ' + bwTenantId + ', rootOrganization: ' + rootOrganization);

            //var proceed = confirm('Click Ok to log into "' + rootOrganization + '" as a tenant owner.');
            //if (proceed) {
            // Save the bwTenantId in the ForestAdministratorLoginToTenant table so that we don't expose any information and make this as secure as possible.

            alert('Calling ForestAdministratorLoginToTenant');

            var data = {
                bwTenantId: bwTenantId,
                bwWorkflowAppId: rootOrganization
            };
            var operationUri = this.options.operationUriPrefix + "_bw/ForestAdministratorLoginToTenant";
            $.ajax({
                url: operationUri,
                type: 'POST',
                data: data,
                headers: {
                    "Accept": "application/json; odata=verbose"
                },
                success: function (results) {

                    console.log('In logInAsTenantOrganizationOwner().success(). results: ' + JSON.stringify(results));

                    if (results.message != 'SUCCESS') {

                        console.log('In logInAsTenantOrganizationOwner().success(). ERROR: FAILED TO AUTHENTICATE: ' + JSON.stringify(results));
                        displayAlertDialog('ERROR: FAILED TO AUTHENTICATE: ' + results.message);

                    } else {

                        var operationUri = thiz.options.operationUriPrefix + '?ForestAdministratorLoginToTenant_ActiveStateIdentifier=' + results.bwActiveStateIdentifier;
                        console.log('Calling window.open(). operationUri: ' + operationUri);
                        var newWin = window.open(operationUri);

                        if (!newWin || newWin.closed || typeof newWin.closed == 'undefined') {
                            //POPUP BLOCKED
                            location.href = operationUri;
                        }

                    }
                },
                error: function (data, errorCode, errorMessage) {
                    console.log('In logInAsTenantOrganizationOwner().error(). Error in logInAsTenantOrganizationOwner(): ' + errorMessage);
                    displayAlertDialog('Error in logInAsTenantOrganizationOwner(): ' + errorMessage);
                }
            });

        } catch (e) {
            console.log('Exception in logInAsTenantOrganizationOwner(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in logInAsTenantOrganizationOwner(): ' + e.message + ', ' + e.stack);
        }
    },











    changeRememberMeCheckboxSetting_OnClick: function () {
        try {
            console.log('In changeRememberMeCheckboxSetting_OnClick().');
            var rememberme;
            rememberme = localStorage['customlogonrememberme']; //this.getCookie('customlogonrememberme');
            if (rememberme == 'selected') {
                rememberme = 'notselected';
            } else {
                rememberme = 'selected';
            }
            localStorage['customlogonrememberme'] = rememberme;
            //this.setCookie('customlogonrememberme', rememberme, 30);
            if (rememberme == 'selected') {
                document.getElementById('cbCustomLogonRememberMe').checked = true;
            } else {
                document.getElementById('cbCustomLogonRememberMe').checked = false;
            }
        } catch (e) {
            console.log('Exception in changeRememberMeCheckboxSetting_OnClick(): ' + e.message + ', ' + e.stack);
        }
    },

    renderDialogDivs: function () {
        console.log('In bwAuthentication.js.renderDialogDivs().');
        var thiz = this;
        return new Promise(function (resolve, reject) {
            try {
                console.log('In renderDialogDivs().');

                var html = '';

                html += '<div id="divBwCoreComponent"></div>';
                html += '<div id="divBwNotificationSound"></div>';
                html += '<div id="divBwPersonalErrorAdministration"></div>'; // Added 7-27-2023. <<<<<<<<<<<<<<<<<<<<<<<<<<<
                html += '<div id="divBwCircleDialog"></div>';
                html += '<div id="divBwRequest"></div>';
                //html += '<div id="divBwHowDoesItWorkCarousel">[bwAuthentication.js.divBwHowDoesItWorkCarousel]</div>';
                //html += '<div id="divBwDonate"></div>';

                html += '';
                html += '        <div style="display:none;" id="divCustomLogonResetPasswordDialog">';
                html += '            <table style="width:100%;">';
                html += '                <tr>';
                html += '                    <td style="width:90%;">';
                html += '                        <span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 30pt;font-weight:bold;">Reset Password</span>';
                html += '                    </td>';
                html += '                    <td style="width:9%;"></td>';
                html += '                    <td style="width:1%;cursor:pointer;vertical-align:top;">';
                html += '                        <span class="dialogXButton" style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;font-size: 30pt;font-weight:bold;" onclick="$(\'#divCustomLogonResetPasswordDialog\').dialog(\'close\');">X</span>';
                html += '                    </td>';
                html += '                </tr>';
                html += '            </table>';
                html += '            <br /><br />';
                html += '            <input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->';
                html += '            <span style="font-family: calibri;font-style:italic;">You will receive an email with instructions. For your security, use the same device to complete this password reset. It will expire in 5 minutes!</span><br /><br />';
                html += '            <span style="font-family: calibri;">Email Address</span><br />';
                html += '            <input type="text" id="txtCustomLogonResetPasswordEmail" style="WIDTH: 95%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;" /><br />';
                html += '            <br />';
                html += '            <!--<input type="checkbox" />Remember me on this device.&nbsp;<a href="">?</a><br />-->';
                html += '            <div id="xxxx" class="divSignInButton" style="width:90%;text-align:center;line-height:1.1em;font-weight:bold;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'cmdSendResetPasswordEmail\');">';
                html += '                Email Me';
                html += '            </div>';
                html += '            <br />';
                html += '            <span style="font-family: calibri;font-style:italic;">Don\'t need to do this? <a href="javascript:$(\'.bwAuthentication\').bwAuthentication(\'displaySignInDialog\', true);">Go back and Sign In.</a></span><br /><br />';
                html += '            <!--<span style="font-family: calibri;font-style:italic;"><a href="https://budgetworkflow.com">Go back to the home page.</a></span><br /><br />-->';
                html += '        </div>';
                html += '';

                html += '        <div style="display:none;" id="divCustomLogonResetPasswordConfirmationDialog">';
                html += '            <table style="width:100%;">';
                html += '                <tr>';
                html += '                    <td style="width:90%;">';
                html += '                        <span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 30pt;font-weight:bold;">Reset Password</span>';
                html += '                    </td>';
                html += '                    <td style="width:9%;"></td>';
                html += '                    <td style="width:1%;cursor:pointer;vertical-align:top;">';
                html += '                        <span class="dialogXButton" style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;font-size: 30pt;font-weight:bold;" onclick="$(\'#divCustomLogonResetPasswordConfirmationDialog\').dialog(\'close\');">X</span>';
                html += '                    </td>';
                html += '                </tr>';
                html += '            </table>';
                html += '            <br /><br />';
                html += '            <input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->';
                html += '            <span style="font-family: calibri;font-style:italic;">We have confirmed you are using the same device to complete this password reset.</span>';
                html += '            <br /><br />';
                html += '            <span style="font-family: calibri;">Choose a new password (4-15 characters)</span><br />';
                html += '            <input type="password" id="txtCustomResetPassword" style="WIDTH: 95%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;" /><br />';
                html += '            <br />';
                html += '            <br />';
                html += '            <!--<input type="checkbox" />Remember me on this device.&nbsp;<a href="">?</a><br />-->';
                html += '            <div id="xxxx" class="divSignInButton" style="width:90%;text-align:center;line-height:1.1em;font-weight:bold;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'cmdResetPasswordNow\');">';
                html += '                Reset password now!';
                html += '            </div>';
                html += '            <br />';
                html += '            <span style="font-family: calibri;font-style:italic;">Don\'t need to do this? <a href="javascript:$(\'.bwAuthentication\').bwAuthentication(\'displayCustomLogonDialog\');">Click here to Sign In.</a></span><br /><br />';
                html += '        </div>';

                thiz.element.html(html);

                $('#divBwCircleDialog').bwCircleDialog({});
                $('#divBwCoreComponent').bwCoreComponent();
                $('#divBwNotificationSound').bwNotificationSound({});
                $('#divBwPersonalErrorAdministration').bwPersonalErrorAdministration({});

                //var $bwHowDoesItWorkCarousel = $('#divBwHowDoesItWorkCarousel').bwHowDoesItWorkCarousel();
                $('#divBwPrintButton').bwPrintButton({ reportType: 'MyPendingTasksReport' });

                console.log('');
                console.log('In bwAuthentication.js.renderDialogDivs(). Widgets bwCircleDialog, bwCoreComponent, and bwPrintButton have been instantiated.');
                console.log('');

                resolve();

            } catch (e) {
                var msg = 'Exception in bwAuthentication.js.renderDialogDivs(): ' + e.message + ', ' + e.stack;
                console.log(msg);
                displayAlertDialog(msg);

                reject(msg)
            }
        });
    },

    renderDialogDivsForBackendAdministration: function () {
        try {
            //debugger;
            console.log('In renderDialogDivsForBackendAdministration(). xcx2');
            //alert('In renderDialogDivsForBackendAdministration(). xcx2');

            var html = '';

            html += '<div id="divBwCoreComponent"></div>';
            //html += '<div id="divBwNotificationSound"></div>';
            html += '<div id="divBwCircleDialog"></div>';
            html += '<div id="divBwRequest"></div>'; // renderDialogDivsForBackendAdministration


            //html += '';
            //html += '        <div style="display:none;" id="divCustomLogonResetPasswordDialog">';
            //html += '            <table style="width:100%;">';
            //html += '                <tr>';
            //html += '                    <td style="width:90%;">';
            //html += '                        <span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 30pt;font-weight:bold;">Reset Password</span>';
            //html += '                    </td>';
            //html += '                    <td style="width:9%;"></td>';
            //html += '                    <td style="width:1%;cursor:pointer;vertical-align:top;">';
            //html += '                        <span class="dialogXButton" style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;font-size: 30pt;font-weight:bold;" onclick="$(\'#divCustomLogonResetPasswordDialog\').dialog(\'close\');">X</span>';
            //html += '                    </td>';
            //html += '                </tr>';
            //html += '            </table>';
            //html += '            <br /><br />';
            //html += '            <input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->';
            //html += '            <span style="font-family: calibri;font-style:italic;">You will receive an email with instructions. For your security, use the same device to complete this password reset. It will expire in 5 minutes!</span><br /><br />';
            //html += '            <span style="font-family: calibri;">Email Address</span><br />';
            //html += '            <input type="text" id="txtCustomLogonResetPasswordEmail" style="WIDTH: 95%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;" /><br />';
            //html += '            <br />';
            //html += '            <!--<input type="checkbox" />Remember me on this device.&nbsp;<a href="">?</a><br />-->';
            //html += '            <div id="xxxx" class="divSignInButton" style="width:90%;text-align:center;line-height:1.1em;font-weight:bold;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'cmdSendResetPasswordEmail\');">';
            //html += '                Email Me';
            //html += '            </div>';
            //html += '            <br />';
            //html += '            <span style="font-family: calibri;font-style:italic;">Don\'t need to do this? <a href="javascript:$(\'.bwCircleDialog\').bwCircleDialog(\'displaySignInDialog\', true);">Go back and Sign In.</a></span><br /><br />';
            //html += '            <!--<span style="font-family: calibri;font-style:italic;"><a href="https://budgetworkflow.com">Go back to the home page.</a></span><br /><br />-->';
            //html += '        </div>';
            //html += '';
            //html += '        <div style="display:none;" id="divCustomLogonResetPasswordConfirmationDialog">';
            //html += '            <table style="width:100%;">';
            //html += '                <tr>';
            //html += '                    <td style="width:90%;">';
            //html += '                        <span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 30pt;font-weight:bold;">Reset Password</span>';
            //html += '                    </td>';
            //html += '                    <td style="width:9%;"></td>';
            //html += '                    <td style="width:1%;cursor:pointer;vertical-align:top;">';
            //html += '                        <span class="dialogXButton" style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;font-size: 30pt;font-weight:bold;" onclick="$(\'#divCustomLogonResetPasswordConfirmationDialog\').dialog(\'close\');">X</span>';
            //html += '                    </td>';
            //html += '                </tr>';
            //html += '            </table>';
            //html += '            <br /><br />';
            //html += '            <input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->';
            //html += '            <span style="font-family: calibri;font-style:italic;">We have confirmed you are using the same device to complete this password reset.</span>';
            //html += '            <br /><br />';
            //html += '            <span style="font-family: calibri;">Choose a new password (4-15 characters)</span><br />';
            //html += '            <input type="password" id="txtCustomResetPassword" style="WIDTH: 95%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;" /><br />';
            //html += '            <br />';
            //html += '            <br />';
            //html += '            <!--<input type="checkbox" />Remember me on this device.&nbsp;<a href="">?</a><br />-->';
            //html += '            <div id="xxxx" class="divSignInButton" style="width:90%;text-align:center;line-height:1.1em;font-weight:bold;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'cmdResetPasswordNow\');">';
            //html += '                Reset password now!';
            //html += '            </div>';
            //html += '            <br />';
            //html += '            <span style="font-family: calibri;font-style:italic;">Don\'t need to do this? <a href="javascript:$(\'.bwAuthentication\').bwAuthentication(\'displayCustomLogonDialog\');">Click here to Sign In.</a></span><br /><br />';
            //html += '        </div>';

            // Render the html.
            this.element.html(html);
            debugger;
            var $circledialog = $("#divBwCircleDialog").bwCircleDialog({});

            var $bwCoreComponent = $('#divBwCoreComponent').bwCoreComponent({});

        } catch (e) {
            console.log('Exception in renderDialogDivsForBackendAdministration(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in renderDialogDivsForBackendAdministration(): ' + e.message + ', ' + e.stack);
        }
    },

    cmdSendResetPasswordEmail: function () {

        var userEmailAddress = document.getElementById('txtCustomLogonResetPasswordEmail').value;

        var data = [];
        data = {
            userEmailAddress: userEmailAddress
        };
        var operationUri = webserviceurl + "/bwworkflow/sendresetpasswordemail";
        $.ajax({
            url: operationUri,
            type: "POST",
            data: data,
            headers: {
                "Accept": "application/json; odata=verbose"
            },
            success: function (data) {
                debugger;
                if (data.message == 'INVALID EMAIL ADDRESS') {
                    displayAlertDialog('This email address is not valid.');
                } else if (data.message == 'PASSWORDRESETIDENTIFIER CURRENTLY ACTIVE THERECANONLYBEONE') {
                    displayAlertDialog('A pasword reset request was made less than 5 minutes ago. Please use the last one, or wait before creating another one.');
                } else if (data.message == 'SUCCESS') {
                    displayAlertDialog('The email has been sent. You should receive it shortly.');
                    $("#divCustomLogonResetPasswordDialog").dialog('close'); // Close the dialog.
                } else {
                    displayAlertDialog(data.message);
                }
            },
            error: function (data, errorCode, errorMessage) {
                //handleExceptionWithAlert('Error in Start.js.displayConnectedWorkflows()', '1:' + errorCode + ', ' + errorMessage);
                displayAlertDialog('Error in index.html.cmdSendResetPasswordEmail(): ' + errorMessage);
            }
        });

    },

    cmdResetPasswordNow: function () {
        // This is where the user sets their new password.
        try {
            console.log('In bwAuthentication.js.cmdResetPasswordNow().');
            var thiz = this;

            var resetPassword = document.getElementById('txtCustomResetPassword').value;
            if (resetPassword.trim().length < 4 || resetPassword.trim().length > 15) {
                displayAlertDialog('Please enter an Password that is 4-15 characters in length.');
            } else {
                // Reset the password.
                var passwordResetIdentifier;

                passwordResetIdentifier = this.getUrlParams('passwordreset'); //['passwordreset'].toString(); //.split('#')[0];
                var data = [];
                data = {
                    passwordResetIdentifier: passwordResetIdentifier,
                    resetPassword: resetPassword
                };
                var operationUri = this.options.operationUriPrefix + "_bw/bwworkflow/resetpasswordnow";
                $.ajax({
                    url: operationUri,
                    type: "POST",
                    data: data,
                    headers: {
                        "Accept": "application/json; odata=verbose"
                    },
                    success: function (data) {
                        //displayAlertDialog(JSON.stringify(data));
                        if (data.message == 'SUCCESS') {
                            displayAlertDialog('Your password has been updated. Continuing to log you in!');

                            var bwParticipantEmail = data.bwParticipantEmail;
                            // Ok, lets see if the password is correct.
                            var data = [];
                            data = {
                                userEmailAddress: bwParticipantEmail,
                                userPassword: resetPassword
                            };
                            var operationUri = webserviceurl + "/bwworkflow/usercustomlogon";
                            $.ajax({
                                url: operationUri,
                                type: "POST",
                                data: data,
                                headers: {
                                    "Accept": "application/json; odata=verbose"
                                },
                                success: function (data) {
                                    try {
                                        //displayAlertDialog(data);

                                        //debugger; // 12-18-2021

                                        if (data.message != 'The password is correct') {
                                            displayAlertDialog(data.message);
                                        } else {

                                            // Cookie!
                                            //setCookie('customlogonusername', bwParticipantEmail, 30);
                                            //setCookie('customlogonpassword', resetPassword, 30);

                                            var bwActiveStateIdentifier = data.bwActiveStateIdentifier;

                                            //debugger;
                                            var location;
                                            location = globalUrlPrefix + globalUrl + '?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                                            //console.log('In bwAuthentication.js.xx(). setting window.location!! xcx343245342-6');
                                            window.location = location;
                                            //if (window.location.href.indexOf('index.html') > -1) {
                                            //    location = globalUrlPrefix + globalUrl + '/index.html?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                                            //    window.location = location;
                                            //} else if (window.location.href.indexOf('ios8.html') > -1) {
                                            //    location = globalUrlPrefix + globalUrl + '/ios8.html?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                                            //    window.location = location;
                                            //} else {
                                            //    displayAlertDialog('Error xcx1: Unexpected window.location. This process cannot proceed.');
                                            //}
                                            //console.log('xcx1Setting window.location: ' + location);
                                            //debugger;


                                        }
                                    } catch (e) {
                                        console.log('Exception in bwAuthentication.js.cmdResetPasswordNow():4: ' + e.message + ', ' + e.stack);
                                        displayAlertDialog('Exception in bwAuthentication.js.cmdResetPasswordNow():4: ' + e.message + ', ' + e.stack);
                                    }
                                },
                                error: function (data, errorCode, errorMessage) {
                                    //displayAlertDialog('Error in Start.js.displayConnectedWorkflows()', '1:' + errorCode + ', ' + errorMessage);
                                    displayAlertDialog('Error in bwAuthentication.js.cmdResetPasswordNow().usercustomlogon: ' + errorMessage + ' ' + JSON.stringify(data));
                                }
                            });

                        } else if (data.message == 'COULD NOT FIND PASSWORDRESETIDENTIFIER') {
                            displayAlertDialog('Could not locate the password reset identifier. It may have expired. You will have to try again to reset your password from the beginning.');
                        } else {
                            displayAlertDialog(data.message);
                        }
                    },
                    error: function (data, errorCode, errorMessage) {
                        console.log('Error in bwAuthentication.js.cmdResetPasswordNow():1: errorCode: ' + errorCode + ', errorMessage: ' + errorMessage + ', data: ' + JSON.stringify(data));
                        displayAlertDialog('Error in bwAuthentication.js.cmdResetPasswordNow():1: errorCode: ' + errorCode + ', errorMessage: ' + errorMessage + ', data: ' + JSON.stringify(data));
                    }
                });

            }
        } catch (e) {
            console.log('Exception in bwAuthentication.js.cmdResetPasswordNow():3: ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.cmdResetPasswordNow():3: ' + e.message + ', ' + e.stack);
        }
    },
    displaySignInDialogForBackendAdministration: function (resetCachedDisplayValues, customLogonDialogDescriptionText, hideSignUpAndResetPasswordButtons) {
        try {
            console.log('In bwAuthentication.js.displaySignInDialogForBackendAdministration().'); // This is how we login to the backend administration (admin2.html)
            var thiz = this;

            var dialogElementId = $('.bwCircleDialog').bwCircleDialog('option', 'dialogElementId'); // >>>> STEP1: The bwCircleDialog widget manages this, so it always knows how to find it in the DOM.

            if (dialogElementId.length == 0) {

                displayAlertDialog('Error in bwAuthentication.js.displaySignInDialogForBackendAdministration(). The bwCircleDialog.js widget has not been instantiated.');

            } else {

                if ($('#' + String(dialogElementId)).dialog('instance')) {
                    $('#' + dialogElementId).dialog('close'); // We make sure we start with a new one!
                }

                window.scrollTo(0, 0); // Scroll to top on button click. This makes sure things render Ok, and also just seems like a nicer user experience.
                $('.bwActiveMenu_Admin').bwActiveMenu_Admin('adjustLeftSideMenu'); // This makes sure our new stretchy-left-menu redraws Ok.

                if (resetCachedDisplayValues == true) {
                    this.options.OnResizeDisplayValues = null;
                }

                var html = '';

                if (this.options.OnResizeDisplayValues != null && this.options.OnResizeDisplayValues.Html) {
                    html = this.options.OnResizeDisplayValues.Html;
                } else {

                    html += '        <table style="width:100%;">';
                    html += '            <tr>';
                    html += '                <td style="width:90%;">';
                    html += '                    <span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 30pt;font-weight:bold;">Sign in</span>';
                    html += '                </td>';
                    html += '                <td style="width:9%;"></td>';
                    html += '                <td style="width:1%;cursor:pointer;vertical-align:top;">';
                    html += '                    <span class="dialogXButton" style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;font-size: 30pt;font-weight:bold;" onclick="$(\'.bwCircleDialog\').bwCircleDialog(\'hideCircleDialog\');">X</span>';
                    html += '                </td>';
                    html += '            </tr>';
                    html += '        </table>';
                    html += '        <br />';
                    html += '        <input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->';
                    html += '        <span id="spanCustomLogonDialogInvitationDescriptionText" style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 20pt;"></span>';

                    html += '        <span style="font-family: calibri;">Email</span>';
                    html += '        <br />';
                    html += '        <input type="text" id="txtCustomLogonEmail" style="WIDTH: 93%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;" />';
                    html += '        <br /><br />';
                    html += '        <span style="font-family: calibri;">Password</span>';
                    html += '        <br />';
                    html += '        <input type="password" id="txtCustomLogonPassword" onkeydown="return carriagereturnpress(event, \'logonWith_BudgetWorkflow\');" style="WIDTH: 93%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;" /><br />';
                    html += '        <br />';

                    //html += 'xcx984375xcx'; // 4-19-2020. Add login "Remember me" checkbox.
                    var zoom = 1.25;
                    html += '<table style="width:100%;">';
                    html += '<tr>';
                    html += '<td style="text-align:right;">';
                    html += '   <span style="cursor:help;color:gray;" title="Auto-logon with local storage. Your logon information gets saved in local storage so that you aren\'t subsequently prompted to logon." >';
                    html += '        <input onclick="$(\'.bwAuthentication\').bwAuthentication(\'changeRememberMeCheckboxSetting_OnClick\');" id="cbCustomLogonRememberMe" type="checkbox" style="cursor:pointer;zoom: ' + zoom + ';transform: scale(' + zoom + ');-ms-transform: scale(' + zoom + ');-webkit-transform: scale(' + zoom + ');-o-transform: scale(' + zoom + ');-moz-transform: scale(' + zoom + ');transform-origin: 0 0;-ms-transform-origin: 0 0;-webkit-transform-origin: 0 0;-o-transform-origin: 0 0;-moz-transform-origin: 0 0;" checked />';
                    html += '        &nbsp;Remember me';
                    html += '   </span>';
                    html += '        <br />';
                    html += '        <br />';
                    html += '</td>';
                    html += '</tr>';
                    html += '</table>';


                    //html += '';
                    html += '        <div id="xcx547" class="divSignInButton" style="width: 75%; text-align: center; line-height: 1.1em; font-weight: bold;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'logonWith_BudgetWorkflow\');">';
                    html += '            Sign In';
                    html += '        </div>';
                    html += '        <br />';

                    //debugger;
                    if (!hideSignUpAndResetPasswordButtons || hideSignUpAndResetPasswordButtons != true) {
                        html += '        <span style="font-family: calibri;font-style:italic;font-size:15pt;">New to BudgetWorkflow.com? Sign up now. It\'s free!</span>';
                        html += '        <br /><br />';

                        html += '        <div id="xxxx" class="divSignInButton" style="width: 75%; text-align: center; line-height: 1.1em; font-weight: bold;" onclick="$(\'.bwCircleDialog\').bwCircleDialog(\'displayCreateFreeAccountDialog\', true);">';
                        html += '            Sign up now';
                        html += '        </div>';
                        html += '        <br />';

                        html += '        <span style="font-family: calibri;font-style:italic;font-size:15pt;">Forgot your password?</span>';
                        html += '        <br /><br />';

                        html += '        <div id="xxxx" class="divSignInButton" style="width: 75%; text-align: center; line-height: 1.1em; font-weight: bold;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'cmdDisplayForgottenPasswordDialog\');">';
                        html += '            Reset password';
                        html += '        </div>';
                        html += '        <br /><br />';
                    }

                }

                //
                // >>>> THIS IS HOW WE should be displaying all of our circle dialogs.
                //

                $('#' + dialogElementId).html(html); // >>>> STEP2: Assign the element all of the html.
                $('#' + dialogElementId).dialog({ // >>>> STEP3: Display the dialog.
                    modal: false,
                    resizable: false,
                    closeOnEscape: false, // Hit the ESC key to hide! Yeah!
                    width: '460',
                    dialogClass: 'no-close', // No close button in the upper right corner.
                    hide: false, // This means when hiding just disappear with no effects.
                    position: {
                        my: 'center top', at: 'center top+150', of: window
                    },
                    close: function () {
                        $('#' + dialogElementId).dialog('destroy');
                    },
                    open: function () {
                        try {
                            $('.bwCircleDialog').bwCircleDialog('displayDialog'); // >>>> STEP 4: Display the circle dialog.

                            // Cookies for the custom login!

                            var username = localStorage['customlogonusername']; //$('.bwAuthentication').bwAuthentication('getCookie', 'customlogonusername');
                            var password = localStorage['customlogonpassword']; //$('.bwAuthentication').bwAuthentication('getCookie', 'customlogonpassword');
                            var rememberme = localStorage['customlogonrememberme']; //$('.bwAuthentication').bwAuthentication('getCookie', 'customlogonrememberme');

                            $('#txtCustomLogonEmail').val(username);
                            $('#txtCustomLogonPassword').val(password);
                            if (rememberme == 'selected') {
                                // This auto-logs in the user.
                                thiz.logonWith_BudgetWorkflow_SwitchToDesktopVersion();
                            } else {
                                document.getElementById('cbCustomLogonRememberMe').checked = false;
                            }

                        } catch (e) {
                            console.log('Exception in bwAuthentication.displaySignInDialogForBackendAdministration():2: ' + e.message + ', ' + e.stack);
                            displayAlertDialog('Exception in bwAuthentication.displaySignInDialogForBackendAdministration():2: ' + e.message + ', ' + e.stack);
                        }
                    }
                });
                //$('#' + dialogElementId).dialog().parents('.ui-dialog').find('.ui-dialog-titlebar').remove();

            }

        } catch (e) {
            console.log('Exception in bwAuthentication.js.displaySignInDialogForBackendAdministration(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.displaySignInDialogForBackendAdministration(): ' + e.message + ', ' + e.stack);
        }
    },
    displayParticipantRoleMultiPickerInACircle: function (resetCachedDisplayValues, originElementId, bwParticipantId, bwParticipantFriendlyName, bwParticipantEmail, bwParticipantLogonType) {
        try {
            console.log('In bwAuthentication.js.displayParticipantRoleMultiPickerInACircle(). bwParticipantId: ' + bwParticipantId + ', bwParticipantFriendlyName: ' + bwParticipantFriendlyName + ', bwParticipantEmail: ' + bwParticipantEmail + ', bwParticipantLogonType: ' + bwParticipantLogonType);
            var thiz = this;

            var tenantId = $('.bwAuthentication').bwAuthentication('option', 'tenantId');
            var workflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');


            //alert('xcx3422 bwParticipantLogonType: ' + bwParticipantLogonType);
            if (bwParticipantLogonType == 'nologon_emailrecipient') {

                // We do not want to display email recipients this way. Exiting! :)

            } else {

                var dialogElementId = $('.bwCircleDialog').bwCircleDialog('option', 'dialogElementId'); // >>>> STEP1: The bwCircleDialog widget manages this, so it always knows how to find it in the DOM.
                if ($('#' + dialogElementId).dialog('instance')) {
                    $('#' + dialogElementId).dialog('close'); // We make sure we start with a new one!
                }

                window.scrollTo(0, 0); // Scroll to top on button click. This makes sure things render Ok, and also just seems like a nicer user experience.
                $('.bwActiveMenu').bwActiveMenu('adjustLeftSideMenu'); // This makes sure our new stretchy-left-menu redraws Ok.

                var identityJson = {
                    bwParticipantId: bwParticipantId,
                    bwParticipantFriendlyName: bwParticipantFriendlyName,
                    bwParticipantEmail: bwParticipantEmail
                };

                if (resetCachedDisplayValues == true) {
                    this.options.OnResizeDisplayValues = null;
                }

                var html = '';

                //if (this.options.OnResizeDisplayValues != null && this.options.OnResizeDisplayValues.Html) {
                //    html = this.options.OnResizeDisplayValues.Html;

                //    //
                //    // >>>> THIS IS HOW WE should be displaying all of our circle dialogs.
                //    //
                //    $('#' + dialogElementId).html(html); // >>>> STEP2: Assign the element all of the html.
                //    $('#' + dialogElementId).dialog({ // >>>> STEP3: Display the dialog.
                //        modal: false,
                //        resizable: false,
                //        closeOnEscape: false, // Hit the ESC key to hide! Yeah!
                //        width: '550',
                //        dialogClass: 'no-close', // No close button in the upper right corner.
                //        hide: false, // This means when hiding just disappear with no effects.
                //        position: {
                //            my: 'center top', at: 'center top+150', of: window
                //        },
                //        close: function () {
                //            $('#' + dialogElementId).dialog('destroy');
                //        },
                //        open: function () {
                //            try {

                //                $('.bwCircleDialog').bwCircleDialog('displayDialog', identityJson); // >>>> STEP 4: Display the circle dialog.

                //            } catch (e) {
                //                console.log('Exception in bwAuthentication.displaySignInDialog():2-1: ' + e.message + ', ' + e.stack);
                //                displayAlertDialog('Exception in bwAuthentication.displaySignInDialog():2-1: ' + e.message + ', ' + e.stack);
                //            }
                //        }
                //    });

                //} else {
                $.ajax({
                    url: this.options.operationUriPrefix + "odata/Roles/" + workflowAppId + "/" + bwParticipantId,
                    dataType: "json",
                    contentType: "application/json",
                    type: "Get"
                }).done(function (result) {
                    try {
                        var json3 = {
                            bwWorkflowAppId: workflowAppId
                        };
                        $.ajax({
                            url: thiz.options.operationUriPrefix + '_bw/bwroles',
                            type: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify(json3),
                            success: function (result3) {
                                try {

                                    debugger;
                                    var roles;
                                    var roles = result.userRoles;
                                    var json = result.orgRoles;
                                    var html = '';
                                    html += '<table xcx="xcx432799">';
                                    for (var i = 0; i < result3.data.length; i++) {
                                        html += '<tr class="orgRow">';
                                        var isSelected = false;
                                        var userOrgsForRole = [];
                                        for (var r = 0; r < roles.length; r++) {
                                            if (roles[r].RoleId == result3.data[i].RoleId) {
                                                var d1, g1, e1, l1;
                                                var orgName = '';
                                                // rebase. This will go away someday!!!!
                                                if (!json.Global) {
                                                    var x = {
                                                        Global: JSON.parse(JSON.stringify(json))
                                                    }
                                                    json = JSON.parse(JSON.stringify(x));
                                                }
                                                if (roles[r].OrgId == json.Global.Id) {
                                                    orgName = json.Global.Name;
                                                    d1 = 'root';
                                                    g1 = undefined;
                                                    e1 = undefined;
                                                    l1 = undefined;
                                                } else {
                                                    for (var d = 0; d < json.Global.Divisions.Items.length; d++) {
                                                        if (roles[r].OrgId == json.Global.Divisions.Items[d].Id) {
                                                            orgName = json.Global.Divisions.Items[d].Name;
                                                            d1 = d;
                                                            g1 = undefined;
                                                            e1 = undefined;
                                                            l1 = undefined;
                                                            break;
                                                        }
                                                        for (var g = 0; g < json.Global.Divisions.Items[d].Groups.Items.length; g++) {
                                                            if (roles[r].OrgId == json.Global.Divisions.Items[d].Groups.Items[g].Id) {
                                                                orgName = json.Global.Divisions.Items[d].Groups.Items[g].Name;
                                                                d1 = d;
                                                                g1 = g;
                                                                e1 = undefined;
                                                                l1 = undefined;
                                                                break;
                                                            }
                                                            for (var e = 0; e < json.Global.Divisions.Items[d].Groups.Items[g].LegalEntities.Items.length; e++) {
                                                                if (roles[r].OrgId == json.Global.Divisions.Items[d].Groups.Items[g].LegalEntities.Items[e].Id) {
                                                                    orgName = json.Global.Divisions.Items[d].Groups.Items[g].LegalEntities.Items[e].Name;
                                                                    d1 = d;
                                                                    g1 = g;
                                                                    e1 = e;
                                                                    l1 = undefined;
                                                                    break;
                                                                }
                                                                for (var l = 0; l < json.Global.Divisions.Items[d].Groups.Items[g].LegalEntities.Items[e].Locations.Items.length; l++) {
                                                                    if (roles[r].OrgId == json.Global.Divisions.Items[d].Groups.Items[g].LegalEntities.Items[e].Locations.Items[l].Id) {
                                                                        orgName = json.Global.Divisions.Items[d].Groups.Items[g].LegalEntities.Items[e].Locations.Items[l].Name;
                                                                        d1 = d;
                                                                        g1 = g;
                                                                        e1 = e;
                                                                        l1 = l;
                                                                        break;
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                                var clickableOrgName = '<span style="cursor:pointer;color:purple;" onclick="$(\'.bwOrganizationEditor\').bwOrganizationEditor(\'displayOrgRoleEditorInACircle\', true, \'' + d1 + '\', \'' + g1 + '\', \'' + e1 + '\', \'' + l1 + '\');">' + orgName + '</span>';
                                                userOrgsForRole.push(clickableOrgName);
                                                isSelected = true;
                                            }
                                        }
                                        if (isSelected) {
                                            if (result3.data[i].RoleId == 'ADMIN') {
                                                html += '   <td><input id="' + 'roleCheckbox_' + i + '" type="checkbox" checked disabled /></td>'; // Don't want to be able to change the ADMIN checkbox here.
                                            } else {
                                                html += '   <td><input id="' + 'roleCheckbox_' + i + '" type="checkbox" checked onchange="$(\'.bwParticipantsEditor\').bwParticipantsEditor(\'participantOrgRoleCheckbox_OnChange\', this, \'' + bwParticipantId + '\', \'' + bwParticipantFriendlyName + '\', \'' + bwParticipantEmail + '\', \'' + result3.data[i].RoleId + '\', \'' + result3.data[i].RoleName + '\');" /></td>';
                                            }
                                        } else {
                                            if (result3.data[i].RoleId == 'ADMIN') {
                                                html += '   <td><input id="' + 'roleCheckbox_' + i + '" type="checkbox" disabled /></td>'; // Don't want to be able to change the ADMIN checkbox here.
                                            } else {
                                                html += '   <td><input id="' + 'roleCheckbox_' + i + '" type="checkbox" onchange="$(\'.bwParticipantsEditor\').bwParticipantsEditor(\'participantOrgRoleCheckbox_OnChange\', this, \'' + bwParticipantId + '\', \'' + bwParticipantFriendlyName + '\', \'' + bwParticipantEmail + '\', \'' + result3.data[i].RoleId + '\', \'' + result3.data[i].RoleName + '\');" /></td>';
                                            }
                                        }
                                        html += '       <td class="roleId">' + result3.data[i].RoleId + '</td>';
                                        html += '       <td>&nbsp;</td>';
                                        html += '       <td class="roleName">' + result3.data[i].RoleName + '</td>';

                                        // Display orgs for user role
                                        html += '       <td>&nbsp;</td>';
                                        if (isSelected) {
                                            html += '   <td xcx="xcx99944234-1">' + userOrgsForRole + '</td>';
                                        } else {
                                            html += '       <td xcx="xcx99944234-1"></td>';
                                        }

                                        html += '</tr>';
                                    }
                                    html += '</table>';
                                    var selectedRolesHtml = html;

                                    var html = '';

                                    html += '<table style="width:100%;">'; // This is the top dialog bar which we use for dragging. We could put a zoom slider here.
                                    html += '   <tr>';
                                    html += '       <td style="width:90%;">';
                                    html += '           <span style="color: #3f3f3f;font-size:30pt;font-weight:bold;">' + bwParticipantFriendlyName + '</span>';
                                    html += '       </td>';
                                    html += '       <td style="width:9%;"></td>';
                                    html += '       <td style="width:1%;cursor:pointer;vertical-align:top;">';
                                    html += '           <span class="dialogXButton" style="font-size:35pt;cursor:pointer;width:100%;font-weight:bold;" onclick="$(\'.bwCircleDialog\').bwCircleDialog(\'hideCircleDialog\');">X</span>';
                                    html += '       </td>';
                                    html += '   </tr>';
                                    html += '</table>';

                                    html += '<input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->';
                                    html += '<span id="spanDivRolePickerDropDown_OrgPath" style="color:purple;font-size:15pt;">';
                                    html += bwParticipantEmail;
                                    html += '</span>';
                                    html += '<br />';
                                    html += '<hr style="border-top: 1px dashed #95b1d3;" />'; // border-top: 1px dashed red;

                                    html += '<style>';
                                    html += '.participantcircledialog-sectionheadercell {';
                                    //html += '    background-color: gainsboro !important;'; // This is the step header row which expans and collapses.
                                    html += '    border-top:#d8d8d8 1pt solid;';
                                    html += '    border-bottom:#d8d8d8 1pt solid;';
                                    html += '}';
                                    html += '.participantcircledialog-sectionheadercell:hover {';
                                    html += '    background-color: gainsboro !important;'; // This is the step header row which expans and collapses.
                                    html += '    border-top:#d8d8d8 1pt solid;';
                                    html += '    border-bottom:#d8d8d8 1pt solid;';
                                    html += '}';
                                    html += '</style>';
                                    var bwParticipantFirstName = bwParticipantFriendlyName.split(' ')[0];
                                    html += '<table style="width:100%;">';
                                    //
                                    // Role management section. "Add or remove roles by using the checkboxes:"
                                    //
                                    html += '  <tr>';
                                    html += '    <td>';
                                    html += '    <table style="width:100%;">';
                                    html += '      <tr id="participantCircleDialogSection_1" style="border:0px;cursor:pointer;" onclick="$(\'.bwCircleDialog\').bwCircleDialog(\'expandOrCollapseParticipantCircleDialogSection\', \'participantCircleDialogSection_1\', \'participantCircleDialogSectionImage_1\', \'participantCircleDialogSectionRow_1\');">';
                                    html += '        <td class="participantcircledialog-sectionheadercell">';
                                    html += '          <span style="white-space:nowrap;width:100%;">';
                                    html += '            <span class="stepname" style="cursor:cell;vertical-align:middle;" >';
                                    html += '              <img id="participantCircleDialogSectionImage_1" src="images/drawer-close.png" title="collapse" style="cursor:pointer;width:45px;height:45px;vertical-align:middle;"  />';
                                    html += '              &nbsp;' + '<span id="participantCircleDialogSectionTitle_1">Manage ' + bwParticipantFirstName + '\'s role in the organization:</span>'; // + 'xcx300Add or remove roles by using the checkboxes:';

                                    // Put a printer icon here!
                                    html += '<span style="vertical-align:middle;float:right;" title="print" class="printButton" onclick="cmdPrintForm();">🖨</span>';

                                    html += '            </span>';
                                    html += '          </span>';
                                    html += '        </td>';
                                    html += '      </tr>';
                                    html += '      <tr id="participantCircleDialogSectionRow_1" style="display:table-row;" >';
                                    html += '        <td>';
                                    debugger;
                                    html += '          <div id="spanSelectedRolesInRolePickerDropdown" style="overflow-y:auto;height:320px;">' + selectedRolesHtml + '</div>';
                                    html += '        </td>';
                                    html += '      </tr>';
                                    html += '    </table>';
                                    html += '    </td>';
                                    html += '  </tr>';

                                    //
                                    // Pending Tasks section. 
                                    //
                                    html += '  <tr id="participantCircleDialogSection_2" style="border:0px;cursor:pointer;" onclick="$(\'.bwCircleDialog\').bwCircleDialog(\'expandOrCollapseParticipantCircleDialogSection\', \'participantCircleDialogSection_2\', \'participantCircleDialogSectionImage_2\', \'participantCircleDialogSectionRow_2\');">';
                                    html += '    <td>';
                                    html += '    <table style="width:100%;">';
                                    html += '      <tr>';
                                    html += '        <td class="participantcircledialog-sectionheadercell">';
                                    html += '          <span style="white-space:nowrap;">';
                                    html += '            <span id="stepname_' + i + '" class="stepname" style="cursor:cell;vertical-align:middle;" >';
                                    html += '              <img id="participantCircleDialogSectionImage_2" src="images/drawer-open.png" title="collapse" style="cursor:pointer;width:45px;height:45px;vertical-align:middle;"  />';
                                    html += '              &nbsp;' + '<span id="participantCircleDialogSectionTitle_2">Pending Tasks</span>';

                                    // Put a printer icon here!
                                    html += '<span style="vertical-align:middle;float:right;" title="print" class="printButton" onclick="$(\'.bwPrintButton\').bwPrintButton(\'PrintPendingTasksReport\', \'' + bwParticipantId + '\', \'' + bwParticipantFriendlyName + '\', \'' + bwParticipantEmail + '\');">🖨</span>'; // bwParticipantId, bwParticipantFriendlyName, bwParticipantEmail

                                    html += '            </span>';
                                    html += '          </span>';
                                    html += '        </td>';
                                    html += '      </tr>';
                                    html += '      <tr id="participantCircleDialogSectionRow_2" style="display:none;" >';
                                    html += '        <td>';
                                    html += '          <div id="spanCircleDialogParticipantTasks" style="vertical-align:middle;overflow-y:auto;height:320px;">[spanCircleDialogParticipantTasks]</div>';
                                    html += '        </td>';
                                    html += '      </tr>';
                                    html += '    </table>';
                                    html += '    </td>';
                                    html += '  </tr>';

                                    //
                                    // History section. 
                                    //
                                    html += '  <tr id="participantCircleDialogSection_3" style="border:0px;cursor:pointer;" onclick="$(\'.bwCircleDialog\').bwCircleDialog(\'expandOrCollapseParticipantCircleDialogSection\', \'participantCircleDialogSection_3\', \'participantCircleDialogSectionImage_3\', \'participantCircleDialogSectionRow_3\');">';
                                    html += '    <td class="participantcircledialog-sectionheadercell">';
                                    html += '    <table style="width:100%;">';
                                    html += '      <tr>';
                                    html += '        <td>';
                                    html += '          <span style="white-space:nowrap;">';
                                    html += '            <span id="stepname_' + i + '" class="stepname" style="cursor:cell;vertical-align:middle;" >';
                                    html += '              <img id="participantCircleDialogSectionImage_3" src="images/drawer-open.png" title="collapse" style="cursor:pointer;width:45px;height:45px;vertical-align:middle;"  />';
                                    html += '              &nbsp;<span id="participantCircleDialogSectionTitle_3">' + bwParticipantFirstName + '\'s previous activity and email history:</span>';

                                    // Put a printer icon here!
                                    html += '<span style="vertical-align:middle;float:right;" title="print" class="printButton" onclick="cmdPrintForm();">🖨</span>';

                                    html += '            </span>';
                                    html += '          </span>';
                                    html += '        </td>';
                                    html += '      </tr>';
                                    html += '      <tr id="participantCircleDialogSectionRow_3" style="display:none;" >';
                                    html += '        <td>';
                                    html += '          <div id="spanSelectedRolesInRolePickerDropdown3x" style="overflow-y:auto;height:320px;">This functionality is incomplete. Coming soon!</div>';
                                    html += '        </td>';
                                    html += '      </tr>';
                                    html += '    </table>';
                                    html += '    </td>';
                                    html += '  </tr>';

                                    html += '</table>';


                                    console.log('******************');
                                    console.log('Attempting to display dialog xcx12425r24.');
                                    console.log('******************');


                                    //
                                    // >>>> THIS IS HOW WE should be displaying all of our circle dialogs.
                                    //
                                    $('#' + dialogElementId).html(html); // >>>> STEP2: Assign the element all of the html.
                                    $('#' + dialogElementId).dialog({ // >>>> STEP3: Display the dialog.
                                        modal: false,
                                        resizable: false,
                                        closeOnEscape: false, // Hit the ESC key to hide! Yeah!
                                        width: '550',
                                        dialogClass: 'no-close', // No close button in the upper right corner.
                                        hide: false, // This means when hiding just disappear with no effects.
                                        position: {
                                            my: 'center top', at: 'center top+150', of: window
                                        },
                                        close: function () {
                                            $('#' + dialogElementId).dialog('destroy');
                                        },
                                        open: function () {
                                            try {
                                                console.log('******************');
                                                console.log('Attempting to call bwCircleDialog.displayDialog().');
                                                console.log('******************');





















                                                //alert('Attempting to call bwCircleDialog.displayDialog(). identityJson: ' + JSON.stringify(identityJson));
                                                $('.bwCircleDialog').bwCircleDialog('displayDialog', identityJson, this); // >>>> STEP 4: Display the circle dialog.

                                                $('.bwCoreComponent').bwCoreComponent('renderParticipantTasks', '' + bwParticipantId + '', 'spanCircleDialogParticipantTasks', '' + bwParticipantFriendlyName + '');







                                                //    // Get the dialog zindex here, then apply that to the circle dialog, so that it can move to the top of the diasplay! woop! 
                                                //$(this).dialog('moveToTop');
                                                //var zindex = $(this).closest('.ui-front').css('zIndex');

                                                //var zindex2 = Number(zindex) - 1;

                                                //var canvasElementId = $('.bwCircleDialog').bwCircleDialog('option', 'canvasElementId');
                                                //var canvasZindex = $('#' + canvasElementId).css('zIndex');
                                                //$('#' + canvasElementId).css('zIndex', zindex2);
                                                //var canvasZindex2 = $('#' + canvasElementId).css('zIndex');

                                                //    console.log('************************');
                                                //    console.log('************************');
                                                //    console.log('This dialog got the focus! zindex: ' + zindex + ', canvasElementId: ' + canvasElementId + ', canvasZindex: ' + canvasZindex + ', canvasZindex2: ' + canvasZindex2);
                                                //    console.log('************************');
                                                //    console.log('************************');













                                            } catch (e) {
                                                console.log('Exception in bwAuthentication.displaySignInDialog():2: ' + e.message + ', ' + e.stack);
                                                displayAlertDialog('Exception in bwAuthentication.displaySignInDialog():2: ' + e.message + ', ' + e.stack);
                                            }
                                        }
                                    });

                                } catch (e) {
                                    console.log('Exception in raci.html.displayRoleMultiPicker().Get[odata/Orgs].done: ' + e.message + ', ' + e.stack);
                                    displayAlertDialog('Exception in raci.html.displayRoleMultiPicker().Get[odata/Orgs].done: ' + e.message + ', ' + e.stack);
                                }
                            },
                            error: function (data, errorCode, errorMessage) {
                                displayAlertDialog('Error in displayParticipantRoleMultiPickerInACircle(' + '' + '):2:' + errorCode + ', ' + errorMessage);
                            }
                        });
                    } catch (e) {
                        console.log('Exception in raci.html.displayRoleMultiPicker().Get[odata/Orgs].done7: ' + e.message + ', ' + e.stack);
                        displayAlertDialog('Exception in raci.html.displayRoleMultiPicker().Get[odata/Orgs].done7: ' + e.message + ', ' + e.stack);
                    }
                }).fail(function (data) {
                    var msg;
                    if (JSON.stringify(data).indexOf('The specified URL cannot be found.') > -1) {
                        msg = 'There has been an error contacting the server. A firewall or network appliance may be interrupting this traffic.';
                    } else {
                        msg = JSON.stringify(data);
                    }
                    displayAlertDialog('Error in raci.html.displayRoleMultiPicker().Get[odata/Orgs].fail: ' + msg); //+ error.message.value + ' ' + error.innererror.message);
                    console.log('Error in raci.html.displayRoleMultiPicker().Get[odata/Orgs].fail:' + JSON.stringify(data));
                    //console.log('Fail in CarForm3.aspx.populateSpendForecastNotReadOnly().spendForecastItems.update: ' + JSON.stringify(data));
                    //var error = JSON.parse(data.responseText)["odata.error"];
                    //alert('Exception in CarForm3.aspx.populateSpendForecastNotReadOnly().spendForecastItems.update: ' + error.message.value + ' ' + error.innererror.message); // + ', EntityValidationErrors: ' + data.EntityValidationErrors);
                });
                //}
            }

        } catch (e) {
            console.log('Exception in bwAuthentication.js.displayParticipantRoleMultiPickerInACircle(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.displayParticipantRoleMultiPickerInACircle(): ' + e.message + ', ' + e.stack);
        }
    },

    displayLoggedInUserDropDownInACircle: function (resetCachedDisplayValues) { //, originElementId, bwParticipantId, bwParticipantFriendlyName, bwParticipantEmail) {
        try {
            console.log('In displayLoggedInUserDropDownInACircle().');
            var thiz = this;

            var tenantId = $('.bwAuthentication').bwAuthentication('option', 'tenantId');
            var workflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
            var participantId = $('.bwAuthentication').bwAuthentication('option', 'participantId');
            var participantEmail = $('.bwAuthentication').bwAuthentication('option', 'participantEmail');
            var participantFriendlyName = $('.bwAuthentication').bwAuthentication('option', 'participantFriendlyName');
            var participantLogonType = $('.bwAuthentication').bwAuthentication('option', 'participantLogonType');

            var dialogElementId = $('.bwCircleDialog').bwCircleDialog('option', 'dialogElementId'); // >>>> STEP1: The bwCircleDialog widget manages this, so it always knows how to find it in the DOM.
            if ($('#' + dialogElementId).dialog('instance')) {
                $('#' + dialogElementId).dialog('close'); // We make sure we start with a new one!
            }

            window.scrollTo(0, 0); // Scroll to top on button click. This makes sure things render Ok, and also just seems like a nicer user experience.
            if ($('.bwActiveMenu') && $('.bwActiveMenu').length) {
                $('.bwActiveMenu').bwActiveMenu('adjustLeftSideMenu'); // This makes sure our new stretchy-left-menu redraws Ok.
            } else {
                $('.bwActiveMenu_Admin').bwActiveMenu_Admin('adjustLeftSideMenu'); // This makes sure our new stretchy-left-menu redraws Ok.
            }

            if (resetCachedDisplayValues == true) {
                this.options.OnResizeDisplayValues = null;
            }

            var html = '';

            if (this.options.OnResizeDisplayValues != null && this.options.OnResizeDisplayValues.Html) {
                html = this.options.OnResizeDisplayValues.Html;
            } else {
                //$.ajax({
                //    url: this.options.operationUriPrefix + "odata/Roles/" + workflowAppId + "/" + participantId,
                //    dataType: "json",
                //    contentType: "application/json",
                //    type: "Get"
                //}).done(function (result) {
                //    try {
                //if (result.message.indexOf('RETURNING NO WORKFLOW') > -1) {
                //    // Must be a new tenant, because there is no workflow yet. We will use the pre-canned one here. Doing this on the client side.

                //}
                //console.log('In my.js.displayRoleMultiPicker().Get[odata/Roles].done: result.userRoles: ' + JSON.stringify(result.userRoles));
                //
                //debugger;
                //var car = result.workflow;
                ////
                ////debugger;
                //var roles;
                //if (result) {
                //    roles = result.userRoles;
                //} else {
                //    console.log('In my.js.displayRoleMultiPicker().Get[odata/Roles].done: result: bad identifier here, please reword.. ' + JSON.stringify(result));
                //}

                var html = '';

                //html += '<div style="display:none;" id="AccountDetailsDialog">';
                html += '            <table style="width:100%;">';
                html += '                <tr>';
                html += '                    <td style="width:90%;">';
                html += '                        <span id="spanAccountDetailsDialogTitle" style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 30pt;font-weight:bold;">';
                html += 'Update account details for ' + participantFriendlyName + '.<br /><span style="font-size:15pt;color:tomato;">Logon provider: ' + participantLogonType + '</span>';
                html += '                        </span>';
                html += '                    </td>';
                html += '                    <td style="width:9%;"></td>';
                html += '                    <td style="width:1%;cursor:pointer;vertical-align:top;">';
                html += '                        <span class="dialogXButton" style="font-size:30pt;cursor:pointer;font-weight:bold;" onclick="$(\'.bwCircleDialog\').bwCircleDialog(\'hideCircleDialog\');">X</span>';
                html += '                    </td>';
                html += '                </tr>';
                html += '            </table>';
                html += '            <br />';
                html += '            <!--<span id="spanAccountDetailsDialogDetails"></span>-->';
                html += '            <!--<input id="txtPeoplePickerDialogSearchBox" title="Type the first name and select from the list below..." style="WIDTH: 85%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;TEXT-ALIGN: left;" /><input id="txtPeoplePickerDialogParticipantId" style="display:none;" /><input id="txtPeoplePickerDialogParticipantEmail" style="display:none;" />';
                html += '            <img src="images/magnifying-glass.jpg" style="width:25px;height:25px;" />';
                html += '            <hr />';
                html += '            <span id="spanPeoplePickerParticipantsList"></span>-->';
                html += '';
                html += '            <input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->';
                html += '            <span style="font-family: calibri;">Name</span>';
                html += '            <br />';
                html += '            <input type="text" id="txtUserOptionsFriendlyName" value="' + participantFriendlyName + '" style="WIDTH: 93%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;" />';
                html += '            <br /><br />';
                html += '            <span style="font-family: calibri;">Email</span>';
                html += '            <br />';
                html += '            <input type="text" id="txtUserOptionsEmail" value="' + participantEmail + '" style="WIDTH: 93%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;" />';
                html += '            <br />';
                html += '            <span id="txtUserOptionsParticipantId" style="color:aliceblue;">' + participantId + '</span>';
                html += '        <br /><br />';

                var zoom = 1.25;
                html += '<table style="width:100%;">';
                html += '<tr>';
                html += '<td style="text-align:right;">';
                html += '   <span style="cursor:help;color:gray;" title="Auto-logon with local storage. Your logon information gets saved in local storage so that you aren\'t subsequently prompted to logon." >';

                var rememberme;
                rememberme = localStorage['customlogonrememberme']; //$('.bwAuthentication').bwAuthentication('getCookie', 'customlogonrememberme');
                if (rememberme == 'selected') {
                    html += '        <input onclick="$(\'.bwAuthentication\').bwAuthentication(\'changeRememberMeCheckboxSetting_OnClick\');" id="cbCustomLogonRememberMe" type="checkbox" style="cursor:pointer;zoom: ' + zoom + ';transform: scale(' + zoom + ');-ms-transform: scale(' + zoom + ');-webkit-transform: scale(' + zoom + ');-o-transform: scale(' + zoom + ');-moz-transform: scale(' + zoom + ');transform-origin: 0 0;-ms-transform-origin: 0 0;-webkit-transform-origin: 0 0;-o-transform-origin: 0 0;-moz-transform-origin: 0 0;" checked />';
                } else {
                    html += '        <input onclick="$(\'.bwAuthentication\').bwAuthentication(\'changeRememberMeCheckboxSetting_OnClick\');" id="cbCustomLogonRememberMe" type="checkbox" style="cursor:pointer;zoom: ' + zoom + ';transform: scale(' + zoom + ');-ms-transform: scale(' + zoom + ');-webkit-transform: scale(' + zoom + ');-o-transform: scale(' + zoom + ');-moz-transform: scale(' + zoom + ');transform-origin: 0 0;-ms-transform-origin: 0 0;-webkit-transform-origin: 0 0;-o-transform-origin: 0 0;-moz-transform-origin: 0 0;" />';
                }
                //html += '        <input onclick="$(\'.bwAuthentication\').bwAuthentication(\'changeRememberMeCheckboxSetting_OnClick\');" id="cbCustomLogonRememberMe" type="checkbox" style="cursor:pointer;zoom: ' + zoom + ';transform: scale(' + zoom + ');-ms-transform: scale(' + zoom + ');-webkit-transform: scale(' + zoom + ');-o-transform: scale(' + zoom + ');-moz-transform: scale(' + zoom + ');transform-origin: 0 0;-ms-transform-origin: 0 0;-webkit-transform-origin: 0 0;-o-transform-origin: 0 0;-moz-transform-origin: 0 0;" checked />';


                html += '        &nbsp;Remember me';
                html += '   </span>';
                //html += '        <br />';
                //html += '        <br />';
                html += '</td>';
                html += '</tr>';
                html += '</table>';


                html += '            <br />';
                html += '            <div class="divSignInButton" style="width:90%;text-align:center;line-height:0.8em;font-weight:bold;" onclick="$(\'.bwCoreComponent\').bwCoreComponent(\'cmdSaveUserOptions\');">';
                html += '                Save';
                html += '            </div>';
                //debugger;
                html += '            <br />';
                html += '            <div class="divSignInButton" style="width:90%;text-align:center;line-height:0.8em;font-weight:bold;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'cmdDisplayForgottenPasswordDialog\');">'; // $('.bwAuthentication').bwAuthentication('cmdDisplayForgottenPasswordDialog');
                html += '                Change Password';
                html += '            </div>';
                html += '            <br />';
                html += '            <div xcx="xcx123125" class="divSignInButton" style="width:90%;text-align:center;line-height:0.8em;font-weight:bold;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'cmdSignOut\');">';
                html += '                Sign out';
                html += '            </div>';

                // var unsubscribeUrl = globalUrlPrefix + globalUrl + '/email.html?unsubscribe=' + bwAssignedToId;
                html += '            <br />';
                html += '            <div class="divSignInButton" style="width:90%;text-align:center;line-height:0.8em;font-weight:bold;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'cmdUnsubscribe\');">';
                html += '                Unsubscribe';
                html += '            </div>';



                html += '            <br />';
                html += '            <div class="divSignInButton" style="width:90%;text-align:center;line-height:0.8em;font-weight:bold;" onclick="$(\'.bwCircleDialog\').bwCircleDialog(\'hideCircleDialog\');">';
                html += '                Close';
                html += '            </div>';
                html += '            <br /><br />';
                //html += '        </div>';


                //
                // >>>> THIS IS HOW WE should be displaying all of our circle dialogs.
                //
                $('#' + dialogElementId).html(html); // >>>> STEP2: Assign the element all of the html.
                $('#' + dialogElementId).dialog({ // >>>> STEP3: Display the dialog.
                    modal: false,
                    resizable: false,
                    closeOnEscape: false, // Hit the ESC key to hide! Yeah!
                    width: '460',
                    dialogClass: 'no-close', // No close button in the upper right corner.
                    hide: false, // This means when hiding just disappear with no effects.
                    position: {
                        my: 'center top', at: 'center top+150', of: window
                    },
                    close: function () {
                        $('#' + dialogElementId).dialog('destroy');
                    },
                    open: function () {
                        try {

                            var identityJson = {
                                bwParticipantId: participantId,
                                bwParticipantFriendlyName: participantFriendlyName,
                                bwParticipantEmail: participantEmail
                            };

                            //    this.drawCircle(divCircleDialog1, 'images/userimage.png', 512, 512, true, identityJson);

                            $('.bwCircleDialog').bwCircleDialog('displayDialog', identityJson); // >>>> STEP 4: Display the circle dialog.


                        } catch (e) {
                            console.log('Exception in bwAuthentication.displaySignInDialog():2: ' + e.message + ', ' + e.stack);
                            displayAlertDialog('Exception in bwAuthentication.displaySignInDialog():2: ' + e.message + ', ' + e.stack);
                        }
                    }
                });
                //$('#' + dialogElementId).dialog().parents('.ui-dialog').find('.ui-dialog-titlebar').remove();

            }

        } catch (e) {
            console.log('Exception in bwCircleDialog.displayLoggedInUserDropDownInACircle(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwCircleDialog.displayLoggedInUserDropDownInACircle(): ' + e.message + ', ' + e.stack);
        }
    },
    displaySignInDialog: function (resetCachedDisplayValues, customLogonDialogDescriptionText, hideSignUpAndResetPasswordButtons, reauthorize) {
        try {
            console.log('In bwAuthentication.js.displaySignInDialog(). reauthorize: ' + reauthorize);
            //alert('In bwAuthentication.js.displaySignInDialog(). reauthorize: ' + reauthorize);
            var thiz = this;

            var dialogElementId = $('.bwCircleDialog').bwCircleDialog('option', 'dialogElementId'); // >>>> STEP1: The bwCircleDialog widget manages this, so it always knows how to find it in the DOM.
            if ($('#' + dialogElementId).dialog('instance')) {
                $('#' + dialogElementId).dialog('close'); // We make sure we start with a new one!
            }

            window.scrollTo(0, 0); // Scroll to top on button click. This makes sure things render Ok, and also just seems like a nicer user experience.
            if ($('.bwActiveMenu') && $('.bwActiveMenu').length) {
                $('.bwActiveMenu').bwActiveMenu('adjustLeftSideMenu'); // This makes sure our new stretchy-left-menu redraws Ok.
            }

            if (resetCachedDisplayValues == true) {
                this.options.OnResizeDisplayValues = null;
            }

            var html = '';

            if (this.options.OnResizeDisplayValues != null && this.options.OnResizeDisplayValues.Html) {
                html = this.options.OnResizeDisplayValues.Html;
            } else {
                html += '<div style="" xcx="xcx9809-1" id="divCustomSignUpDialog">'; // 10-8-2022
                html += '        <table style="width:100%;">';
                html += '            <tr>';
                html += '                <td style="width:90%;">';
                html += '                    <span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 30pt;font-weight:bold;">Sign in</span>';
                html += '                </td>';
                html += '                <td style="width:9%;"></td>';
                html += '                <td style="width:1%;cursor:pointer;vertical-align:top;">';
                //html += '                    <span class="dialogXButton" style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;font-size: 30pt;font-weight:bold;" onclick="$(\'.bwCircleDialog\').bwCircleDialog(\'hideCircleDialog\');">X</span>';
                html += '                    <span class="dialogXButton" style="font-size:35pt;cursor:pointer;width:100%;font-weight:bold;" onclick="$(\'.bwCircleDialog\').bwCircleDialog(\'hideCircleDialog\');">X</span>';
                html += '                </td>';
                html += '            </tr>';
                html += '        </table>';
                html += '        <br />';
                html += '        <input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->';
                if (customLogonDialogDescriptionText) {
                    html += '        <span id="spanCustomLogonDialogInvitationDescriptionText" style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 20pt;">' + customLogonDialogDescriptionText + '</span>';
                } else {
                    html += '        <span id="spanCustomLogonDialogInvitationDescriptionText" style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 20pt;"></span>';
                }
                html += '        <span style="font-family: calibri;">Email</span>';
                html += '        <br />';
                html += '        <input type="text" id="txtCustomLogonEmail" style="WIDTH: 93%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;" />';
                html += '        <br /><br />';
                html += '        <span style="font-family: calibri;">Password</span>';
                html += '        <br />';
                html += '        <input type="password" id="txtCustomLogonPassword" onkeydown="return carriagereturnpress(event, \'logonWith_BudgetWorkflow\');" style="WIDTH: 93%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;" /><br />';
                html += '        <br />';
                var zoom = 1.25;
                html += '<table style="width:100%;">';
                html += '<tr>';
                html += '<td style="text-align:right;">';
                html += '   <span style="cursor:help;color:gray;" title="Auto-logon with local storage. Your logon information gets saved in local storage so that you aren\'t subsequently prompted to logon." >';
                html += '        <input onclick="$(\'.bwAuthentication\').bwAuthentication(\'changeRememberMeCheckboxSetting_OnClick\');" id="cbCustomLogonRememberMe" type="checkbox" style="cursor:pointer;zoom: ' + zoom + ';transform: scale(' + zoom + ');-ms-transform: scale(' + zoom + ');-webkit-transform: scale(' + zoom + ');-o-transform: scale(' + zoom + ');-moz-transform: scale(' + zoom + ');transform-origin: 0 0;-ms-transform-origin: 0 0;-webkit-transform-origin: 0 0;-o-transform-origin: 0 0;-moz-transform-origin: 0 0;" checked />';
                html += '        &nbsp;Remember me';
                html += '   </span>';
                html += '        <br />';
                html += '        <br />';
                html += '</td>';
                html += '</tr>';
                html += '</table>';

                if (reauthorize && (reauthorize == true)) {

                    html += '        <div id="xcx90809-1" class="divSignInButton" style="width: 75%; text-align: center; line-height: 1.1em; font-weight: bold;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'logonWith_BudgetWorkflow\', true, true);">'; // forceIgnoreInvitation = true
                    html += '            Sign In';
                    html += '        </div>';

                } else {

                    html += '        <div id="xcx90809-2" class="divSignInButton" style="width: 75%; text-align: center; line-height: 1.1em; font-weight: bold;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'logonWith_BudgetWorkflow\', false);">'; // This may be an invitation, so set forceIgnoreInvitation = false.
                    html += '            Sign In';
                    html += '        </div>';

                }

                html += '        <br />';
                if (!hideSignUpAndResetPasswordButtons || hideSignUpAndResetPasswordButtons != true) {
                    html += '        <span style="font-family: calibri;font-style:italic;font-size:15pt;">New to BudgetWorkflow.com? Sign up now. It\'s free!</span>';
                    html += '        <br /><br />';

                    html += '        <div id="xxxx" class="divSignInButton" style="width: 75%; text-align: center; line-height: 1.1em; font-weight: bold;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'displayCreateFreeAccountDialog\', true);">';
                    html += '            Sign up now';
                    html += '        </div>';
                    html += '        <br />';

                    html += '        <span style="font-family: calibri;font-style:italic;font-size:15pt;">Forgot your password?</span>';
                    html += '        <br /><br />';

                    html += '        <div id="xxxx" class="divSignInButton" style="width: 75%; text-align: center; line-height: 1.1em; font-weight: bold;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'cmdDisplayForgottenPasswordDialog\');">';
                    html += '            Reset password';
                    html += '        </div>';
                    //html += '        <br /><br />';
                    //html += '        <br /><br />';
                    //html += '        <br /><br />';
                } else {

                    // Just need this to force the circle dialog to be larger.
                    html += '        <br /><br />';

                }
                html += '</div>'; // 10-8-2022 // The height of this div determines the diameter of the bwCircleDialog. Should match displayCreateFreeAccountDialog().
            }

            //
            // >>>> THIS IS HOW WE should be displaying all of our circle dialogs.
            //
            $('#' + dialogElementId).html(html); // >>>> STEP2: Assign the element all of the html.
            $('#' + dialogElementId).dialog({ // >>>> STEP3: Display the dialog.
                modal: false,
                resizable: false,
                closeOnEscape: false, // Hit the ESC key to hide! Yeah!
                width: '550',
                dialogClass: 'no-close', // No close button in the upper right corner.
                hide: false, // This means when hiding just disappear with no effects.
                position: {
                    my: 'center top', at: 'center top+150', of: window
                },
                close: function () {
                    $('#' + dialogElementId).dialog('destroy');
                },
                open: function () {
                    try {
                        $('.bwCircleDialog').bwCircleDialog('displayDialog'); // >>>> STEP 4: Display the circle dialog.

                        $('#divAlertDialog').dialog('close');

                        // local storage for the custom login!
                        var username = localStorage ? localStorage['customlogonusername'] : '';
                        var password = localStorage ? localStorage['customlogonpassword'] : '';
                        var rememberme = localStorage ? localStorage['customlogonrememberme'] : '';

                        $('#txtCustomLogonEmail').val(username);
                        $('#txtCustomLogonPassword').val(password);
                        if (rememberme == 'selected') {
                            // This auto-logs in the user.
                            thiz.logonWith_BudgetWorkflow_SwitchToDesktopVersion();
                        } else {
                            document.getElementById('cbCustomLogonRememberMe').checked = false;
                        }
                    } catch (e) {
                        console.log('Exception in bwAuthentication.js.displaySignInDialog():2: ' + e.message + ', ' + e.stack);
                        displayAlertDialog('Exception in bwAuthentication.js.displaySignInDialog():2: ' + e.message + ', ' + e.stack);
                    }
                }
            });
            //$('#' + dialogElementId).dialog().parents('.ui-dialog').find('.ui-dialog-titlebar').remove();

            //        var displayValues = {
            //            DrawCircleDialog: true,
            //            DisplayMethod: 'displaySignInDialog',
            //            Image: {
            //                Path: 'images/userimage.png',
            //                Width: 512,
            //                Height: 512
            //            },
            //            Html: divCircleDialog1.innerHTML
            //        };
            //        $('#divCircleDialog1').bwCircleDialog({ OnResizeDisplayValues: displayValues });
            //        $('#divCircleDialog1').bwCircleDialog('drawCircle', divCircleDialog1, 'images/businesswoman2.png', 512, 512, false);

        } catch (e) {
            console.log('Exception in bwAuthentication.js.displaySignInDialog(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.displaySignInDialog(): ' + e.message + ', ' + e.stack);
        }
    },

    determineLogonTypeAndSignIn: function () {
        try {
            console.log('In bwAuthentication.js.determineLogonTypeAndSignIn().');
            //alert('In bwAuthentication.js.determineLogonTypeAndSignIn().');
            //if (document.getElementById('selectLogonType') && document.getElementById('selectLogonType').value) {
            //    var selectedLogonType = document.getElementById('selectLogonType').value;
            //    if (selectedLogonType == 'Microsoft') {
            //        this.logonWith_Microsoft();
            //    } else if (selectedLogonType == 'BudgetWorkflow.com') {
            $('.bwCircleDialog').bwCircleDialog('displaySignInDialog', true);
            //    } else {
            //        displayAlertDialog('Unrecognized logon type in determineLogonTypeAndSignIn(): ' + selectedLogonType);
            //    }
            //} else {
            //    $('.bwCircleDialog').bwCircleDialog('displaySignInDialog', true);
            //}
        } catch (e) {
            displayAlertDialog('Exception in bwAuthentication.js.determineLogonTypeAndSignIn(): ' + e.message + ', ' + e.stack);
        }
    },
    selectLogonType_OnChange: function () {
        try {
            // We need to save the selected value to the cookie, so that the drop down displays the last selected value.
            var selectedLogonType = document.getElementById('selectLogonType').value;
            if (selectedLogonType == 'Microsoft') {
                // Display the Azure AD connection details.
                document.getElementById('spanAzureADConnectionDetails').innerHTML = '<span class="bwLink">Connect to your Microsoft Azure Active Directory</span>';
            } else {
                // Hide the Azure AD connection details.
                if (document.getElementById('spanAzureADConnectionDetails')) {
                    document.getElementById('spanAzureADConnectionDetails').innerHTML = '';
                }
                // 1-28-2022 This has been moved from the home page as the user will configure this once they are logged in. // document.getElementById('spanAzureADConnectionDetails').innerHTML = '<span class="bwLink">Configure dual-factor authentication xcx4</span>';
            }

            localStorage['selectedlogontype'] = selectedLogonType;
            //setCookie('selectedlogontype', selectedLogonType, 30);
            //this.displayAlertDialog('In selectLogonType_OnChange(). selectedLogonType: ' + selectedLogonType);
        } catch (e) {
            displayAlertDialog('Exception in selectLogonType_OnChange(): ' + e.message + ', ' + e.stack);
        }
    },
    displayAzureADConnectionDetails: function () {
        try {

            var html = '';
            html += '<div style="font-size:18pt;">';
            html += 'You can configure your Microsoft Azure Active Directory to work with BudgetWorkflow.com by sending me your unique AD application client id. Contact me for more information.'; // by entering these settings.';
            html += '<br /><br />';
            html += '<span style="font-size:14pt;">';
            html += 'example clientId: 55d270fb-e669-465a-a792-ab44f4ac23f0';
            html += '<br />';
            html += 'redirectUri: https://budgetworkflow.com/index.html';
            html += '<br />';
            html += 'postLogoutRedirectUri: https://budgetworkflow.com';
            html += '</span>';
            html += '<span style="font-size:14pt;">';
            html += '<br /><br />';
            html += 'Detailed instructions are coming in the near future. In the meantime, feel free to email todd_hiltz@hotmail.com with any questions.';
            html += '</span>';
            html += '</div>';

            this.displayAlertDialog(html);

            //var msalConfig = {
            //    auth: {
            //        clientId: '55d270fb-e669-465a-a792-ab44f4ac23f0',
            //        redirectUri: 'https://budgetworkflow.com/index.html',
            //        postLogoutRedirectUri: 'https://budgetworkflow.com'
            //    },
            //    cache: {
            //        //cacheLocation: 'localStorage',
            //        storeAuthStateInCookie: true
            //    }
            //}
        } catch (e) {
            displayAlertDialog('Exception in displayAzureADConnectionDetails(): ' + e.message + ', ' + e.stack);
        }
    },
    displayBudgetWorkflowTwoFactorAuthenticationDetails: function () {
        try {

            var html = '';
            html += '<div style="font-size:18pt;">';
            html += 'This functionality is incomplete. Coming soon!';
            html += '<br /><br />';
            html += 'The iOS App is required in order to configure dual-factor authentication.';

            html += '</div>';

            this.displayAlertDialog(html);

        } catch (e) {
            displayAlertDialog('Exception in displayBudgetWorkflowTwoFactorAuthenticationDetails(): ' + e.message + ', ' + e.stack);
        }
    },

    cmdSignOut: function () {
        try {
            console.log('In bwCoreComponent.cmdSignOut().');

            //var workflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
            //var participantId = $('.bwAuthentication').bwAuthentication('option', 'participantId');
            //var participantEmail = $('.bwAuthentication').bwAuthentication('option', 'participantEmail');
            //var participantFriendlyName = $('.bwAuthentication').bwAuthentication('option', 'participantFriendlyName');

            if (!this.options.participantLogonType) {

                var msg = 'In bwAuthentication.js.cmdSignOut(). Unexpected value for participantLogonType: ' + this.options.participantLogonType + ', participantId: ' + this.options.participantId + ', participantEmail: ' + this.options.participantEmail + ', participantFriendlyName: ' + this.options.participantFriendlyName;
                console.log(msg);
                WriteToErrorLog(msg);

                this.options.participantLogonType = 'custom';
            }

            // Sign out the user.
            if (this.options.participantLogonType == 'microsoft') {

                this.options.msalInstance.logout();

            } else if (this.options.participantLogonType == 'custom') {

                var msg = 'In bwAuthentication.js.cmdSignOut(). This user has chosen to log out. participantFriendlyName: ' + this.options.participantFriendlyName + ' (' + this.options.participantEmail + ') participantId: ' + this.options.participantId + ', participantLogonType: ' + this.options.participantLogonType;
                WriteToErrorLog(msg);

                //// Reset these values!!!
                //tenantId = '';
                //$('#divRequest').bwRequest('option', 'tenantId', tenantId);
                //workflowAppId = '';
                //$('#divRequest').bwRequest('option', 'workflowAppId', workflowAppId);

                //workflowAppTitle = '';
                //participantId = '';
                //participantLogonType = '';
                //participantLogonTypeUserId = '';
                //participantFriendlyName = '';
                //participantEmail = '';

                //$('.bwCircleDialog').bwCircleDialog('hideAndDestroyCircleDialog');

                //setCookie('customlogonusername', '', 30);
                //setCookie('customlogonpassword', '', 30);

                var location = globalUrlPrefix + globalUrl;
                //alert('In bwAuthentication.js.cmdSignOut(). setting window.location!! xcx343245342-7');

                window.location = location;

                //$('#spanLogoutDialogLogonProvider').text(participantLogonType); // 

                //$("#LogoutDialog").dialog({
                //    modal: true,
                //    resizable: false,
                //    closeText: "Cancel",
                //    closeOnEscape: true, // Hit the ESC key to hide! Yeah!
                //    title: "",
                //    width: "400px",
                //    dialogClass: "no-close", // No close button in the upper right corner.
                //    hide: false, // This means when hiding just disappear with no effects.
                //    buttons: {
                //        "Close": function () {
                //            $(this).dialog("close");
                //        }
                //    }
                //});

                //displayAlertDialog('ATTEMPTING TO LOG OUT OF FB');
                //FB.logout(function (response) {
                //    // user is now logged out
                //    displayAlertDialog('LOGGED OUT OF FB');
                //    window.location = 'index.html';
                //});
            } else {
                this.displayAlertDialog('Unknown participantLogonType in cmdSignOut(). participantLogonType: ' + participantLogonType);

                var msg = 'In bwAuthentication.js.cmdSignOut(). Unexpected value for participantLogonType: ' + this.options.participantLogonType + ', participantId: ' + this.options.participantId + ', participantEmail: ' + this.options.participantEmail + ', participantFriendlyName: ' + this.options.participantFriendlyName;
                console.log(msg);
                WriteToErrorLog(msg);

            }


        } catch (e) {
            console.log('Exception in bwCoreComponent.cmdSignOut(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwCoreComponent.cmdSignOut(): ' + e.message + ', ' + e.stack);
        }
    },


    cmdUnsubscribe: function () {
        try {
            console.log('In bwCoreComponent.cmdSignOut().');

            //var workflowAppId = $('.bwAuthentication').bwAuthentication('option', 'workflowAppId');
            var participantId = $('.bwAuthentication').bwAuthentication('option', 'participantId');
            //var participantEmail = $('.bwAuthentication').bwAuthentication('option', 'participantEmail');
            //var participantFriendlyName = $('.bwAuthentication').bwAuthentication('option', 'participantFriendlyName');

            if (!this.options.participantLogonType) {

                var msg = 'In bwAuthentication.js.cmdUnsubscribe(). Unexpected value for participantLogonType: ' + this.options.participantLogonType + ', participantId: ' + this.options.participantId + ', participantEmail: ' + this.options.participantEmail + ', participantFriendlyName: ' + this.options.participantFriendlyName;
                console.log(msg);
                WriteToErrorLog('', msg);

                this.options.participantLogonType = 'custom';
            }

            // Sign out the user.
            if (this.options.participantLogonType == 'microsoft') {

                this.options.msalInstance.logout();

            } else if (this.options.participantLogonType == 'custom') {

                var msg = 'In bwAuthentication.js.cmdUnsubscribe(). This user has chosen to unsubscribe. participantFriendlyName: ' + this.options.participantFriendlyName + ' (' + this.options.participantEmail + ') participantId: ' + this.options.participantId + ', participantLogonType: ' + this.options.participantLogonType;
                WriteToErrorLog('', msg);

                //// Reset these values!!!
                //tenantId = '';
                //$('#divRequest').bwRequest('option', 'tenantId', tenantId);
                //workflowAppId = '';
                //$('#divRequest').bwRequest('option', 'workflowAppId', workflowAppId);

                //workflowAppTitle = '';
                //participantId = '';
                //participantLogonType = '';
                //participantLogonTypeUserId = '';
                //participantFriendlyName = '';
                //participantEmail = '';

                //$('.bwCircleDialog').bwCircleDialog('hideAndDestroyCircleDialog');

                //setCookie('customlogonusername', '', 30);
                //setCookie('customlogonpassword', '', 30);



                var location = globalUrlPrefix + globalUrl + '/index.html?unsubscribe=' + participantId;

                window.location = location;



                //$('#spanLogoutDialogLogonProvider').text(participantLogonType); // 

                //$("#LogoutDialog").dialog({
                //    modal: true,
                //    resizable: false,
                //    closeText: "Cancel",
                //    closeOnEscape: true, // Hit the ESC key to hide! Yeah!
                //    title: "",
                //    width: "400px",
                //    dialogClass: "no-close", // No close button in the upper right corner.
                //    hide: false, // This means when hiding just disappear with no effects.
                //    buttons: {
                //        "Close": function () {
                //            $(this).dialog("close");
                //        }
                //    }
                //});

                //displayAlertDialog('ATTEMPTING TO LOG OUT OF FB');
                //FB.logout(function (response) {
                //    // user is now logged out
                //    displayAlertDialog('LOGGED OUT OF FB');
                //    window.location = 'index.html';
                //});
            } else {
                this.displayAlertDialog('Unknown participantLogonType in cmdUnsubscribe(). participantLogonType: ' + participantLogonType);

                var msg = 'In bwAuthentication.js.cmdUnsubscribe(). Unexpected value for participantLogonType: ' + this.options.participantLogonType + ', participantId: ' + this.options.participantId + ', participantEmail: ' + this.options.participantEmail + ', participantFriendlyName: ' + this.options.participantFriendlyName;
                console.log(msg);
                WriteToErrorLog('', msg);

            }


        } catch (e) {
            console.log('Exception in bwCoreComponent.cmdUnsubscribe(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwCoreComponent.cmdUnsubscribe(): ' + e.message + ', ' + e.stack);
        }
    },

    //getUrlParams: function () {
    //    try {
    //        console.log('In bwAuthentication.js.getUrlParams(). window.location.href: ' + window.location.href);
    //        //alert('In bwAuthentication.js.getUrlParams(). window.location.href: ' + window.location.href);

    //        var urlParams = {};
    //        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
    //            urlParams[key] = decodeURIComponent(value);
    //        });
    //        return urlParams;
    //    } catch (e) {
    //        console.log('Exception in bwAuthentication.js.getUrlParams(): ' + e.message + ', ' + e.stack);
    //        displayAlertDialog('Exception in bwAuthentication.js.getUrlParams(): ' + e.message + ', ' + e.stack);
    //    }
    //},
    getUrlParams: function (urlParam) {
        try {
            console.log('In bwAuthentication.js.getUrlParams("' + urlParam + '").');

            var urlParams = {};
            var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
                urlParams[key] = decodeURIComponent(value);
            });

            var param1, param2, param3;
            param1 = urlParams[urlParam];
            if (param1) {
                param2 = param1.toString().split('#');
                if (param2 && param2.length && (param2.length > 0)) {
                    param3 = param2[0];
                }
            }
            // This is how we used to do it: openrequest = $('.bwAuthentication').bwAuthentication('getUrlParams', 'openrequest'); //)['openrequest'].toString().split('#')[0];
            // Now we do it like: var openrequest = $('.bwAuthentication').bwAuthentication('getUrlParams', 'openrequest');

            return param3; //urlParams;

        } catch (e) {
            console.log('Exception in bwAuthentication.js.getUrlParams(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.getUrlParams(): ' + e.message + ', ' + e.stack);
        }
    },

    getActiveStateIdentifier: function () {
        try {
            console.log('In bwAuthentication.js.getActiveStateIdentifier(). window.location.href: ' + window.location.href);
            //alert('In bwAuthentication.js.getUrlParams(). window.location.href: ' + window.location.href);

            // Replace this:
            //   var activeStateIdentifier = $('.bwAuthentication:first').bwAuthentication('getActiveStateIdentifier');

            // With this:
            //   This new method, getActiveStateIdentifier(), checks the querystring values for "ActiveStateIdentifier", and if that doesn't exist, then "ForestAdministratorLoginToTenant_ActiveStateIdentifier".
            //   var activeStateIdentifier = $('.bwAuthentication:first').bwAuthentication('getActiveStateIdentifier');

            var urlParams = {};
            var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
                urlParams[key] = decodeURIComponent(value);
            });

            var activeStateIdentifierJson;
            if (urlParams["ActiveStateIdentifier"]) {

                var bwActiveStateIdentifier_FromLocalStorage = localStorage.getItem('bwActiveStateIdentifier');
                console.log('In bwAuthentication.js.getActiveStateIdentifier(). bwActiveStateIdentifier_FromLocalStorage: ' + bwActiveStateIdentifier_FromLocalStorage);
                activeStateIdentifierJson = {
                    status: 'SUCCESS',
                    message: 'Found a value for ActiveStateIdentifier.',
                    ActiveStateIdentifier: urlParams["ActiveStateIdentifier"].toString().split('#')[0],
                    ActiveStateIdentifier_FromLocalStorage: bwActiveStateIdentifier_FromLocalStorage
                }

            } else if (urlParams["ForestAdministratorLoginToTenant_ActiveStateIdentifier"]) {

                activeStateIdentifierJson = {
                    status: 'SUCCESS',
                    message: 'Found a value for ForestAdministratorLoginToTenant_ActiveStateIdentifier.',
                    ForestAdministratorLoginToTenant_ActiveStateIdentifier: urlParams["ForestAdministratorLoginToTenant_ActiveStateIdentifier"].toString().split('#')[0]
                }

            } else {

                activeStateIdentifierJson = {
                    status: 'ERROR',
                    message: 'Did not find a value for ActiveStateIdentifier or ForestAdministratorLoginToTenant_ActiveStateIdentifier.'
                }

            }

            console.log('In bwAuthentication.js.getActiveStateIdentifier(). activeStateIdentifierJson: ' + JSON.stringify(activeStateIdentifierJson));

            return JSON.stringify(activeStateIdentifierJson); // Return this stringified because it gets passed subsequently in a JSON object...

        } catch (e) {
            console.log('Exception in bwAuthentication.js.getActiveStateIdentifier(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.getActiveStateIdentifier(): ' + e.message + ', ' + e.stack);
        }
    },

    displayAlertDialog: function (errorMessage) {
        try {
            document.getElementById('spanErrorMessage').innerHTML = errorMessage;
            $("#divAlertDialog").dialog({
                modal: true,
                resizable: false,
                //closeText: "Cancel",
                closeOnEscape: false, // Hit the ESC key to hide! Yeah!
                //title: 'Add a New Person',
                width: '800',
                dialogClass: "no-close", // No close button in the upper right corner.
                hide: false, // This means when hiding just disappear with no effects.
                open: function () {
                    $('.ui-widget-overlay').bind('click', function () {
                        $("#divAlertDialog").dialog('close');
                    });
                },
                close: function () {
                    //$(this).dialog('destroy').remove();
                }
            });
            $("#divAlertDialog").dialog().parents(".ui-dialog").find(".ui-dialog-titlebar").remove();
        } catch (e) {
            console.log('Exception in index.html.displayAlertDialog(): ' + e.message + ', ' + e.stack);
        }
    },

    displayCustomLogonDialog: function () {


        try {
            $("#divCustomLogonDialog").dialog('close');
        } catch (e) { }
        try {
            $("#divCustomSignUpDialog").dialog('close');
        } catch (e) { }
        try {
            $("#divCustomLogonResetPasswordDialog").dialog('close');
        } catch (e) { }
        try {
            $("#divCustomLogonResetPasswordConfirmationDialog").dialog('close');
        } catch (e) { }

        //var bwInvitationId;
        //try {
        //    bwInvitationId = getUrlParams()['invitation'].toString(); //.split('#')[0];
        //} catch (e) { }




        // Now we have to show the logon dialog box.
        $("#divCustomLogonDialog").dialog({
            modal: true,
            resizable: false,
            //closeText: "Cancel",
            closeOnEscape: false, // Hit the ESC key to hide! Yeah!
            title: 'Sign In',
            width: "720px",
            dialogClass: "no-close", // No close button in the upper right corner.
            hide: false, // This means when hiding just disappear with no effects.
            open: function (event, ui) {
                $('.ui-widget-overlay').bind('click', function () {
                    $("#divCustomLogonDialog").dialog('close');
                });
            }//, // This allows the dialog to close when clicked outside of the dialog. Only works for modal dialogs.
            //close: function (event, ui) {
            //    window.location.href = 'https://budgetworkflow.com';
            //}
        });

        $("#divCustomLogonDialog").dialog().parents(".ui-dialog").find(".ui-dialog-titlebar").remove();

        // Cookies for the custom login!
        var username = localStorage['customlogonusername']; // this.getCookie('customlogonusername');
        var password = localStorage['customlogonpassword']; //this.getCookie('customlogonpassword');
        $('#txtCustomLogonEmail').val(username);
        $('#txtCustomLogonPassword').val(password);

        //debugger; // add remember me checkbox here....
    },


    displayPasswordResetConfirmationDialog: function () {
        try {
            $("#divCustomLogonDialog").dialog('close');
        } catch (e) { }
        try {
            $("#divCustomSignUpDialog").dialog('close');
        } catch (e) { }
        try {
            $("#divCustomLogonResetPasswordDialog").dialog('close');
        } catch (e) { }
        try {
            $("#divCustomLogonResetPasswordConfirmationDialog").dialog('close');
        } catch (e) { }

        $("#divCustomLogonResetPasswordConfirmationDialog").dialog({
            modal: true,
            resizable: false,
            //closeText: "Cancel",
            closeOnEscape: false, // Hit the ESC key to hide! Yeah!
            title: 'Sign Up',
            width: "480",
            dialogClass: "no-close", // No close button in the upper right corner.
            hide: false, // This means when hiding just disappear with no effects.
            open: function (event, ui) { $('.ui-widget-overlay').bind('click', function () { $("#divCustomLogonResetPasswordConfirmationDialog").dialog('close'); }); } // This allows the dialog to close when clicked outside of the dialog. Only works for modal dialogs.
        });

        $("#divCustomLogonResetPasswordConfirmationDialog").dialog().parents(".ui-dialog").find(".ui-dialog-titlebar").remove();

    },

    cmdDisplayForgottenPasswordDialog: function () {
        try {
            $("#divCustomLogonDialog").dialog('close');
        } catch (e) { }
        try {
            $("#divCustomSignUpDialog").dialog('close');
        } catch (e) { }
        try {
            $("#divCustomLogonResetPasswordDialog").dialog('close');
        } catch (e) { }
        try {
            $("#divCustomLogonResetPasswordConfirmationDialog").dialog('close');
        } catch (e) { }

        $("#divCustomLogonResetPasswordDialog").dialog({
            modal: true,
            resizable: false,
            //closeText: "Cancel",
            closeOnEscape: false, // Hit the ESC key to hide! Yeah!
            title: 'Sign Up',
            width: "720",
            dialogClass: "no-close", // No close button in the upper right corner.
            hide: false, // This means when hiding just disappear with no effects.
            open: function (event, ui) { $('.ui-widget-overlay').bind('click', function () { $("#divCustomLogonResetPasswordDialog").dialog('close'); }); } // This allows the dialog to close when clicked outside of the dialog. Only works for modal dialogs.
        });

        $("#divCustomLogonResetPasswordDialog").dialog().parents(".ui-dialog").find(".ui-dialog-titlebar").remove();

        // Cookies for the custom login!
        var username = localStorage['customlogonusername']; //getCookie('customlogonusername');
        $('#txtCustomLogonResetPasswordEmail').val(username);

        //debugger; // add remember me checkbox here....
    },

    displayResetPasswordDialog: function (username) {
        try {
            console.log('In displayResetPasswordDialog().');

            //try {
            //    $("#divCustomLogonDialog").dialog('close');
            //} catch (e) { }
            //try {
            //    $("#divCustomSignUpDialog").dialog('close');
            //} catch (e) { }
            //try {
            //    $("#divCustomLogonResetPasswordDialog").dialog('close');
            //} catch (e) { }
            //try {
            //    $("#divCustomLogonResetPasswordConfirmationDialog").dialog('close');
            //} catch (e) { }

            var div = document.getElementById('divCustomLogonResetPasswordDialog');
            if (!div) { // for some reason this gets added twice to the DOM. Figure this out someday, but for now this seems to fix it and is a good safety I suppose.
                div = document.createElement('div');
                div.id = 'divCustomLogonResetPasswordDialog';
                div.style.display = 'none';
                document.body.appendChild(div); // to place at end of document

                var html = '';
                //html += '        <div style="display:none;" id="divCustomLogonResetPasswordDialog">';
                html += '            <table style="width:100%;">';
                html += '                <tr>';
                html += '                    <td style="width:90%;">';
                html += '                        <span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 30pt;font-weight:bold;">Reset Password</span>';
                html += '                    </td>';
                html += '                    <td style="width:9%;"></td>';
                html += '                    <td style="width:1%;cursor:pointer;vertical-align:top;">';
                html += '                        <span class="dialogXButton" style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;font-size: 30pt;font-weight:bold;" onclick="$(\'#divCustomLogonResetPasswordDialog\').dialog(\'close\');">X</span>';
                html += '                    </td>';
                html += '                </tr>';
                html += '            </table>';
                html += '            <br /><br />';
                html += '            <input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->';
                html += '            <span style="font-family: calibri;font-style:italic;">You will receive an email with instructions. For your security, use the same device to complete this password reset. It will expire in 5 minutes!</span><br /><br />';
                html += '            <span style="font-family: calibri;">Email Address</span><br />';
                html += '            <input type="text" id="txtCustomLogonResetPasswordEmail" style="WIDTH: 95%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;" /><br />';
                html += '            <br />';
                html += '            <!--<input type="checkbox" />Remember me on this device.&nbsp;<a href="">?</a><br />-->';
                html += '            <div id="xxxx" class="divSignInButton" style="width:90%;text-align:center;line-height:1.1em;font-weight:bold;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'cmdSendResetPasswordEmail\');">';
                html += '                Email Me';
                html += '            </div>';
                html += '            <br />';
                html += '            <span style="font-family: calibri;font-style:italic;">Don\'t need to do this? <a href="javascript:$(\'.bwAuthentication\').bwAuthentication(\'displaySignInDialog\', true);">Go back and Sign In.</a></span><br /><br />';
                html += '            <!--<span style="font-family: calibri;font-style:italic;"><a href="https://budgetworkflow.com">Go back to the home page.</a></span><br /><br />-->';
                //html += '        </div>';

                div.innerHTML = html;
            }

            var div = document.getElementById('divCustomLogonResetPasswordConfirmationDialog');
            if (!div) { // for some reason this gets added twice to the DOM. Figure this out someday, but for now this seems to fix it and is a good safety I suppose.
                div = document.createElement('div');
                div.id = 'divCustomLogonResetPasswordConfirmationDialog';
                div.style.display = 'none';
                document.body.appendChild(div); // to place at end of document

                var html = '';
                //html += '        <div style="display:none;" id="divCustomLogonResetPasswordConfirmationDialog">';
                html += '            <table style="width:100%;">';
                html += '                <tr>';
                html += '                    <td style="width:90%;">';
                html += '                        <span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 30pt;font-weight:bold;">Reset Password</span>';
                html += '                    </td>';
                html += '                    <td style="width:9%;"></td>';
                html += '                    <td style="width:1%;cursor:pointer;vertical-align:top;">';
                html += '                        <span class="dialogXButton" style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;font-size: 30pt;font-weight:bold;" onclick="$(\'#divCustomLogonResetPasswordConfirmationDialog\').dialog(\'close\');">X</span>';
                html += '                    </td>';
                html += '                </tr>';
                html += '            </table>';
                html += '            <br /><br />';
                html += '            <input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->';
                html += '            <span style="font-family: calibri;font-style:italic;">We have confirmed you are using the same device to complete this password reset.</span>';
                html += '            <br /><br />';
                html += '            <span style="font-family: calibri;">Choose a new password (4-15 characters)</span><br />';
                html += '            <input type="password" id="txtCustomResetPassword" style="WIDTH: 95%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;" /><br />';
                html += '            <br />';
                html += '            <br />';
                html += '            <!--<input type="checkbox" />Remember me on this device.&nbsp;<a href="">?</a><br />-->';
                html += '            <div id="xxxx" class="divSignInButton" style="width:90%;text-align:center;line-height:1.1em;font-weight:bold;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'cmdResetPasswordNow\');">';
                html += '                Reset password now!';
                html += '            </div>';
                html += '            <br />';
                html += '            <span style="font-family: calibri;font-style:italic;">Don\'t need to do this? <a href="javascript:$(\'.bwAuthentication\').bwAuthentication(\'displayCustomLogonDialog\');">Click here to Sign In.</a></span><br /><br />';
                //html += '        </div>';

                div.innerHTML = html;
            }

            $("#divCustomLogonResetPasswordDialog").dialog({
                modal: true,
                resizable: false,
                //closeText: "Cancel",
                closeOnEscape: false, // Hit the ESC key to hide! Yeah!
                title: 'Sign Up',
                width: "720",
                dialogClass: "no-close", // No close button in the upper right corner.
                hide: false, // This means when hiding just disappear with no effects.
                open: function (event, ui) { $('.ui-widget-overlay').bind('click', function () { $("#divCustomLogonResetPasswordDialog").dialog('close'); }); } // This allows the dialog to close when clicked outside of the dialog. Only works for modal dialogs.
            });
            $("#divCustomLogonResetPasswordDialog").dialog().parents(".ui-dialog").find(".ui-dialog-titlebar").remove();

            $('#txtCustomLogonResetPasswordEmail').val(username);

        } catch (e) {
            console.log('Exception in bwAuthentication.js.displayResetPasswordDialog(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.js.displayResetPasswordDialog(): ' + e.message + ', ' + e.stack);
        }
    },

    displayCreateFreeAccountDialog: function (inviteeId, resetCachedDisplayValues) {
        try {
            console.log('In bwAuthentication.js.displayCreateFreeAccountDialog().');
            var thiz = this;

            var dialogElementId = $('.bwCircleDialog').bwCircleDialog('option', 'dialogElementId'); // >>>> STEP1: The bwCircleDialog widget manages this, so it always knows how to find it in the DOM.
            if ($('#' + dialogElementId).dialog('instance')) {
                $('#' + dialogElementId).dialog('close'); // We make sure we start with a new one!
            }

            window.scrollTo(0, 0); // Scroll to top on button click. This makes sure things render Ok, and also just seems like a nicer user experience.
            $('.bwActiveMenu').bwActiveMenu('adjustLeftSideMenu'); // This makes sure our new stretchy-left-menu redraws Ok.

            if (resetCachedDisplayValues == true) {
                this.options.OnResizeDisplayValues = null;
            }

            var html = '';

            if (this.options.OnResizeDisplayValues != null && this.options.OnResizeDisplayValues.Html) {
                html = this.options.OnResizeDisplayValues.Html;
            } else {
                html += '<div style="" xcx="xcx9809-2" id="divCustomSignUpDialog">';
                html += '        <table style="width:100%;">';
                html += '            <tr>';
                html += '                <td style="width:90%;">';


                html += '                   <span style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 30pt;font-weight:bold;">Create your account</span>';
                html += '                   <br />';
                html += '                   <span style="font-family: calibri;font-size:20pt;color:gray;">Sign up now!</span>';


                html += '                </td>';
                html += '                <td style="width:9%;"></td>';
                html += '                <td style="width:1%;cursor:pointer;vertical-align:top;">';
                html += '                    <span class="dialogXButton" style="font-size:35pt;cursor:pointer;width:100%;font-weight:bold;" onclick="$(\'.bwCircleDialog\').bwCircleDialog(\'hideCircleDialog\');">X</span>';
                html += '                </td>';
                html += '            </tr>';
                html += '        </table>';
                html += '        <br /><br />';
                html += '        <input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->';
                html += '        <span id="spanCustomSignUpDialogInvitationDescriptionText" style="font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 20pt;"></span>';
                html += '        <span style="font-family: calibri;">Name</span><br />';
                html += '        <input type="text" id="txtCustomSignUpFriendlyName" style="WIDTH: 95%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;" /><br /><br />';
                html += '        <span style="font-family: calibri;">Email Address</span><br />';
                html += '        <input type="text" id="txtCustomSignUpEmail" style="WIDTH: 95%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;" /><br /><br />';
                html += '        <span style="font-family: calibri;">Choose a password (4-15 characters). <span style="color:gray;font-style:italic;">To help ensure your password is secure, include a special character, and a number, with upper and lower case characters.</span></span><br />';
                html += '        <input type="password" id="txtCustomSignUpPassword" onkeydown="return carriagereturnpress(event, \'newUserProvisioning_Custom\');" style="WIDTH: 95%;font-family: \'Segoe UI Light\',\'Segoe UI\',\'Segoe\',Tahoma,Helvetica,Arial,sans-serif;color: #262626;font-size: 20pt;" /><br />';
                html += '        <br />';
                html += '        <!--<input type="checkbox" />Remember me on this device.&nbsp;<a href="">?</a><br />-->';
                html += '        <div id="xxxx" class="divSignInButton" style="width:90%;text-align:center;line-height:1.1em;font-weight:bold;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'newUserProvisioning_Custom\');">';
                html += '            Create your account now!';
                html += '        </div>';
                html += '        <br />';
                html += '        <span style="font-family: calibri;font-style:italic;">Already have an account? <!--<a href="javascript:cmdSignInNow(\'divCustomSignUpDialog\');">Sign in now.</a>--></span>';
                html += '        <br /><br />';
                html += '        <div id="xcx121235" class="divSignInButton" style="width: 90%; text-align: center; line-height: 1.1em; font-weight: bold;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'displaySignInDialog\', true);">';
                html += '            Sign in now';
                html += '        </div>';
                html += '';
                html += '        <br /><br />';
                html += '        <!--<span style="font-family: calibri;font-style:italic;"><a href="https://budgetworkflow.com">Go back to the home page.</a></span><br /><br />-->';
                html += '    </div>'; // The height of this div determines the diameter of the bwCircleDialog. Should match displaySignInDialog().
            }

            //
            // >>>> THIS IS HOW WE should be displaying all of our circle dialogs.
            //
            $('#' + dialogElementId).html(html); // >>>> STEP2: Assign the element all of the html.
            $('#' + dialogElementId).dialog({ // >>>> STEP3: Display the dialog.
                modal: false,
                resizable: false,
                closeOnEscape: false, // Hit the ESC key to hide! Yeah!
                width: '550',
                dialogClass: 'no-close', // No close button in the upper right corner.
                hide: false, // This means when hiding just disappear with no effects.
                position: {
                    my: 'center top', at: 'center top+150', of: window
                },
                close: function () {
                    $('#' + dialogElementId).dialog('destroy');
                },
                open: function () {
                    try {
                        $('.bwCircleDialog').bwCircleDialog('displayDialog'); // >>>> STEP 4: Display the circle dialog.

                        //// Cookies for the custom login!
                        //var username = $('.bwAuthentication').bwAuthentication('getCookie', 'customlogonusername');
                        //var password = $('.bwAuthentication').bwAuthentication('getCookie', 'customlogonpassword');
                        //var rememberme = $('.bwAuthentication').bwAuthentication('getCookie', 'customlogonrememberme');

                        //$('#txtCustomLogonEmail').val(username);
                        //$('#txtCustomLogonPassword').val(password);
                        //if (rememberme == 'selected') {
                        //    // This auto-logs in the user.
                        //    thiz.logonWith_BudgetWorkflow_SwitchToDesktopVersion();
                        //} else {
                        //    document.getElementById('cbCustomLogonRememberMe').checked = false;
                        //}
                    } catch (e) {
                        console.log('Exception in bwAuthentication.displayCreateFreeAccountDialog():2: ' + e.message + ', ' + e.stack);
                        displayAlertDialog('Exception in bwAuthentication.displayCreateFreeAccountDialog():2: ' + e.message + ', ' + e.stack);
                    }
                }
            });



























            //// This replaces this url: my.html?logontype=createaccount

            //// Make sure the Sign In dialog is closed.
            //try {
            //    $("#divCustomLogonDialog").dialog('close');
            //} catch (e) { }
            //try {
            //    $("#divCustomSignUpDialog").dialog('close');
            //} catch (e) { }
            //try {
            //    $("#divCustomLogonResetPasswordDialog").dialog('close');
            //} catch (e) { }
            //try {
            //    $("#divCustomLogonResetPasswordConfirmationDialog").dialog('close');
            //} catch (e) { }


            //$("#divCustomSignUpDialog").dialog({
            //    modal: true,
            //    resizable: false,
            //    //closeText: "Cancel",
            //    closeOnEscape: false, // Hit the ESC key to hide! Yeah!
            //    title: 'Sign Up',
            //    width: "720",
            //    dialogClass: "no-close", // No close button in the upper right corner.
            //    hide: false, // This means when hiding just disappear with no effects.
            //    open: function (event, ui) { $('.ui-widget-overlay').bind('click', function () { $("#divCustomSignUpDialog").dialog('close'); }); } // This allows the dialog to close when clicked outside of the dialog. Only works for modal dialogs.
            //});

            //$("#divCustomSignUpDialog").dialog().parents(".ui-dialog").find(".ui-dialog-titlebar").remove();

        } catch (e) {
            console.log('Exception in bwAuthentication.displayCreateFreeAccountDialog(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in bwAuthentication.displayCreateFreeAccountDialog(): ' + e.message + ', ' + e.stack);
        }
    },



    logonWith_BudgetWorkflow_SwitchToMobileVersion: function () {
        try {
            // This is used for redirecting to the mobile version.
            console.log('In logonWith_BudgetWorkflow_SwitchToMobileVersion().');
            //alert('This functionality is incomplete. Coming soon! In logonWith_BudgetWorkflow_SwitchToMobileVersion().');
            //var proceed = confirm('Mobile functionality is incomplete, but you can proceed if you wish...');
            //if (proceed) {
            var thiz = this;
            var userEmailAddress = localStorage['customlogonusername']; //this.getCookie('customlogonusername');
            var userPassword = localStorage['customlogonpassword']; //this.getCookie('customlogonpassword');
            var data = [];
            data = {
                userEmailAddress: userEmailAddress,
                userPassword: userPassword
            };
            //debugger;
            var operationUri = webserviceurl + "/bwworkflow/usercustomlogon";
            $.ajax({
                url: operationUri,
                timeout: ajaxTimeout,
                type: "POST",
                data: data,
                headers: {
                    "Accept": "application/json; odata=verbose"
                },
                success: function (data) {
                    //displayAlertDialog(data);

                    if (data.message != 'The password is correct') {
                        displayAlertDialog(data.message);
                    } else {

                        // Cookie!
                        //thiz.setCookie('customlogonusername', userEmailAddress, 30);
                        //thiz.setCookie('customlogonpassword', userPassword, 30);

                        var bwActiveStateIdentifier = data.bwActiveStateIdentifier;
                        //debugger; // Switch to mobile version!
                        var location = appweburl + '/ios8.html?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                        console.log('xcx6Setting window.location: ' + location);
                        //debugger;
                        window.location = location;

                    }
                },
                error: function (data, errorCode, errorMessage) {
                    // "readyState":0,"responseText":"","status":0,"statusText":"error"
                    // Todd 10-14-17: This first if statement may not be necessary, but I can't replicate the issue so I am leaving it here.
                    //if (data.readyState == 0 && data.status == 0 && data.statusText == 'error') {
                    //    displayAlertDialog('Our back end web server is not responding. Please try again in a few minutes.');
                    //} else 
                    //if (JSON.stringify(data).toUpperCase().indexOf('ERROR 503 SERVICE UNAVAILABLE') > -1) {
                    //    displayAlertDialog('Our back end web server is not responding. Please try again in a few minutes.');
                    //    WriteToErrorLog('LOGIN FAILURE1!!!!!!!!!!! Error in index.js.logonWith_BudgetWorkflow().usercustomlogon: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                    //} else {
                    //    displayAlertDialog('Error in usercustomlogon. Incorrect .js file version: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                    //    WriteToErrorLog('Error in usercustomlogon. Incorrect .js file version: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                    //}

                    if (errorCode === "timeout") {
                        //alert("got timeout");
                        displayAlertDialog('Our back end server/database is not responding. Please try again in a few minutes.');
                        WriteToErrorLog('LOGIN FAILURE1!!!!!!!!!!! Error in bwAuthentication.logonWith_BudgetWorkflow_SwitchToMobileVersion(): ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));

                    } else if (JSON.stringify(data).toUpperCase().indexOf('ERROR 503 SERVICE UNAVAILABLE') > -1) {
                        displayAlertDialog('Our back end database is not responding. Please try again in a few minutes.');
                        WriteToErrorLog('LOGIN FAILURE1!!!!!!!!!!! Error in bwAuthentication.logonWith_BudgetWorkflow_SwitchToMobileVersion(): ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                    } else {
                        displayAlertDialog('Error in bwAuthentication.logonWith_BudgetWorkflow(). Incorrect .js file version:2: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                        WriteToErrorLog('Error in bwAuthentication.logonWith_BudgetWorkflow_SwitchToMobileVersion(). Incorrect .js file version: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                    }
                }
            });
            //}
        } catch (e) {
            console.log('Exception in logonWith_BudgetWorkflow_SwitchToMobileVersion(): ' + e.message + ', ' + e.stack);
        }
    },

    logonWith_BudgetWorkflow_SwitchToDesktopVersion: function () {
        try {
            // This is used for redirecting to the mobile version.
            console.log('In logonWith_BudgetWorkflow_SwitchToDesktopVersion().');
            var thiz = this;
            var userEmailAddress = localStorage['customlogonusername']; //this.getCookie('customlogonusername');
            var userPassword = localStorage['customlogonpassword']; //this.getCookie('customlogonpassword');
            var data = [];
            data = {
                userEmailAddress: userEmailAddress,
                userPassword: userPassword
            };
            var operationUri = this.options.operationUriPrefix + "_bw/bwworkflow/usercustomlogon";
            $.ajax({
                url: operationUri,
                type: "POST",
                data: data,
                headers: {
                    "Accept": "application/json; odata=verbose"
                },
                success: function (data) {
                    //displayAlertDialog(data);

                    if (data.message != 'The password is correct') {
                        if (!data.message) {
                            displayAlertDialog('Error in logonWith_BudgetWorkflow_SwitchToDesktopVersion(). data.message: ' + data.message);
                        } else {
                            displayAlertDialog(data.message);
                        }
                    } else {

                        // Cookie!
                        //thiz.setCookie('customlogonusername', userEmailAddress, 30);
                        //thiz.setCookie('customlogonpassword', userPassword, 30);

                        var bwActiveStateIdentifier = data.bwActiveStateIdentifier;

                        //debugger;
                        var location;
                        //if (window.location.indexOf('my.html') > -1) {
                        location = appweburl + '?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                        //} else if (window.location.indexOf('ios8.html') > -1) {
                        //    location = appweburl + '/ios8.html?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                        //} else {
                        //    displayAlertDialog('Error xcx4: Unexpected window.location. This process cannot proceed.');
                        //}
                        console.log('xcx7Setting window.location: ' + location);

                        //thiz.setCookie('userselecteddeviceplatform', 'DESKTOP');

                        //debugger;
                        window.location = location;

                        //var location = appweburl + '/my.html?ActiveStateIdentifier=' + bwActiveStateIdentifier;
                        //window.location = location;

                    }
                },
                error: function (data, errorCode, errorMessage) {
                    // "readyState":0,"responseText":"","status":0,"statusText":"error"
                    // Todd 10-14-17: This first if statement may not be necessary, but I can't replicate the issue so I am leaving it here.
                    //if (data.readyState == 0 && data.status == 0 && data.statusText == 'error') {
                    //    displayAlertDialog('Our back end web server is not responding. Please try again in a few minutes.');
                    //} else 
                    //if (JSON.stringify(data).toUpperCase().indexOf('ERROR 503 SERVICE UNAVAILABLE') > -1) {
                    //    displayAlertDialog('Our back end web server is not responding. Please try again in a few minutes.');
                    //    WriteToErrorLog('LOGIN FAILURE1!!!!!!!!!!! Error in index.js.logonWith_BudgetWorkflow().usercustomlogon: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                    //} else {
                    //    displayAlertDialog('Error in usercustomlogon. Incorrect .js file version: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                    //    WriteToErrorLog('Error in usercustomlogon. Incorrect .js file version: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                    //}

                    if (errorCode === "timeout") {
                        //alert("got timeout");
                        displayAlertDialog('Our back end server/database is not responding. Please try again in a few minutes.');
                        WriteToErrorLog('LOGIN FAILURE1!!!!!!!!!!! Error in bwAuthentication.logonWith_BudgetWorkflow_SwitchToDesktopVersion(): ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));

                    } else if (JSON.stringify(data).toUpperCase().indexOf('ERROR 503 SERVICE UNAVAILABLE') > -1) {
                        displayAlertDialog('Our back end database is not responding. Please try again in a few minutes.');
                        WriteToErrorLog('LOGIN FAILURE1!!!!!!!!!!! Error in bwAuthentication.logonWith_BudgetWorkflow_SwitchToDesktopVersion(): ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                    } else {
                        displayAlertDialog('Error in bwAuthentication.logonWith_BudgetWorkflow(). Incorrect .js file version:3: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                        WriteToErrorLog('Error in bwAuthentication.logonWith_BudgetWorkflow_SwitchToDesktopVersion(). Incorrect .js file version: ' + operationUri + ', ' + errorCode + ', ' + errorMessage + ', ' + JSON.stringify(data));
                    }
                }
            });
        } catch (e) {
            console.log('Exception in logonWith_BudgetWorkflow_SwitchToDesktopVersion(): ' + e.message + ', ' + e.stack);
            displayAlertDialog('Exception in logonWith_BudgetWorkflow_SwitchToDesktopVersion(): ' + e.message + ', ' + e.stack);
        }
    },



    initializeTheForm_Mobile: function () {
        try {
            //debugger;
            // When a user clicks the back or refresh button, this is the additional message to the "Do you want to leave this page?" dialog.
            // Todd: THIS DOESN'T WORK FOR IOS!!!
            //window.onbeforeunload = function (event) {
            //    return 'You may have to login again.';
            //};





            //var data = [];
            //data = {
            //    logonProvider: participantLogonType,
            //    logonId: participantLogonTypeUserId,
            //    participantFriendlyName: participantFriendlyName,
            //    participantEmail: participantEmail,
            //    appweburl: appweburl
            //};
            ////var operationUri = appweburl + "/getparticipantdetails/" + participantLogonType + "/" + participantLogonTypeUserId.toString() + "/" + participantFriendlyName + "/" + participantEmail;
            //var operationUri = webserviceurl + "/getparticipantdetails";
            //$.ajax({
            //    url: operationUri,
            //    type: "POST", timeout: ajaxTimeout,
            //    data: data,
            //    headers: {
            //        "Accept": "application/json; odata=verbose"
            //    },
            //    success: function (userData) {
            //        try {
            //            debugger;
            //            tenantId = userData.participant.bwTenantId; // global. todd this needs to accomodate multiple tenant membership eventually.
            //            workflowAppId = userData.participant.bwLastSelectedWorkflowAppId;




            // DOING THIS FOR NOW FIX SOON!
            // Load bwEnabledRequestTypes.
            //
            // This get loaded up too much! So initializing here.... This may be an indicator that the loading should not have to happen for this.... not sure. 3-1-2020
            //bwEnabledRequestTypes.EnabledItems = [];
            //if (true) {
            //    bwEnabledRequestTypes.Details.BudgetRequests.Enabled = true; // Todd: We need to create a spot in the database for this, and add a settings slider....
            //    var request = ['budgetrequest', 'Budget Request', 'selected'];
            //    bwEnabledRequestTypes.EnabledItems.push(request);
            //}
            //if (true) {
            //    bwEnabledRequestTypes.Details.CapitalPlanProjects.Enabled = true; // Todd: We need to create a spot in the database for this, and add a settings slider....
            //    var request = ['capitalplanproject', 'Capital Plan Project', ''];
            //    bwEnabledRequestTypes.EnabledItems.push(request);
            //}
            //if (true) { //userData.participant.participantWorkflowApps[wa].bwQuotingEnabled == 'true') {
            //    bwEnabledRequestTypes.Details.QuoteRequests.Enabled = true;
            //    var request = ['quoterequest', 'Quote Request', ''];
            //    bwEnabledRequestTypes.EnabledItems.push(request);
            //}
            //if (true) { //userData.participant.participantWorkflowApps[wa].bwExpenseRequestsEnabled == 'true') {
            //    bwEnabledRequestTypes.Details.ReimbursementRequests.Enabled = true;
            //    var request = ['expenserequest', 'Reimbursement Request', ''];
            //    bwEnabledRequestTypes.EnabledItems.push(request);

            //}
            //if (true) { //userData.participant.participantWorkflowApps[wa].bwRecurringExpensesEnabled == 'true') {
            //    bwEnabledRequestTypes.Details.RecurringExpenses.Enabled = true;
            //    var request = ['recurringexpense', 'Recurring Expense', ''];
            //    bwEnabledRequestTypes.EnabledItems.push(request);
            //}
            //if (true) {
            //    bwEnabledRequestTypes.Details.WorkOrders.Enabled = true; // Todd: We need to create a spot in the database for this, and add a settings slider....
            //    var request = ['workorder', 'Work Order', ''];
            //    bwEnabledRequestTypes.EnabledItems.push(request);
            //}









            //        } catch (e) {
            //            console.log('Exception in bwAuthentication.initializeTheForm_Mobile(): ' + e.message + ', ' + e.stack);
            //        }
            //    },
            //    error: function (data, errorCode, errorMessage) {
            //        //displayAlertDialog('Error in Start.js.displayConnectedWorkflows()', '1:' + errorCode + ', ' + errorMessage);
            //        displayAlertDialog('There has been an error contacting the server.\n\n' + errorMessage); // + ' data:' + data);
            //    }
            //});






























            //$('#bwStartPageAccordion').show();

            //$('#liWelcome').show();
            //$('#liNewRequest').hide();
            //$('#liArchive').hide();
            //$('#liSummaryReport').hide();
            //$('#liConfiguration').hide();
            //$('#liHelp').hide();

            //try {
            //    document.getElementById('spanNotLoggedInBetaBanner').style.display = 'none';
            //    document.getElementById('spanLoggedInBetaBanner').style.display = 'block';
            //} catch (e) { }

            //var financialOrParticipantSummaryOptions = {
            //    checked: false, // DEFAULT TO THE FINANCIAL SUMMARY. This fixes an issue when the participant summary is rendered first. The participant summary relies on the financial summary being rendered first.
            //    show_labels: true,         // Should we show the on and off labels?
            //    labels_placement: "both",  // Position of the labels: "both", "left" or "right"
            //    on_label: "Participant<br />Summary",            // Text to be displayed when checked
            //    off_label: "Financial<br />Summary",          // Text to be displayed when unchecked
            //    width: 50,                 // Width of the button in pixels
            //    height: 22,                // Height of the button in pixels
            //    button_width: 24,         // Width of the sliding part in pixels
            //    clear_after: null         // Override the element after which the clearing div should be inserted 
            //};
            //$("input#financialOrParticipantSummary").switchButton(financialOrParticipantSummaryOptions);

            ////setCustomSizesDependingOnTheDevice();

            //$('#financialOrParticipantSummary').change(function () {


            //    //displayAlertDialog('financialOrParticipantSummary.change()');


            //    if (!$('#financialOrParticipantSummary').is(':checked')) {
            //        if (!$('#budgetRequestsOrQuotes').is(':checked')) {
            //            renderFinancialSummary9(false);
            //        } else if ($('#budgetRequestsOrQuotes').is(':checked')) {
            //            renderFinancialSummary9(true);
            //        } else {
            //            displayAlertDialog('budgetRequestsOrQuotes is in an invalid state.');
            //        }
            //    } else if ($('#financialOrParticipantSummary').is(':checked')) {
            //        if (!$('#budgetRequestsOrQuotes').is(':checked')) {
            //            renderParticipantSummary(false);
            //        } else if ($('#budgetRequestsOrQuotes').is(':checked')) {
            //            renderParticipantSummary(true);
            //        } else {
            //            displayAlertDialog('budgetRequestsOrQuotes is in an invalid state.');
            //        }
            //    } else {
            //        displayAlertDialog('financialOrParticipantSummary is in an invalid state.');
            //    }
            //});

            //setCustomSizesDependingOnTheDevice();

            //populateTheYearDropdown('false');



            //addInLicenseCheck(); // Todd: If you uncomment this line of code, the license check will proceed.


            // Initialize the date pickers.
            //displayAlertDialog('initializeTheForm');
            //$('#dtEstimatedStartDate').datepicker(); // todd commented out 11-15-19
            //$('#dtEstimatedEndDate').datepicker(); // todd commented out 11-15-19
            // Create a GUID for the attachments folder name.
            //attachmentsFolderName = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) { // todd commented out 11-15-19
            //    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
            //    return v.toString(16);
            //});
            //initializePeoplePicker('peoplePicker');
            //populateYear(); 
            //tenantId = '1';
            //var year = 2016;
            //var year = new Date().getFullYear().toString(); // todd hardcoded. // todd commented out 11-15-19
            //$("<option value=\"" + year.toString() + "\" selected>" + year.toString() + "</option>").appendTo($('#ddlYear'));


            //GetWorkflowAppConfigurationData9 = $.Deferred();
            //GetWorkflowAppConfigurationData9
            //    .done(function () {
            //        //displayAlertDialog('DONE');
            //        selectArchivePageFilterDropDown_change();
            //        renderLeftButtons('divArchivePageLeftButtons');
            //    })
            //    .fail(function () {
            //        handleExceptionWithAlert('Error in my.js.populateStartPageItem(divFunctionalAreas)', 'GetWorkflowAppConfigurationData9.fail()');
            //    });
            //loadWorkflowAppConfigurationDetails9();



            //renderWelcomeScreen();



            //var checkThatTheFormHasRenderedAndTheGlobalVariablesArePopulated = function () { // This ugliness will go away as we build in promises a bit better.
            //    setTimeout(function () {

            //        if (tenantId) {
            //            console.log('Calling resolve() in checkThatTheFormHasRenderedAndTheGlobalVariablesArePopulated().');


            //            //debugger; // we should have participantId by the time we get here!!!
            //            var options = {
            //                bwTenantId: tenantId,
            //                bwWorkflowAppId: workflowAppId,
            //                bwWorkflowAppTitle: workflowAppTitle,
            //                bwParticipantId: participantId,
            //                bwParticipantEmail: participantEmail,
            //                bwParticipantFriendlyName: participantFriendlyName,
            //                bwEnabledRequestTypes: bwEnabledRequestTypes
            //            };
            //            var $bwCoreComponent = $('#divBwCoreComponent').bwCoreComponent(options);

            //            $('#divBwCoreComponent').bwCoreComponent('loadWorkflowAppConfigurationDetails9');

            //            var options = {
            //                bwTenantId: tenantId,
            //                bwWorkflowAppId: workflowAppId,
            //                bwParticipantId: participantId,
            //                bwParticipantEmail: participantEmail,
            //                bwParticipantFriendlyName: participantFriendlyName,
            //                bwEnabledRequestTypes: bwEnabledRequestTypes
            //            };
            //            var $bwRequest = $("#divBwRequest").bwRequest(options);


            //            var printButtonOptions = {
            //                reportType: 'MyPendingTasksReport'
            //            };
            //            var $printbutton = $('#divBwPrintButton').bwPrintButton(printButtonOptions);



            //            // Log the page hit! When a user gets here, we are considering it a new logon.
            //            try {
            //                //debugger;
            //                var data = [];
            //                data = {
            //                    bwTenantId: tenantId,
            //                    bwWorkflowAppId: workflowAppId,
            //                    bwWebsiteTrafficLogUserLogonType: participantLogonType,
            //                    bwWebsiteTrafficLogUserLogonTypeId: participantLogonTypeUserId,
            //                    bwParticipantId: participantId,
            //                    bwParticipantFriendlyName: participantFriendlyName,
            //                    bwParticipantEmail: participantEmail
            //                };
            //                var operationUri = webserviceurl + "/logonactivityvisitorcounter";
            //                $.ajax({
            //                    url: operationUri,
            //                    type: "POST", timeout: ajaxTimeout,
            //                    data: data,
            //                    headers: {
            //                        "Accept": "application/json; odata=verbose"
            //                    },
            //                    success: function (data) {
            //                        //displayAlertDialog(data);
            //                    },
            //                    error: function (data, errorCode, errorMessage) {
            //                        //displayAlertDialog('Error in my.js.cmdUnsubscribe():1:' + errorMessage + ' ' + JSON.stringify(data));
            //                        //WriteToErrorLog('Error in InitBudgetRequest.js.cmdCreateBudgetRequest()', 'Error creating the budget request in budgetrequests library: ' + errorCode + ', ' + errorMessage);
            //                    }
            //                });
            //            } catch (e) {
            //                // Do nothing, just ignore it!
            //            }










            //            //debugger;
            //            //var options = {
            //            //    bwTenantId: tenantId,
            //            //    bwWorkflowAppId: workflowAppId,
            //            //    bwWorkflowAppTitle: workflowAppTitle,
            //            //    bwParticipantId: participantId,
            //            //    bwParticipantEmail: participantEmail,
            //            //    bwParticipantFriendlyName: participantFriendlyName,
            //            //    bwEnabledRequestTypes: bwEnabledRequestTypes
            //            //};
            //            //var $bwCoreComponent = $('#divBwCoreComponent').bwCoreComponent(options);





            //            //debugger;
            //            //var options = {
            //            //    bwTenantId: tenantId,
            //            //    bwWorkflowAppId: workflowAppId,
            //            //    bwParticipantId: participantId,
            //            //    bwParticipantEmail: participantEmail,
            //            //    bwParticipantFriendlyName: participantFriendlyName,
            //            //    bwEnabledRequestTypes: bwEnabledRequestTypes
            //            //};
            //            //var $bwRequest = $("#divBwRequest").bwRequest(options);




            //            //resolve();
            //        } else {
            //            //debugger;
            //            checkThatTheFormHasRenderedAndTheGlobalVariablesArePopulated();
            //        }
            //        // Do Something Here
            //        // Then recall the parent function to
            //        // create a recursive loop.

            //    }, 1000);
            //}
            //checkThatTheFormHasRenderedAndTheGlobalVariablesArePopulated();

        } catch (e) {
            handleExceptionWithAlert('Error in initializeTheForm()', e.message + ', ' + e.stack);
        }
    },

    initializeTheLogonForParticipantIdAndDisplayUnsubscribePage: function (participantId) {
        try {
            console.log('In bwAuthentication.js.initializeTheLogonForParticipantIdAndDisplayUnsubscribePage(). participantId: ' + participantId);
            alert('In bwAuthentication.js.initializeTheLogonForParticipantIdAndDisplayUnsubscribePage(). participantId: ' + participantId);

            // 1. Get the logontype.
            var thiz = this;
            var logontype;
            var operationUri = webserviceurl + "/getparticipantlogontype/" + participantId;
            $.ajax({
                url: operationUri,
                method: "GET",
                headers: {
                    "Accept": "application/json; odata=verbose"
                },
                success: function (data) {
                    logontype = data[0].bwParticipantLogonType; //JSON.stringify(data); //.bwParticipantLogonType;
                    //displayAlertDialog('In initializeTheLogonForParticipantIdAndDisplayUnsubscribePage logontype:' + logontype);

                    if (logontype == 'facebook') {
                        //displayAlertDialog('FACEBOOK LOGON TYPE');
                        window.fbAsyncInit = function () {
                            FB.init({
                                appId: '39139756228',
                                cookie: true,  // enable cookies to allow the server to access
                                // the session
                                xfbml: true,  // parse social plugins on this page
                                version: 'v2.2' // use version 2.2
                            });

                            // Now that we've initialized the JavaScript SDK, we call
                            // FB.getLoginStatus().  This function gets the state of the
                            // person visiting this page and can return one of three states to
                            // the callback you provide.  They can be:
                            //
                            // 1. Logged into your app ('connected')
                            // 2. Logged into Facebook, but not your app ('not_authorized')
                            // 3. Not logged into Facebook and can't tell if they are logged into
                            //    your app or not.
                            //
                            // These three cases are handled in the callback function.

                            //FB.getLoginStatus(function (response) {
                            //    facebookStatusChangeCallback(response);
                            //});
                            checkFbLoginState();
                        };
                        // Load the SDK asynchronously
                        (function (d, s, id) {
                            var js, fjs = d.getElementsByTagName(s)[0];
                            if (d.getElementById(id)) return;
                            js = d.createElement(s); js.id = id;
                            js.src = "//connect.facebook.net/en_US/sdk.js";
                            fjs.parentNode.insertBefore(js, fjs);
                        }(document, 'script', 'facebook-jssdk'));
                    } else if (logontype == 'microsoft') {
                        //displayAlertDialog('MICROSOFT LOGON TYPE');
                        var uri = window.location.href;
                        var part1 = uri.split('#')[1];
                        var part2 = part1.split('access_token=')[1];
                        var accessToken = part2.split('&')[0];
                        var url = 'https://apis.live.net/v5.0/me?access_token=' + accessToken; //ACCESS_TOKEN';
                        $.ajax({
                            url: url,
                            method: "GET",
                            headers: {
                                "Accept": "application/json; odata=verbose"
                            },
                            success: function (data) {
                                participantLogonType = 'microsoft';
                                participantLogonTypeUserId = data.id;
                                participantFriendlyName = data.name;
                                //participantEmail = response.email;

                                //debugger;
                                thiz.loadRemainingJsAndCssAndBWMData(); // loadRemainingJsAndCssAndBWMData xcx4
                            },
                            error: function (data, errorCode, errorMessage) {
                                displayAlertDialog('Error:' + errorCode + ':' + errorMessage + ':' + JSON.stringify(data));
                                //WriteToErrorLog('Error in bw.assignbudget.js.cmdRejectRequest_AssignBudget()', 'Error accessing the functional areas: ' + errorCode + ', ' + errorMessage);
                            }
                        });
                    } else if (logontype == 'google') {

                        alert('xcx88653-7 DEV:Check code.');

                        var title = 'Google logon...';
                        var unsubscribe = '';
                        try {
                            unsubscribe = this.getUrlParams()["unsubscribe"].toString().split('#')[0];
                        } catch (e) {
                        }
                        if (unsubscribe != '') {
                            // Include the ability to instantly unsubscribe.
                            var html = '';
                            html += '<hr>It would be better if you can log in prior to completing your email unsubscribe request, but if you prefer to do it now <br />';
                            html += 'then you can <a href="javascript:cmdForceUnsubscribe();">Click here to unsubscribe</a><br /><br />';
                            html += '<hr>';
                            html += '<i>You will receive a confirmation email. We send this out to ensure you have authorized this request.<br /><br />';
                            html += 'We will also send emails to the participants of the workflow so they know you won\'t be participating in the workflows.</i>';

                            title = 'Unsubscribe...';
                            $("#divGoogleLogonButtonUnsubscribeOptions").html(html);
                            $("#divGoogleLogonButtonUnsubscribeOptions").show();
                        }





                        $("#divGoogleLogonButton").dialog({
                            modal: true,
                            resizable: false,
                            closeText: "Cancel",
                            closeOnEscape: true, // Hit the ESC key to hide! Yeah!
                            title: title, //'Google logon...',
                            width: "650px",
                            dialogClass: "no-close", // No close button in the upper right corner.
                            hide: false//, // This means when hiding just disappear with no effects.
                            //buttons: {
                            //    "Close": function () {
                            //        $(this).dialog("close");
                            //    }
                            //}
                        });
                        var loginFinished = function (authResult) {
                            //displayAlertDialog('logged in1');
                            //if (authResult) {
                            //    displayAlertDialog(authResult);
                            //}
                            //displayAlertDialog('logged in2');
                            gapi.client.load('oauth2', 'v2', function () {
                                //displayAlertDialog('logged in3');
                                gapi.client.oauth2.userinfo.get().execute(function (resp) {
                                    //displayAlertDialog('logged in4');
                                    participantLogonType = 'google';
                                    participantLogonTypeUserId = resp.id;
                                    participantFriendlyName = resp.name;
                                    participantEmail = resp.email;
                                    try {
                                        $("#divGoogleLogonButton").dialog('close');
                                    } catch (e) {
                                    }
                                    //displayAlertDialog('gggg');
                                    if (participantLogonTypeUserId) {
                                        //debugger;
                                        thiz.loadRemainingJsAndCssAndBWMData(); // loadRemainingJsAndCssAndBWMData xcx5
                                    } else {
                                        // No id was issued, so redirect back to the index page.
                                        console.log('xcx8Setting window.location: ' + location);
                                        alert('In bwAuthentication.js.xx(). setting window.location!! xcx343245342-8');
                                        window.location = 'index.html';

                                    }
                                });
                            });
                        };
                        var options = {
                            'callback': loginFinished,
                            'approvalprompt': 'force',
                            'clientid': googleOAuth2ClientId,
                            'scope': 'https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email',
                            'requestvisibleactions': 'http://schemas.google.com/CommentActivity http://schemas.google.com/ReviewActivity',
                            'cookiepolicy': 'single_host_origin'
                        };
                        var renderBtn = function () {
                            gapi.signin.render('renderMe', options);
                        }
                        renderBtn();
                    }
                },
                error: function (data, errorCode, errorMessage) {
                    //handleExceptionWithAlert('Error in Start.js.displayConnectedWorkflows()', '1:' + errorCode + ', ' + errorMessage);
                    displayAlertDialog('You have no internet connectivity, or the website is not processing requests at this time. Additional information: Error in my.js.initializeTheLogonForParticipantIdAndDisplayUnsubscribePage():1:', errorCode + ', ' + errorMessage + ' data:' + data);
                }
            });
        } catch (e) {
            handleExceptionWithAlert('Error in my.js.initializeTheLogonForParticipantIdAndDisplayUnsubscribePage():2:', e.message);
        }
    }



});