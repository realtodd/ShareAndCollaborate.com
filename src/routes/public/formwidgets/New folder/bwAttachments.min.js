$.widget("bw.bwAttachments",{options:{elementIdSuffix:null,jsonData:null,fieldTitle:"Attachments",file:null,filename:null,max_chunk_size:null,loaded:null,reader:null,blob:null,workflowAppId:null,bwBudgetRequestId:null,description:null,allowRequestModifications:!1,renderAsARequiredField:null,inFormsEditor:null,requestDialogId:null,attachmentsAreStoredInIndexDb:null,operationUriPrefix:null,ajaxTimeout:15e3,autoSenseDeviceType:!1},_create:function(){var t,i,r,u,n;console.log("In bwAttachments.js._create().");this.element.addClass("bwAttachments");t=this;try{this.options.operationUriPrefix==null&&(i=window.location.href.split("https://")[1],r=i.split("/")[0],this.options.operationUriPrefix="https://"+r+"/");u="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)});this.options.elementIdSuffix=u;this.options.inFormsEditor==!0?(console.log("In bwAttachments.js._create().option.inFormsEditor == true."),this.renderAndPopulateAttachments_ReadOnly()):this.options.allowRequestModifications==!1?(console.log("In bwAttachments.js._create().option.allowRequestModifications == false."),this.renderAndPopulateAttachments_ReadOnly()):this.options.allowRequestModifications==!0?(console.log("In bwAttachments.js._create().option.allowRequestModifications == true."),this.renderAndPopulateAttachments()):(n="",n+='<span style="font-size:24pt;color:red;">CANNOT RENDER bwAttachments<\/span>',n+="<br />",n+='<span style="">Invalid value for allowRequestModifications: '+this.options.allowRequestModifications+"<\/span>",this.element.html(n))}catch(f){n="";n+='<span style="font-size:24pt;color:red;">CANNOT RENDER bwAttachments<\/span>';n+="<br />";n+='<span style="">Exception in bwAttachments.Create(): '+f.message+", "+f.stack+"<\/span>";t.element.html(n)}},_setOption:function(n,t){this.options[n]=t;this._update()},_update:function(){try{console.log("In _update(). This does nothing! (yet)")}catch(n){console.log("Exception in _update(): "+n.message+", "+n.stack)}},_destroy:function(){this.element.removeClass("bwAttachments").text("")},getDataType:function(){try{return console.log("In bwAttachments.js.getDataType()."),"attachments"}catch(n){console.log("Exception in bwAttachments.js.getDataType(): "+n.message+", "+n.stack);alert("Exception in bwAttachments.js.getDataType(): "+n.message+", "+n.stack)}},getData:function(){try{console.log("In bwAttachments.getData().");var t=$(this.element).find("#newrequestattachments")[0].innerHTML.trim();return t!=""?"has attachments":null}catch(n){console.log("Exception in bwAttachments.getData(): "+n.message+", "+n.stack);alert("Exception in bwAttachments.getData(): "+n.message+", "+n.stack)}},isARequiredField:function(){try{return console.log("In bwAttachments.isARequiredField()."),this.options.renderAsARequiredField}catch(n){console.log("Exception in bwAttachments.isARequiredField(): "+n.message+", "+n.stack);alert("Exception in bwAttachments.isARequiredField(): "+n.message+", "+n.stack)}},getfieldTitle:function(){try{return console.log("In bwAttachments.getfieldTitle()."),this.options.fieldTitle}catch(n){console.log("Exception in bwAttachments.getfieldTitle(): "+n.message+", "+n.stack);alert("Exception in bwAttachments.getfieldTitle(): "+n.message+", "+n.stack)}},renderAndPopulateAttachments:function(){var r,t,i,e,o,f,s,n;try{if(console.log(""),console.log("##################################"),console.log("In bwAttachments.js.renderAndPopulateAttachments()."),console.log("##################################"),console.log(""),r=this,t=$(this.element).closest("#budgetrequestform")[0].getAttribute("bwbudgetrequestid"),t){i="divRequestFormDialog_"+t;$("#"+i)||(i="divCreateRequestFormContent");n="";n+='<table style="height:100%;vertical-align:top;">';n+="   <tbody>";n+='       <tr xcx="xcx21342526-1" id="xcx21342526-1" class="xdTableOffsetRow xdTableOffsetRow-editor" id="toolboxdraggablerow_2" draggable="true" bwwidgetname="bwAttachments">';n+='           <td class="xdTableOffsetCellLabel" style="text-align:left; VERTICAL-ALIGN: top; PADDING-BOTTOM: 4px; PADDING-TOP: 4px; PADDING-LEFT: 22px; BORDER-LEFT: #d8d8d8 1pt; PADDING-RIGHT: 5px;height:100%;">';n+='               <table style="height:100%;">';n+='                   <tr style="height:1%;">';n+='                       <td style="vertical-align:top;">';n+='                           <span class="xdlabel" style="color:black;">';n+="                               Attachments:";n+="                           <\/span>";this.options.renderAsARequiredField==!0?n+='                       <span style="color:red;font-size:medium;">*<\/span>':this.options.renderAsARequiredField==!1||(n+='                       <span class="ToggleRequiredAsterisk" title="Select this asterick to make this a required field." onclick="$(\'.bwFormsEditor\').bwFormsEditor(\'toggleFormRequiredField\', this);">*<\/span>');n+="                       <\/td>";n+="                   <\/tr>";n+='                   <tr style="height:99%;">';n+='                       <td style="vertical-align:top;">';/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||(n+='                           <table id="dropzone1" contenteditable="true" style="height:100%;border:1px solid goldenrod;background-color:#f6f6f6;color:gray;font-size:10pt;">',n+="                               <tr>",n+='                                   <td style="vertical-align:middle;">',n+='                                       <span style="color:goldenrod;">Drag-and-drop, or right-click to paste attachments here.<\/span>',n+="                                   <\/td>",n+="                               <\/tr>",n+="                           <\/table>");n+="                       <\/td>";n+="                   <\/tr>";n+="               <\/table>";n+="           <\/td>";n+='           <td class="xdTableOffsetCellComponent" style="white-space:nowrap;text-align:left; VERTICAL-ALIGN: top; PADDING-LEFT: 5px; PADDING-RIGHT: 22px;">';n+='               <div style="width:365px;height:55px;text-align:center;background-color:#f6f6f6;padding-left:0;">';n+='                   <label for="inputFile_'+t+'" class="divSignInButton" style="font-style:normal;width:100%;height:100%;text-align:center;line-height:1.65em;font-size:23pt;border-radius: 5px 5px 5px 5px;display:inline-block;padding-left:0;padding-top:0;">Choose file...&nbsp;&nbsp;&nbsp;&#128193;<\/label>';n+='<form id="uploadForm_'+t+'" action="/" enctype="multipart/form-data" method="post">';n+='<input type="hidden" name="bwWorkflowAppId" value="" />';n+='<input type="hidden" name="bwBudgetRequestId" value="" />';n+='<input type="hidden" name="bwParticipantId" value="" />';n+='<input type="hidden" name="bwParticipantEmail" value="" />';n+='<input type="hidden" name="bwParticipantFriendlyName" value="" />';n+='<input type="hidden" name="bwActiveStateIdentifier" value="" />';n+='<input type="hidden" name="Filename" value="" />';n+='<input type="hidden" name="Description" value="" />';n+='<input type="hidden" name="ConvertToAPdf" value="" />';console.log('The "multiple" attribute in the input/file element below turns on the ability to select multiple items for the upload. THIS IS TURNED OFF FOR THE MOMENT UNTILL WE UPGRADE THE WEB SERVICE ETC. 4-15-2023.');n+='<input type="file" name="multerFileUploadIdentifier" id="inputFile_'+t+"\" class=\"upload\" style=\"visibility:hidden;\" onchange=\"$('.bwAttachments:first').bwAttachments('uploadAttachment','newrequestattachments', '"+i+"', '"+t+"');\" />";n+="<\/form>  ";n+="           <\/div>";n+='           <p id="newrequestattachments" xcx="xcx448-1" style="word-break:break-all;white-space:normal;"><\/p>';n+="           <br />";n+="           <br />";e=$(this.element).closest("#budgetrequestform")[0].getAttribute("bwrequesttitle");o=$(this.element).closest("#budgetrequestform")[0].getAttribute("bwrequesttypeid");n+='           <input id="'+i+'_buttonEmailAttachmentsExternally" type="button" style="display:none;padding:5px 10px 5px 10px;" value="Email attachment(s) externally..." title="Email attachments to a customer using your internet facing url, which is configured in the organization settings." class="BwButton350" ';n+="               onclick=\"$('.bwAttachments:first').bwAttachments('copyAttachments','newrequestattachments', '"+i+"', '"+t+"', '"+e+"', '"+o+"');\" />";n+="                            <\/td>";n+="                        <\/tr>";n+="                    <\/tbody>";n+="<\/table>";this.options.inFormsEditor!=!0&&this.element.closest("tr").removeAttr("draggable");this.element.html(n);$(this.element).find("#newrequestattachments")[0].innerHTML='<span style="color:tomato;"><\/span>';f=$(this.element).find("#dropzone1");$(f).off("paste").on("paste",function(n){try{console.log("paste");setTimeout(function(){var f,b,e,o;try{var n=$(r.element).find("#dropzone1 img"),u=$(r.element).find("#dropzone1 img")[0].src,v="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)}),s=u.split(","),h=s[1];if(h){var y=s[0].match(/:(.*?);/)[1],c=atob(h),p=c.length,l=new ArrayBuffer(p),w=new Uint8Array(l);c.split("").forEach(function(n,t){w[t]=n.charCodeAt(0)});f=new File([l],v,{type:y});b=URL.createObjectURL(f);n.remove();e=document.getElementById("inputFile_"+t);o=new DataTransfer;o.items.add(f);e.files=o.files;console.log("fileInput.files.length: "+e.files.length);r.uploadAttachment("newrequestattachments",i,t)}else console.log("No base64 in the img src or this element. It must be a http reference... imgSrc: "+u),fetch(u).then(function(t){try{t.blob()}catch(i){alert("Exception xcx21312312 "+i.message+", "+i.stack);n.remove()}}).then(function(u){try{const o=new File([u],"dot.png",u);var f=document.getElementById("inputFile_"+t),e=new DataTransfer;e.items.add(o);f.files=e.files;console.log("fileInput.files.length: "+f.files.length);n.remove();r.uploadAttachment("newrequestattachments",i,t)}catch(o){alert("Exception xcx215343 "+o.message+", "+o.stack);n.remove()}}).catch(function(t){alert("Exception from psomise xcx87987 "+t+', Exception when fetching "'+u+'".');n.remove()})}catch(a){alert("Exception in xcx1214124: "+a.message+", "+a.stack)}},1e3)}catch(n){alert("Exception xcx123124235: "+n.message+", "+n.stack)}});$(f).off("drop").on("drop",function(n){try{console.log("drop");setTimeout(function(){var f,b,e,o;try{var n=$(r.element).find("#dropzone1 img"),u=$(r.element).find("#dropzone1 img")[0].src,v="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)}),s=u.split(","),h=s[1];if(h){var y=s[0].match(/:(.*?);/)[1],c=atob(h),p=c.length,l=new ArrayBuffer(p),w=new Uint8Array(l);c.split("").forEach(function(n,t){w[t]=n.charCodeAt(0)});f=new File([l],v,{type:y});b=URL.createObjectURL(f);n.remove();e=document.getElementById("inputFile_"+t);o=new DataTransfer;o.items.add(f);e.files=o.files;console.log("fileInput.files.length: "+e.files.length);r.uploadAttachment("newrequestattachments",i,t)}else console.log("No base64 in the img src or this element. It must be a http reference... imgSrc: "+u),fetch(u).then(function(t){try{t.blob()}catch(i){alert("Exception xcx21312312 "+i.message+", "+i.stack);n.remove()}}).then(function(u){try{const n=new File([u],"dot.png",u);var f=document.getElementById("inputFile_"+t),e=new DataTransfer;e.items.add(n);f.files=e.files;console.log("fileInput.files.length: "+f.files.length);r.uploadAttachment("newrequestattachments",i,t)}catch(o){alert("Exception xcx215343 "+o.message+", "+o.stack);n.remove()}}).catch(function(t){alert("Exception from psomise xcx87987 "+t+', Exception when fetching "'+u+'".');n.remove()})}catch(a){alert("Exception in drop xcx1214124: "+a.message+", "+a.stack)}},1e3)}catch(n){alert("Exception in drop xcx123124235: "+n.message+", "+n.stack)}});this.options.jsonData&&(console.log("Calling bwAttachments.js.populateAttachments(). xcx13124-1"),console.log("xcx213234-19 calling populateAttachments(). bwBudgetRequestId: "+t),s=$(".bwAuthentication").bwAuthentication("option","workflowAppId"),this.populateAttachments(s,t,"newrequestattachments"))}else alert("Error in bwAttachments.js.xx(). Unexpected value for bwBudgetRequestId: "+t),displayAlertDialog("Error in bwAttachments.js.xx(). Unexpected value for bwBudgetRequestId: "+t)}catch(u){console.log("Exception in renderAndPopulateAttachments: "+u.message+", "+u.stack);n="";n+='<span style="font-size:24pt;color:red;">CANNOT RENDER bwAttachments<\/span>';n+="<br />";n+='<span style="">Exception in bwAttachments.renderAndPopulateAttachments(): '+u.message+", "+u.stack+"<\/span>";this.element.html(n)}},launchFileConversion:function(n,t){try{console.log("In bwAttachments.js.launchFileConversion().");var o=this,i=$(".bwAuthentication").bwAuthentication("option","workflowAppId"),r=globalUrlPrefix+globalUrlForWebServices+"/_files",u={bwWorkflowAppId:i,bwBudgetRequestId:n,Filename:t},f=r+"/launchFileConversion";$.ajax({url:f,type:"POST",data:u,headers:{Accept:"application/json; odata=verbose"},success:function(t){try{t!="SUCCESS"?displayAlertDialog(t):displayAlertDialog("File conversion has been launched for this bwBudgetRequestId: "+n)}catch(i){console.log("Exception in bwAttachments.js.launchFileConversion.success(): "+i.message+", "+i.stack);displayAlertDialog("Exception in bwAttachments.js.launchFileConversion.success(): "+i.message+", "+i.stack)}},error:function(i,r,u){console.log("Error in bwAttachments.js.launchFileConversion.error(): "+e.message+", "+e.stack);displayAlertDialog("Error in bwAttachments.js.launchFileConversion.error(): bwBudgetRequestId: "+n+", filename: "+t+", errorMessage: "+u)}})}catch(e){console.log("Exception in bwAttachments.js.launchFileConversion(): "+e.message+", "+e.stack);displayAlertDialog("Exception in bwAttachments.js.launchFileConversion(): "+e.message+", "+e.stack)}},getExifData:function(n,t){try{console.log("In bwAttachments.js.getExifData().");var i=this,r=$(".bwAuthentication").bwAuthentication("option","workflowAppId"),u=globalUrlPrefix+globalUrlForWebServices+"/_files",f={bwWorkflowAppId:r,bwBudgetRequestId:n,Filename:t},o=u+"/getExifData";$.ajax({url:o,type:"POST",data:f,headers:{Accept:"application/json; odata=verbose"},success:function(n){var r,u,t;try{n.status!="SUCCESS"?displayAlertDialog(n.message):(r="divImageAnalysisDialog_"+i.options.elementIdSuffix,u=document.getElementById(r),u||(u=document.createElement("div"),u.id=r,u.style.display="none",document.body.appendChild(u),t="",t+='  <table style="width:100%;">',t+="    <tr>",t+='      <td style="width:90%;">',t+='        <span style="color: #3f3f3f;font-size:30pt;font-weight:bold;">Image Analysis<\/span>',t+="      <\/td>",t+='      <td style="width:9%;"><\/td>',t+='      <td style="width:1%;cursor:pointer;vertical-align:top;">',t+="        <span class=\"dialogXButton\" style=\"font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;font-size:30pt;font-weight:bold;\" onclick=\"$('#"+r+"').dialog('close');\">X<\/span>",t+="      <\/td>",t+="    <\/tr>",t+="  <\/table>",t+="  <br /><br />",t+='  <input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->',t+="  <br />",t+="  <br />",t+='<div class="tooltip">',t+="   <button onclick=\"copyToClipboard('txtDisplayJsonDialogJSON', 'spanDisplayJsonDialogCopyJsonTooltip')\" onmouseout=\"copyToClipboardMouseout('spanDisplayJsonDialogCopyJsonTooltip')\">",t+='       <span class="tooltiptext" id="spanDisplayJsonDialogCopyJsonTooltip">Copy JSON to the clipboard<\/span>',t+="       Copy",t+="   <\/button>",t+="<\/div>",t+='  <textarea id="spanImageAnalysisContent_'+i.options.elementIdSuffix+'" rows="30" cols="130" style="padding-top:4px;font-size:8pt;"><\/textarea>',t+="  <br /><br />",t+='  <div class="divDialogButton" onclick="$(\'#'+r+"').dialog('close');\">",t+="   Close",t+="  <\/div>",t+="  <br />",t+="  <br />",u.innerHTML=t),$("#"+r).dialog({modal:!0,resizable:!1,closeOnEscape:!1,width:"820",dialogClass:"no-close",hide:!1,open:function(){$(".ui-widget-overlay").bind("click",function(){$("#"+r).dialog("close")});$("#spanImageAnalysisContent_"+i.options.elementIdSuffix).val(JSON.stringify(n.data,null,2))},close:function(){$("#"+r).dialog("destroy")}}))}catch(f){console.log("Exception in bwAttachments.js.getExifData.success(): "+f.message+", "+f.stack);displayAlertDialog("Exception in bwAttachments.js.getExifData.success(): "+f.message+", "+f.stack)}},error:function(i,r,u){console.log("Error in bwAttachments.js.getExifData.error(): "+e.message+", "+e.stack);displayAlertDialog("Error in bwAttachments.js.getExifData.error(): bwBudgetRequestId: "+n+", filename: "+t+", errorMessage: "+u)}})}catch(e){console.log("Exception in bwAttachments.js.getExifData(): "+e.message+", "+e.stack);displayAlertDialog("Exception in bwAttachments.js.getExifData(): "+e.message+", "+e.stack)}},performOCR:function(n,t){try{console.log("In bwAttachments.js.performOCR().");var u=$(".bwAuthentication").bwAuthentication("option","workflowAppId"),f=$(".bwAuthentication:first").bwAuthentication("getActiveStateIdentifier"),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)}),r=this.options.operationUriPrefix+"_files/"+u+"/"+n+"/"+t+"?v="+e+"&ActiveStateIdentifier="+JSON.parse(f).ActiveStateIdentifier;ShowActivitySpinner("Performing Optical Character Recognition (OCR)...");Tesseract.recognize(r,"eng",{logger:function(n){console.log(n)}}).then(function(n){HideActivitySpinner();var t=n.data.text;console.log(t);displayAlertDialog(t)}).catch(function(n,t,i){HideActivitySpinner();console.log("EXCEPTION XCX322342354 "+JSON.stringify(n));displayAlertDialog("EXCEPTION XCX322342354 image1: "+r+", "+JSON.stringify(n)+", f: "+ +JSON.stringify(t)+", g: "+ +JSON.stringify(i))})}catch(i){console.log("Exception in bwAttachments.js.performOCR(): "+i.message+", "+i.stack);displayAlertDialog("Exception in bwAttachments.js.performOCR(): "+i.message+", "+i.stack);alert("Exception in bwAttachments.js.performOCR(): "+i.message+", "+i.stack)}},repairFileType:function(n,t){var u,r,i;try{console.log("In bwAttachments.js.repairFileType().");u=this;r=document.getElementById("divRepairFileTypeDialog");r||(console.log("In bwAttachments.js.repairFileType(). adding element to the dom: divRepairFileTypeDialog"),r=document.createElement("div"),r.id="divRepairFileTypeDialog",r.style.display="none",document.body.appendChild(r));i="";i+='        <table style="width:100%;">';i+="            <tr>";i+='                <td style="width:90%;">';i+='                    <span id="spanDeleteAnAttachmentOfflineDialogTitle" style="color: #3f3f3f;font-size: 60pt;font-weight:bold;">Rename File<\/span>';i+="                <\/td>";i+='                <td style="width:9%;"><\/td>';i+='                <td style="width:1%;cursor:pointer;vertical-align:top;">';i+="                    <span class=\"dialogXButton\" style=\"font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;font-size: 120pt;font-weight:bold;\" onclick=\"$('#divRepairFileTypeDialog').dialog('close');\">X<\/span>";i+="                <\/td>";i+="            <\/tr>";i+="        <\/table>";i+="        <br />";i+="        <span style=\"font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size: 30pt;\">";i+=" Attempt to repair this file by entering a new file name, with the correct extension:";i+="        <\/span>";i+="        <br />";i+='        <input type="text" id="divRepairFileTypeDialog_NewFilename" style="width:900px;font-size:18pt;" value="'+t+'" />';i+="        <br />";i+="        <br />";i+='        <div id="divRepairFileTypeDialog_RenameFileButton" class="divDialogButton">';i+="            Rename";i+="        <\/div>";i+="        <br /><br />";i+="       <div class=\"divDialogButton\" onclick=\"$('#divRepairFileTypeDialog').dialog('close');\">";i+="           Close";i+="        <\/div>";i+="        <br /><br />";i+="        <br /><br />";r.innerHTML=i;$("#divRepairFileTypeDialog").dialog({modal:!0,resizable:!1,closeText:"Cancel",closeOnEscape:!0,width:"1000",dialogClass:"no-close",hide:!1,open:function(){$(".ui-widget-overlay").bind("click",function(){$("#divRepairFileTypeDialog").dialog("close")})}});$("#divRepairFileTypeDialog").dialog().parents(".ui-dialog").find(".ui-dialog-titlebar").remove();$("#divRepairFileTypeDialog_RenameFileButton").off("click").click(function(){try{var i=$(".bwAuthentication").bwAuthentication("option","workflowAppId"),r=$(".bwAuthentication").bwAuthentication("option","participantId"),f=$(".bwAuthentication:first").bwAuthentication("getActiveStateIdentifier"),o={bwWorkflowAppId_LoggedIn:i,bwParticipantId_LoggedIn:r,bwActiveStateIdentifier:f,bwWorkflowAppId:i,bwBudgetRequestId:n,OriginalFilename:t,NewFilename:$("#divRepairFileTypeDialog_NewFilename").val()},s=u.options.operationUriPrefix+"_files/renameafile";$.ajax({url:s,type:"POST",data:o,headers:{Accept:"application/json; odata=verbose"},success:function(n){try{$("#divRepairFileTypeDialog").dialog("close");n.status!="SUCCESS"?displayAlertDialog(n.message):displayAlertDialog(n.message)}catch(t){console.log("Exception in bwAttachments.js.repairFileType.post.removeattachment.success(): "+t.message+", "+t.stack);displayAlertDialog("Exception in bwAttachments.js.repairFileType.post.removeattachment.success(): "+t.message+", "+t.stack)}},error:function(t,i,r){console.log("Error in bwAttachments.js.repairFileType.post.removeattachment.error(): "+e.message+", "+e.stack);displayAlertDialog("Error in bwAttachments.js.repairFileType.post.removeattachment.error(): bwBudgetRequestId: "+n+", filename: "+filename+", errorMessage: "+r)}})}catch(e){console.log("Exception in bwAttachments.js.repairFileType.deletebutton.click(): "+e.message+", "+e.stack);displayAlertDialog("Exception in bwAttachments.js.repairFileType.deletebutton.click(): "+e.message+", "+e.stack)}})}catch(e){console.log("Exception in bwAttachments.js.repairFileType(): "+e.message+", "+e.stack);displayAlertDialog("Exception in bwAttachments.js.repairFileType(): "+e.message+", "+e.stack)}},copyAttachments:function(n,t,i,r,u){var e,h,o,s,f;try{if(console.log("In bwAttachments.js.copyAttachments()."),e=this,h=$(".bwAuthentication").bwAuthentication("option","externallyFacingUrlForAttachments"),h){if(o="divEmailAttachmentsDialog_bwAttachments_"+this.options.elementIdSuffix,s=document.getElementById(o),s)try{$(s).dialog("close")}catch(c){}else s=document.createElement("div"),s.id=o,s.style.display="none",document.body.appendChild(s);f="";f+='<table style="width:100%;">';f+="   <tr>";f+='       <td style="width:90%;">';f+="           <span id=\"spanConfigureEmailNotificationsDialogTitle\" style=\"font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size:30pt;font-weight:bold;\">";f+="               Copy attachments to "+h+"";f+="           <\/span>";f+="           <br />";f+="           <span id=\"spanConfigureEmailNotificationsDialogSubTitle\" style=\"font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size:15pt;font-weight:normal;\">";f+="               The recipients of this email will be able to access the attachments using the included links.";f+="           <\/span>";f+='           <span id="spanConfigureEmailNotificationsDialogInstructionText_EditButton"><\/span>';f+="       <\/td>";f+='       <td style="width:9%;"><\/td>';f+='       <td style="width:1%;cursor:pointer;vertical-align:top;">';f+='           <span class="dialogXButton" style="font-size:35pt;cursor:pointer;width:100%;font-weight:bold;" onclick="$(\'#'+o+"').dialog('close');\">X<\/span>";f+="       <\/td>";f+="   <\/tr>";f+="<\/table>";f+='<input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->';f+="<br />";f+='<div id="'+o+'_BodyEditor" style="height:500px;"><\/div>';f+="<br />";f+='<div style="white-space:nowrap;">';f+="<div class=\"divSignInButton\" style=\"width:90%;text-align:center;line-height:1.1em;font-weight:bold;\" onclick=\"$('.bwAttachments').bwAttachments('copyFiles','newrequestattachments', '"+t+"', '"+i+"', '"+r+"', '"+u+"');\">";f+="Copy Selected Files to "+h;f+="<\/div>";f+="<\/div>";f+="<br />";f+='<div class="divSignInButton" style="width:90%;text-align:center;line-height:1.1em;font-weight:bold;" onclick="$(\'#'+o+"').dialog('close');\">Cancel<\/div>";f+="<br /><br />";s.innerHTML=f;$("#"+o).dialog({modal:!0,resizable:!1,closeOnEscape:!1,width:"1100",dialogClass:"no-close",hide:!1,close:function(){$(this).dialog("destroy")},open:function(){var t;try{var v=$(".bwAuthentication").bwAuthentication("option","workflowAppTitle"),y=$(".bwAuthentication").bwAuthentication("option","participantFriendlyName"),p=$(".bwAuthentication").bwAuthentication("option","participantEmail"),f=$(".bwAuthentication").bwAuthentication("option","bwEnabledRequestTypes").EnabledItems,h;for(t=0;t<f.length;t++)u==f[t].bwRequestTypeId&&(h=f[t].SingletonName);var n=$(".bwAuthentication").bwAuthentication("option","workflowAppId"),s=$(".bwAuthentication").bwAuthentication("option","participantId"),c=$(".bwAuthentication:first").bwAuthentication("getActiveStateIdentifier"),l={bwParticipantId_LoggedIn:s,bwActiveStateIdentifier:c,bwWorkflowAppId_LoggedIn:n,bwWorkflowAppId:n,bwBudgetRequestId:i},a=globalUrlPrefix+globalUrlForWebServices+"/_files/getlistofattachmentsforbudgetrequest";$.ajax({url:a,type:"POST",data:l,timeout:15e3,headers:{Accept:"application/json; odata=verbose"},success:function(t){var h,w,r,a,u,f,l,c,b,k,s,v,y;try{if(h=t.data,t.status!="SUCCESS")$("#"+o+"_BodyEditor").html('<span style="color:tomato;">[Unexpected response from the file server]<\/span>');else if(t.message.indexOf("ENOENT")>-1)console.log("[Server response: No such file or directory: "+h.path+"]. This is probably Ok.?");else if(h&&h.length&&h.length>0){var r="",d=new Date,g=d.toLocaleDateString().replace(/\//g,"-");for(r+="<span style=\"font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size:25pt;font-weight:bold;\">",r+='   Choose a name for the sub-folder:&nbsp;&nbsp;<input id="txtSubfolder_'+e.options.elementIdSuffix+'" type="text" value="'+g+'" />',r+="<\/span>",r+="<br />",r+="<span style=\"font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size:25pt;font-weight:bold;\">",r+='   Select the file(s) you wish to copy to the external URL, then click the "Copy" button.',r+="<\/span>",$("#"+o+"_BodyEditor").html(r),w=function(n,t){$.get(t).done(function(){var i=new Image;i.src=t;i.onload=function(i){try{document.getElementById(n).src=t}catch(i){alert("xcx2312 exception 2: "+i.message+", "+i.stack);console.log("Exception in bwAttachments.js.copyAttachments.displayImageThumbnail(): "+i.message+", "+i.stack);displayAlertDialog("Exception in bwAttachments.js.copyAttachments.displayImageThumbnail(): "+i.message+", "+i.stack);document.getElementById(n).src=globalUrlPrefix+globalUrl+"/images/mp4.jfif"}}}).fail(function(i){alert("fail in Displaying thumbnail 1: "+t);console.log("Fail in bwAttachments.js.copyAttachments.displayImageThumbnail(): "+JSON.stringify(i));displayAlertDialog("Fail in bwAttachments.js.copyAttachments.displayImageThumbnail(): "+JSON.stringify(i));document.getElementById(n).src=globalUrlPrefix+globalUrl+"/images/mp4.jfif"})},r="",r+='<div id="'+o+'_BodyEditor_Attachments" style="overflow-y:scroll;scroll-behavior:smooth;max-height:500px;padding-left:20px;">',r+="<\/div>",$("#"+o+"_BodyEditor").append(r),a=0;a<h.length;a++)if(u=h[a].Display_Filename,!(u.indexOf("_thumbnail_")>-1)){f=h[a].Description;l=h[a].Size;l&&l.toLowerCase&&l.toLowerCase()!="na"&&(l=(Number(l)/1e6).toFixed(1));b=JSON.parse($(".bwAuthentication:first").bwAuthentication("getActiveStateIdentifier"));c=b.status!="SUCCESS"?"[No image. Unauthorized. xcx213124-3-22x]":"_files/"+n+"/"+i+"/"+h[a].Actual_Filename+"?ActiveStateIdentifier="+b.ActiveStateIdentifier;var nt=(screen.width-800)/2,tt=(screen.height-600)/2,r="";r+='<table style="width:100%;" xcx="xcx3254367">';r+="  <tr>";r+='    <td style="width:10%;">';r+="<table>";r+="   <tr>";r+="       <td>";r+='           <input style="transform: scale(3);" bwfilename="'+u+'" bwfiledescription="'+f+'" bwfilesize="'+l+'" class="cbAttachment" type="checkbox" />';r+="       <\/td>";r+="       <td>&nbsp;&nbsp;<\/td>";r+="       <td>";k=u.split(".").length-1;s=u.toLowerCase().split(".")[k];s=="png"||s=="jpg"||s=="jpeg"||s=="jfif"||s=="webp"||s=="gif"?(r+='<img id="attachmentstest1" xcx="xcx2312-1" src="'+e.options.operationUriPrefix+c+'" style="height:120px;display:block;margin-left:auto;margin-right:auto;cursor:pointer;" alt="" ',r+=Platform=="IOS8"?"onclick=\"$('.bwAuthentication').bwAuthentication('displayAttachmentInDialog', '"+e.options.operationUriPrefix+c+"', '"+u+"', '"+f+"', '"+i+"');\"":"onclick=\"$('.bwAuthentication').bwAuthentication('displayAttachmentInDialog', '"+e.options.operationUriPrefix+c+"', '"+u+"', '"+f+"', '"+i+"');\" ",r+=" />"):s=="xlsx"||s=="xls"?r+=Platform=="IOS8"?"<img src=\"images/excelicon.png\" style=\"width:100px;cursor:pointer;\" onclick=\"$('.bwAuthentication').bwAuthentication('displayAttachmentInDialog', '"+e.options.operationUriPrefix+c+"', '"+u+"', '"+f+"', '"+i+"');\" />":"<img src=\"images/excelicon.png\" style=\"width:100px;cursor:pointer;\" onclick=\"$('.bwAuthentication').bwAuthentication('displayAttachmentInDialog', '"+e.options.operationUriPrefix+c+"', '"+u+"', '"+f+"', '"+i+"');\" />":s=="pdf"?(v="img_bwAttachments_"+e.options.elementIdSuffix+"_"+i+"_"+a,y=e.options.operationUriPrefix+"_files/"+n+"/"+i+"/"+u+"_thumbnail_320px_pdf_.png",r+='<img xcx="xcx3396048" id="'+v+'" style="height:120px;display:block;margin-left:auto;margin-right:auto;cursor:pointer;" alt="" src="'+y+'" ',r+="   onclick=\"$('.bwAuthentication').bwAuthentication('displayAttachmentInDialog', '"+e.options.operationUriPrefix+c+"', '"+u+"', '"+f+"', '"+i+"');\" ",r+=" />",w(v,y)):s=="mp4"?(v="img_bwAttachments_"+e.options.elementIdSuffix+"_"+i+"_"+a,y=e.options.operationUriPrefix+"_files/"+n+"/"+i+"/"+u+"_thumbnail_.jpg",r+='<img xcx="xcx3396048" id="'+v+'" style="height:120px;display:block;margin-left:auto;margin-right:auto;cursor:pointer;" alt="" src="'+y+'" ',r+="   onclick=\"$('.bwAuthentication').bwAuthentication('displayAttachmentInDialog', '"+e.options.operationUriPrefix+c+"', '"+u+"', '"+f+"', '"+i+"');\" ",r+=" />",w(v,y)):s=="rtf"?(r+='<img src="images/rtf.png" style="width:50px;cursor:pointer;" ',r+="onclick=\"$('.bwAuthentication').bwAuthentication('displayAttachmentInDialog', '"+e.options.operationUriPrefix+c+"', '"+u+"', '"+f+"', '"+i+"');\" ",r+=" />"):s=="vob"?(r+='<img src="images/vob.png" style="width:50px;cursor:pointer;" ',r+="onclick=\"$('.bwAuthentication').bwAuthentication('displayAttachmentInDialog', '"+e.options.operationUriPrefix+c+"', '"+u+"', '"+f+"', '"+i+"');\" ",r+=" />"):s=="mp3"&&(r+='<img src="images/mp3.png" style="width:50px;cursor:pointer;" ',r+="onclick=\"$('.bwAuthentication').bwAuthentication('displayAttachmentInDialog', '"+e.options.operationUriPrefix+c+"', '"+u+"', '"+f+"', '"+i+"');\" ",r+=" />");r+="       <\/td>";r+="   <\/tr>";r+="<\/table>";r+="    <\/td>";r+='    <td style="width:90%;white-space:normal;">';r+=Platform=="IOS8"?'<div xcx="xcx21342346-1" class="attachmentsSectionFileLink" style="height:50px;border:1px thin red;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'displayAttachmentInDialog\', \''+e.options.operationUriPrefix+c+"', '"+u+"', '"+f+"', '"+i+"');\">":'<div xcx="xcx21342346-2" class="attachmentsSectionFileLink" style="cursor:pointer;white-space:nowrap;width:250px;" onclick="$(\'.bwAuthentication\').bwAuthentication(\'displayAttachmentInDialog\', \''+e.options.operationUriPrefix+c+"', '"+u+"', '"+f+"', '"+i+"');\">";r+=u;r+=f.length>0?'<br /><span class="attachmentsSectionDescription"> - "'+f+'"<\/span>':'<br /><span class="attachmentsSectionDescription"> - [no description]'+f+"<\/span>";r+=l&&l.toLowerCase&&l.toLowerCase()!="na"?'<br /><span class="attachmentsSectionDescription">'+l+" MB<\/span>":'<br /><span class="attachmentsSectionDescription" style="">[size unavailable]<\/span>';r+="<\/div>";r+="<\/br>";$("#"+o+"_BodyEditor_Attachments").append(r)}}else $("#"+o+"_BodyEditor").innerHTML=h?'<span xcx="xcx22945-1" style="color:tomato;">No attachments found: '+JSON.stringify(h)+"<\/span>":'<span xcx="xcx22945-1" style="color:tomato;">ERROR: Unexpected response: '+JSON.stringify(h)+"<\/span>"}catch(p){console.log("Exception in bwAttachments.js.copyAttachments.dialog.open.ajax.success(): "+p.message+", "+p.stack);displayAlertDialog("Exception in bwAttachments.js.copyAttachments.dialog.open.ajax.success(): "+p.message+", "+p.stack)}},error:function(t,r,u){console.log("Error in bwAttachments.js.copyAttachments.dialog.open.ajax.error(): "+u+", workflowAppId: "+n+", bwBudgetRequestId: "+i+", participantId: "+s);displayAlertDialog("Error in bwAttachments.js.copyAttachments.dialog.open.ajax.error(): "+u+", workflowAppId: "+n+", bwBudgetRequestId: "+i+", participantId: "+s)}})}catch(r){console.log("Exception in bwAttachments.js.copyAttachments.dialog.open(): "+r.message+", "+r.stack);displayAlertDialog("Exception in bwAttachments.js.copyAttachments.dialog.open(): "+r.message+", "+r.stack)}}})}else displayAlertDialog('This functionality is not currently available. An external URL has to be configured in the "Configuration > Organization Settings".')}catch(c){console.log("Exception in bwAttachments.js.copyAttachments(): "+c.message+", "+c.stack);displayAlertDialog("Exception in bwAttachments.js.copyAttachments(): "+c.message+", "+c.stack)}},copyFiles:function(n,t,i,r,u){var e,s,o,a,v,y;try{console.log("In bwAttachments.js.copyFiles().");var p=this,l=$(".bwAuthentication").bwAuthentication("option","workflowAppId"),w=$(".bwAuthentication").bwAuthentication("option","participantId"),b=$(".bwAuthentication").bwAuthentication("option","participantFriendlyName"),k=$(".bwAuthentication").bwAuthentication("option","participantEmail"),d=$(".bwAuthentication").bwAuthentication("option","externallyFacingUrlForAttachments"),g=document.getElementById("txtSubfolder_"+this.options.elementIdSuffix).value,h=[],f=$(".cbAttachment");if(f&&f.length)for(e=0;e<f.length;e++)if(f[e].checked)if(s=$(f[e]).closest("tr").find("img")[0],s){o=document.createElement("canvas");o.height=s.naturalHeight;o.width=s.naturalWidth;a=o.getContext("2d");a.drawImage(s,0,0,o.width,o.height);v=o.toDataURL();o.remove();var nt=f[e].getAttribute("bwfilename"),tt=f[e].getAttribute("bwfiledescription"),it=f[e].getAttribute("bwfilesize"),rt={bwWorkflowAppId:l,bwBudgetRequestId:i,subfolder:g,Filename:nt,Description:tt,Size:it,File64bit:v};h.push(rt)}else displayAlertDialog("Error in bwAttachments.js.copyFiles(). Could not locate the img element. xcx21345677");h.length>0?(ShowActivitySpinner("Copying files to "+d),emailDetails={bwWorkflowAppId:l,bwParticipantId:w,bwParticipantFriendlyName:b,bwParticipantEmail:k,attachments:JSON.stringify(h)},y=this.options.operationUriPrefix+"_files/EmailAttachmentsExternally",$.ajax({url:y,type:"POST",data:emailDetails,timeout:6e5,headers:{Accept:"application/json; odata=verbose"},success:function(f){try{HideActivitySpinner();f.status!="SUCCESS"?displayAlertDialog(f.message):p.emailAttachments(n,t,i,r,u,h)}catch(e){HideActivitySpinner();console.log("Exception in bwAttachments.js.copyFiles():1: "+e.message+", "+e.stack);displayAlertDialog("Exception in bwAttachments.js.copyFiles():1: "+e.message+", "+e.stack)}},error:function(n,t,i){HideActivitySpinner();console.log("Error in bwAttachments.js.copyFiles(): "+t+" "+i+", data: "+JSON.stringify(n));displayAlertDialog("Error in bwAttachments.js.copyFiles(): "+t+" "+i+", data: "+JSON.stringify(n))}})):(displayAlertDialog("You have not selected any attachments."),HideActivitySpinner())}catch(c){HideActivitySpinner();console.log("Exception in bwAttachments.js.copyFiles(): "+c.message+", "+c.stack);displayAlertDialog("Exception in bwAttachments.js.copyFiles(): "+c.message+", "+c.stack)}},emailAttachments:function(n,t,i,r,u,f){var l,h,o,s,e,a;try{console.log("In bwAttachments.js.emailAttachments().");l=this;h=$(".bwAuthentication").bwAuthentication("option","externallyFacingUrlForAttachments");h?(o="divEmailAttachmentsDialog_bwAttachments_"+this.options.elementIdSuffix,s=document.getElementById(o),s?$(s).dialog("close"):(s=document.createElement("div"),s.id=o,s.style.display="none",document.body.appendChild(s)),e="",e+='<table style="width:100%;">',e+="   <tr>",e+='       <td style="width:90%;">',e+="           <span id=\"spanConfigureEmailNotificationsDialogTitle\" style=\"font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size:30pt;font-weight:bold;\">",e+="               Email attachments as public links to "+h+"",e+="           <\/span>",e+="           <br />",e+="           <span id=\"spanConfigureEmailNotificationsDialogSubTitle\" style=\"font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size:15pt;font-weight:normal;\">",e+="               The recipients of this email will be able to access the attachments using the included links.",e+="           <\/span>",e+='           <span id="spanConfigureEmailNotificationsDialogInstructionText_EditButton"><\/span>',e+="       <\/td>",e+='       <td style="width:9%;"><\/td>',e+='       <td style="width:1%;cursor:pointer;vertical-align:top;">',e+='           <span class="dialogXButton" style="font-size:35pt;cursor:pointer;width:100%;font-weight:bold;" onclick="$(\'#'+o+"').dialog('close');\">X<\/span>",e+="       <\/td>",e+="   <\/tr>",e+="<\/table>",e+='<input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->',e+="<br />",a="divEmailAttachmentsDialog_bwAttachments_bwPeoplePicker_EmailRecipients_"+this.options.elementIdSuffix,e+='<div id="'+a+'"><\/div>',e+="<br />",e+="<span style=\"font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size:12pt;font-weight:bold;\">",e+="   Subject:",e+="<\/span>",e=="<br />",e+='<input type="text" id="'+o+'_SubjectEditor" style="WIDTH: 100%;font-family:sans-serif;color: #262626;font-size: 14pt;" />',e+="<br /><br />",e+="<span style=\"font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;color: #3f3f3f;font-size:12pt;font-weight:bold;\">",e+="   Body:",e+="<\/span>",e=="<br />",e+='<div id="'+o+'_BodyEditor" style="height:500px;"><\/div>',e+="<br />",e+='<div style="white-space:nowrap;">',e+="<div class=\"divSignInButton\" style=\"width:90%;text-align:center;line-height:1.1em;font-weight:bold;\" onclick=\"$('.bwAttachments').bwAttachments('sendEmail', '"+t+"', '"+i+"');\">",e+="Send Email",e+="<\/div>",e+="<\/div>",e+="<br />",e+='<div class="divSignInButton" style="width:90%;text-align:center;line-height:1.1em;font-weight:bold;" onclick="$(\'#'+o+"').dialog('close');\">Cancel<\/div>",e+="<br /><br />",s.innerHTML=e,$("#"+o).dialog({modal:!0,resizable:!1,closeOnEscape:!1,width:"1100",dialogClass:"no-close",hide:!1,open:function(){var k,d,n,t,p,w,s,c,e;try{var tt=$(".bwAuthentication").bwAuthentication("option","workflowAppId"),g=$(".bwAuthentication").bwAuthentication("option","workflowAppTitle"),b=$(".bwAuthentication").bwAuthentication("option","participantFriendlyName"),nt=$(".bwAuthentication").bwAuthentication("option","participantEmail"),v=$(".bwAuthentication").bwAuthentication("option","bwEnabledRequestTypes").EnabledItems,y;for(t=0;t<v.length;t++)u==v[t].bwRequestTypeId&&(y=v[t].SingletonName);if(k="divEmailAttachmentsDialog_bwAttachments_bwPeoplePicker_EmailRecipients_"+l.options.elementIdSuffix,$("#"+k).bwPeoplePicker_EmailRecipients({parentElementIdSuffix:l.options.elementIdSuffix}),d="Attachment links for "+y+" "+r,$("#"+o+"_SubjectEditor")[0].value=d,n="",n+='<div style="background-color:white;">',n+="Hi,",n+="<br /><br />",n+="Here are the attachment links for "+y+" "+r+":",n+="<br /><br />",n+='<div id="'+o+'_BodyEditor_AttachmentsLinks">',n+='   <img src="/images/ajax-loader.gif" width="50px" />',n+="<\/div>",n+="<br /><br />",n+="Sincerely,",n+="<br /><br />",n+=b.split(" ")[0],n+="<br /><br />",n+=b,n+="<br />",n+=nt,n+="<br />",n+=g,n+="<br /><br />",n+="<\/div>",$("#"+o+"_BodyEditor").summernote({dialogsInBody:!0,placeholder:"",tabsize:2,height:450,toolbar:[["style",["style"]],["font",["bold","underline","clear"]],["color",["color"]],["para",["ul","ol","paragraph"]],["table",["table"]],["insert",["link"]],["view",["codeview","help"]]]}),$("#"+o+"_BodyEditor").summernote("code",n),i)for($("#"+o+"_BodyEditor_AttachmentsLinks").html(""),t=0;t<f.length;t++)p=f[t].Filename,p.indexOf("_thumbnail_")>-1||(w=f[t].Description,s=f[t].Size,s.toLowerCase()!="na"&&(s=(Number(s)/1e6).toFixed(1)),c=h+"/"+encodeURIComponent(f[t].subfolder)+"/"+encodeURIComponent(p),e="",e+='<div style="white-space:nowrap;">',e+='   <a href="'+c+'" target="_blank" style="cursor:pointer;">',e+='       <img src="'+f[t].File64bit+'" alt="'+w+'" title="'+w+'" style="height:120px;display:block;cursor:pointer;max-width:250px;border:1px solid gray;" />',e+="   <\/a>",e+="   <br />",e+='   <a href="'+c+'" target="_blank" style="cursor:pointer;">'+c+"<\/a>",e+="<\/div>",e+="<br />",$("#"+o+"_BodyEditor_AttachmentsLinks").append(e));else console.log("ERROR IN bwAttachments.js.emailAttachments(). Unexpected value for bwBudgetRequestId: "+i),displayAlertDialog("ERROR IN bwAttachments.js.emailAttachments(). Unexpected value for bwBudgetRequestId: "+i)}catch(a){console.log("Exception in bwAttachments.js.emailAttachments():2: "+a.message+", "+a.stack);displayAlertDialog("Exception in bwAttachments.js.emailAttachments():2: "+a.message+", "+a.stack)}},close:function(){$(this).dialog("destroy")}})):displayAlertDialog('This functionality is not currently available. An external URL has to be configured in the "Configuration > Organization Settings".')}catch(c){console.log("Exception in bwAttachments.js.emailAttachments(): "+c.message+", "+c.stack);displayAlertDialog("Exception in bwAttachments.js.emailAttachments(): "+c.message+", "+c.stack)}},sendEmail:function(){var o,i,t;try{console.log("In sendEmail().");var p=this,f=$(".bwAuthentication").bwAuthentication("option","workflowAppId"),e=$(".bwAuthentication").bwAuthentication("option","participantId"),s=$(".bwAuthentication").bwAuthentication("option","participantEmail"),h=$(".bwAuthentication").bwAuthentication("option","participantFriendlyName"),c="divEmailAttachmentsDialog_bwAttachments_bwPeoplePicker_EmailRecipients_"+this.options.elementIdSuffix,n=JSON.parse($("#"+c).bwPeoplePicker_EmailRecipients("getData"));if(n&&n.length&&n.length>0){for(o=$(".bwAuthentication:first").bwAuthentication("getActiveStateIdentifier"),i="",t=0;t<n.length;t++)t>0&&(i+=","),i+=n[t].ParticipantEmail;var u="divEmailAttachmentsDialog_bwAttachments_"+this.options.elementIdSuffix,l=$("#"+u+"_SubjectEditor")[0].value,a=$("#"+u+"_BodyEditor").summernote("code"),v={bwParticipantId_LoggedIn:e,bwActiveStateIdentifier:o,bwWorkflowAppId_LoggedIn:f,bwWorkflowAppId:f,bwParticipantId:e,bwParticipantEmail:s,bwParticipantFriendlyName:h,to:i,cc:"",bcc:"",subject:l,body:a},y=this.options.operationUriPrefix+"_bw/sendemail";$.ajax({url:y,type:"POST",data:v,headers:{Accept:"application/json; odata=verbose"},success:function(n){try{HideActivitySpinner();n.message!="SUCCESS"?displayAlertDialog(n.message):($("#"+u).dialog("close"),displayAlertDialog("This email has been queued. If email is turned on for this organization, it will be sent shortly, otherwise it will be put in the Pending email queue, and will be sent when email is enabled for this organization."))}catch(t){HideActivitySpinner();console.log("Exception in bwAttachments.js.sendEmail():1: "+t.message+", "+t.stack);displayAlertDialog("Exception in bwAttachments.js.sendEmail():1: "+t.message+", "+t.stack)}},error:function(n,t,i){HideActivitySpinner();console.log("Error in bwAttachments.js.sendEmail(): "+t+" "+i);displayAlertDialog("Error in bwAttachments.js.sendEmail(): "+t+" "+i)}})}else displayAlertDialog("Select at least 1 email recipient before sending this email.")}catch(r){console.log("Exception in sendEmail(): "+r.message+", "+r.stack);displayAlertDialog("Exception in sendEmail(): "+r.message+", "+r.stack)}},renderAndPopulateAttachments_ReadOnly:function(n){var u,r,n,f,e,t;try{console.log("");console.log("##################################");console.log("In bwAttachments.js.renderAndPopulateAttachments_ReadOnly().");console.log("##################################");console.log("");u=this;this.options.inFormsEditor!=!0&&(r=$(this.element).closest("#budgetrequestform")[0].getAttribute("bwbudgetrequestid"),n="divRequestFormDialog_"+r,$("#"+n)||(n="divCreateRequestFormContent"));t="";t+='<table style="height:100%;vertical-align:top;">';t+="   <tbody>";t+='       <tr xcx="xcx21342526-1" id="xcx21342526-1" class="xdTableOffsetRow xdTableOffsetRow-editor" id="toolboxdraggablerow_2" draggable="true" bwwidgetname="bwAttachments">';t+='           <td class="xdTableOffsetCellLabel" style="text-align:left; VERTICAL-ALIGN: top; PADDING-BOTTOM: 4px; PADDING-TOP: 4px; PADDING-LEFT: 22px; BORDER-LEFT: #d8d8d8 1pt; PADDING-RIGHT: 5px;height:100%;">';t+='               <table style="height:100%;">';t+='                   <tr style="height:1%;">';t+='                       <td style="vertical-align:top;">';t+='                           <span class="xdlabel" style="color:black;">';t+="                               Attachments:";t+="                           <\/span>";this.options.renderAsARequiredField==!0?t+='                       <span style="color:red;font-size:medium;">*<\/span>':this.options.renderAsARequiredField==!1||(t+='                       <span class="ToggleRequiredAsterisk" title="Select this asterick to make this a required field." onclick="$(\'.bwFormsEditor\').bwFormsEditor(\'toggleFormRequiredField\', this);">*<\/span>');t+="                       <\/td>";t+="                   <\/tr>";t+='                   <tr style="height:99%;">';t+='                       <td style="vertical-align:top;">';t+="                       <\/td>";t+="                   <\/tr>";t+="               <\/table>";t+="           <\/td>";t+='           <td class="xdTableOffsetCellComponent" style="white-space:nowrap;text-align:left; VERTICAL-ALIGN: top; PADDING-LEFT: 5px; PADDING-RIGHT: 22px;">';this.options.inFormsEditor==!0&&(t+='           <div style="width:365px;height:55px;text-align:center;background-color:#f6f6f6;padding-left:0;">',t+='               <label for="inputFile_bwBudgetRequestId" class="divSignInButton" style="font-style:normal;width:100%;height:100%;text-align:center;line-height:1.65em;font-size:23pt;border-radius: 5px 5px 5px 5px;display:inline-block;padding-left:0;padding-top:0;">Choose file...&nbsp;&nbsp;&nbsp;&#128193;<\/label>',t+="           <\/div>");t+='           <p id="newrequestattachments" xcx="xcx448-1" style="word-break:break-all;white-space:normal;"><\/p>';this.options.inFormsEditor!=!0&&(f=$(this.element).closest("#budgetrequestform")[0].getAttribute("bwrequesttitle"),e=$(this.element).closest("#budgetrequestform")[0].getAttribute("bwrequesttypeid"));t+="                            <\/td>";t+="                        <\/tr>";t+="                    <\/tbody>";t+="<\/table>";this.options.inFormsEditor!=!0&&this.element.closest("tr").removeAttr("draggable");this.element.html(t);$(this.element).find("#newrequestattachments")[0].innerHTML='<span style="color:tomato;"><\/span>';this.options.jsonData&&(console.log("Calling bwAttachments.js.populateAttachments(). xcx13124-2"),this.populateAttachments(this.options.jsonData.bwWorkflowAppId,this.options.jsonData.bwBudgetRequestId,"newrequestattachments"))}catch(i){console.log("Exception in renderAndPopulateAttachments_ReadOnly: "+i.message+", "+i.stack);t="";t+='<span style="font-size:24pt;color:red;">CANNOT RENDER bwAttachments<\/span>';t+="<br />";t+='<span style="">Exception in bwAttachments.renderAndPopulateAttachments_ReadOnly(): '+i.message+", "+i.stack+"<\/span>";this.element.html(t)}},uploadAttachment:function(n,t,i){try{console.log("In bwAttachments.js.uploadAttachment(). attachmentsAreStoredInIndexDb: "+this.options.attachmentsAreStoredInIndexDb+", bwBudgetRequestId: "+i+", elementIdSuffix: "+this.options.elementIdSuffix+", displayAttachmentsTagName: "+n+", requestDialogId: "+t);var f=$("#inputFile_"+i)[0],u=f.files;u?u.size>1e8?(console.log("Currently the system does not allow files over 100MB."),displayAlertDialog("Currently the system does not allow files over 100MB."),f.replaceWith($("#inputFile_"+i).clone())):(console.log("In bwAttachments.js.uploadAttachment(). Calling cmdDisplayConfirmFileUploadDialog(). bwBudgetRequestId: "+i+", file.length: "+u.length),console.log("RRRRRRR In bwAttachments.js.uploadAttachment(). Calling cmdDisplayConfirmFileUploadDialog(). bwBudgetRequestId: "+i+", file.length: "+u.length),this.cmdDisplayConfirmFileUploadDialog(n,i,t,f)):(console.log("There was an error attaching this file. Please try again."),displayAlertDialog("There was an error attaching this file. Please try again."))}catch(r){console.log("Error in bwAttachments.js.uploadAttachment(): "+r.message+", "+r.stack);displayAlertDialog("Error in bwAttachments.js.uploadAttachment(): "+r.message+", "+r.stack);$(this.element).find("#newrequestattachments")[0].innerHTML="Exception in bwAttachments.uploadAttachment(): "+r.message+", "+r.stack}},uploadPastedAttachment:function(n){try{alert("In uploadPastedAttachment(). imgSrc: "+n);var i=new FileReader;i.onload=function(n){try{alert("In reader.onload()");var i=n.target.result;alert("In reader.onload size: "+i.size)}catch(t){alert("Exception in xcx213123: "+t.message+", "+t.stack)}};i.readAsDataURL(n)}catch(t){displayAlertDialog("Error in bwAttachments.js.uploadAttachment(): "+t.message+", "+t.stack);$(this.element).find("#newrequestattachments")[0].innerHTML="Exception in bwAttachments.uploadAttachment(): "+t.message+", "+t.stack}},UploadButton_OnClick:function(){},CancelButton_OnClick:function(){$("#divConfirmFileUploadDialog_ForAttachments").dialog("close")},cmdDisplayConfirmFileUploadDialog:function(n,t){var i,u,e;try{console.log("In bwAttachments.js.cmdDisplayConfirmFileUploadDialog(). bwBudgetRequestId: "+t);var s=this,r="divConfirmFileUploadDialog_ForAttachments_"+t,f=document.getElementById(r);f||(f=document.createElement("div"),f.id=r,f.style.display="none",document.body.appendChild(f));i="";i+='   <table style="width:100%;">';i+="       <tr>";i+='           <td style="width:90%;">';i+='               <span id="spanConfirmFileUploadDialogTitle" style="color: #3f3f3f;font-size: 60pt;font-weight:bold;">';i+="                   Select the 'Upload' button...";i+="               <\/span>";i+="           <\/td>";i+='           <td style="width:9%;"><\/td>';i+='           <td style="width:1%;cursor:pointer;vertical-align:top;">';i+="               <span class=\"dialogXButton\" style=\"font-family: 'Segoe UI Light','Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;font-size: 120pt;font-weight:bold;\" onclick=\"$('#"+r+"').dialog('close');\">X<\/span>";i+="           <\/td>";i+="       <\/tr>";i+="   <\/table>";i+='   <input type="text" autofocus="true" style="display:none;" /> <!-- This is here to prevent the first visible field from getting the cursor and showing the keyboard. -->';i+="   <br /><br />";i+='   <span style="font-style:italic;color:gray;font-size:15pt;">The file name and description are not required because they can be changed later on.<\/span>';i+="   <br /><br />";i+='   <input type="checkbox" id="ConfirmFileUploadDialog_ConvertToAPdfCheckbox_'+t+'" />&nbsp;<span style="font-style:italic;color:gray;font-size:15pt;">Convert to a pdf<\/span>';i+="   <br /><br />";i+='   <img xcx="xcx445776" id="ConfirmFileUploadDialog_ImagePreview_'+t+'" src="#" alt="your image" />';i+="   <table>";i+="       <tr>";i+='           <td><span style="font-style:italic;color:gray;font-size:20pt;">file name:<\/span><\/td>';i+="           <td>";i+='               <input type="text" id="txtConfirmFileUploadDialogFilename" style="width:380px;font-size:20pt;" />&nbsp;<span style="font-style:italic;font-size:11pt;color:gray;">';i+="               <br />(don't include a file extension)";i+="               <\/span>";i+="           <\/td>";i+="       <\/tr>";i+="       <tr>";i+="           <td><\/td>";i+="           <td><\/td>";i+="       <\/tr>";i+="       <tr>";i+='           <td style="vertical-align:top;"><span style="font-style:italic;font-size:20pt;color:gray;">description:<\/span><\/td>';i+='           <td><textarea id="txtConfirmFileUploadDialogFileDescription" style="overflow:hidden;font-size:20pt;" rows="4" cols="30"><\/textarea><\/td>';i+="       <\/tr>";i+="   <\/table>";i+='   <div id="'+r+'_btnUploadTheFileNow" class="divDialogButton" title="Click here to upload the attachment.">';i+="       Upload";i+="   <\/div>";i+="   <br /><br />";i+='   <div id="btnCancelUploadTheFileNow" class="divDialogButton" onclick="$(\'#'+r+"').dialog('close');\">";i+="       Cancel";i+="   <\/div>";f.innerHTML=i;$("#ConfirmFileUploadDialog_ImagePreview_"+t).attr("src","");$("#"+r).find("#txtConfirmFileUploadDialogFileDescription")[0].innerHTML="";u=$("#inputFile_"+t)[0];u&&u.files&&u.files.length&&u.files.length>0?(e=u.files,e?e.size>1e8?(console.log("xcx121312 Currently the system does not allow files over 100MB."),displayAlertDialog("xcx121312 Currently the system does not allow files over 100MB."),u.replaceWith($("#inputFile_"+t).clone())):(console.log(">>>> In bwAttachments.js.uploadAttachment(). Calling .dialog(). bwBudgetRequestId: "+t+", file.length: "+e.length),$("#"+r).dialog({modal:!0,resizable:!1,closeText:"Cancel",closeOnEscape:!0,width:"720px",dialogClass:"no-close",hide:!1,position:{my:"middle top+12",at:"middle top",of:window},open:function(){var e,i,o,a,u,v,h,c,l;try{$(".ui-widget-overlay").bind("click",function(){$("#"+r).dialog("close")});console.log(">>>>>>>>>>>>>>>>In $("+r+"dialogId).dialog.open().");e=document.getElementById("inputFile_"+t);console.log(">>>>>>>>>>>>>xcx23213 x.files.length: "+e.files.length);i=e.files[0];i.name?o=i.name.substring(0,i.name.lastIndexOf(".")):(alert("xcx213123 NO file.name!!!"),a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)}),o=a);u=$("#"+r).find("#txtConfirmFileUploadDialogFilename");u&&u[0]&&(u[0].value==""||u[0].value)?u[0].value=o:(console.log(""),console.log("CANNOT find element divConfirmFileUploadDialog_ForAttachments. xcx999246."),console.log(""),alert("CANNOT find element divConfirmFileUploadDialog_ForAttachments. xcx999246."));v=$("#"+r+"_btnUploadTheFileNow");v?$(this).ready(function(){console.log("Dialog is ready(). xcx234 adding click event for element: "+r+"_btnUploadTheFileNow");var e=i.name,f=i.name,o=e.split(".").length-1,u=e.toLowerCase().split(".")[o];alert("fileExtension_original: "+u);console.log('Images display in the "Upload Attachment" dialog Ok, but there are some other cases to handle here.');u.toLowerCase()=="vob"&&$("#"+r).find("#ConfirmFileUploadDialog_ImagePreview_"+t).attr("src","images/vob.png");$("#"+r+"_btnUploadTheFileNow").off("click").click(function(){var e,h,c,l,a;try{console.log("In bwAttachments.js.UploadButton_OnClick(). displayAttachmentsTagName: "+n+", bwBudgetRequestId: "+t);e=$("#"+r).find("#txtConfirmFileUploadDialogFilename")[0];e&&e.value&&e.value.trim().length>1&&(h=e.value.trim().split(".").length-1,c=e.value.trim().toLowerCase().split(".")[h],u==c||(f=e.value.trim()+"."+u));l=$("#"+r).find("#ConfirmFileUploadDialog_ConvertToAPdfCheckbox_"+t)[0];a=l.checked;$("#"+r).dialog("close");console.log("In bwAttachments.js.UploadButton_OnClick(). Getting ready to call processUpload(). filename: "+f+", file.name: "+i.name);s.processUpload(n,t,i,f,a)}catch(o){console.log("Exception in bwAttachments.js.btnUploadTheFileNow.click(): "+o.message+", "+o.stack);alert("Exception in bwAttachments.js.btnUploadTheFileNow.click(): "+o.message+", "+o.stack)}})}):alert("xcx214252523 Error: Could not locate element ["+r+"_btnUploadTheFileNow] to attach upload button event...");$("#btnCancelUploadTheFileNow").off("click").click(function(){try{}catch(n){console.log("Exception in btnCancelUploadTheFileNow.click(): "+n.message+", "+n.stack);displayAlertDialog("Exception in btnCancelUploadTheFileNow.click(): "+n.message+", "+n.stack)}});console.log(">>>>>>>>>>>>xcx999934 file name: "+i.name+", size: "+i.size);h=window.URL||window.webkitURL;c=new Image;l=h.createObjectURL(i);c.onload=function(){try{if(h.revokeObjectURL(l),this.width<50||this.height<50)$("#"+r).dialog("close"),alert("The image must be a 50px square. This image is too small.");else{var u=new FileReader;u.onload=function(n){try{$("#"+r).find("#ConfirmFileUploadDialog_ImagePreview_"+t).attr("src",n.target.result);$("#"+r).find("#ConfirmFileUploadDialog_ImagePreview_"+t).attr("style","width:400px;")}catch(n){console.log("Exception in cmdDisplayConfirmFileUploadDialog.divConfirmFileUploadDialog.open.img.onload.reader.onload(): "+n.message+", "+n.stack);displayAlertDialog("Exception in cmdDisplayConfirmFileUploadDialog.divConfirmFileUploadDialog.open.img.onload.reader.onload(): "+n.message+", "+n.stack)}};u.readAsDataURL(i)}}catch(n){console.log("Exception in cmdDisplayConfirmFileUploadDialog.divConfirmFileUploadDialog.open.img.onload(): "+n.message+", "+n.stack);displayAlertDialog("Exception in cmdDisplayConfirmFileUploadDialog.divConfirmFileUploadDialog.open.img.onload(): "+n.message+", "+n.stack)}};c.src=l}catch(f){console.log("Exception in cmdDisplayConfirmFileUploadDialog.divConfirmFileUploadDialog.open(): "+f.message+", "+f.stack);displayAlertDialog("Exception in cmdDisplayConfirmFileUploadDialog.divConfirmFileUploadDialog.open(): "+f.message+", "+f.stack)}}})):(console.log("xcx121312 There was an error attaching this file. Please try again."),displayAlertDialog("xcx121312 There was an error attaching this file. Please try again."))):alert("xcx3124 Fatal error in bwAttachments.js.cmdDisplayConfirmFileUploadDialog(). NO FILES FOR ELEMENT [inputFile_"+t+"].");$("#"+r).dialog().parents(".ui-dialog").find(".ui-dialog-titlebar").remove()}catch(o){console.log("Exception in bwAttachments.js.cmdDisplayConfirmFileUploadDialog(): "+o.message+", "+o.stack);displayAlertDialog("Exception in bwAttachments.js.cmdDisplayConfirmFileUploadDialog(): "+o.message+", "+o.stack)}},processUpload:function(n,t,i,r,u){var f,e;try{console.log("In bwAttachments.js.processUpload().");f=this;i&&i.length!=0?(console.log("In bwAttachments.js.processUpload(). filename: "+r),r.indexOf(".xml")>0?(e=new FileReader,e.onload=function(){var i=e.result;f.performUpload(i,r,n,t,u)},e.readAsText(i)):(console.log("In bwAttachments.js.processUpload(). Calling performUpload()."),f.performUpload(s,r,n,t,u))):displayAlertDialog("There was an error. Zero files returned.")}catch(o){console.log("In processUpload() catch for second attempt...: "+o.message+", "+o.stack);alert("In processUpload() catch for second attempt...: "+o.message+", "+o.stack);try{var c=new ActiveXObject("Scripting.FileSystemObject"),l=c.OpenTextFile(fileInput),s=i.ReadAll();f.performUpload(s)}catch(h){try{$("#divWorkingOnItDialog").dialog("close")}catch(o){}displayAlertDialog("Exception in processUpload(): Uploading files doesn't seem to be supported in your browser: "+h.number+": "+h.message)}}},performUpload:function(n,t,i,r,u){var w,rt;try{console.log("In bwAttachments.js.performUpload().");var s=this,ut=$(".bwAuthentication").bwAuthentication("option","largeFileUploadEnabled"),f=$(".bwAuthentication").bwAuthentication("option","workflowAppId"),p=$(".bwAuthentication").bwAuthentication("option","participantId"),b=$(".bwAuthentication").bwAuthentication("option","participantEmail"),k=$(".bwAuthentication").bwAuthentication("option","participantFriendlyName");console.log("In performUpload(). IS THIS POPULATED AND CORRECT? IF SO THIS IS THE FIX: "+r);var ft="divConfirmFileUploadDialog_ForAttachments_"+r,d=$("#"+ft).find("#txtConfirmFileUploadDialogFileDescription").val(),v=0,et="inputFile_"+r,c=$("#"+et)[0];c&&c.files&&c.files[0]&&c.files[0].size&&(v=c.files[0].size);console.log("size: "+v+", fileElement: "+c);v||(alert("xcx1234234 size: "+v),alert("fileElement: "+JSON.stringify(c)),console.log("fileElement: "+JSON.stringify(c)));console.log("In bwAttachments.js.performUpload(). workflowAppId: "+f+", bwBudgetRequestId: "+r);var ot="uploadForm_"+r,st=$("#"+ot)[0],o=new FormData(st),g=$(".bwAuthentication:first").bwAuthentication("getActiveStateIdentifier");if(o&&o.set){console.log("xcx333 formData is an object with a set function!!! <<<<<<<<<<<<<<<<< WOOP!");o.set("bwWorkflowAppId",f);o.set("bwBudgetRequestId",r);o.set("bwParticipantId",p);o.set("bwParticipantEmail",b);o.set("bwParticipantFriendlyName",k);o.set("bwActiveStateIdentifier",g);o.set("Filename",t);o.set("Description",d);o.set("ConvertToAPdf",u);var e,h,l=0,tt=0,a="stopped",it=18e5;a=setInterval(function(){l==tt?(h="The file upload has stalled for "+String(Number(it)/1e3)+" seconds. The upload has been cancelled. Unknown error. xcx21321499552",e.abort(),console.log(""),console.log(h),console.log(""),clearInterval(a),a="stopped"):(tt=l,e&&e.readyState&&e.readyState==1?(console.log(""),console.log("fileUploadTimer: "+e.readyState),console.log("")):(h="fileUploadTimerxcx2: THE FILE UPLOAD HAS STALLED WE HAVE A PROBLEM OF SOME SORT. The upload has been cancelled.",e.abort(),console.log(""),console.log(h),console.log(""),clearInterval(a),a="stopped"))},it);w=5e7;ut!=!0&&v>w?displayAlertDialog("Large file uploads are not currently enabled for this organization. This file cannot be uploaded. The limit is "+w+" bytes, and this file size is: "+v+" bytes."):(ShowActivitySpinner_FileUpload("Uploading the file..."),rt=this.options.operationUriPrefix+"_files/uploadattachment_large",$.ajax({xhr:function(){try{return e=new window.XMLHttpRequest,e.upload.addEventListener("progress",function(n){n.lengthComputable&&(l=n.loaded/n.total*100,$("#divBwActivitySpinner_FileUpload_ProgressBar").width(l+"%"),$("#divBwActivitySpinner_FileUpload_ProgressBar").html(Math.round(l)+"%"),console.log(""),console.log("progress "+Math.round(l)+"% workflowAppId: "+f+", bwBudgetRequestId: "+r),console.log(""),l==100&&ShowActivitySpinner_FileUpload("Completing the save operations..."))},!1),e.upload.addEventListener("loadstart",function(){console.log("");console.log("loadstart workflowAppId: "+f+", bwBudgetRequestId: "+r);console.log("")},!1),e.upload.addEventListener("abort",function(){console.log("");console.log("abort message: "+h+",  workflowAppId: "+f+", bwBudgetRequestId: "+r);console.log("")},!1),e.upload.addEventListener("error",function(){console.log("");console.log("error workflowAppId: "+f+", bwBudgetRequestId: "+r);console.log("");displayAlertDialog("error")},!1),e.upload.addEventListener("load",function(){console.log("");console.log("load workflowAppId: "+f+", bwBudgetRequestId: "+r);console.log("")},!1),e.upload.addEventListener("timeout",function(){console.log("");console.log("timeout workflowAppId: "+f+", bwBudgetRequestId: "+r);console.log("");displayAlertDialog("timeout")},!1),e.upload.addEventListener("loadend",function(){console.log("");console.log("loadend workflowAppId: "+f+", bwBudgetRequestId: "+r);console.log("")},!1),e}catch(n){console.log("");console.log("Exception in POST uploadattachment_large.ajax.xhr(). workflowAppId: "+f+", bwBudgetRequestId: "+r+", "+n.message+", "+n.stack);console.log("")}},type:"POST",enctype:"multipart/form-data",url:rt,data:o,processData:!1,contentType:!1,cache:!1,timeout:6e5,beforeSend:function(){$("#divBwActivitySpinner_FileUpload_ProgressBar").width("0%")},success:function(n){var h,c,e,u,l,t;try{if(console.log(""),console.log("POST success workflowAppId: "+f+", bwBudgetRequestId: "+r),console.log(""),HideActivitySpinner_FileUpload(),console.log("In bwAttachments.js.xx(). This resets the file input for uploading, so the onchange/change event fires as expected. xcx86984."),h=$("#inputFile_"+r)[0],h.files=null,$(".bwAuthentication").bwAuthentication("checkIfWeNeedToUpdateTheHomepage",r),clearInterval(a),a="stopped",n.status=="SUCCESS")displayAlertDialog_QuickNotice("The file has uploaded successfully."),console.log("Calling bwAttachments.js.populateAttachments(). xcx13124-3"),s.populateAttachments(f,r,i,!0);else if(n.status=="NO_REQUEST_SAVED"){for(console.log("xcx23235NO_REQUEST_SAVED  data.result: "+n.result),console.log("xcx2143234215 This means it must have been the first attachment uploaded for a new request. <<< IS THIS TRUE???????????????????????"),console.log(""),console.log("xcx2143234215 This means it must have been the first attachment uploaded for a new request. In this case, we will call back to the server and create the new request, so that it is not lost. Calling bwRequest.js.saveAndPublishTheRequest()."),console.log(""),console.log("8-23-2022 FIXED THIS, remove this log entry once the bwAttachments.js widget works 100%. xcx1236899 bwBudgetRequestId: "+r),e=document.getElementsByClassName("budgetrequestform"),u=0;u<e.length;u++)if(l=$(e[u])[0].getAttribute("bwbudgetrequestid"),r==l){c=$(e[u]);break}c?(alert("This saves and publishes the New Request for the first time. 5-4-2022"),$(".bwRequest").bwRequest("saveAndPublishTheRequest","divPageContent1",!0,r,bwRequestTypeId).then(function(n){if(n.status!="SUCCESS"){var t="Error in bwAttachments.js.performUpload(). xcx21345-1: "+n.status+", "+n.message;displayAlertDialog(t)}else console.log("Calling bwAttachments.js.populateAttachments(). xcx13124-4"),alert("xcx213234-12 calling populateAttachments()."),s.populateAttachments(f,r,i,!0)}).catch(function(n){console.log("Calling bwAttachments.js.populateAttachments(). xcx13124-5");alert("xcx213234-11 calling populateAttachments().");s.populateAttachments(f,r,i,!0);console.log("Exception from Promise in bwAttachments.js.performUpload(). xcx21345-2: "+JSON.stringify(n))})):displayAlertDialog("In bwAttachments.js.performUpload(). Could not find budgetrequestform with bwBudgetRequestId: "+r)}else n.status=="ERROR"?n.message.indexOf("gmError: Error: Command failed: identify-im6.q16: no decode delegate for this image format `M4A")>-1?(t="The file has uploaded successfully. It will be converted and available as a .mp3 file shortly.",displayAlertDialog(t),console.log("Calling bwAttachments.js.populateAttachments(). xcx13124-6"),alert("xcx213234-10 calling populateAttachments()."),s.populateAttachments(f,r,i,!0)):(t=n.status+" in bwAttachments.js.performUpload() xcx02856-1: "+n.message,console.log(t),displayAlertDialog(t)):n.status=="EXCEPTION"?(t=n.status+" in bwAttachments.js.performUpload() xcx02856-2: "+n.message,console.log(t),displayAlertDialog(t)):(alert("xcx2131234 Unexpected response. data: "+JSON.stringify(n)),displayAlertDialog(n.message))}catch(o){console.log("Exception in bwAttachments.js.performUpload():xcx33: "+o.message+", "+o.stack);alert("Exception in bwAttachments.js.performUpload():xcx33: "+o.message+", "+o.stack)}},error:function(n){HideActivitySpinner();h&&h!=""?(console.log(""),console.log("POST error. xcx1242525 Intentional abort: "+h),console.log(""),displayAlertDialog("POST error. xcx1242525 Intentional abort: "+h+", workflowAppId: "+f+", bwBudgetRequestId: "+r)):(console.log(""),console.log("POST error. Unexpected error: "+JSON.stringify(n)),console.log(""),displayAlertDialog("POST unexpected error. xcx1242525-2 workflowAppId: "+f+", bwBudgetRequestId: "+r+", Unexpected error: "+JSON.stringify(n)))}}))}else{ShowActivitySpinner_FileUpload("Uploading the file...");var ht=document.getElementById("inputFile_"+r),ct=ht.files[0],nt=new FileReader;nt.onload=function(n){var o,h,a;try{var c="",v=n.target.result,l=new Uint8Array(v);for(o=0;o<l.byteLength;o++)c+=String.fromCharCode(l[o]);h=[];h={bwParticipantId_LoggedIn:p,bwActiveStateIdentifier:g,bwWorkflowAppId_LoggedIn:f,bwWorkflowAppId:f,bwBudgetRequestId:r,Filename:t,FileContent:c,Description:d,ConvertToAPdf:u,bwParticipantId:p,bwParticipantEmail:b,bwParticipantFriendlyName:k};a=s.options.operationUriPrefix+"_files/uploadattachment";$.ajax({url:a,type:"PUT",data:h,headers:{Accept:"application/json; odata=verbose"},timeout:6e4,success:function(n){var h,c,o,e,l,t;try{if(console.log(""),console.log("POST success workflowAppId: "+f+", bwBudgetRequestId: "+r),console.log(""),HideActivitySpinner_FileUpload(),console.log("In bwAttachments.js.xx(). This resets the file input for uploading, so the onchange/change event fires as expected. xcx86984."),h=$("#inputFile_"+r)[0],h.files=null,$(".bwAuthentication").bwAuthentication("checkIfWeNeedToUpdateTheHomepage",r),n.status=="SUCCESS")displayAlertDialog_QuickNotice("The file has uploaded successfully."),console.log("Calling bwAttachments.js.populateAttachments(). xcx13124-3"),alert("xcx213234-17 calling populateAttachments()."),s.populateAttachments(f,r,i,!0);else if(n.status=="NO_REQUEST_SAVED"){for(console.log("xcx23235NO_REQUEST_SAVED  data.result: "+n.result),console.log("xcx2143234215 This means it must have been the first attachment uploaded for a new request. <<< IS THIS TRUE???????????????????????"),console.log(""),console.log("xcx2143234215 This means it must have been the first attachment uploaded for a new request. In this case, we will call back to the server and create the new request, so that it is not lost. Calling bwRequest.js.saveAndPublishTheRequest()."),console.log(""),console.log("8-23-2022 FIXED THIS, remove this log entry once the bwAttachments.js widget works 100%. xcx1236899 bwBudgetRequestId: "+r),o=document.getElementsByClassName("budgetrequestform"),e=0;e<o.length;e++)if(l=$(o[e])[0].getAttribute("bwbudgetrequestid"),r==l){c=$(o[e]);break}c?$(".bwRequest").bwRequest("saveAndPublishTheRequest","divPageContent1",!0,r,bwRequestTypeId).then(function(n){if(n.status!="SUCCESS"){var t="Error in bwAttachments.js.performUpload(). xcx21345-1: "+n.status+", "+n.message;displayAlertDialog(t)}else console.log("Calling bwAttachments.js.populateAttachments(). xcx13124-4"),alert("xcx213234-16 calling populateAttachments()."),s.populateAttachments(f,r,i,!0)}).catch(function(n){console.log("Calling bwAttachments.js.populateAttachments(). xcx13124-5");alert("xcx213234-15 calling populateAttachments().");s.populateAttachments(f,r,i,!0);console.log("Exception from Promise in bwAttachments.js.performUpload(). xcx21345-2: "+JSON.stringify(n))}):displayAlertDialog("In bwAttachments.js.performUpload(). Could not find budgetrequestform with bwBudgetRequestId: "+r)}else n.status=="ERROR"?n.message.indexOf("gmError: Error: Command failed: identify-im6.q16: no decode delegate for this image format `M4A")>-1?(t="The file has uploaded successfully. It will be converted and available as a .mp3 file shortly.",displayAlertDialog(t),console.log("Calling bwAttachments.js.populateAttachments(). xcx13124-6"),alert("xcx213234-14 calling populateAttachments()."),s.populateAttachments(f,r,i,!0)):(t=n.status+" in bwAttachments.js.performUpload() xcx02856-1: "+n.message,console.log(t),displayAlertDialog(t)):n.status=="EXCEPTION"?(t=n.status+" in bwAttachments.js.performUpload() xcx02856-2: "+n.message,console.log(t),displayAlertDialog(t)):(alert("xcx2131234 Unexpected response. data: "+JSON.stringify(n)),displayAlertDialog(n.message))}catch(u){console.log("Exception in performUpload():2: "+u.message+", "+u.stack);displayAlertDialog("Exception in performUpload():2: "+u.message+", "+u.stack);$(this.element).find("#newrequestattachments")[0].innerHTML="Exception in bwAttachments.performUpload:2: "+u.message+", "+u.stack}},error:function(n,t,i){$("#divWorkingOnItDialog").dialog("close");console.log("Error in performUpload(): "+i);i=="timeout"?displayAlertDialog("The file server could not be contacted. Please try again in a few minutes."):displayAlertDialog("Error in performUpload(): "+i)}})}catch(e){console.log("Exception in performUpload():2:xcx3243246 "+e.message+", "+e.stack);displayAlertDialog("Exception in performUpload():2:xcx3243246 "+e.message+", "+e.stack);$(this.element).find("#newrequestattachments")[0].innerHTML="Exception in bwAttachments.performUpload:2: "+e.message+", "+e.stack}};nt.readAsArrayBuffer(ct)}}catch(y){console.log("Exception in bwAttachments.js.performUpload(): "+y.message+", "+y.stack);displayAlertDialog("Exception in bwAttachments.js.performUpload(): "+y.message+", "+y.stack);$(this.element).find("#newrequestattachments")[0].innerHTML="Exception in bwAttachments.performUpload: "+y.message+", "+y.stack}},populateAttachments:function(n,t,i,r){var l,h,e,c,f,u;try{if(console.log("In bwAttachments.js.populateAttachments(). bwBudgetRequestId: "+t),l=this,t){for(e=$(".budgetrequestform"),f=0;f<e.length;f++)e[f].getAttribute("bwbudgetrequestid")==t&&(console.log("In bwAttachments.js.populateAttachments(). FOUND THE FORM"),c=e[f]);if(c)if(u=$(c).find(".bwAttachments")[0],u){console.log("In bwAttachments.js.populateAttachments(). workflowAppId: "+o+", bwBudgetRequestId: "+t+", attachmentsTagId: "+i+", showRemoveAttachmentButton: "+r+").");var o=$(".bwAuthentication").bwAuthentication("option","workflowAppId"),a=$(".bwAuthentication").bwAuthentication("option","participantId"),v=$(".bwAuthentication:first").bwAuthentication("getActiveStateIdentifier"),y={bwParticipantId_LoggedIn:a,bwActiveStateIdentifier:v,bwWorkflowAppId_LoggedIn:o,bwWorkflowAppId:o,bwBudgetRequestId:t},p=globalUrlPrefix+globalUrlForWebServices+"/_files/getlistofattachmentsforbudgetrequest";$.ajax({url:p,type:"POST",data:y,timeout:15e3,headers:{Accept:"application/json; odata=verbose"},success:function(n){try{var r=$(".bwCoreComponent:first").bwCoreComponent("createHtmlToDisplayTheListOfAttachments_ForBwAttachmentsWidget",l.options.elementIdSuffix,o,t,n);$(u).find("#newrequestattachments")[0].innerHTML="";$(u).find("#newrequestattachments").append(r)}catch(i){$(u).find("#newrequestattachments")[0].innerHTML='<span style="color:tomato;">Exception in bwAttachments.populateAttachments:1: '+i.message+", "+i.stack+"<\/span>";i.number&&(console.log("Exception in bwAttachments.js.populateAttachments():1: "+i.message+", "+i.stack),displayAlertDialog("Exception in bwAttachments.js.populateAttachments():1: "+i.message+", "+i.stack))}},error:function(n,t,i){if(t==="timeout"&&i==="timeout")displayAlertDialog("In bwAttachments.js.populateAttachments(). SERVICE UNAVAILABLE. File services is not responding. communication timeout is set at "+ajaxTimeout/1e3+" seconds: "+t+", "+i),$(u).find("#newrequestattachments")[0].innerHTML='<span style="color:tomato;">File services is not responding. communication timeout is set at '+ajaxTimeout/1e3+" seconds: "+t+", "+i+"<\/span>";else{var r="Error in bwAttachments.js.populateAttachments(): "+i+".";console.log(r+" xcx123123 data: "+JSON.stringify(n));$(u).find("#newrequestattachments")[0].innerHTML='<span style="color:tomato;">'+r+"<\/span>"}}})}else console.log("Error in bwAttachments.js.populateAttachments(). Could not locate the bwAttachment widget. xcx32425263. bwBudgetRequestId: "+t),displayAlertDialog("Error in bwAttachments.js.populateAttachments(). Could not locate the bwAttachment widget. xcx32425263. bwBudgetRequestId: "+t);else console.log("Error in bwAttachments.js.populateAttachments(). NO FORM FOUND for bwBudgetRequestId: "+t),displayAlertDialog("Error in bwAttachments.js.populateAttachments(). NO FORM FOUND for bwBudgetRequestId: "+t)}else h="Error in bwAttachments.js.populateAttachments. Unexpected value for bwBudgetRequestId: "+t,console.log(h),displayAlertDialog(h)}catch(s){console.log("Exception in bwAttachments.js.populateAttachments: "+s.message+", "+s.stack);displayAlertDialog("Exception in bwAttachments.js.populateAttachments: "+s.message+", "+s.stack)}},cmdSaveAttachmentMetadata:function(n,t){try{console.log("In bwAttachments.js.cmdSaveAttachmentMetadata().");var u=this,f=document.getElementById("txtAttachmentsDialog1Filename").value+document.getElementById("spanAttachmentsDialog1FileExtension").innerHTML,e=document.getElementById("txtAttachmentsDialog1FileDescription").value.replace(/["']/g,""),i=$(".bwAuthentication").bwAuthentication("option","workflowAppId"),o=$(".bwAuthentication").bwAuthentication("option","participantId"),s=$(".bwAuthentication:first").bwAuthentication("getActiveStateIdentifier"),h={bwParticipantId_LoggedIn:o,bwActiveStateIdentifier:s,bwWorkflowAppId_LoggedIn:i,bwWorkflowAppId:i,bwBudgetRequestId:n,OriginalFilename:t,NewFilename:f,Description:e},c=globalUrlPrefix+globalUrlForWebServices+"/_files",l=c+"/saveattachmentmetadata";$.ajax({url:l,type:"POST",data:h,headers:{Accept:"application/json; odata=verbose"},success:function(t){try{if(t.status!="SUCCESS")displayAlertDialog("Failed to update metadata: "+t.status+", "+t.message);else{try{$("#AttachmentsDialog1").dialog("close")}catch(r){}document.getElementById("attachmentsInXslForm")?(console.log("Calling bwAttachments.js.populateAttachments(). xcx13124-7"),alert("xcx213234-4 calling populateAttachments()."),u.populateAttachments(i,n,"attachmentsInXslForm",!0)):(console.log("Calling bwAttachments.js.populateAttachments(). xcx13124-8"),alert("xcx213234-5 calling populateAttachments()."),u.populateAttachments(i,n,"newrequestattachments",!0))}}catch(r){console.log("Exception in bwAttachments.js.cmdSaveAttachmentMetadata(): "+r.message+", "+r.stack);displayAlertDialog("Exception in bwAttachments.js.cmdSaveAttachmentMetadata(): "+r.message+", "+r.stack)}},error:function(n,t,i){$("#AttachmentsDialog1").dialog("close");displayAlertDialog("Error in bwAttachments.js.cmdSaveAttachmentMetadata().saveattachmentmetadata: "+n+", "+i)}})}catch(r){console.log("Exception in bwAttachments.js.cmdSaveAttachmentMetadata():2: "+r.message+", "+r.stack);displayAlertDialog("Exception in bwAttachments.js.cmdSaveAttachmentMetadata():2: "+r.message+", "+r.stack)}},cmdDeleteAttachment:function(n,t){try{console.log("In bwAttachments.js.cmdDeleteAttachment("+n+", "+t+").");var i=this,r=$(".bwAuthentication").bwAuthentication("option","workflowAppId");$("#divDeleteAnAttachmentOfflineDialog").dialog({modal:!0,resizable:!1,closeText:"Cancel",closeOnEscape:!0,width:"1000",dialogClass:"no-close",hide:!1,open:function(){$(".ui-widget-overlay").bind("click",function(){$("#divDeleteAnAttachmentOfflineDialog").dialog("close")})}});$("#divDeleteAnAttachmentOfflineDialog").dialog().parents(".ui-dialog").find(".ui-dialog-titlebar").remove();document.getElementById("spanDeleteAnAttachmentOfflineDialogTitle").innerHTML="Delete "+t;$("#divDeleteAnAttachmentOfflineDialogDeleteRequestButton").off("click").click(function(){try{console.log("In bwAttachments.js.cmdDeleteAttachment.divDeleteAnAttachmentOfflineDialogDeleteRequestButton.click(). bwBudgetRequestId: "+n+", filename: "+t);var r=$(".bwAuthentication").bwAuthentication("option","workflowAppId"),u=$(".bwAuthentication").bwAuthentication("option","participantId"),f=$(".bwAuthentication:first").bwAuthentication("getActiveStateIdentifier"),o={bwParticipantId_LoggedIn:u,bwActiveStateIdentifier:f,bwWorkflowAppId_LoggedIn:r,bwBudgetRequestId:n,Filename:t},s=globalUrlPrefix+globalUrlForWebServices+"/_files",h=s+"/removeattachment";$.ajax({url:h,type:"POST",data:o,headers:{Accept:"application/json; odata=verbose"},success:function(t){try{if($("#divDeleteAnAttachmentOfflineDialog").dialog("close"),JSON.stringify(t).toUpperCase().indexOf("THE FILE WAS DELETED")>-1){try{$("#AttachmentsDialog1").dialog("close");$(".bwAuthentication").bwAuthentication("checkIfWeNeedToUpdateTheHomepage",n)}catch(u){}console.log("Calling bwAttachments.js.populateAttachments(). xcx13124-9");console.log("xcx213234-6 calling populateAttachments().");i.populateAttachments(r,n,"attachmentsInXslForm",!0)}else{console.log("There was an error deleting the file: "+JSON.stringify(t));try{$("#AttachmentsDialog1").dialog("close")}catch(u){}console.log("Calling bwAttachments.js.populateAttachments(). xcx13124-10");alert("xcx213234-7 calling populateAttachments().");i.populateAttachments(r,n,"attachmentsInXslForm",!0)}}catch(u){console.log("Exception in bwAttachments.js.cmdDeleteAttachment.post.removeattachment.success(): "+u.message+", "+u.stack);displayAlertDialog("Exception in bwAttachments.js.cmdDeleteAttachment.post.removeattachment.success(): "+u.message+", "+u.stack)}},error:function(i,r,u){console.log("Error in bwAttachments.js.cmdDeleteAttachment.post.removeattachment.error(): "+e.message+", "+e.stack);displayAlertDialog("Error in bwAttachments.js.cmdDeleteAttachment.post.removeattachment.error(): bwBudgetRequestId: "+n+", filename: "+t+", errorMessage: "+u)}})}catch(e){console.log("Exception in bwAttachments.js.cmdDeleteAttachment.deletebutton.click(): "+e.message+", "+e.stack);displayAlertDialog("Exception in bwAttachments.js.cmdDeleteAttachment.deletebutton.click(): "+e.message+", "+e.stack)}})}catch(e){console.log("Exception in bwAttachments.js.cmdDeleteAttachment():2: "+e.message+", "+e.stack);displayAlertDialog("Exception in bwAttachments.js.cmdDeleteAttachment():2: "+e.message+", "+e.stack)}}});
//# sourceMappingURL=bwAttachments.min.js.map
